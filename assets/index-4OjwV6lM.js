(function(){const y=document.createElement("link").relList;if(y&&y.supports&&y.supports("modulepreload"))return;for(const P of document.querySelectorAll('link[rel="modulepreload"]'))C(P);new MutationObserver(P=>{for(const D of P)if(D.type==="childList")for(const E of D.addedNodes)E.tagName==="LINK"&&E.rel==="modulepreload"&&C(E)}).observe(document,{childList:!0,subtree:!0});function w(P){const D={};return P.integrity&&(D.integrity=P.integrity),P.referrerPolicy&&(D.referrerPolicy=P.referrerPolicy),P.crossOrigin==="use-credentials"?D.credentials="include":P.crossOrigin==="anonymous"?D.credentials="omit":D.credentials="same-origin",D}function C(P){if(P.ep)return;P.ep=!0;const D=w(P);fetch(P.href,D)}})();function F_(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var mg={exports:{}},yp={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var t_;function Py(){if(t_)return yp;t_=1;var u=Symbol.for("react.transitional.element"),y=Symbol.for("react.fragment");function w(C,P,D){var E=null;if(D!==void 0&&(E=""+D),P.key!==void 0&&(E=""+P.key),"key"in P){D={};for(var o in P)o!=="key"&&(D[o]=P[o])}else D=P;return P=D.ref,{$$typeof:u,type:C,key:E,ref:P!==void 0?P:null,props:D}}return yp.Fragment=y,yp.jsx=w,yp.jsxs=w,yp}var i_;function zy(){return i_||(i_=1,mg.exports=Py()),mg.exports}var Re=zy(),gg={exports:{}},vp={},_g={exports:{}},yg={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var a_;function Iy(){return a_||(a_=1,(function(u){function y(He,at){var At=He.length;He.push(at);e:for(;0<At;){var ft=At-1>>>1,Kt=He[ft];if(0<P(Kt,at))He[ft]=at,He[At]=Kt,At=ft;else break e}}function w(He){return He.length===0?null:He[0]}function C(He){if(He.length===0)return null;var at=He[0],At=He.pop();if(At!==at){He[0]=At;e:for(var ft=0,Kt=He.length,pe=Kt>>>1;ft<pe;){var Ue=2*(ft+1)-1,We=He[Ue],Mt=Ue+1,Lt=He[Mt];if(0>P(We,At))Mt<Kt&&0>P(Lt,We)?(He[ft]=Lt,He[Mt]=At,ft=Mt):(He[ft]=We,He[Ue]=At,ft=Ue);else if(Mt<Kt&&0>P(Lt,At))He[ft]=Lt,He[Mt]=At,ft=Mt;else break e}}return at}function P(He,at){var At=He.sortIndex-at.sortIndex;return At!==0?At:He.id-at.id}if(u.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var D=performance;u.unstable_now=function(){return D.now()}}else{var E=Date,o=E.now();u.unstable_now=function(){return E.now()-o}}var B=[],j=[],J=1,K=null,W=3,ee=!1,we=!1,Oe=!1,Ae=!1,Ze=typeof setTimeout=="function"?setTimeout:null,Be=typeof clearTimeout=="function"?clearTimeout:null,Ke=typeof setImmediate<"u"?setImmediate:null;function vt(He){for(var at=w(j);at!==null;){if(at.callback===null)C(j);else if(at.startTime<=He)C(j),at.sortIndex=at.expirationTime,y(B,at);else break;at=w(j)}}function Et(He){if(Oe=!1,vt(He),!we)if(w(B)!==null)we=!0,xt||(xt=!0,gt());else{var at=w(j);at!==null&&Xi(Et,at.startTime-He)}}var xt=!1,lt=-1,xe=5,Se=-1;function Ye(){return Ae?!0:!(u.unstable_now()-Se<xe)}function mt(){if(Ae=!1,xt){var He=u.unstable_now();Se=He;var at=!0;try{e:{we=!1,Oe&&(Oe=!1,Be(lt),lt=-1),ee=!0;var At=W;try{t:{for(vt(He),K=w(B);K!==null&&!(K.expirationTime>He&&Ye());){var ft=K.callback;if(typeof ft=="function"){K.callback=null,W=K.priorityLevel;var Kt=ft(K.expirationTime<=He);if(He=u.unstable_now(),typeof Kt=="function"){K.callback=Kt,vt(He),at=!0;break t}K===w(B)&&C(B),vt(He)}else C(B);K=w(B)}if(K!==null)at=!0;else{var pe=w(j);pe!==null&&Xi(Et,pe.startTime-He),at=!1}}break e}finally{K=null,W=At,ee=!1}at=void 0}}finally{at?gt():xt=!1}}}var gt;if(typeof Ke=="function")gt=function(){Ke(mt)};else if(typeof MessageChannel<"u"){var Gt=new MessageChannel,Oi=Gt.port2;Gt.port1.onmessage=mt,gt=function(){Oi.postMessage(null)}}else gt=function(){Ze(mt,0)};function Xi(He,at){lt=Ze(function(){He(u.unstable_now())},at)}u.unstable_IdlePriority=5,u.unstable_ImmediatePriority=1,u.unstable_LowPriority=4,u.unstable_NormalPriority=3,u.unstable_Profiling=null,u.unstable_UserBlockingPriority=2,u.unstable_cancelCallback=function(He){He.callback=null},u.unstable_forceFrameRate=function(He){0>He||125<He?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):xe=0<He?Math.floor(1e3/He):5},u.unstable_getCurrentPriorityLevel=function(){return W},u.unstable_next=function(He){switch(W){case 1:case 2:case 3:var at=3;break;default:at=W}var At=W;W=at;try{return He()}finally{W=At}},u.unstable_requestPaint=function(){Ae=!0},u.unstable_runWithPriority=function(He,at){switch(He){case 1:case 2:case 3:case 4:case 5:break;default:He=3}var At=W;W=He;try{return at()}finally{W=At}},u.unstable_scheduleCallback=function(He,at,At){var ft=u.unstable_now();switch(typeof At=="object"&&At!==null?(At=At.delay,At=typeof At=="number"&&0<At?ft+At:ft):At=ft,He){case 1:var Kt=-1;break;case 2:Kt=250;break;case 5:Kt=1073741823;break;case 4:Kt=1e4;break;default:Kt=5e3}return Kt=At+Kt,He={id:J++,callback:at,priorityLevel:He,startTime:At,expirationTime:Kt,sortIndex:-1},At>ft?(He.sortIndex=At,y(j,He),w(B)===null&&He===w(j)&&(Oe?(Be(lt),lt=-1):Oe=!0,Xi(Et,At-ft))):(He.sortIndex=Kt,y(B,He),we||ee||(we=!0,xt||(xt=!0,gt()))),He},u.unstable_shouldYield=Ye,u.unstable_wrapCallback=function(He){var at=W;return function(){var At=W;W=at;try{return He.apply(this,arguments)}finally{W=At}}}})(yg)),yg}var n_;function Ry(){return n_||(n_=1,_g.exports=Iy()),_g.exports}var vg={exports:{}},wi={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r_;function Dy(){if(r_)return wi;r_=1;var u=Symbol.for("react.transitional.element"),y=Symbol.for("react.portal"),w=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),P=Symbol.for("react.profiler"),D=Symbol.for("react.consumer"),E=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),B=Symbol.for("react.suspense"),j=Symbol.for("react.memo"),J=Symbol.for("react.lazy"),K=Symbol.for("react.activity"),W=Symbol.iterator;function ee(pe){return pe===null||typeof pe!="object"?null:(pe=W&&pe[W]||pe["@@iterator"],typeof pe=="function"?pe:null)}var we={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Oe=Object.assign,Ae={};function Ze(pe,Ue,We){this.props=pe,this.context=Ue,this.refs=Ae,this.updater=We||we}Ze.prototype.isReactComponent={},Ze.prototype.setState=function(pe,Ue){if(typeof pe!="object"&&typeof pe!="function"&&pe!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,pe,Ue,"setState")},Ze.prototype.forceUpdate=function(pe){this.updater.enqueueForceUpdate(this,pe,"forceUpdate")};function Be(){}Be.prototype=Ze.prototype;function Ke(pe,Ue,We){this.props=pe,this.context=Ue,this.refs=Ae,this.updater=We||we}var vt=Ke.prototype=new Be;vt.constructor=Ke,Oe(vt,Ze.prototype),vt.isPureReactComponent=!0;var Et=Array.isArray;function xt(){}var lt={H:null,A:null,T:null,S:null},xe=Object.prototype.hasOwnProperty;function Se(pe,Ue,We){var Mt=We.ref;return{$$typeof:u,type:pe,key:Ue,ref:Mt!==void 0?Mt:null,props:We}}function Ye(pe,Ue){return Se(pe.type,Ue,pe.props)}function mt(pe){return typeof pe=="object"&&pe!==null&&pe.$$typeof===u}function gt(pe){var Ue={"=":"=0",":":"=2"};return"$"+pe.replace(/[=:]/g,function(We){return Ue[We]})}var Gt=/\/+/g;function Oi(pe,Ue){return typeof pe=="object"&&pe!==null&&pe.key!=null?gt(""+pe.key):Ue.toString(36)}function Xi(pe){switch(pe.status){case"fulfilled":return pe.value;case"rejected":throw pe.reason;default:switch(typeof pe.status=="string"?pe.then(xt,xt):(pe.status="pending",pe.then(function(Ue){pe.status==="pending"&&(pe.status="fulfilled",pe.value=Ue)},function(Ue){pe.status==="pending"&&(pe.status="rejected",pe.reason=Ue)})),pe.status){case"fulfilled":return pe.value;case"rejected":throw pe.reason}}throw pe}function He(pe,Ue,We,Mt,Lt){var Ot=typeof pe;(Ot==="undefined"||Ot==="boolean")&&(pe=null);var ai=!1;if(pe===null)ai=!0;else switch(Ot){case"bigint":case"string":case"number":ai=!0;break;case"object":switch(pe.$$typeof){case u:case y:ai=!0;break;case J:return ai=pe._init,He(ai(pe._payload),Ue,We,Mt,Lt)}}if(ai)return Lt=Lt(pe),ai=Mt===""?"."+Oi(pe,0):Mt,Et(Lt)?(We="",ai!=null&&(We=ai.replace(Gt,"$&/")+"/"),He(Lt,Ue,We,"",function(Ni){return Ni})):Lt!=null&&(mt(Lt)&&(Lt=Ye(Lt,We+(Lt.key==null||pe&&pe.key===Lt.key?"":(""+Lt.key).replace(Gt,"$&/")+"/")+ai)),Ue.push(Lt)),1;ai=0;var Ut=Mt===""?".":Mt+":";if(Et(pe))for(var jt=0;jt<pe.length;jt++)Mt=pe[jt],Ot=Ut+Oi(Mt,jt),ai+=He(Mt,Ue,We,Ot,Lt);else if(jt=ee(pe),typeof jt=="function")for(pe=jt.call(pe),jt=0;!(Mt=pe.next()).done;)Mt=Mt.value,Ot=Ut+Oi(Mt,jt++),ai+=He(Mt,Ue,We,Ot,Lt);else if(Ot==="object"){if(typeof pe.then=="function")return He(Xi(pe),Ue,We,Mt,Lt);throw Ue=String(pe),Error("Objects are not valid as a React child (found: "+(Ue==="[object Object]"?"object with keys {"+Object.keys(pe).join(", ")+"}":Ue)+"). If you meant to render a collection of children, use an array instead.")}return ai}function at(pe,Ue,We){if(pe==null)return pe;var Mt=[],Lt=0;return He(pe,Mt,"","",function(Ot){return Ue.call(We,Ot,Lt++)}),Mt}function At(pe){if(pe._status===-1){var Ue=pe._result;Ue=Ue(),Ue.then(function(We){(pe._status===0||pe._status===-1)&&(pe._status=1,pe._result=We)},function(We){(pe._status===0||pe._status===-1)&&(pe._status=2,pe._result=We)}),pe._status===-1&&(pe._status=0,pe._result=Ue)}if(pe._status===1)return pe._result.default;throw pe._result}var ft=typeof reportError=="function"?reportError:function(pe){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Ue=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof pe=="object"&&pe!==null&&typeof pe.message=="string"?String(pe.message):String(pe),error:pe});if(!window.dispatchEvent(Ue))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",pe);return}console.error(pe)},Kt={map:at,forEach:function(pe,Ue,We){at(pe,function(){Ue.apply(this,arguments)},We)},count:function(pe){var Ue=0;return at(pe,function(){Ue++}),Ue},toArray:function(pe){return at(pe,function(Ue){return Ue})||[]},only:function(pe){if(!mt(pe))throw Error("React.Children.only expected to receive a single React element child.");return pe}};return wi.Activity=K,wi.Children=Kt,wi.Component=Ze,wi.Fragment=w,wi.Profiler=P,wi.PureComponent=Ke,wi.StrictMode=C,wi.Suspense=B,wi.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=lt,wi.__COMPILER_RUNTIME={__proto__:null,c:function(pe){return lt.H.useMemoCache(pe)}},wi.cache=function(pe){return function(){return pe.apply(null,arguments)}},wi.cacheSignal=function(){return null},wi.cloneElement=function(pe,Ue,We){if(pe==null)throw Error("The argument must be a React element, but you passed "+pe+".");var Mt=Oe({},pe.props),Lt=pe.key;if(Ue!=null)for(Ot in Ue.key!==void 0&&(Lt=""+Ue.key),Ue)!xe.call(Ue,Ot)||Ot==="key"||Ot==="__self"||Ot==="__source"||Ot==="ref"&&Ue.ref===void 0||(Mt[Ot]=Ue[Ot]);var Ot=arguments.length-2;if(Ot===1)Mt.children=We;else if(1<Ot){for(var ai=Array(Ot),Ut=0;Ut<Ot;Ut++)ai[Ut]=arguments[Ut+2];Mt.children=ai}return Se(pe.type,Lt,Mt)},wi.createContext=function(pe){return pe={$$typeof:E,_currentValue:pe,_currentValue2:pe,_threadCount:0,Provider:null,Consumer:null},pe.Provider=pe,pe.Consumer={$$typeof:D,_context:pe},pe},wi.createElement=function(pe,Ue,We){var Mt,Lt={},Ot=null;if(Ue!=null)for(Mt in Ue.key!==void 0&&(Ot=""+Ue.key),Ue)xe.call(Ue,Mt)&&Mt!=="key"&&Mt!=="__self"&&Mt!=="__source"&&(Lt[Mt]=Ue[Mt]);var ai=arguments.length-2;if(ai===1)Lt.children=We;else if(1<ai){for(var Ut=Array(ai),jt=0;jt<ai;jt++)Ut[jt]=arguments[jt+2];Lt.children=Ut}if(pe&&pe.defaultProps)for(Mt in ai=pe.defaultProps,ai)Lt[Mt]===void 0&&(Lt[Mt]=ai[Mt]);return Se(pe,Ot,Lt)},wi.createRef=function(){return{current:null}},wi.forwardRef=function(pe){return{$$typeof:o,render:pe}},wi.isValidElement=mt,wi.lazy=function(pe){return{$$typeof:J,_payload:{_status:-1,_result:pe},_init:At}},wi.memo=function(pe,Ue){return{$$typeof:j,type:pe,compare:Ue===void 0?null:Ue}},wi.startTransition=function(pe){var Ue=lt.T,We={};lt.T=We;try{var Mt=pe(),Lt=lt.S;Lt!==null&&Lt(We,Mt),typeof Mt=="object"&&Mt!==null&&typeof Mt.then=="function"&&Mt.then(xt,ft)}catch(Ot){ft(Ot)}finally{Ue!==null&&We.types!==null&&(Ue.types=We.types),lt.T=Ue}},wi.unstable_useCacheRefresh=function(){return lt.H.useCacheRefresh()},wi.use=function(pe){return lt.H.use(pe)},wi.useActionState=function(pe,Ue,We){return lt.H.useActionState(pe,Ue,We)},wi.useCallback=function(pe,Ue){return lt.H.useCallback(pe,Ue)},wi.useContext=function(pe){return lt.H.useContext(pe)},wi.useDebugValue=function(){},wi.useDeferredValue=function(pe,Ue){return lt.H.useDeferredValue(pe,Ue)},wi.useEffect=function(pe,Ue){return lt.H.useEffect(pe,Ue)},wi.useEffectEvent=function(pe){return lt.H.useEffectEvent(pe)},wi.useId=function(){return lt.H.useId()},wi.useImperativeHandle=function(pe,Ue,We){return lt.H.useImperativeHandle(pe,Ue,We)},wi.useInsertionEffect=function(pe,Ue){return lt.H.useInsertionEffect(pe,Ue)},wi.useLayoutEffect=function(pe,Ue){return lt.H.useLayoutEffect(pe,Ue)},wi.useMemo=function(pe,Ue){return lt.H.useMemo(pe,Ue)},wi.useOptimistic=function(pe,Ue){return lt.H.useOptimistic(pe,Ue)},wi.useReducer=function(pe,Ue,We){return lt.H.useReducer(pe,Ue,We)},wi.useRef=function(pe){return lt.H.useRef(pe)},wi.useState=function(pe){return lt.H.useState(pe)},wi.useSyncExternalStore=function(pe,Ue,We){return lt.H.useSyncExternalStore(pe,Ue,We)},wi.useTransition=function(){return lt.H.useTransition()},wi.version="19.2.0",wi}var s_;function Bg(){return s_||(s_=1,vg.exports=Dy()),vg.exports}var xg={exports:{}},jr={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var o_;function ky(){if(o_)return jr;o_=1;var u=Bg();function y(B){var j="https://react.dev/errors/"+B;if(1<arguments.length){j+="?args[]="+encodeURIComponent(arguments[1]);for(var J=2;J<arguments.length;J++)j+="&args[]="+encodeURIComponent(arguments[J])}return"Minified React error #"+B+"; visit "+j+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function w(){}var C={d:{f:w,r:function(){throw Error(y(522))},D:w,C:w,L:w,m:w,X:w,S:w,M:w},p:0,findDOMNode:null},P=Symbol.for("react.portal");function D(B,j,J){var K=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:P,key:K==null?null:""+K,children:B,containerInfo:j,implementation:J}}var E=u.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function o(B,j){if(B==="font")return"";if(typeof j=="string")return j==="use-credentials"?j:""}return jr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=C,jr.createPortal=function(B,j){var J=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!j||j.nodeType!==1&&j.nodeType!==9&&j.nodeType!==11)throw Error(y(299));return D(B,j,null,J)},jr.flushSync=function(B){var j=E.T,J=C.p;try{if(E.T=null,C.p=2,B)return B()}finally{E.T=j,C.p=J,C.d.f()}},jr.preconnect=function(B,j){typeof B=="string"&&(j?(j=j.crossOrigin,j=typeof j=="string"?j==="use-credentials"?j:"":void 0):j=null,C.d.C(B,j))},jr.prefetchDNS=function(B){typeof B=="string"&&C.d.D(B)},jr.preinit=function(B,j){if(typeof B=="string"&&j&&typeof j.as=="string"){var J=j.as,K=o(J,j.crossOrigin),W=typeof j.integrity=="string"?j.integrity:void 0,ee=typeof j.fetchPriority=="string"?j.fetchPriority:void 0;J==="style"?C.d.S(B,typeof j.precedence=="string"?j.precedence:void 0,{crossOrigin:K,integrity:W,fetchPriority:ee}):J==="script"&&C.d.X(B,{crossOrigin:K,integrity:W,fetchPriority:ee,nonce:typeof j.nonce=="string"?j.nonce:void 0})}},jr.preinitModule=function(B,j){if(typeof B=="string")if(typeof j=="object"&&j!==null){if(j.as==null||j.as==="script"){var J=o(j.as,j.crossOrigin);C.d.M(B,{crossOrigin:J,integrity:typeof j.integrity=="string"?j.integrity:void 0,nonce:typeof j.nonce=="string"?j.nonce:void 0})}}else j==null&&C.d.M(B)},jr.preload=function(B,j){if(typeof B=="string"&&typeof j=="object"&&j!==null&&typeof j.as=="string"){var J=j.as,K=o(J,j.crossOrigin);C.d.L(B,J,{crossOrigin:K,integrity:typeof j.integrity=="string"?j.integrity:void 0,nonce:typeof j.nonce=="string"?j.nonce:void 0,type:typeof j.type=="string"?j.type:void 0,fetchPriority:typeof j.fetchPriority=="string"?j.fetchPriority:void 0,referrerPolicy:typeof j.referrerPolicy=="string"?j.referrerPolicy:void 0,imageSrcSet:typeof j.imageSrcSet=="string"?j.imageSrcSet:void 0,imageSizes:typeof j.imageSizes=="string"?j.imageSizes:void 0,media:typeof j.media=="string"?j.media:void 0})}},jr.preloadModule=function(B,j){if(typeof B=="string")if(j){var J=o(j.as,j.crossOrigin);C.d.m(B,{as:typeof j.as=="string"&&j.as!=="script"?j.as:void 0,crossOrigin:J,integrity:typeof j.integrity=="string"?j.integrity:void 0})}else C.d.m(B)},jr.requestFormReset=function(B){C.d.r(B)},jr.unstable_batchedUpdates=function(B,j){return B(j)},jr.useFormState=function(B,j,J){return E.H.useFormState(B,j,J)},jr.useFormStatus=function(){return E.H.useHostTransitionStatus()},jr.version="19.2.0",jr}var l_;function Ly(){if(l_)return xg.exports;l_=1;function u(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(u)}catch(y){console.error(y)}}return u(),xg.exports=ky(),xg.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var c_;function Oy(){if(c_)return vp;c_=1;var u=Ry(),y=Bg(),w=Ly();function C(i){var s="https://react.dev/errors/"+i;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)s+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+i+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function P(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function D(i){var s=i,h=i;if(i.alternate)for(;s.return;)s=s.return;else{i=s;do s=i,(s.flags&4098)!==0&&(h=s.return),i=s.return;while(i)}return s.tag===3?h:null}function E(i){if(i.tag===13){var s=i.memoizedState;if(s===null&&(i=i.alternate,i!==null&&(s=i.memoizedState)),s!==null)return s.dehydrated}return null}function o(i){if(i.tag===31){var s=i.memoizedState;if(s===null&&(i=i.alternate,i!==null&&(s=i.memoizedState)),s!==null)return s.dehydrated}return null}function B(i){if(D(i)!==i)throw Error(C(188))}function j(i){var s=i.alternate;if(!s){if(s=D(i),s===null)throw Error(C(188));return s!==i?null:i}for(var h=i,g=s;;){var M=h.return;if(M===null)break;var z=M.alternate;if(z===null){if(g=M.return,g!==null){h=g;continue}break}if(M.child===z.child){for(z=M.child;z;){if(z===h)return B(M),i;if(z===g)return B(M),s;z=z.sibling}throw Error(C(188))}if(h.return!==g.return)h=M,g=z;else{for(var G=!1,Q=M.child;Q;){if(Q===h){G=!0,h=M,g=z;break}if(Q===g){G=!0,g=M,h=z;break}Q=Q.sibling}if(!G){for(Q=z.child;Q;){if(Q===h){G=!0,h=z,g=M;break}if(Q===g){G=!0,g=z,h=M;break}Q=Q.sibling}if(!G)throw Error(C(189))}}if(h.alternate!==g)throw Error(C(190))}if(h.tag!==3)throw Error(C(188));return h.stateNode.current===h?i:s}function J(i){var s=i.tag;if(s===5||s===26||s===27||s===6)return i;for(i=i.child;i!==null;){if(s=J(i),s!==null)return s;i=i.sibling}return null}var K=Object.assign,W=Symbol.for("react.element"),ee=Symbol.for("react.transitional.element"),we=Symbol.for("react.portal"),Oe=Symbol.for("react.fragment"),Ae=Symbol.for("react.strict_mode"),Ze=Symbol.for("react.profiler"),Be=Symbol.for("react.consumer"),Ke=Symbol.for("react.context"),vt=Symbol.for("react.forward_ref"),Et=Symbol.for("react.suspense"),xt=Symbol.for("react.suspense_list"),lt=Symbol.for("react.memo"),xe=Symbol.for("react.lazy"),Se=Symbol.for("react.activity"),Ye=Symbol.for("react.memo_cache_sentinel"),mt=Symbol.iterator;function gt(i){return i===null||typeof i!="object"?null:(i=mt&&i[mt]||i["@@iterator"],typeof i=="function"?i:null)}var Gt=Symbol.for("react.client.reference");function Oi(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===Gt?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case Oe:return"Fragment";case Ze:return"Profiler";case Ae:return"StrictMode";case Et:return"Suspense";case xt:return"SuspenseList";case Se:return"Activity"}if(typeof i=="object")switch(i.$$typeof){case we:return"Portal";case Ke:return i.displayName||"Context";case Be:return(i._context.displayName||"Context")+".Consumer";case vt:var s=i.render;return i=i.displayName,i||(i=s.displayName||s.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case lt:return s=i.displayName||null,s!==null?s:Oi(i.type)||"Memo";case xe:s=i._payload,i=i._init;try{return Oi(i(s))}catch{}}return null}var Xi=Array.isArray,He=y.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,at=w.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,At={pending:!1,data:null,method:null,action:null},ft=[],Kt=-1;function pe(i){return{current:i}}function Ue(i){0>Kt||(i.current=ft[Kt],ft[Kt]=null,Kt--)}function We(i,s){Kt++,ft[Kt]=i.current,i.current=s}var Mt=pe(null),Lt=pe(null),Ot=pe(null),ai=pe(null);function Ut(i,s){switch(We(Ot,s),We(Lt,i),We(Mt,null),s.nodeType){case 9:case 11:i=(i=s.documentElement)&&(i=i.namespaceURI)?lp(i):0;break;default:if(i=s.tagName,s=s.namespaceURI)s=lp(s),i=wl(s,i);else switch(i){case"svg":i=1;break;case"math":i=2;break;default:i=0}}Ue(Mt),We(Mt,i)}function jt(){Ue(Mt),Ue(Lt),Ue(Ot)}function Ni(i){i.memoizedState!==null&&We(ai,i);var s=Mt.current,h=wl(s,i.type);s!==h&&(We(Lt,i),We(Mt,h))}function ri(i){Lt.current===i&&(Ue(Mt),Ue(Lt)),ai.current===i&&(Ue(ai),Ve._currentValue=At)}var mi,di;function Xt(i){if(mi===void 0)try{throw Error()}catch(h){var s=h.stack.trim().match(/\n( *(at )?)/);mi=s&&s[1]||"",di=-1<h.stack.indexOf(`
    at`)?" (<anonymous>)":-1<h.stack.indexOf("@")?"@unknown:0:0":""}return`
`+mi+i+di}var fi=!1;function Jt(i,s){if(!i||fi)return"";fi=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var g={DetermineComponentFrameRoot:function(){try{if(s){var ot=function(){throw Error()};if(Object.defineProperty(ot.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ot,[])}catch(Xe){var qe=Xe}Reflect.construct(i,[],ot)}else{try{ot.call()}catch(Xe){qe=Xe}i.call(ot.prototype)}}else{try{throw Error()}catch(Xe){qe=Xe}(ot=i())&&typeof ot.catch=="function"&&ot.catch(function(){})}}catch(Xe){if(Xe&&qe&&typeof Xe.stack=="string")return[Xe.stack,qe.stack]}return[null,null]}};g.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var M=Object.getOwnPropertyDescriptor(g.DetermineComponentFrameRoot,"name");M&&M.configurable&&Object.defineProperty(g.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var z=g.DetermineComponentFrameRoot(),G=z[0],Q=z[1];if(G&&Q){var _e=G.split(`
`),Ge=Q.split(`
`);for(M=g=0;g<_e.length&&!_e[g].includes("DetermineComponentFrameRoot");)g++;for(;M<Ge.length&&!Ge[M].includes("DetermineComponentFrameRoot");)M++;if(g===_e.length||M===Ge.length)for(g=_e.length-1,M=Ge.length-1;1<=g&&0<=M&&_e[g]!==Ge[M];)M--;for(;1<=g&&0<=M;g--,M--)if(_e[g]!==Ge[M]){if(g!==1||M!==1)do if(g--,M--,0>M||_e[g]!==Ge[M]){var tt=`
`+_e[g].replace(" at new "," at ");return i.displayName&&tt.includes("<anonymous>")&&(tt=tt.replace("<anonymous>",i.displayName)),tt}while(1<=g&&0<=M);break}}}finally{fi=!1,Error.prepareStackTrace=h}return(h=i?i.displayName||i.name:"")?Xt(h):""}function wa(i,s){switch(i.tag){case 26:case 27:case 5:return Xt(i.type);case 16:return Xt("Lazy");case 13:return i.child!==s&&s!==null?Xt("Suspense Fallback"):Xt("Suspense");case 19:return Xt("SuspenseList");case 0:case 15:return Jt(i.type,!1);case 11:return Jt(i.type.render,!1);case 1:return Jt(i.type,!0);case 31:return Xt("Activity");default:return""}}function Si(i){try{var s="",h=null;do s+=wa(i,h),h=i,i=i.return;while(i);return s}catch(g){return`
Error generating stack: `+g.message+`
`+g.stack}}var gi=Object.prototype.hasOwnProperty,ia=u.unstable_scheduleCallback,qn=u.unstable_cancelCallback,Ja=u.unstable_shouldYield,An=u.unstable_requestPaint,Pi=u.unstable_now,Pn=u.unstable_getCurrentPriorityLevel,Ui=u.unstable_ImmediatePriority,Sa=u.unstable_UserBlockingPriority,ya=u.unstable_NormalPriority,ve=u.unstable_LowPriority,H=u.unstable_IdlePriority,$=u.log,te=u.unstable_setDisableYieldValue,ce=null,fe=null;function be(i){if(typeof $=="function"&&te(i),fe&&typeof fe.setStrictMode=="function")try{fe.setStrictMode(ce,i)}catch{}}var Ie=Math.clz32?Math.clz32:ct,Ce=Math.log,$e=Math.LN2;function ct(i){return i>>>=0,i===0?32:31-(Ce(i)/$e|0)|0}var Je=256,zt=262144,Vt=4194304;function Pe(i){var s=i&42;if(s!==0)return s;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return i&261888;case 262144:case 524288:case 1048576:case 2097152:return i&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function _i(i,s,h){var g=i.pendingLanes;if(g===0)return 0;var M=0,z=i.suspendedLanes,G=i.pingedLanes;i=i.warmLanes;var Q=g&134217727;return Q!==0?(g=Q&~z,g!==0?M=Pe(g):(G&=Q,G!==0?M=Pe(G):h||(h=Q&~i,h!==0&&(M=Pe(h))))):(Q=g&~z,Q!==0?M=Pe(Q):G!==0?M=Pe(G):h||(h=g&~i,h!==0&&(M=Pe(h)))),M===0?0:s!==0&&s!==M&&(s&z)===0&&(z=M&-M,h=s&-s,z>=h||z===32&&(h&4194048)!==0)?s:M}function zi(i,s){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&s)===0}function kt(i,s){switch(i){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ei(){var i=Vt;return Vt<<=1,(Vt&62914560)===0&&(Vt=4194304),i}function Fa(i){for(var s=[],h=0;31>h;h++)s.push(i);return s}function za(i,s){i.pendingLanes|=s,s!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function qa(i,s,h,g,M,z){var G=i.pendingLanes;i.pendingLanes=h,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=h,i.entangledLanes&=h,i.errorRecoveryDisabledLanes&=h,i.shellSuspendCounter=0;var Q=i.entanglements,_e=i.expirationTimes,Ge=i.hiddenUpdates;for(h=G&~h;0<h;){var tt=31-Ie(h),ot=1<<tt;Q[tt]=0,_e[tt]=-1;var qe=Ge[tt];if(qe!==null)for(Ge[tt]=null,tt=0;tt<qe.length;tt++){var Xe=qe[tt];Xe!==null&&(Xe.lane&=-536870913)}h&=~ot}g!==0&&hn(i,g,0),z!==0&&M===0&&i.tag!==0&&(i.suspendedLanes|=z&~(G&~s))}function hn(i,s,h){i.pendingLanes|=s,i.suspendedLanes&=~s;var g=31-Ie(s);i.entangledLanes|=s,i.entanglements[g]=i.entanglements[g]|1073741824|h&261930}function Ji(i,s){var h=i.entangledLanes|=s;for(i=i.entanglements;h;){var g=31-Ie(h),M=1<<g;M&s|i[g]&s&&(i[g]|=s),h&=~M}}function Za(i,s){var h=s&-s;return h=(h&42)!==0?1:ji(h),(h&(i.suspendedLanes|s))!==0?0:h}function ji(i){switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=128;break;case 268435456:i=134217728;break;default:i=0}return i}function st(i){return i&=-i,2<i?8<i?(i&134217727)!==0?32:268435456:8:2}function Gr(){var i=at.p;return i!==0?i:(i=window.event,i===void 0?32:En(i.type))}function Zn(i,s){var h=at.p;try{return at.p=i,s()}finally{at.p=h}}var $a=Math.random().toString(36).slice(2),Ri="__reactFiber$"+$a,ut="__reactProps$"+$a,si="__reactContainer$"+$a,li="__reactEvents$"+$a,ar="__reactListeners$"+$a,os="__reactHandles$"+$a,Ur="__reactResources$"+$a,ni="__reactMarker$"+$a;function no(i){delete i[Ri],delete i[ut],delete i[li],delete i[ar],delete i[os]}function ls(i){var s=i[Ri];if(s)return s;for(var h=i.parentNode;h;){if(s=h[si]||h[Ri]){if(h=s.alternate,s.child!==null||h!==null&&h.child!==null)for(i=nf(i);i!==null;){if(h=i[Ri])return h;i=nf(i)}return s}i=h,h=i.parentNode}return null}function Mr(i){if(i=i[Ri]||i[si]){var s=i.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return i}return null}function Ps(i){var s=i.tag;if(s===5||s===26||s===27||s===6)return i.stateNode;throw Error(C(33))}function $n(i){var s=i[Ur];return s||(s=i[Ur]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function Ma(i){i[ni]=!0}var Ra=new Set,Hn={};function Zi(i,s){cs(i,s),cs(i+"Capture",s)}function cs(i,s){for(Hn[i]=s,i=0;i<s.length;i++)Ra.add(s[i])}var Cl=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),hu={},ro={};function zs(i){return gi.call(ro,i)?!0:gi.call(hu,i)?!1:Cl.test(i)?ro[i]=!0:(hu[i]=!0,!1)}function fc(i,s,h){if(zs(s))if(h===null)i.removeAttribute(s);else{switch(typeof h){case"undefined":case"function":case"symbol":i.removeAttribute(s);return;case"boolean":var g=s.toLowerCase().slice(0,5);if(g!=="data-"&&g!=="aria-"){i.removeAttribute(s);return}}i.setAttribute(s,""+h)}}function Al(i,s,h){if(h===null)i.removeAttribute(s);else{switch(typeof h){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(s);return}i.setAttribute(s,""+h)}}function us(i,s,h,g){if(g===null)i.removeAttribute(h);else{switch(typeof g){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(h);return}i.setAttributeNS(s,h,""+g)}}function bn(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function ah(i){var s=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function yf(i,s,h){var g=Object.getOwnPropertyDescriptor(i.constructor.prototype,s);if(!i.hasOwnProperty(s)&&typeof g<"u"&&typeof g.get=="function"&&typeof g.set=="function"){var M=g.get,z=g.set;return Object.defineProperty(i,s,{configurable:!0,get:function(){return M.call(this)},set:function(G){h=""+G,z.call(this,G)}}),Object.defineProperty(i,s,{enumerable:g.enumerable}),{getValue:function(){return h},setValue:function(G){h=""+G},stopTracking:function(){i._valueTracker=null,delete i[s]}}}}function nh(i){if(!i._valueTracker){var s=ah(i)?"checked":"value";i._valueTracker=yf(i,s,""+i[s])}}function ud(i){if(!i)return!1;var s=i._valueTracker;if(!s)return!0;var h=s.getValue(),g="";return i&&(g=ah(i)?i.checked?"true":"false":i.value),i=g,i!==h?(s.setValue(i),!0):!1}function pc(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var rh=/[\n"\\]/g;function dn(i){return i.replace(rh,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function mc(i,s,h,g,M,z,G,Q){i.name="",G!=null&&typeof G!="function"&&typeof G!="symbol"&&typeof G!="boolean"?i.type=G:i.removeAttribute("type"),s!=null?G==="number"?(s===0&&i.value===""||i.value!=s)&&(i.value=""+bn(s)):i.value!==""+bn(s)&&(i.value=""+bn(s)):G!=="submit"&&G!=="reset"||i.removeAttribute("value"),s!=null?Is(i,G,bn(s)):h!=null?Is(i,G,bn(h)):g!=null&&i.removeAttribute("value"),M==null&&z!=null&&(i.defaultChecked=!!z),M!=null&&(i.checked=M&&typeof M!="function"&&typeof M!="symbol"),Q!=null&&typeof Q!="function"&&typeof Q!="symbol"&&typeof Q!="boolean"?i.name=""+bn(Q):i.removeAttribute("name")}function sh(i,s,h,g,M,z,G,Q){if(z!=null&&typeof z!="function"&&typeof z!="symbol"&&typeof z!="boolean"&&(i.type=z),s!=null||h!=null){if(!(z!=="submit"&&z!=="reset"||s!=null)){nh(i);return}h=h!=null?""+bn(h):"",s=s!=null?""+bn(s):h,Q||s===i.value||(i.value=s),i.defaultValue=s}g=g??M,g=typeof g!="function"&&typeof g!="symbol"&&!!g,i.checked=Q?i.checked:!!g,i.defaultChecked=!!g,G!=null&&typeof G!="function"&&typeof G!="symbol"&&typeof G!="boolean"&&(i.name=G),nh(i)}function Is(i,s,h){s==="number"&&pc(i.ownerDocument)===i||i.defaultValue===""+h||(i.defaultValue=""+h)}function so(i,s,h,g){if(i=i.options,s){s={};for(var M=0;M<h.length;M++)s["$"+h[M]]=!0;for(h=0;h<i.length;h++)M=s.hasOwnProperty("$"+i[h].value),i[h].selected!==M&&(i[h].selected=M),M&&g&&(i[h].defaultSelected=!0)}else{for(h=""+bn(h),s=null,M=0;M<i.length;M++){if(i[M].value===h){i[M].selected=!0,g&&(i[M].defaultSelected=!0);return}s!==null||i[M].disabled||(s=i[M])}s!==null&&(s.selected=!0)}}function hd(i,s,h){if(s!=null&&(s=""+bn(s),s!==i.value&&(i.value=s),h==null)){i.defaultValue!==s&&(i.defaultValue=s);return}i.defaultValue=h!=null?""+bn(h):""}function Pl(i,s,h,g){if(s==null){if(g!=null){if(h!=null)throw Error(C(92));if(Xi(g)){if(1<g.length)throw Error(C(93));g=g[0]}h=g}h==null&&(h=""),s=h}h=bn(s),i.defaultValue=h,g=i.textContent,g===h&&g!==""&&g!==null&&(i.value=g),nh(i)}function hs(i,s){if(s){var h=i.firstChild;if(h&&h===i.lastChild&&h.nodeType===3){h.nodeValue=s;return}}i.textContent=s}var oh=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function zn(i,s,h){var g=s.indexOf("--")===0;h==null||typeof h=="boolean"||h===""?g?i.setProperty(s,""):s==="float"?i.cssFloat="":i[s]="":g?i.setProperty(s,h):typeof h!="number"||h===0||oh.has(s)?s==="float"?i.cssFloat=h:i[s]=(""+h).trim():i[s]=h+"px"}function Mi(i,s,h){if(s!=null&&typeof s!="object")throw Error(C(62));if(i=i.style,h!=null){for(var g in h)!h.hasOwnProperty(g)||s!=null&&s.hasOwnProperty(g)||(g.indexOf("--")===0?i.setProperty(g,""):g==="float"?i.cssFloat="":i[g]="");for(var M in s)g=s[M],s.hasOwnProperty(M)&&h[M]!==g&&zn(i,M,g)}else for(var z in s)s.hasOwnProperty(z)&&zn(i,z,s[z])}function oo(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Bn=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Uo=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function hi(i){return Uo.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}function nr(){}var Vo=null;function lo(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var en=null,Da=null;function tn(i){var s=Mr(i);if(s&&(i=s.stateNode)){var h=i[ut]||null;e:switch(i=s.stateNode,s.type){case"input":if(mc(i,h.value,h.defaultValue,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name),s=h.name,h.type==="radio"&&s!=null){for(h=i;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll('input[name="'+dn(""+s)+'"][type="radio"]'),s=0;s<h.length;s++){var g=h[s];if(g!==i&&g.form===i.form){var M=g[ut]||null;if(!M)throw Error(C(90));mc(g,M.value,M.defaultValue,M.defaultValue,M.checked,M.defaultChecked,M.type,M.name)}}for(s=0;s<h.length;s++)g=h[s],g.form===i.form&&ud(g)}break e;case"textarea":hd(i,h.value,h.defaultValue);break e;case"select":s=h.value,s!=null&&so(i,!!h.multiple,s,!1)}}}var an=!1;function sa(i,s,h){if(an)return i(s,h);an=!0;try{var g=i(s);return g}finally{if(an=!1,(en!==null||Da!==null)&&(jd(),en&&(s=en,i=Da,Da=en=null,tn(s),i)))for(s=0;s<i.length;s++)tn(i[s])}}function ds(i,s){var h=i.stateNode;if(h===null)return null;var g=h[ut]||null;if(g===null)return null;h=g[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(g=!g.disabled)||(i=i.type,g=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!g;break e;default:i=!1}if(i)return null;if(h&&typeof h!="function")throw Error(C(231,s,typeof h));return h}var Ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Nn=!1;if(Ia)try{var fn={};Object.defineProperty(fn,"passive",{get:function(){Nn=!0}}),window.addEventListener("test",fn,fn),window.removeEventListener("test",fn,fn)}catch{Nn=!1}var Tr=null,$i=null,da=null;function yi(){if(da)return da;var i,s=$i,h=s.length,g,M="value"in Tr?Tr.value:Tr.textContent,z=M.length;for(i=0;i<h&&s[i]===M[i];i++);var G=h-i;for(g=1;g<=G&&s[h-g]===M[z-g];g++);return da=M.slice(i,1<g?1-g:void 0)}function Yt(i){var s=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&s===13&&(i=13)):i=s,i===10&&(i=13),32<=i||i===13?i:0}function Rs(){return!0}function ci(){return!1}function wn(i){function s(h,g,M,z,G){this._reactName=h,this._targetInst=M,this.type=g,this.nativeEvent=z,this.target=G,this.currentTarget=null;for(var Q in i)i.hasOwnProperty(Q)&&(h=i[Q],this[Q]=h?h(z):z[Q]);return this.isDefaultPrevented=(z.defaultPrevented!=null?z.defaultPrevented:z.returnValue===!1)?Rs:ci,this.isPropagationStopped=ci,this}return K(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=Rs)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=Rs)},persist:function(){},isPersistent:Rs}),s}var ka={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},zl=wn(ka),Ds=K({},ka,{view:0,detail:0}),gc=wn(Ds),co,qo,Zo,$o=K({},Ds,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:_c,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==Zo&&(Zo&&i.type==="mousemove"?(co=i.screenX-Zo.screenX,qo=i.screenY-Zo.screenY):qo=co=0,Zo=i),co)},movementY:function(i){return"movementY"in i?i.movementY:qo}}),Il=wn($o),fs=K({},$o,{dataTransfer:0}),pn=wn(fs),Ho=K({},Ds,{relatedTarget:0}),Xo=wn(Ho),uo=K({},ka,{animationName:0,elapsedTime:0,pseudoElement:0}),mn=wn(uo),du=K({},ka,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),fu=wn(du),dd=K({},ka,{data:0}),fd=wn(dd),nn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Rl={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Er={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function pu(i){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(i):(i=Er[i])?!!s[i]:!1}function _c(){return pu}var yc=K({},Ds,{key:function(i){if(i.key){var s=nn[i.key]||i.key;if(s!=="Unidentified")return s}return i.type==="keypress"?(i=Yt(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?Rl[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:_c,charCode:function(i){return i.type==="keypress"?Yt(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?Yt(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),ks=wn(yc),Vr=K({},$o,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),lh=wn(Vr),mu=K({},Ds,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:_c}),vf=wn(mu),ch=K({},ka,{propertyName:0,elapsedTime:0,pseudoElement:0}),xf=wn(ch),gu=K({},$o,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),uh=wn(gu),_u=K({},ka,{newState:0,oldState:0}),Dl=wn(_u),hh=[9,13,27,32],rr=Ia&&"CompositionEvent"in window,kl=null;Ia&&"documentMode"in document&&(kl=document.documentMode);var dh=Ia&&"TextEvent"in window&&!kl,Yo=Ia&&(!rr||kl&&8<kl&&11>=kl),Ll=" ",pd=!1;function vc(i,s){switch(i){case"keyup":return hh.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function md(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var qr=!1;function gd(i,s){switch(i){case"compositionend":return md(s);case"keypress":return s.which!==32?null:(pd=!0,Ll);case"textInput":return i=s.data,i===Ll&&pd?null:i;default:return null}}function fh(i,s){if(qr)return i==="compositionend"||!rr&&vc(i,s)?(i=yi(),da=$i=Tr=null,qr=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return Yo&&s.locale!=="ko"?null:s.data;default:return null}}var _d={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ph(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s==="input"?!!_d[i.type]:s==="textarea"}function yu(i,s,h,g){en?Da?Da.push(g):Da=[g]:en=g,s=td(s,"onChange"),0<s.length&&(h=new zl("onChange","change",null,h,g),i.push({event:h,listeners:s}))}var Ol=null,Bl=null;function xc(i){gm(i,0)}function bc(i){var s=Ps(i);if(ud(s))return i}function ho(i,s){if(i==="change")return s}var mh=!1;if(Ia){var vu;if(Ia){var Ls="oninput"in document;if(!Ls){var gh=document.createElement("div");gh.setAttribute("oninput","return;"),Ls=typeof gh.oninput=="function"}vu=Ls}else vu=!1;mh=vu&&(!document.documentMode||9<document.documentMode)}function wc(){Ol&&(Ol.detachEvent("onpropertychange",yd),Bl=Ol=null)}function yd(i){if(i.propertyName==="value"&&bc(Bl)){var s=[];yu(s,Bl,i,lo(i)),sa(xc,s)}}function vd(i,s,h){i==="focusin"?(wc(),Ol=s,Bl=h,Ol.attachEvent("onpropertychange",yd)):i==="focusout"&&wc()}function _h(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return bc(Bl)}function xd(i,s){if(i==="click")return bc(s)}function bd(i,s){if(i==="input"||i==="change")return bc(s)}function yh(i,s){return i===s&&(i!==0||1/i===1/s)||i!==i&&s!==s}var jn=typeof Object.is=="function"?Object.is:yh;function fo(i,s){if(jn(i,s))return!0;if(typeof i!="object"||i===null||typeof s!="object"||s===null)return!1;var h=Object.keys(i),g=Object.keys(s);if(h.length!==g.length)return!1;for(g=0;g<h.length;g++){var M=h[g];if(!gi.call(s,M)||!jn(i[M],s[M]))return!1}return!0}function ps(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function xu(i,s){var h=ps(i);i=0;for(var g;h;){if(h.nodeType===3){if(g=i+h.textContent.length,i<=s&&g>=s)return{node:h,offset:s-i};i=g}e:{for(;h;){if(h.nextSibling){h=h.nextSibling;break e}h=h.parentNode}h=void 0}h=ps(h)}}function bu(i,s){return i&&s?i===s?!0:i&&i.nodeType===3?!1:s&&s.nodeType===3?bu(i,s.parentNode):"contains"in i?i.contains(s):i.compareDocumentPosition?!!(i.compareDocumentPosition(s)&16):!1:!1}function Di(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var s=pc(i.document);s instanceof i.HTMLIFrameElement;){try{var h=typeof s.contentWindow.location.href=="string"}catch{h=!1}if(h)i=s.contentWindow;else break;s=pc(i.document)}return s}function wu(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s&&(s==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||s==="textarea"||i.contentEditable==="true")}var vh=Ia&&"documentMode"in document&&11>=document.documentMode,Cr=null,Sc=null,Mc=null,xh=!1;function wd(i,s,h){var g=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;xh||Cr==null||Cr!==pc(g)||(g=Cr,"selectionStart"in g&&wu(g)?g={start:g.selectionStart,end:g.selectionEnd}:(g=(g.ownerDocument&&g.ownerDocument.defaultView||window).getSelection(),g={anchorNode:g.anchorNode,anchorOffset:g.anchorOffset,focusNode:g.focusNode,focusOffset:g.focusOffset}),Mc&&fo(Mc,g)||(Mc=g,g=td(Sc,"onSelect"),0<g.length&&(s=new zl("onSelect","select",null,s,h),i.push({event:s,listeners:g}),s.target=Cr)))}function Wo(i,s){var h={};return h[i.toLowerCase()]=s.toLowerCase(),h["Webkit"+i]="webkit"+s,h["Moz"+i]="moz"+s,h}var Qo={animationend:Wo("Animation","AnimationEnd"),animationiteration:Wo("Animation","AnimationIteration"),animationstart:Wo("Animation","AnimationStart"),transitionrun:Wo("Transition","TransitionRun"),transitionstart:Wo("Transition","TransitionStart"),transitioncancel:Wo("Transition","TransitionCancel"),transitionend:Wo("Transition","TransitionEnd")},bh={},wh={};Ia&&(wh=document.createElement("div").style,"AnimationEvent"in window||(delete Qo.animationend.animation,delete Qo.animationiteration.animation,delete Qo.animationstart.animation),"TransitionEvent"in window||delete Qo.transitionend.transition);function ms(i){if(bh[i])return bh[i];if(!Qo[i])return i;var s=Qo[i],h;for(h in s)if(s.hasOwnProperty(h)&&h in wh)return bh[i]=s[h];return i}var Tc=ms("animationend"),Ec=ms("animationiteration"),Su=ms("animationstart"),Ko=ms("transitionrun"),Cc=ms("transitionstart"),Nl=ms("transitioncancel"),sr=ms("transitionend"),Sh=new Map,Mu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Mu.push("scrollEnd");function or(i,s){Sh.set(i,s),Zi(s,[i])}var gs=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)},Fn=[],Os=0,Jo=0;function el(){for(var i=Os,s=Jo=Os=0;s<i;){var h=Fn[s];Fn[s++]=null;var g=Fn[s];Fn[s++]=null;var M=Fn[s];Fn[s++]=null;var z=Fn[s];if(Fn[s++]=null,g!==null&&M!==null){var G=g.pending;G===null?M.next=M:(M.next=G.next,G.next=M),g.pending=M}z!==0&&Mh(h,M,z)}}function Ac(i,s,h,g){Fn[Os++]=i,Fn[Os++]=s,Fn[Os++]=h,Fn[Os++]=g,Jo|=g,i.lanes|=g,i=i.alternate,i!==null&&(i.lanes|=g)}function po(i,s,h,g){return Ac(i,s,h,g),mo(i)}function Ar(i,s){return Ac(i,null,null,s),mo(i)}function Mh(i,s,h){i.lanes|=h;var g=i.alternate;g!==null&&(g.lanes|=h);for(var M=!1,z=i.return;z!==null;)z.childLanes|=h,g=z.alternate,g!==null&&(g.childLanes|=h),z.tag===22&&(i=z.stateNode,i===null||i._visibility&1||(M=!0)),i=z,z=z.return;return i.tag===3?(z=i.stateNode,M&&s!==null&&(M=31-Ie(h),i=z.hiddenUpdates,g=i[M],g===null?i[M]=[s]:g.push(s),s.lane=h|536870912),z):null}function mo(i){if(50<Ba)throw Ba=0,Hh=null,Error(C(185));for(var s=i.return;s!==null;)i=s,s=i.return;return i.tag===3?i.stateNode:null}var ui={};function Tu(i,s,h,g){this.tag=i,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=g,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function lr(i,s,h,g){return new Tu(i,s,h,g)}function Pc(i){return i=i.prototype,!(!i||!i.isReactComponent)}function cr(i,s){var h=i.alternate;return h===null?(h=lr(i.tag,s,i.key,i.mode),h.elementType=i.elementType,h.type=i.type,h.stateNode=i.stateNode,h.alternate=i,i.alternate=h):(h.pendingProps=s,h.type=i.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=i.flags&65011712,h.childLanes=i.childLanes,h.lanes=i.lanes,h.child=i.child,h.memoizedProps=i.memoizedProps,h.memoizedState=i.memoizedState,h.updateQueue=i.updateQueue,s=i.dependencies,h.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},h.sibling=i.sibling,h.index=i.index,h.ref=i.ref,h.refCleanup=i.refCleanup,h}function Sd(i,s){i.flags&=65011714;var h=i.alternate;return h===null?(i.childLanes=0,i.lanes=s,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=h.childLanes,i.lanes=h.lanes,i.child=h.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=h.memoizedProps,i.memoizedState=h.memoizedState,i.updateQueue=h.updateQueue,i.type=h.type,s=h.dependencies,i.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),i}function tl(i,s,h,g,M,z){var G=0;if(g=i,typeof i=="function")Pc(i)&&(G=1);else if(typeof i=="string")G=V(i,h,Mt.current)?26:i==="html"||i==="head"||i==="body"?27:5;else e:switch(i){case Se:return i=lr(31,h,s,M),i.elementType=Se,i.lanes=z,i;case Oe:return Bs(h.children,M,z,s);case Ae:G=8,M|=24;break;case Ze:return i=lr(12,h,s,M|2),i.elementType=Ze,i.lanes=z,i;case Et:return i=lr(13,h,s,M),i.elementType=Et,i.lanes=z,i;case xt:return i=lr(19,h,s,M),i.elementType=xt,i.lanes=z,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case Ke:G=10;break e;case Be:G=9;break e;case vt:G=11;break e;case lt:G=14;break e;case xe:G=16,g=null;break e}G=29,h=Error(C(130,i===null?"null":typeof i,"")),g=null}return s=lr(G,h,s,M),s.elementType=i,s.type=g,s.lanes=z,s}function Bs(i,s,h,g){return i=lr(7,i,g,s),i.lanes=h,i}function Th(i,s,h){return i=lr(6,i,null,s),i.lanes=h,i}function Eu(i){var s=lr(18,null,null,0);return s.stateNode=i,s}function jl(i,s,h){return s=lr(4,i.children!==null?i.children:[],i.key,s),s.lanes=h,s.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},s}var zc=new WeakMap;function Gn(i,s){if(typeof i=="object"&&i!==null){var h=zc.get(i);return h!==void 0?h:(s={value:i,source:s,stack:Si(s)},zc.set(i,s),s)}return{value:i,source:s,stack:Si(s)}}var Ns=[],go=0,il=null,_o=0,In=[],gn=0,Zr=null,_s=1,Xn="";function js(i,s){Ns[go++]=_o,Ns[go++]=il,il=i,_o=s}function Eh(i,s,h){In[gn++]=_s,In[gn++]=Xn,In[gn++]=Zr,Zr=i;var g=_s;i=Xn;var M=32-Ie(g)-1;g&=~(1<<M),h+=1;var z=32-Ie(s)+M;if(30<z){var G=M-M%5;z=(g&(1<<G)-1).toString(32),g>>=G,M-=G,_s=1<<32-Ie(s)+M|h<<M|g,Xn=z+i}else _s=1<<z|h<<M|g,Xn=i}function al(i){i.return!==null&&(js(i,1),Eh(i,1,0))}function Fl(i){for(;i===il;)il=Ns[--go],Ns[go]=null,_o=Ns[--go],Ns[go]=null;for(;i===Zr;)Zr=In[--gn],In[gn]=null,Xn=In[--gn],In[gn]=null,_s=In[--gn],In[gn]=null}function Ic(i,s){In[gn++]=_s,In[gn++]=Xn,In[gn++]=Zr,_s=s.id,Xn=s.overflow,Zr=i}var Ha=null,Yi=null,Ti=!1,$r=null,ur=!1,Ta=Error(C(519));function Yn(i){var s=Error(C(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw ys(Gn(s,i)),Ta}function hr(i){var s=i.stateNode,h=i.type,g=i.memoizedProps;switch(s[Ri]=i,s[ut]=g,h){case"dialog":Li("cancel",s),Li("close",s);break;case"iframe":case"object":case"embed":Li("load",s);break;case"video":case"audio":for(h=0;h<Jh.length;h++)Li(Jh[h],s);break;case"source":Li("error",s);break;case"img":case"image":case"link":Li("error",s),Li("load",s);break;case"details":Li("toggle",s);break;case"input":Li("invalid",s),sh(s,g.value,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name,!0);break;case"select":Li("invalid",s);break;case"textarea":Li("invalid",s),Pl(s,g.value,g.defaultValue,g.children)}h=g.children,typeof h!="string"&&typeof h!="number"&&typeof h!="bigint"||s.textContent===""+h||g.suppressHydrationWarning===!0||sp(s.textContent,h)?(g.popover!=null&&(Li("beforetoggle",s),Li("toggle",s)),g.onScroll!=null&&Li("scroll",s),g.onScrollEnd!=null&&Li("scrollend",s),g.onClick!=null&&(s.onclick=nr),s=!0):s=!1,s||Yn(i,!0)}function Cu(i){for(Ha=i.return;Ha;)switch(Ha.tag){case 5:case 31:case 13:ur=!1;return;case 27:case 3:ur=!0;return;default:Ha=Ha.return}}function Fs(i){if(i!==Ha)return!1;if(!Ti)return Cu(i),Ti=!0,!1;var s=i.tag,h;if((h=s!==3&&s!==27)&&((h=s===5)&&(h=i.type,h=!(h!=="form"&&h!=="button")||Jd(i.type,i.memoizedProps)),h=!h),h&&Yi&&Yn(i),Cu(i),s===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(C(317));Yi=dp(i)}else if(s===31){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(C(317));Yi=dp(i)}else s===27?(s=Yi,io(i.type)?(i=af,af=null,Yi=i):Yi=s):Yi=Ha?Lr(i.stateNode.nextSibling):null;return!0}function Gs(){Yi=Ha=null,Ti=!1}function Us(){var i=$r;return i!==null&&(vr===null?vr=i:vr.push.apply(vr,i),$r=null),i}function ys(i){$r===null?$r=[i]:$r.push(i)}var nl=pe(null),vs=null,Hr=null;function Vs(i,s,h){We(nl,s._currentValue),s._currentValue=h}function Xr(i){i._currentValue=nl.current,Ue(nl)}function Rc(i,s,h){for(;i!==null;){var g=i.alternate;if((i.childLanes&s)!==s?(i.childLanes|=s,g!==null&&(g.childLanes|=s)):g!==null&&(g.childLanes&s)!==s&&(g.childLanes|=s),i===h)break;i=i.return}}function yo(i,s,h,g){var M=i.child;for(M!==null&&(M.return=i);M!==null;){var z=M.dependencies;if(z!==null){var G=M.child;z=z.firstContext;e:for(;z!==null;){var Q=z;z=M;for(var _e=0;_e<s.length;_e++)if(Q.context===s[_e]){z.lanes|=h,Q=z.alternate,Q!==null&&(Q.lanes|=h),Rc(z.return,h,i),g||(G=null);break e}z=Q.next}}else if(M.tag===18){if(G=M.return,G===null)throw Error(C(341));G.lanes|=h,z=G.alternate,z!==null&&(z.lanes|=h),Rc(G,h,i),G=null}else G=M.child;if(G!==null)G.return=M;else for(G=M;G!==null;){if(G===i){G=null;break}if(M=G.sibling,M!==null){M.return=G.return,G=M;break}G=G.return}M=G}}function Pr(i,s,h,g){i=null;for(var M=s,z=!1;M!==null;){if(!z){if((M.flags&524288)!==0)z=!0;else if((M.flags&262144)!==0)break}if(M.tag===10){var G=M.alternate;if(G===null)throw Error(C(387));if(G=G.memoizedProps,G!==null){var Q=M.type;jn(M.pendingProps.value,G.value)||(i!==null?i.push(Q):i=[Q])}}else if(M===ai.current){if(G=M.alternate,G===null)throw Error(C(387));G.memoizedState.memoizedState!==M.memoizedState.memoizedState&&(i!==null?i.push(Ve):i=[Ve])}M=M.return}i!==null&&yo(s,i,h,g),s.flags|=262144}function Dc(i){for(i=i.firstContext;i!==null;){if(!jn(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function vo(i){vs=i,Hr=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function _n(i){return Ch(vs,i)}function kc(i,s){return vs===null&&vo(i),Ch(i,s)}function Ch(i,s){var h=s._currentValue;if(s={context:s,memoizedValue:h,next:null},Hr===null){if(i===null)throw Error(C(308));Hr=s,i.dependencies={lanes:0,firstContext:s},i.flags|=524288}else Hr=Hr.next=s;return h}var Gl=typeof AbortController<"u"?AbortController:function(){var i=[],s=this.signal={aborted:!1,addEventListener:function(h,g){i.push(g)}};this.abort=function(){s.aborted=!0,i.forEach(function(h){return h()})}},Ul=u.unstable_scheduleCallback,Wn=u.unstable_NormalPriority,oa={$$typeof:Ke,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Lc(){return{controller:new Gl,data:new Map,refCount:0}}function Rn(i){i.refCount--,i.refCount===0&&Ul(Wn,function(){i.controller.abort()})}var Un=null,xo=0,Sn=0,dr=null;function bf(i,s){if(Un===null){var h=Un=[];xo=0,Sn=rc(),dr={status:"pending",value:void 0,then:function(g){h.push(g)}}}return xo++,s.then(Au,Au),s}function Au(){if(--xo===0&&Un!==null){dr!==null&&(dr.status="fulfilled");var i=Un;Un=null,Sn=0,dr=null;for(var s=0;s<i.length;s++)(0,i[s])()}}function wf(i,s){var h=[],g={status:"pending",value:null,reason:null,then:function(M){h.push(M)}};return i.then(function(){g.status="fulfilled",g.value=s;for(var M=0;M<h.length;M++)(0,h[M])(s)},function(M){for(g.status="rejected",g.reason=M,M=0;M<h.length;M++)(0,h[M])(void 0)}),g}var Vl=He.S;He.S=function(i,s){sm=Pi(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&bf(i,s),Vl!==null&&Vl(i,s)};var bo=pe(null);function rl(){var i=bo.current;return i!==null?i:ha.pooledCache}function zr(i,s){s===null?We(bo,bo.current):We(bo,s.pool)}function Tt(){var i=rl();return i===null?null:{parent:oa._currentValue,pool:i}}var sl=Error(C(460)),Oc=Error(C(474)),wo=Error(C(542)),So={then:function(){}};function Mo(i){return i=i.status,i==="fulfilled"||i==="rejected"}function ol(i,s,h){switch(h=i[h],h===void 0?i.push(s):h!==s&&(s.then(nr,nr),s=h),s.status){case"fulfilled":return s.value;case"rejected":throw i=s.reason,Bc(i),i;default:if(typeof s.status=="string")s.then(nr,nr);else{if(i=ha,i!==null&&100<i.shellSuspendCounter)throw Error(C(482));i=s,i.status="pending",i.then(function(g){if(s.status==="pending"){var M=s;M.status="fulfilled",M.value=g}},function(g){if(s.status==="pending"){var M=s;M.status="rejected",M.reason=g}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw i=s.reason,Bc(i),i}throw xs=s,sl}}function oi(i){try{var s=i._init;return s(i._payload)}catch(h){throw h!==null&&typeof h=="object"&&typeof h.then=="function"?(xs=h,sl):h}}var xs=null;function Ah(){if(xs===null)throw Error(C(459));var i=xs;return xs=null,i}function Bc(i){if(i===sl||i===wo)throw Error(C(483))}var To=null,ql=0;function Nc(i){var s=ql;return ql+=1,To===null&&(To=[]),ol(To,i,s)}function Eo(i,s){s=s.props.ref,i.ref=s!==void 0?s:null}function jc(i,s){throw s.$$typeof===W?Error(C(525)):(i=Object.prototype.toString.call(s),Error(C(31,i==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":i)))}function Ph(i){function s(ze,Te){if(i){var Fe=ze.deletions;Fe===null?(ze.deletions=[Te],ze.flags|=16):Fe.push(Te)}}function h(ze,Te){if(!i)return null;for(;Te!==null;)s(ze,Te),Te=Te.sibling;return null}function g(ze){for(var Te=new Map;ze!==null;)ze.key!==null?Te.set(ze.key,ze):Te.set(ze.index,ze),ze=ze.sibling;return Te}function M(ze,Te){return ze=cr(ze,Te),ze.index=0,ze.sibling=null,ze}function z(ze,Te,Fe){return ze.index=Fe,i?(Fe=ze.alternate,Fe!==null?(Fe=Fe.index,Fe<Te?(ze.flags|=67108866,Te):Fe):(ze.flags|=67108866,Te)):(ze.flags|=1048576,Te)}function G(ze){return i&&ze.alternate===null&&(ze.flags|=67108866),ze}function Q(ze,Te,Fe,nt){return Te===null||Te.tag!==6?(Te=Th(Fe,ze.mode,nt),Te.return=ze,Te):(Te=M(Te,Fe),Te.return=ze,Te)}function _e(ze,Te,Fe,nt){var Ht=Fe.type;return Ht===Oe?tt(ze,Te,Fe.props.children,nt,Fe.key):Te!==null&&(Te.elementType===Ht||typeof Ht=="object"&&Ht!==null&&Ht.$$typeof===xe&&oi(Ht)===Te.type)?(Te=M(Te,Fe.props),Eo(Te,Fe),Te.return=ze,Te):(Te=tl(Fe.type,Fe.key,Fe.props,null,ze.mode,nt),Eo(Te,Fe),Te.return=ze,Te)}function Ge(ze,Te,Fe,nt){return Te===null||Te.tag!==4||Te.stateNode.containerInfo!==Fe.containerInfo||Te.stateNode.implementation!==Fe.implementation?(Te=jl(Fe,ze.mode,nt),Te.return=ze,Te):(Te=M(Te,Fe.children||[]),Te.return=ze,Te)}function tt(ze,Te,Fe,nt,Ht){return Te===null||Te.tag!==7?(Te=Bs(Fe,ze.mode,nt,Ht),Te.return=ze,Te):(Te=M(Te,Fe),Te.return=ze,Te)}function ot(ze,Te,Fe){if(typeof Te=="string"&&Te!==""||typeof Te=="number"||typeof Te=="bigint")return Te=Th(""+Te,ze.mode,Fe),Te.return=ze,Te;if(typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case ee:return Fe=tl(Te.type,Te.key,Te.props,null,ze.mode,Fe),Eo(Fe,Te),Fe.return=ze,Fe;case we:return Te=jl(Te,ze.mode,Fe),Te.return=ze,Te;case xe:return Te=oi(Te),ot(ze,Te,Fe)}if(Xi(Te)||gt(Te))return Te=Bs(Te,ze.mode,Fe,null),Te.return=ze,Te;if(typeof Te.then=="function")return ot(ze,Nc(Te),Fe);if(Te.$$typeof===Ke)return ot(ze,kc(ze,Te),Fe);jc(ze,Te)}return null}function qe(ze,Te,Fe,nt){var Ht=Te!==null?Te.key:null;if(typeof Fe=="string"&&Fe!==""||typeof Fe=="number"||typeof Fe=="bigint")return Ht!==null?null:Q(ze,Te,""+Fe,nt);if(typeof Fe=="object"&&Fe!==null){switch(Fe.$$typeof){case ee:return Fe.key===Ht?_e(ze,Te,Fe,nt):null;case we:return Fe.key===Ht?Ge(ze,Te,Fe,nt):null;case xe:return Fe=oi(Fe),qe(ze,Te,Fe,nt)}if(Xi(Fe)||gt(Fe))return Ht!==null?null:tt(ze,Te,Fe,nt,null);if(typeof Fe.then=="function")return qe(ze,Te,Nc(Fe),nt);if(Fe.$$typeof===Ke)return qe(ze,Te,kc(ze,Fe),nt);jc(ze,Fe)}return null}function Xe(ze,Te,Fe,nt,Ht){if(typeof nt=="string"&&nt!==""||typeof nt=="number"||typeof nt=="bigint")return ze=ze.get(Fe)||null,Q(Te,ze,""+nt,Ht);if(typeof nt=="object"&&nt!==null){switch(nt.$$typeof){case ee:return ze=ze.get(nt.key===null?Fe:nt.key)||null,_e(Te,ze,nt,Ht);case we:return ze=ze.get(nt.key===null?Fe:nt.key)||null,Ge(Te,ze,nt,Ht);case xe:return nt=oi(nt),Xe(ze,Te,Fe,nt,Ht)}if(Xi(nt)||gt(nt))return ze=ze.get(Fe)||null,tt(Te,ze,nt,Ht,null);if(typeof nt.then=="function")return Xe(ze,Te,Fe,Nc(nt),Ht);if(nt.$$typeof===Ke)return Xe(ze,Te,Fe,kc(Te,nt),Ht);jc(Te,nt)}return null}function Ft(ze,Te,Fe,nt){for(var Ht=null,Ki=null,Ct=Te,Qt=Te=0,xi=null;Ct!==null&&Qt<Fe.length;Qt++){Ct.index>Qt?(xi=Ct,Ct=null):xi=Ct.sibling;var bi=qe(ze,Ct,Fe[Qt],nt);if(bi===null){Ct===null&&(Ct=xi);break}i&&Ct&&bi.alternate===null&&s(ze,Ct),Te=z(bi,Te,Qt),Ki===null?Ht=bi:Ki.sibling=bi,Ki=bi,Ct=xi}if(Qt===Fe.length)return h(ze,Ct),Ti&&js(ze,Qt),Ht;if(Ct===null){for(;Qt<Fe.length;Qt++)Ct=ot(ze,Fe[Qt],nt),Ct!==null&&(Te=z(Ct,Te,Qt),Ki===null?Ht=Ct:Ki.sibling=Ct,Ki=Ct);return Ti&&js(ze,Qt),Ht}for(Ct=g(Ct);Qt<Fe.length;Qt++)xi=Xe(Ct,ze,Qt,Fe[Qt],nt),xi!==null&&(i&&xi.alternate!==null&&Ct.delete(xi.key===null?Qt:xi.key),Te=z(xi,Te,Qt),Ki===null?Ht=xi:Ki.sibling=xi,Ki=xi);return i&&Ct.forEach(function(Nr){return s(ze,Nr)}),Ti&&js(ze,Qt),Ht}function ii(ze,Te,Fe,nt){if(Fe==null)throw Error(C(151));for(var Ht=null,Ki=null,Ct=Te,Qt=Te=0,xi=null,bi=Fe.next();Ct!==null&&!bi.done;Qt++,bi=Fe.next()){Ct.index>Qt?(xi=Ct,Ct=null):xi=Ct.sibling;var Nr=qe(ze,Ct,bi.value,nt);if(Nr===null){Ct===null&&(Ct=xi);break}i&&Ct&&Nr.alternate===null&&s(ze,Ct),Te=z(Nr,Te,Qt),Ki===null?Ht=Nr:Ki.sibling=Nr,Ki=Nr,Ct=xi}if(bi.done)return h(ze,Ct),Ti&&js(ze,Qt),Ht;if(Ct===null){for(;!bi.done;Qt++,bi=Fe.next())bi=ot(ze,bi.value,nt),bi!==null&&(Te=z(bi,Te,Qt),Ki===null?Ht=bi:Ki.sibling=bi,Ki=bi);return Ti&&js(ze,Qt),Ht}for(Ct=g(Ct);!bi.done;Qt++,bi=Fe.next())bi=Xe(Ct,ze,Qt,bi.value,nt),bi!==null&&(i&&bi.alternate!==null&&Ct.delete(bi.key===null?Qt:bi.key),Te=z(bi,Te,Qt),Ki===null?Ht=bi:Ki.sibling=bi,Ki=bi);return i&&Ct.forEach(function(Fo){return s(ze,Fo)}),Ti&&js(ze,Qt),Ht}function ma(ze,Te,Fe,nt){if(typeof Fe=="object"&&Fe!==null&&Fe.type===Oe&&Fe.key===null&&(Fe=Fe.props.children),typeof Fe=="object"&&Fe!==null){switch(Fe.$$typeof){case ee:e:{for(var Ht=Fe.key;Te!==null;){if(Te.key===Ht){if(Ht=Fe.type,Ht===Oe){if(Te.tag===7){h(ze,Te.sibling),nt=M(Te,Fe.props.children),nt.return=ze,ze=nt;break e}}else if(Te.elementType===Ht||typeof Ht=="object"&&Ht!==null&&Ht.$$typeof===xe&&oi(Ht)===Te.type){h(ze,Te.sibling),nt=M(Te,Fe.props),Eo(nt,Fe),nt.return=ze,ze=nt;break e}h(ze,Te);break}else s(ze,Te);Te=Te.sibling}Fe.type===Oe?(nt=Bs(Fe.props.children,ze.mode,nt,Fe.key),nt.return=ze,ze=nt):(nt=tl(Fe.type,Fe.key,Fe.props,null,ze.mode,nt),Eo(nt,Fe),nt.return=ze,ze=nt)}return G(ze);case we:e:{for(Ht=Fe.key;Te!==null;){if(Te.key===Ht)if(Te.tag===4&&Te.stateNode.containerInfo===Fe.containerInfo&&Te.stateNode.implementation===Fe.implementation){h(ze,Te.sibling),nt=M(Te,Fe.children||[]),nt.return=ze,ze=nt;break e}else{h(ze,Te);break}else s(ze,Te);Te=Te.sibling}nt=jl(Fe,ze.mode,nt),nt.return=ze,ze=nt}return G(ze);case xe:return Fe=oi(Fe),ma(ze,Te,Fe,nt)}if(Xi(Fe))return Ft(ze,Te,Fe,nt);if(gt(Fe)){if(Ht=gt(Fe),typeof Ht!="function")throw Error(C(150));return Fe=Ht.call(Fe),ii(ze,Te,Fe,nt)}if(typeof Fe.then=="function")return ma(ze,Te,Nc(Fe),nt);if(Fe.$$typeof===Ke)return ma(ze,Te,kc(ze,Fe),nt);jc(ze,Fe)}return typeof Fe=="string"&&Fe!==""||typeof Fe=="number"||typeof Fe=="bigint"?(Fe=""+Fe,Te!==null&&Te.tag===6?(h(ze,Te.sibling),nt=M(Te,Fe),nt.return=ze,ze=nt):(h(ze,Te),nt=Th(Fe,ze.mode,nt),nt.return=ze,ze=nt),G(ze)):h(ze,Te)}return function(ze,Te,Fe,nt){try{ql=0;var Ht=ma(ze,Te,Fe,nt);return To=null,Ht}catch(Ct){if(Ct===sl||Ct===wo)throw Ct;var Ki=lr(29,Ct,null,ze.mode);return Ki.lanes=nt,Ki.return=ze,Ki}finally{}}}var Co=Ph(!0),zh=Ph(!1),qs=!1;function bs(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Wi(i,s){i=i.updateQueue,s.updateQueue===i&&(s.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function Zs(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function Ir(i,s,h){var g=i.updateQueue;if(g===null)return null;if(g=g.shared,(Gi&2)!==0){var M=g.pending;return M===null?s.next=s:(s.next=M.next,M.next=s),g.pending=s,s=mo(i),Mh(i,null,h),s}return Ac(i,g,s,h),mo(i)}function Ao(i,s,h){if(s=s.updateQueue,s!==null&&(s=s.shared,(h&4194048)!==0)){var g=s.lanes;g&=i.pendingLanes,h|=g,s.lanes=h,Ji(i,h)}}function Fc(i,s){var h=i.updateQueue,g=i.alternate;if(g!==null&&(g=g.updateQueue,h===g)){var M=null,z=null;if(h=h.firstBaseUpdate,h!==null){do{var G={lane:h.lane,tag:h.tag,payload:h.payload,callback:null,next:null};z===null?M=z=G:z=z.next=G,h=h.next}while(h!==null);z===null?M=z=s:z=z.next=s}else M=z=s;h={baseState:g.baseState,firstBaseUpdate:M,lastBaseUpdate:z,shared:g.shared,callbacks:g.callbacks},i.updateQueue=h;return}i=h.lastBaseUpdate,i===null?h.firstBaseUpdate=s:i.next=s,h.lastBaseUpdate=s}var ll=!1;function Zl(){if(ll){var i=dr;if(i!==null)throw i}}function cl(i,s,h,g){ll=!1;var M=i.updateQueue;qs=!1;var z=M.firstBaseUpdate,G=M.lastBaseUpdate,Q=M.shared.pending;if(Q!==null){M.shared.pending=null;var _e=Q,Ge=_e.next;_e.next=null,G===null?z=Ge:G.next=Ge,G=_e;var tt=i.alternate;tt!==null&&(tt=tt.updateQueue,Q=tt.lastBaseUpdate,Q!==G&&(Q===null?tt.firstBaseUpdate=Ge:Q.next=Ge,tt.lastBaseUpdate=_e))}if(z!==null){var ot=M.baseState;G=0,tt=Ge=_e=null,Q=z;do{var qe=Q.lane&-536870913,Xe=qe!==Q.lane;if(Xe?(Bi&qe)===qe:(g&qe)===qe){qe!==0&&qe===Sn&&(ll=!0),tt!==null&&(tt=tt.next={lane:0,tag:Q.tag,payload:Q.payload,callback:null,next:null});e:{var Ft=i,ii=Q;qe=s;var ma=h;switch(ii.tag){case 1:if(Ft=ii.payload,typeof Ft=="function"){ot=Ft.call(ma,ot,qe);break e}ot=Ft;break e;case 3:Ft.flags=Ft.flags&-65537|128;case 0:if(Ft=ii.payload,qe=typeof Ft=="function"?Ft.call(ma,ot,qe):Ft,qe==null)break e;ot=K({},ot,qe);break e;case 2:qs=!0}}qe=Q.callback,qe!==null&&(i.flags|=64,Xe&&(i.flags|=8192),Xe=M.callbacks,Xe===null?M.callbacks=[qe]:Xe.push(qe))}else Xe={lane:qe,tag:Q.tag,payload:Q.payload,callback:Q.callback,next:null},tt===null?(Ge=tt=Xe,_e=ot):tt=tt.next=Xe,G|=qe;if(Q=Q.next,Q===null){if(Q=M.shared.pending,Q===null)break;Xe=Q,Q=Xe.next,Xe.next=null,M.lastBaseUpdate=Xe,M.shared.pending=null}}while(!0);tt===null&&(_e=ot),M.baseState=_e,M.firstBaseUpdate=Ge,M.lastBaseUpdate=tt,z===null&&(M.shared.lanes=0),ic|=G,i.lanes=G,i.memoizedState=ot}}function Yr(i,s){if(typeof i!="function")throw Error(C(191,i));i.call(s)}function Gc(i,s){var h=i.callbacks;if(h!==null)for(i.callbacks=null,i=0;i<h.length;i++)Yr(h[i],s)}var Pt=pe(null),qt=pe(0);function ul(i,s){i=Lo,We(qt,i),We(Pt,s),Lo=i|s.baseLanes}function Pu(){We(qt,Lo),We(Pt,Pt.current)}function $l(){Lo=qt.current,Ue(Pt),Ue(qt)}var la=pe(null),fr=null;function yn(i){var s=i.alternate;We(fa,fa.current&1),We(la,i),fr===null&&(s===null||Pt.current!==null||s.memoizedState!==null)&&(fr=i)}function $s(i){We(fa,fa.current),We(la,i),fr===null&&(fr=i)}function Md(i){i.tag===22?(We(fa,fa.current),We(la,i),fr===null&&(fr=i)):Po()}function Po(){We(fa,fa.current),We(la,la.current)}function pr(i){Ue(la),fr===i&&(fr=null),Ue(fa)}var fa=pe(0);function ca(i){for(var s=i;s!==null;){if(s.tag===13){var h=s.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||hp(h)||oc(h)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Qi=0,ti=null,Fi=null,va=null,hl=!1,ws=!1,Hs=!1,Wr=0,Qr=0,zo=null,zu=0;function aa(){throw Error(C(321))}function Uc(i,s){if(s===null)return!1;for(var h=0;h<s.length&&h<i.length;h++)if(!jn(i[h],s[h]))return!1;return!0}function Vc(i,s,h,g,M,z){return Qi=z,ti=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,He.H=i===null||i.memoizedState===null?Ru:Ms,Hs=!1,z=h(g,M),Hs=!1,ws&&(z=Iu(s,h,g,M)),qc(i),z}function qc(i){He.H=fl;var s=Fi!==null&&Fi.next!==null;if(Qi=0,va=Fi=ti=null,hl=!1,Qr=0,zo=null,s)throw Error(C(300));i===null||rn||(i=i.dependencies,i!==null&&Dc(i)&&(rn=!0))}function Iu(i,s,h,g){ti=i;var M=0;do{if(ws&&(zo=null),Qr=0,ws=!1,25<=M)throw Error(C(301));if(M+=1,va=Fi=null,i.updateQueue!=null){var z=i.updateQueue;z.lastEffect=null,z.events=null,z.stores=null,z.memoCache!=null&&(z.memoCache.index=0)}He.H=Du,z=s(h,g)}while(ws);return z}function p(){var i=He.H,s=i.useState()[0];return s=typeof s.then=="function"?T(s):s,i=i.useState()[0],(Fi!==null?Fi.memoizedState:null)!==i&&(ti.flags|=1024),s}function e(){var i=Wr!==0;return Wr=0,i}function r(i,s,h){s.updateQueue=i.updateQueue,s.flags&=-2053,i.lanes&=~h}function c(i){if(hl){for(i=i.memoizedState;i!==null;){var s=i.queue;s!==null&&(s.pending=null),i=i.next}hl=!1}Qi=0,va=Fi=ti=null,ws=!1,Qr=Wr=0,zo=null}function f(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return va===null?ti.memoizedState=va=i:va=va.next=i,va}function m(){if(Fi===null){var i=ti.alternate;i=i!==null?i.memoizedState:null}else i=Fi.next;var s=va===null?ti.memoizedState:va.next;if(s!==null)va=s,Fi=i;else{if(i===null)throw ti.alternate===null?Error(C(467)):Error(C(310));Fi=i,i={memoizedState:Fi.memoizedState,baseState:Fi.baseState,baseQueue:Fi.baseQueue,queue:Fi.queue,next:null},va===null?ti.memoizedState=va=i:va=va.next=i}return va}function x(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function T(i){var s=Qr;return Qr+=1,zo===null&&(zo=[]),i=ol(zo,i,s),s=ti,(va===null?s.memoizedState:va.next)===null&&(s=s.alternate,He.H=s===null||s.memoizedState===null?Ru:Ms),i}function A(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return T(i);if(i.$$typeof===Ke)return _n(i)}throw Error(C(438,String(i)))}function k(i){var s=null,h=ti.updateQueue;if(h!==null&&(s=h.memoCache),s==null){var g=ti.alternate;g!==null&&(g=g.updateQueue,g!==null&&(g=g.memoCache,g!=null&&(s={data:g.data.map(function(M){return M.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),h===null&&(h=x(),ti.updateQueue=h),h.memoCache=s,h=s.data[s.index],h===void 0)for(h=s.data[s.index]=Array(i),g=0;g<i;g++)h[g]=Ye;return s.index++,h}function L(i,s){return typeof s=="function"?s(i):s}function F(i){var s=m();return N(s,Fi,i)}function N(i,s,h){var g=i.queue;if(g===null)throw Error(C(311));g.lastRenderedReducer=h;var M=i.baseQueue,z=g.pending;if(z!==null){if(M!==null){var G=M.next;M.next=z.next,z.next=G}s.baseQueue=M=z,g.pending=null}if(z=i.baseState,M===null)i.memoizedState=z;else{s=M.next;var Q=G=null,_e=null,Ge=s,tt=!1;do{var ot=Ge.lane&-536870913;if(ot!==Ge.lane?(Bi&ot)===ot:(Qi&ot)===ot){var qe=Ge.revertLane;if(qe===0)_e!==null&&(_e=_e.next={lane:0,revertLane:0,gesture:null,action:Ge.action,hasEagerState:Ge.hasEagerState,eagerState:Ge.eagerState,next:null}),ot===Sn&&(tt=!0);else if((Qi&qe)===qe){Ge=Ge.next,qe===Sn&&(tt=!0);continue}else ot={lane:0,revertLane:Ge.revertLane,gesture:null,action:Ge.action,hasEagerState:Ge.hasEagerState,eagerState:Ge.eagerState,next:null},_e===null?(Q=_e=ot,G=z):_e=_e.next=ot,ti.lanes|=qe,ic|=qe;ot=Ge.action,Hs&&h(z,ot),z=Ge.hasEagerState?Ge.eagerState:h(z,ot)}else qe={lane:ot,revertLane:Ge.revertLane,gesture:Ge.gesture,action:Ge.action,hasEagerState:Ge.hasEagerState,eagerState:Ge.eagerState,next:null},_e===null?(Q=_e=qe,G=z):_e=_e.next=qe,ti.lanes|=ot,ic|=ot;Ge=Ge.next}while(Ge!==null&&Ge!==s);if(_e===null?G=z:_e.next=Q,!jn(z,i.memoizedState)&&(rn=!0,tt&&(h=dr,h!==null)))throw h;i.memoizedState=z,i.baseState=G,i.baseQueue=_e,g.lastRenderedState=z}return M===null&&(g.lanes=0),[i.memoizedState,g.dispatch]}function q(i){var s=m(),h=s.queue;if(h===null)throw Error(C(311));h.lastRenderedReducer=i;var g=h.dispatch,M=h.pending,z=s.memoizedState;if(M!==null){h.pending=null;var G=M=M.next;do z=i(z,G.action),G=G.next;while(G!==M);jn(z,s.memoizedState)||(rn=!0),s.memoizedState=z,s.baseQueue===null&&(s.baseState=z),h.lastRenderedState=z}return[z,g]}function X(i,s,h){var g=ti,M=m(),z=Ti;if(z){if(h===void 0)throw Error(C(407));h=h()}else h=s();var G=!jn((Fi||M).memoizedState,h);if(G&&(M.memoizedState=h,rn=!0),M=M.queue,vi(re.bind(null,g,M,i),[i]),M.getSnapshot!==s||G||va!==null&&va.memoizedState.tag&1){if(g.flags|=2048,Ii(9,{destroy:void 0},ne.bind(null,g,M,h,s),null),ha===null)throw Error(C(349));z||(Qi&127)!==0||ae(g,s,h)}return h}function ae(i,s,h){i.flags|=16384,i={getSnapshot:s,value:h},s=ti.updateQueue,s===null?(s=x(),ti.updateQueue=s,s.stores=[i]):(h=s.stores,h===null?s.stores=[i]:h.push(i))}function ne(i,s,h,g){s.value=h,s.getSnapshot=g,oe(s)&&ue(i)}function re(i,s,h){return h(function(){oe(s)&&ue(i)})}function oe(i){var s=i.getSnapshot;i=i.value;try{var h=s();return!jn(i,h)}catch{return!0}}function ue(i){var s=Ar(i,2);s!==null&&er(s,i,2)}function le(i){var s=f();if(typeof i=="function"){var h=i;if(i=h(),Hs){be(!0);try{h()}finally{be(!1)}}}return s.memoizedState=s.baseState=i,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:L,lastRenderedState:i},s}function me(i,s,h,g){return i.baseState=h,N(i,Fi,typeof g=="function"?g:L)}function ye(i,s,h,g,M){if(Jn(i))throw Error(C(485));if(i=s.action,i!==null){var z={payload:M,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(G){z.listeners.push(G)}};He.T!==null?h(!0):z.isTransition=!1,g(z),h=s.pending,h===null?(z.next=s.pending=z,he(s,z)):(z.next=h.next,s.pending=h.next=z)}}function he(i,s){var h=s.action,g=s.payload,M=i.state;if(s.isTransition){var z=He.T,G={};He.T=G;try{var Q=h(M,g),_e=He.S;_e!==null&&_e(G,Q),Me(i,s,Q)}catch(Ge){De(i,s,Ge)}finally{z!==null&&G.types!==null&&(z.types=G.types),He.T=z}}else try{z=h(M,g),Me(i,s,z)}catch(Ge){De(i,s,Ge)}}function Me(i,s,h){h!==null&&typeof h=="object"&&typeof h.then=="function"?h.then(function(g){je(i,s,g)},function(g){return De(i,s,g)}):je(i,s,h)}function je(i,s,h){s.status="fulfilled",s.value=h,Le(s),i.state=h,s=i.pending,s!==null&&(h=s.next,h===s?i.pending=null:(h=h.next,s.next=h,he(i,h)))}function De(i,s,h){var g=i.pending;if(i.pending=null,g!==null){g=g.next;do s.status="rejected",s.reason=h,Le(s),s=s.next;while(s!==g)}i.action=null}function Le(i){i=i.listeners;for(var s=0;s<i.length;s++)(0,i[s])()}function Ne(i,s){return s}function ht(i,s){if(Ti){var h=ha.formState;if(h!==null){e:{var g=ti;if(Ti){if(Yi){t:{for(var M=Yi,z=ur;M.nodeType!==8;){if(!z){M=null;break t}if(M=Lr(M.nextSibling),M===null){M=null;break t}}z=M.data,M=z==="F!"||z==="F"?M:null}if(M){Yi=Lr(M.nextSibling),g=M.data==="F!";break e}}Yn(g)}g=!1}g&&(s=h[0])}}return h=f(),h.memoizedState=h.baseState=s,g={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ne,lastRenderedState:s},h.queue=g,h=Xl.bind(null,ti,g),g.dispatch=h,g=le(!1),z=es.bind(null,ti,!1,g.queue),g=f(),M={state:s,dispatch:null,action:i,pending:null},g.queue=M,h=ye.bind(null,ti,M,z,h),M.dispatch=h,g.memoizedState=i,[s,h,!1]}function dt(i){var s=m();return it(s,Fi,i)}function it(i,s,h){if(s=N(i,s,Ne)[0],i=F(L)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var g=T(s)}catch(G){throw G===sl?wo:G}else g=s;s=m();var M=s.queue,z=M.dispatch;return h!==s.memoizedState&&(ti.flags|=2048,Ii(9,{destroy:void 0},Rt.bind(null,M,h),null)),[g,z,i]}function Rt(i,s){i.action=s}function ei(i){var s=m(),h=Fi;if(h!==null)return it(s,h,i);m(),s=s.memoizedState,h=m();var g=h.queue.dispatch;return h.memoizedState=i,[s,g,!1]}function Ii(i,s,h,g){return i={tag:i,create:h,deps:g,inst:s,next:null},s=ti.updateQueue,s===null&&(s=x(),ti.updateQueue=s),h=s.lastEffect,h===null?s.lastEffect=i.next=i:(g=h.next,h.next=i,i.next=g,s.lastEffect=i),i}function Vi(){return m().memoizedState}function qi(i,s,h,g){var M=f();ti.flags|=i,M.memoizedState=Ii(1|s,{destroy:void 0},h,g===void 0?null:g)}function ua(i,s,h,g){var M=m();g=g===void 0?null:g;var z=M.memoizedState.inst;Fi!==null&&g!==null&&Uc(g,Fi.memoizedState.deps)?M.memoizedState=Ii(s,z,h,g):(ti.flags|=i,M.memoizedState=Ii(1|s,z,h,g))}function na(i,s){qi(8390656,8,i,s)}function vi(i,s){ua(2048,8,i,s)}function xa(i){ti.flags|=4;var s=ti.updateQueue;if(s===null)s=x(),ti.updateQueue=s,s.events=[i];else{var h=s.events;h===null?s.events=[i]:h.push(i)}}function vn(i){var s=m().memoizedState;return xa({ref:s,nextImpl:i}),function(){if((Gi&2)!==0)throw Error(C(440));return s.impl.apply(void 0,arguments)}}function La(i,s){return ua(4,2,i,s)}function Oa(i,s){return ua(4,4,i,s)}function Dn(i,s){if(typeof s=="function"){i=i();var h=s(i);return function(){typeof h=="function"?h():s(null)}}if(s!=null)return i=i(),s.current=i,function(){s.current=null}}function Xs(i,s,h){h=h!=null?h.concat([i]):null,ua(4,4,Dn.bind(null,s,i),h)}function mr(){}function Ys(i,s){var h=m();s=s===void 0?null:s;var g=h.memoizedState;return s!==null&&Uc(s,g[1])?g[0]:(h.memoizedState=[i,s],i)}function Io(i,s){var h=m();s=s===void 0?null:s;var g=h.memoizedState;if(s!==null&&Uc(s,g[1]))return g[0];if(g=i(),Hs){be(!0);try{i()}finally{be(!1)}}return h.memoizedState=[g,s],g}function Hl(i,s,h){return h===void 0||(Qi&1073741824)!==0&&(Bi&261930)===0?i.memoizedState=s:(i.memoizedState=h,i=Uf(),ti.lanes|=i,ic|=i,h)}function dl(i,s,h,g){return jn(h,s)?h:Pt.current!==null?(i=Hl(i,h,g),jn(i,s)||(rn=!0),i):(Qi&42)===0||(Qi&1073741824)!==0&&(Bi&261930)===0?(rn=!0,i.memoizedState=h):(i=Uf(),ti.lanes|=i,ic|=i,s)}function Ss(i,s,h,g,M){var z=at.p;at.p=z!==0&&8>z?z:8;var G=He.T,Q={};He.T=Q,es(i,!1,s,h);try{var _e=M(),Ge=He.S;if(Ge!==null&&Ge(Q,_e),_e!==null&&typeof _e=="object"&&typeof _e.then=="function"){var tt=wf(_e,g);Jr(i,s,tt,kr(i))}else Jr(i,s,g,kr(i))}catch(ot){Jr(i,s,{then:function(){},status:"rejected",reason:ot},kr())}finally{at.p=z,G!==null&&Q.types!==null&&(G.types=Q.types),He.T=G}}function gr(){}function Rr(i,s,h,g){if(i.tag!==5)throw Error(C(476));var M=Kr(i).queue;Ss(i,M,s,At,h===null?gr:function(){return Qn(i),h(g)})}function Kr(i){var s=i.memoizedState;if(s!==null)return s;s={memoizedState:At,baseState:At,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:L,lastRenderedState:At},next:null};var h={};return s.next={memoizedState:h,baseState:h,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:L,lastRenderedState:h},next:null},i.memoizedState=s,i=i.alternate,i!==null&&(i.memoizedState=s),s}function Qn(i){var s=Kr(i);s.next===null&&(s=i.alternate.memoizedState),Jr(i,s.next.queue,{},kr())}function Ea(){return _n(Ve)}function Xa(){return m().memoizedState}function Kn(){return m().memoizedState}function xn(i){for(var s=i.return;s!==null;){switch(s.tag){case 24:case 3:var h=kr();i=Zs(h);var g=Ir(s,i,h);g!==null&&(er(g,s,h),Ao(g,s,h)),s={cache:Lc()},i.payload=s;return}s=s.return}}function Ih(i,s,h){var g=kr();h={lane:g,revertLane:0,gesture:null,action:h,hasEagerState:!1,eagerState:null,next:null},Jn(i)?Ws(s,h):(h=po(i,s,h,g),h!==null&&(er(h,i,g),Qs(h,s,g)))}function Xl(i,s,h){var g=kr();Jr(i,s,h,g)}function Jr(i,s,h,g){var M={lane:g,revertLane:0,gesture:null,action:h,hasEagerState:!1,eagerState:null,next:null};if(Jn(i))Ws(s,M);else{var z=i.alternate;if(i.lanes===0&&(z===null||z.lanes===0)&&(z=s.lastRenderedReducer,z!==null))try{var G=s.lastRenderedState,Q=z(G,h);if(M.hasEagerState=!0,M.eagerState=Q,jn(Q,G))return Ac(i,s,M,0),ha===null&&el(),!1}catch{}finally{}if(h=po(i,s,M,g),h!==null)return er(h,i,g),Qs(h,s,g),!0}return!1}function es(i,s,h,g){if(g={lane:2,revertLane:rc(),gesture:null,action:g,hasEagerState:!1,eagerState:null,next:null},Jn(i)){if(s)throw Error(C(479))}else s=po(i,h,g,2),s!==null&&er(s,i,2)}function Jn(i){var s=i.alternate;return i===ti||s!==null&&s===ti}function Ws(i,s){ws=hl=!0;var h=i.pending;h===null?s.next=s:(s.next=h.next,h.next=s),i.pending=s}function Qs(i,s,h){if((h&4194048)!==0){var g=s.lanes;g&=i.pendingLanes,h|=g,s.lanes=h,Ji(i,h)}}var fl={readContext:_n,use:A,useCallback:aa,useContext:aa,useEffect:aa,useImperativeHandle:aa,useLayoutEffect:aa,useInsertionEffect:aa,useMemo:aa,useReducer:aa,useRef:aa,useState:aa,useDebugValue:aa,useDeferredValue:aa,useTransition:aa,useSyncExternalStore:aa,useId:aa,useHostTransitionStatus:aa,useFormState:aa,useActionState:aa,useOptimistic:aa,useMemoCache:aa,useCacheRefresh:aa};fl.useEffectEvent=aa;var Ru={readContext:_n,use:A,useCallback:function(i,s){return f().memoizedState=[i,s===void 0?null:s],i},useContext:_n,useEffect:na,useImperativeHandle:function(i,s,h){h=h!=null?h.concat([i]):null,qi(4194308,4,Dn.bind(null,s,i),h)},useLayoutEffect:function(i,s){return qi(4194308,4,i,s)},useInsertionEffect:function(i,s){qi(4,2,i,s)},useMemo:function(i,s){var h=f();s=s===void 0?null:s;var g=i();if(Hs){be(!0);try{i()}finally{be(!1)}}return h.memoizedState=[g,s],g},useReducer:function(i,s,h){var g=f();if(h!==void 0){var M=h(s);if(Hs){be(!0);try{h(s)}finally{be(!1)}}}else M=s;return g.memoizedState=g.baseState=M,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:M},g.queue=i,i=i.dispatch=Ih.bind(null,ti,i),[g.memoizedState,i]},useRef:function(i){var s=f();return i={current:i},s.memoizedState=i},useState:function(i){i=le(i);var s=i.queue,h=Xl.bind(null,ti,s);return s.dispatch=h,[i.memoizedState,h]},useDebugValue:mr,useDeferredValue:function(i,s){var h=f();return Hl(h,i,s)},useTransition:function(){var i=le(!1);return i=Ss.bind(null,ti,i.queue,!0,!1),f().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,s,h){var g=ti,M=f();if(Ti){if(h===void 0)throw Error(C(407));h=h()}else{if(h=s(),ha===null)throw Error(C(349));(Bi&127)!==0||ae(g,s,h)}M.memoizedState=h;var z={value:h,getSnapshot:s};return M.queue=z,na(re.bind(null,g,z,i),[i]),g.flags|=2048,Ii(9,{destroy:void 0},ne.bind(null,g,z,h,s),null),h},useId:function(){var i=f(),s=ha.identifierPrefix;if(Ti){var h=Xn,g=_s;h=(g&~(1<<32-Ie(g)-1)).toString(32)+h,s="_"+s+"R_"+h,h=Wr++,0<h&&(s+="H"+h.toString(32)),s+="_"}else h=zu++,s="_"+s+"r_"+h.toString(32)+"_";return i.memoizedState=s},useHostTransitionStatus:Ea,useFormState:ht,useActionState:ht,useOptimistic:function(i){var s=f();s.memoizedState=s.baseState=i;var h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=h,s=es.bind(null,ti,!0,h),h.dispatch=s,[i,s]},useMemoCache:k,useCacheRefresh:function(){return f().memoizedState=xn.bind(null,ti)},useEffectEvent:function(i){var s=f(),h={impl:i};return s.memoizedState=h,function(){if((Gi&2)!==0)throw Error(C(440));return h.impl.apply(void 0,arguments)}}},Ms={readContext:_n,use:A,useCallback:Ys,useContext:_n,useEffect:vi,useImperativeHandle:Xs,useInsertionEffect:La,useLayoutEffect:Oa,useMemo:Io,useReducer:F,useRef:Vi,useState:function(){return F(L)},useDebugValue:mr,useDeferredValue:function(i,s){var h=m();return dl(h,Fi.memoizedState,i,s)},useTransition:function(){var i=F(L)[0],s=m().memoizedState;return[typeof i=="boolean"?i:T(i),s]},useSyncExternalStore:X,useId:Xa,useHostTransitionStatus:Ea,useFormState:dt,useActionState:dt,useOptimistic:function(i,s){var h=m();return me(h,Fi,i,s)},useMemoCache:k,useCacheRefresh:Kn};Ms.useEffectEvent=vn;var Du={readContext:_n,use:A,useCallback:Ys,useContext:_n,useEffect:vi,useImperativeHandle:Xs,useInsertionEffect:La,useLayoutEffect:Oa,useMemo:Io,useReducer:q,useRef:Vi,useState:function(){return q(L)},useDebugValue:mr,useDeferredValue:function(i,s){var h=m();return Fi===null?Hl(h,i,s):dl(h,Fi.memoizedState,i,s)},useTransition:function(){var i=q(L)[0],s=m().memoizedState;return[typeof i=="boolean"?i:T(i),s]},useSyncExternalStore:X,useId:Xa,useHostTransitionStatus:Ea,useFormState:ei,useActionState:ei,useOptimistic:function(i,s){var h=m();return Fi!==null?me(h,Fi,i,s):(h.baseState=i,[i,h.queue.dispatch])},useMemoCache:k,useCacheRefresh:Kn};Du.useEffectEvent=vn;function Zc(i,s,h,g){s=i.memoizedState,h=h(g,s),h=h==null?s:K({},s,h),i.memoizedState=h,i.lanes===0&&(i.updateQueue.baseState=h)}var pl={enqueueSetState:function(i,s,h){i=i._reactInternals;var g=kr(),M=Zs(g);M.payload=s,h!=null&&(M.callback=h),s=Ir(i,M,g),s!==null&&(er(s,i,g),Ao(s,i,g))},enqueueReplaceState:function(i,s,h){i=i._reactInternals;var g=kr(),M=Zs(g);M.tag=1,M.payload=s,h!=null&&(M.callback=h),s=Ir(i,M,g),s!==null&&(er(s,i,g),Ao(s,i,g))},enqueueForceUpdate:function(i,s){i=i._reactInternals;var h=kr(),g=Zs(h);g.tag=2,s!=null&&(g.callback=s),s=Ir(i,g,h),s!==null&&(er(s,i,h),Ao(s,i,h))}};function Sf(i,s,h,g,M,z,G){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(g,z,G):s.prototype&&s.prototype.isPureReactComponent?!fo(h,g)||!fo(M,z):!0}function Yl(i,s,h,g){i=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(h,g),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(h,g),s.state!==i&&pl.enqueueReplaceState(s,s.state,null)}function ts(i,s){var h=s;if("ref"in s){h={};for(var g in s)g!=="ref"&&(h[g]=s[g])}if(i=i.defaultProps){h===s&&(h=K({},h));for(var M in i)h[M]===void 0&&(h[M]=i[M])}return h}function Mf(i){gs(i)}function Vp(i){console.error(i)}function Td(i){gs(i)}function Rh(i,s){try{var h=i.onUncaughtError;h(s.value,{componentStack:s.stack})}catch(g){setTimeout(function(){throw g})}}function Dh(i,s,h){try{var g=i.onCaughtError;g(h.value,{componentStack:h.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(M){setTimeout(function(){throw M})}}function Ed(i,s,h){return h=Zs(h),h.tag=3,h.payload={element:null},h.callback=function(){Rh(i,s)},h}function qp(i){return i=Zs(i),i.tag=3,i}function Cd(i,s,h,g){var M=h.type.getDerivedStateFromError;if(typeof M=="function"){var z=g.value;i.payload=function(){return M(z)},i.callback=function(){Dh(s,h,g)}}var G=h.stateNode;G!==null&&typeof G.componentDidCatch=="function"&&(i.callback=function(){Dh(s,h,g),typeof M!="function"&&(vl===null?vl=new Set([this]):vl.add(this));var Q=g.stack;this.componentDidCatch(g.value,{componentStack:Q!==null?Q:""})})}function Jm(i,s,h,g,M){if(h.flags|=32768,g!==null&&typeof g=="object"&&typeof g.then=="function"){if(s=h.alternate,s!==null&&Pr(s,h,M,!0),h=la.current,h!==null){switch(h.tag){case 31:case 13:return fr===null?Fd():h.alternate===null&&Ya===0&&(Ya=3),h.flags&=-257,h.flags|=65536,h.lanes=M,g===So?h.flags|=16384:(s=h.updateQueue,s===null?h.updateQueue=new Set([g]):s.add(g),Wh(i,g,M)),!1;case 22:return h.flags|=65536,g===So?h.flags|=16384:(s=h.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([g])},h.updateQueue=s):(h=s.retryQueue,h===null?s.retryQueue=new Set([g]):h.add(g)),Wh(i,g,M)),!1}throw Error(C(435,h.tag))}return Wh(i,g,M),Fd(),!1}if(Ti)return s=la.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=M,g!==Ta&&(i=Error(C(422),{cause:g}),ys(Gn(i,h)))):(g!==Ta&&(s=Error(C(423),{cause:g}),ys(Gn(s,h))),i=i.current.alternate,i.flags|=65536,M&=-M,i.lanes|=M,g=Gn(g,h),M=Ed(i.stateNode,g,M),Fc(i,M),Ya!==4&&(Ya=2)),!1;var z=Error(C(520),{cause:g});if(z=Gn(z,h),eu===null?eu=[z]:eu.push(z),Ya!==4&&(Ya=2),s===null)return!0;g=Gn(g,h),h=s;do{switch(h.tag){case 3:return h.flags|=65536,i=M&-M,h.lanes|=i,i=Ed(h.stateNode,g,i),Fc(h,i),!1;case 1:if(s=h.type,z=h.stateNode,(h.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||z!==null&&typeof z.componentDidCatch=="function"&&(vl===null||!vl.has(z))))return h.flags|=65536,M&=-M,h.lanes|=M,M=qp(M),Cd(M,i,h,g),Fc(h,M),!1}h=h.return}while(h!==null);return!1}var kh=Error(C(461)),rn=!1;function kn(i,s,h,g){s.child=i===null?zh(s,null,h,g):Co(s,i.child,h,g)}function $c(i,s,h,g,M){h=h.render;var z=s.ref;if("ref"in g){var G={};for(var Q in g)Q!=="ref"&&(G[Q]=g[Q])}else G=g;return vo(s),g=Vc(i,s,h,G,z,M),Q=e(),i!==null&&!rn?(r(i,s,M),Ks(i,s,M)):(Ti&&Q&&al(s),s.flags|=1,kn(i,s,g,M),s.child)}function Zp(i,s,h,g,M){if(i===null){var z=h.type;return typeof z=="function"&&!Pc(z)&&z.defaultProps===void 0&&h.compare===null?(s.tag=15,s.type=z,Hc(i,s,z,g,M)):(i=tl(h.type,null,g,s,s.mode,M),i.ref=s.ref,i.return=s,s.child=i)}if(z=i.child,!Pf(i,M)){var G=z.memoizedProps;if(h=h.compare,h=h!==null?h:fo,h(G,g)&&i.ref===s.ref)return Ks(i,s,M)}return s.flags|=1,i=cr(z,g),i.ref=s.ref,i.return=s,s.child=i}function Hc(i,s,h,g,M){if(i!==null){var z=i.memoizedProps;if(fo(z,g)&&i.ref===s.ref)if(rn=!1,s.pendingProps=g=z,Pf(i,M))(i.flags&131072)!==0&&(rn=!0);else return s.lanes=i.lanes,Ks(i,s,M)}return Bh(i,s,h,g,M)}function Lh(i,s,h,g){var M=g.children,z=i!==null?i.memoizedState:null;if(i===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),g.mode==="hidden"){if((s.flags&128)!==0){if(z=z!==null?z.baseLanes|h:h,i!==null){for(g=s.child=i.child,M=0;g!==null;)M=M|g.lanes|g.childLanes,g=g.sibling;g=M&~z}else g=0,s.child=null;return $p(i,s,z,h,g)}if((h&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},i!==null&&zr(s,z!==null?z.cachePool:null),z!==null?ul(s,z):Pu(),Md(s);else return g=s.lanes=536870912,$p(i,s,z!==null?z.baseLanes|h:h,h,g)}else z!==null?(zr(s,z.cachePool),ul(s,z),Po(),s.memoizedState=null):(i!==null&&zr(s,null),Pu(),Po());return kn(i,s,M,h),s.child}function Wl(i,s){return i!==null&&i.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function $p(i,s,h,g,M){var z=rl();return z=z===null?null:{parent:oa._currentValue,pool:z},s.memoizedState={baseLanes:h,cachePool:z},i!==null&&zr(s,null),Pu(),Md(s),i!==null&&Pr(i,s,g,!0),s.childLanes=M,null}function Ad(i,s){return s=jh({mode:s.mode,children:s.children},i.mode),s.ref=i.ref,i.child=s,s.return=i,s}function Hp(i,s,h){return Co(s,i.child,null,h),i=Ad(s,s.pendingProps),i.flags|=2,pr(s),s.memoizedState=null,i}function eg(i,s,h){var g=s.pendingProps,M=(s.flags&128)!==0;if(s.flags&=-129,i===null){if(Ti){if(g.mode==="hidden")return i=Ad(s,g),s.lanes=536870912,Wl(null,i);if($s(s),(i=Yi)?(i=Sm(i,ur),i=i!==null&&i.data==="&"?i:null,i!==null&&(s.memoizedState={dehydrated:i,treeContext:Zr!==null?{id:_s,overflow:Xn}:null,retryLane:536870912,hydrationErrors:null},h=Eu(i),h.return=s,s.child=h,Ha=s,Yi=null)):i=null,i===null)throw Yn(s);return s.lanes=536870912,null}return Ad(s,g)}var z=i.memoizedState;if(z!==null){var G=z.dehydrated;if($s(s),M)if(s.flags&256)s.flags&=-257,s=Hp(i,s,h);else if(s.memoizedState!==null)s.child=i.child,s.flags|=128,s=null;else throw Error(C(558));else if(rn||Pr(i,s,h,!1),M=(h&i.childLanes)!==0,rn||M){if(g=ha,g!==null&&(G=Za(g,h),G!==0&&G!==z.retryLane))throw z.retryLane=G,Ar(i,G),er(g,i,G),kh;Fd(),s=Hp(i,s,h)}else i=z.treeContext,Yi=Lr(G.nextSibling),Ha=s,Ti=!0,$r=null,ur=!1,i!==null&&Ic(s,i),s=Ad(s,g),s.flags|=4096;return s}return i=cr(i.child,{mode:g.mode,children:g.children}),i.ref=s.ref,s.child=i,i.return=s,i}function Oh(i,s){var h=s.ref;if(h===null)i!==null&&i.ref!==null&&(s.flags|=4194816);else{if(typeof h!="function"&&typeof h!="object")throw Error(C(284));(i===null||i.ref!==h)&&(s.flags|=4194816)}}function Bh(i,s,h,g,M){return vo(s),h=Vc(i,s,h,g,void 0,M),g=e(),i!==null&&!rn?(r(i,s,M),Ks(i,s,M)):(Ti&&g&&al(s),s.flags|=1,kn(i,s,h,M),s.child)}function Tf(i,s,h,g,M,z){return vo(s),s.updateQueue=null,h=Iu(s,g,h,M),qc(i),g=e(),i!==null&&!rn?(r(i,s,z),Ks(i,s,z)):(Ti&&g&&al(s),s.flags|=1,kn(i,s,h,z),s.child)}function Ef(i,s,h,g,M){if(vo(s),s.stateNode===null){var z=ui,G=h.contextType;typeof G=="object"&&G!==null&&(z=_n(G)),z=new h(g,z),s.memoizedState=z.state!==null&&z.state!==void 0?z.state:null,z.updater=pl,s.stateNode=z,z._reactInternals=s,z=s.stateNode,z.props=g,z.state=s.memoizedState,z.refs={},bs(s),G=h.contextType,z.context=typeof G=="object"&&G!==null?_n(G):ui,z.state=s.memoizedState,G=h.getDerivedStateFromProps,typeof G=="function"&&(Zc(s,h,G,g),z.state=s.memoizedState),typeof h.getDerivedStateFromProps=="function"||typeof z.getSnapshotBeforeUpdate=="function"||typeof z.UNSAFE_componentWillMount!="function"&&typeof z.componentWillMount!="function"||(G=z.state,typeof z.componentWillMount=="function"&&z.componentWillMount(),typeof z.UNSAFE_componentWillMount=="function"&&z.UNSAFE_componentWillMount(),G!==z.state&&pl.enqueueReplaceState(z,z.state,null),cl(s,g,z,M),Zl(),z.state=s.memoizedState),typeof z.componentDidMount=="function"&&(s.flags|=4194308),g=!0}else if(i===null){z=s.stateNode;var Q=s.memoizedProps,_e=ts(h,Q);z.props=_e;var Ge=z.context,tt=h.contextType;G=ui,typeof tt=="object"&&tt!==null&&(G=_n(tt));var ot=h.getDerivedStateFromProps;tt=typeof ot=="function"||typeof z.getSnapshotBeforeUpdate=="function",Q=s.pendingProps!==Q,tt||typeof z.UNSAFE_componentWillReceiveProps!="function"&&typeof z.componentWillReceiveProps!="function"||(Q||Ge!==G)&&Yl(s,z,g,G),qs=!1;var qe=s.memoizedState;z.state=qe,cl(s,g,z,M),Zl(),Ge=s.memoizedState,Q||qe!==Ge||qs?(typeof ot=="function"&&(Zc(s,h,ot,g),Ge=s.memoizedState),(_e=qs||Sf(s,h,_e,g,qe,Ge,G))?(tt||typeof z.UNSAFE_componentWillMount!="function"&&typeof z.componentWillMount!="function"||(typeof z.componentWillMount=="function"&&z.componentWillMount(),typeof z.UNSAFE_componentWillMount=="function"&&z.UNSAFE_componentWillMount()),typeof z.componentDidMount=="function"&&(s.flags|=4194308)):(typeof z.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=g,s.memoizedState=Ge),z.props=g,z.state=Ge,z.context=G,g=_e):(typeof z.componentDidMount=="function"&&(s.flags|=4194308),g=!1)}else{z=s.stateNode,Wi(i,s),G=s.memoizedProps,tt=ts(h,G),z.props=tt,ot=s.pendingProps,qe=z.context,Ge=h.contextType,_e=ui,typeof Ge=="object"&&Ge!==null&&(_e=_n(Ge)),Q=h.getDerivedStateFromProps,(Ge=typeof Q=="function"||typeof z.getSnapshotBeforeUpdate=="function")||typeof z.UNSAFE_componentWillReceiveProps!="function"&&typeof z.componentWillReceiveProps!="function"||(G!==ot||qe!==_e)&&Yl(s,z,g,_e),qs=!1,qe=s.memoizedState,z.state=qe,cl(s,g,z,M),Zl();var Xe=s.memoizedState;G!==ot||qe!==Xe||qs||i!==null&&i.dependencies!==null&&Dc(i.dependencies)?(typeof Q=="function"&&(Zc(s,h,Q,g),Xe=s.memoizedState),(tt=qs||Sf(s,h,tt,g,qe,Xe,_e)||i!==null&&i.dependencies!==null&&Dc(i.dependencies))?(Ge||typeof z.UNSAFE_componentWillUpdate!="function"&&typeof z.componentWillUpdate!="function"||(typeof z.componentWillUpdate=="function"&&z.componentWillUpdate(g,Xe,_e),typeof z.UNSAFE_componentWillUpdate=="function"&&z.UNSAFE_componentWillUpdate(g,Xe,_e)),typeof z.componentDidUpdate=="function"&&(s.flags|=4),typeof z.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof z.componentDidUpdate!="function"||G===i.memoizedProps&&qe===i.memoizedState||(s.flags|=4),typeof z.getSnapshotBeforeUpdate!="function"||G===i.memoizedProps&&qe===i.memoizedState||(s.flags|=1024),s.memoizedProps=g,s.memoizedState=Xe),z.props=g,z.state=Xe,z.context=_e,g=tt):(typeof z.componentDidUpdate!="function"||G===i.memoizedProps&&qe===i.memoizedState||(s.flags|=4),typeof z.getSnapshotBeforeUpdate!="function"||G===i.memoizedProps&&qe===i.memoizedState||(s.flags|=1024),g=!1)}return z=g,Oh(i,s),g=(s.flags&128)!==0,z||g?(z=s.stateNode,h=g&&typeof h.getDerivedStateFromError!="function"?null:z.render(),s.flags|=1,i!==null&&g?(s.child=Co(s,i.child,null,M),s.child=Co(s,null,h,M)):kn(i,s,h,M),s.memoizedState=z.state,i=s.child):i=Ks(i,s,M),i}function Xp(i,s,h,g){return Gs(),s.flags|=256,kn(i,s,h,g),s.child}var Cf={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Pd(i){return{baseLanes:i,cachePool:Tt()}}function zd(i,s,h){return i=i!==null?i.childLanes&~h:0,s&&(i|=as),i}function Yp(i,s,h){var g=s.pendingProps,M=!1,z=(s.flags&128)!==0,G;if((G=z)||(G=i!==null&&i.memoizedState===null?!1:(fa.current&2)!==0),G&&(M=!0,s.flags&=-129),G=(s.flags&32)!==0,s.flags&=-33,i===null){if(Ti){if(M?yn(s):Po(),(i=Yi)?(i=Sm(i,ur),i=i!==null&&i.data!=="&"?i:null,i!==null&&(s.memoizedState={dehydrated:i,treeContext:Zr!==null?{id:_s,overflow:Xn}:null,retryLane:536870912,hydrationErrors:null},h=Eu(i),h.return=s,s.child=h,Ha=s,Yi=null)):i=null,i===null)throw Yn(s);return oc(i)?s.lanes=32:s.lanes=536870912,null}var Q=g.children;return g=g.fallback,M?(Po(),M=s.mode,Q=jh({mode:"hidden",children:Q},M),g=Bs(g,M,h,null),Q.return=s,g.return=s,Q.sibling=g,s.child=Q,g=s.child,g.memoizedState=Pd(h),g.childLanes=zd(i,G,h),s.memoizedState=Cf,Wl(null,g)):(yn(s),Nh(s,Q))}var _e=i.memoizedState;if(_e!==null&&(Q=_e.dehydrated,Q!==null)){if(z)s.flags&256?(yn(s),s.flags&=-257,s=Fh(i,s,h)):s.memoizedState!==null?(Po(),s.child=i.child,s.flags|=128,s=null):(Po(),Q=g.fallback,M=s.mode,g=jh({mode:"visible",children:g.children},M),Q=Bs(Q,M,h,null),Q.flags|=2,g.return=s,Q.return=s,g.sibling=Q,s.child=g,Co(s,i.child,null,h),g=s.child,g.memoizedState=Pd(h),g.childLanes=zd(i,G,h),s.memoizedState=Cf,s=Wl(null,g));else if(yn(s),oc(Q)){if(G=Q.nextSibling&&Q.nextSibling.dataset,G)var Ge=G.dgst;G=Ge,g=Error(C(419)),g.stack="",g.digest=G,ys({value:g,source:null,stack:null}),s=Fh(i,s,h)}else if(rn||Pr(i,s,h,!1),G=(h&i.childLanes)!==0,rn||G){if(G=ha,G!==null&&(g=Za(G,h),g!==0&&g!==_e.retryLane))throw _e.retryLane=g,Ar(i,g),er(G,i,g),kh;hp(Q)||Fd(),s=Fh(i,s,h)}else hp(Q)?(s.flags|=192,s.child=i.child,s=null):(i=_e.treeContext,Yi=Lr(Q.nextSibling),Ha=s,Ti=!0,$r=null,ur=!1,i!==null&&Ic(s,i),s=Nh(s,g.children),s.flags|=4096);return s}return M?(Po(),Q=g.fallback,M=s.mode,_e=i.child,Ge=_e.sibling,g=cr(_e,{mode:"hidden",children:g.children}),g.subtreeFlags=_e.subtreeFlags&65011712,Ge!==null?Q=cr(Ge,Q):(Q=Bs(Q,M,h,null),Q.flags|=2),Q.return=s,g.return=s,g.sibling=Q,s.child=g,Wl(null,g),g=s.child,Q=i.child.memoizedState,Q===null?Q=Pd(h):(M=Q.cachePool,M!==null?(_e=oa._currentValue,M=M.parent!==_e?{parent:_e,pool:_e}:M):M=Tt(),Q={baseLanes:Q.baseLanes|h,cachePool:M}),g.memoizedState=Q,g.childLanes=zd(i,G,h),s.memoizedState=Cf,Wl(i.child,g)):(yn(s),h=i.child,i=h.sibling,h=cr(h,{mode:"visible",children:g.children}),h.return=s,h.sibling=null,i!==null&&(G=s.deletions,G===null?(s.deletions=[i],s.flags|=16):G.push(i)),s.child=h,s.memoizedState=null,h)}function Nh(i,s){return s=jh({mode:"visible",children:s},i.mode),s.return=i,i.child=s}function jh(i,s){return i=lr(22,i,null,s),i.lanes=0,i}function Fh(i,s,h){return Co(s,i.child,null,h),i=Nh(s,s.pendingProps.children),i.flags|=2,s.memoizedState=null,i}function ku(i,s,h){i.lanes|=s;var g=i.alternate;g!==null&&(g.lanes|=s),Rc(i.return,s,h)}function Vn(i,s,h,g,M,z){var G=i.memoizedState;G===null?i.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:g,tail:h,tailMode:M,treeForkCount:z}:(G.isBackwards=s,G.rendering=null,G.renderingStartTime=0,G.last=g,G.tail=h,G.tailMode=M,G.treeForkCount=z)}function Af(i,s,h){var g=s.pendingProps,M=g.revealOrder,z=g.tail;g=g.children;var G=fa.current,Q=(G&2)!==0;if(Q?(G=G&1|2,s.flags|=128):G&=1,We(fa,G),kn(i,s,g,h),g=Ti?_o:0,!Q&&i!==null&&(i.flags&128)!==0)e:for(i=s.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&ku(i,h,s);else if(i.tag===19)ku(i,h,s);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break e;for(;i.sibling===null;){if(i.return===null||i.return===s)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}switch(M){case"forwards":for(h=s.child,M=null;h!==null;)i=h.alternate,i!==null&&ca(i)===null&&(M=h),h=h.sibling;h=M,h===null?(M=s.child,s.child=null):(M=h.sibling,h.sibling=null),Vn(s,!1,M,h,z,g);break;case"backwards":case"unstable_legacy-backwards":for(h=null,M=s.child,s.child=null;M!==null;){if(i=M.alternate,i!==null&&ca(i)===null){s.child=M;break}i=M.sibling,M.sibling=h,h=M,M=i}Vn(s,!0,h,null,z,g);break;case"together":Vn(s,!1,null,null,void 0,g);break;default:s.memoizedState=null}return s.child}function Ks(i,s,h){if(i!==null&&(s.dependencies=i.dependencies),ic|=s.lanes,(h&s.childLanes)===0)if(i!==null){if(Pr(i,s,h,!1),(h&s.childLanes)===0)return null}else return null;if(i!==null&&s.child!==i.child)throw Error(C(153));if(s.child!==null){for(i=s.child,h=cr(i,i.pendingProps),s.child=h,h.return=s;i.sibling!==null;)i=i.sibling,h=h.sibling=cr(i,i.pendingProps),h.return=s;h.sibling=null}return s.child}function Pf(i,s){return(i.lanes&s)!==0?!0:(i=i.dependencies,!!(i!==null&&Dc(i)))}function Wp(i,s,h){switch(s.tag){case 3:Ut(s,s.stateNode.containerInfo),Vs(s,oa,i.memoizedState.cache),Gs();break;case 27:case 5:Ni(s);break;case 4:Ut(s,s.stateNode.containerInfo);break;case 10:Vs(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,$s(s),null;break;case 13:var g=s.memoizedState;if(g!==null)return g.dehydrated!==null?(yn(s),s.flags|=128,null):(h&s.child.childLanes)!==0?Yp(i,s,h):(yn(s),i=Ks(i,s,h),i!==null?i.sibling:null);yn(s);break;case 19:var M=(i.flags&128)!==0;if(g=(h&s.childLanes)!==0,g||(Pr(i,s,h,!1),g=(h&s.childLanes)!==0),M){if(g)return Af(i,s,h);s.flags|=128}if(M=s.memoizedState,M!==null&&(M.rendering=null,M.tail=null,M.lastEffect=null),We(fa,fa.current),g)break;return null;case 22:return s.lanes=0,Lh(i,s,h,s.pendingProps);case 24:Vs(s,oa,i.memoizedState.cache)}return Ks(i,s,h)}function Qp(i,s,h){if(i!==null)if(i.memoizedProps!==s.pendingProps)rn=!0;else{if(!Pf(i,h)&&(s.flags&128)===0)return rn=!1,Wp(i,s,h);rn=(i.flags&131072)!==0}else rn=!1,Ti&&(s.flags&1048576)!==0&&Eh(s,_o,s.index);switch(s.lanes=0,s.tag){case 16:e:{var g=s.pendingProps;if(i=oi(s.elementType),s.type=i,typeof i=="function")Pc(i)?(g=ts(i,g),s.tag=1,s=Ef(null,s,i,g,h)):(s.tag=0,s=Bh(null,s,i,g,h));else{if(i!=null){var M=i.$$typeof;if(M===vt){s.tag=11,s=$c(null,s,i,g,h);break e}else if(M===lt){s.tag=14,s=Zp(null,s,i,g,h);break e}}throw s=Oi(i)||i,Error(C(306,s,""))}}return s;case 0:return Bh(i,s,s.type,s.pendingProps,h);case 1:return g=s.type,M=ts(g,s.pendingProps),Ef(i,s,g,M,h);case 3:e:{if(Ut(s,s.stateNode.containerInfo),i===null)throw Error(C(387));g=s.pendingProps;var z=s.memoizedState;M=z.element,Wi(i,s),cl(s,g,null,h);var G=s.memoizedState;if(g=G.cache,Vs(s,oa,g),g!==z.cache&&yo(s,[oa],h,!0),Zl(),g=G.element,z.isDehydrated)if(z={element:g,isDehydrated:!1,cache:G.cache},s.updateQueue.baseState=z,s.memoizedState=z,s.flags&256){s=Xp(i,s,g,h);break e}else if(g!==M){M=Gn(Error(C(424)),s),ys(M),s=Xp(i,s,g,h);break e}else{switch(i=s.stateNode.containerInfo,i.nodeType){case 9:i=i.body;break;default:i=i.nodeName==="HTML"?i.ownerDocument.body:i}for(Yi=Lr(i.firstChild),Ha=s,Ti=!0,$r=null,ur=!0,h=zh(s,null,g,h),s.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling}else{if(Gs(),g===M){s=Ks(i,s,h);break e}kn(i,s,g,h)}s=s.child}return s;case 26:return Oh(i,s),i===null?(h=Am(s.type,null,s.pendingProps,null))?s.memoizedState=h:Ti||(h=s.type,i=s.pendingProps,g=Kd(Ot.current).createElement(h),g[Ri]=s,g[ut]=i,on(g,h,i),Ma(g),s.stateNode=g):s.memoizedState=Am(s.type,i.memoizedProps,s.pendingProps,i.memoizedState),null;case 27:return Ni(s),i===null&&Ti&&(g=s.stateNode=Mm(s.type,s.pendingProps,Ot.current),Ha=s,ur=!0,M=Yi,io(s.type)?(af=M,Yi=Lr(g.firstChild)):Yi=M),kn(i,s,s.pendingProps.children,h),Oh(i,s),i===null&&(s.flags|=4194304),s.child;case 5:return i===null&&Ti&&((M=g=Yi)&&(g=tf(g,s.type,s.pendingProps,ur),g!==null?(s.stateNode=g,Ha=s,Yi=Lr(g.firstChild),ur=!1,M=!0):M=!1),M||Yn(s)),Ni(s),M=s.type,z=s.pendingProps,G=i!==null?i.memoizedProps:null,g=z.children,Jd(M,z)?g=null:G!==null&&Jd(M,G)&&(s.flags|=32),s.memoizedState!==null&&(M=Vc(i,s,p,null,null,h),Ve._currentValue=M),Oh(i,s),kn(i,s,g,h),s.child;case 6:return i===null&&Ti&&((i=h=Yi)&&(h=pg(h,s.pendingProps,ur),h!==null?(s.stateNode=h,Ha=s,Yi=null,i=!0):i=!1),i||Yn(s)),null;case 13:return Yp(i,s,h);case 4:return Ut(s,s.stateNode.containerInfo),g=s.pendingProps,i===null?s.child=Co(s,null,g,h):kn(i,s,g,h),s.child;case 11:return $c(i,s,s.type,s.pendingProps,h);case 7:return kn(i,s,s.pendingProps,h),s.child;case 8:return kn(i,s,s.pendingProps.children,h),s.child;case 12:return kn(i,s,s.pendingProps.children,h),s.child;case 10:return g=s.pendingProps,Vs(s,s.type,g.value),kn(i,s,g.children,h),s.child;case 9:return M=s.type._context,g=s.pendingProps.children,vo(s),M=_n(M),g=g(M),s.flags|=1,kn(i,s,g,h),s.child;case 14:return Zp(i,s,s.type,s.pendingProps,h);case 15:return Hc(i,s,s.type,s.pendingProps,h);case 19:return Af(i,s,h);case 31:return eg(i,s,h);case 22:return Lh(i,s,h,s.pendingProps);case 24:return vo(s),g=_n(oa),i===null?(M=rl(),M===null&&(M=ha,z=Lc(),M.pooledCache=z,z.refCount++,z!==null&&(M.pooledCacheLanes|=h),M=z),s.memoizedState={parent:g,cache:M},bs(s),Vs(s,oa,M)):((i.lanes&h)!==0&&(Wi(i,s),cl(s,null,null,h),Zl()),M=i.memoizedState,z=s.memoizedState,M.parent!==g?(M={parent:g,cache:g},s.memoizedState=M,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=M),Vs(s,oa,g)):(g=z.cache,Vs(s,oa,g),g!==M.cache&&yo(s,[oa],h,!0))),kn(i,s,s.pendingProps.children,h),s.child;case 29:throw s.pendingProps}throw Error(C(156,s.tag))}function ml(i){i.flags|=4}function Id(i,s,h,g,M){if((s=(i.mode&32)!==0)&&(s=!1),s){if(i.flags|=16777216,(M&335544128)===M)if(i.stateNode.complete)i.flags|=8192;else if(lm())i.flags|=8192;else throw xs=So,Oc}else i.flags&=-16777217}function Kp(i,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)i.flags&=-16777217;else if(i.flags|=16777216,!Z(s))if(lm())i.flags|=8192;else throw xs=So,Oc}function Lu(i,s){s!==null&&(i.flags|=4),i.flags&16384&&(s=i.tag!==22?Ei():536870912,i.lanes|=s,Jc|=s)}function Ou(i,s){if(!Ti)switch(i.tailMode){case"hidden":s=i.tail;for(var h=null;s!==null;)s.alternate!==null&&(h=s),s=s.sibling;h===null?i.tail=null:h.sibling=null;break;case"collapsed":h=i.tail;for(var g=null;h!==null;)h.alternate!==null&&(g=h),h=h.sibling;g===null?s||i.tail===null?i.tail=null:i.tail.sibling=null:g.sibling=null}}function Ca(i){var s=i.alternate!==null&&i.alternate.child===i.child,h=0,g=0;if(s)for(var M=i.child;M!==null;)h|=M.lanes|M.childLanes,g|=M.subtreeFlags&65011712,g|=M.flags&65011712,M.return=i,M=M.sibling;else for(M=i.child;M!==null;)h|=M.lanes|M.childLanes,g|=M.subtreeFlags,g|=M.flags,M.return=i,M=M.sibling;return i.subtreeFlags|=g,i.childLanes=h,s}function tg(i,s,h){var g=s.pendingProps;switch(Fl(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ca(s),null;case 1:return Ca(s),null;case 3:return h=s.stateNode,g=null,i!==null&&(g=i.memoizedState.cache),s.memoizedState.cache!==g&&(s.flags|=2048),Xr(oa),jt(),h.pendingContext&&(h.context=h.pendingContext,h.pendingContext=null),(i===null||i.child===null)&&(Fs(s)?ml(s):i===null||i.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,Us())),Ca(s),null;case 26:var M=s.type,z=s.memoizedState;return i===null?(ml(s),z!==null?(Ca(s),Kp(s,z)):(Ca(s),Id(s,M,null,g,h))):z?z!==i.memoizedState?(ml(s),Ca(s),Kp(s,z)):(Ca(s),s.flags&=-16777217):(i=i.memoizedProps,i!==g&&ml(s),Ca(s),Id(s,M,i,g,h)),null;case 27:if(ri(s),h=Ot.current,M=s.type,i!==null&&s.stateNode!=null)i.memoizedProps!==g&&ml(s);else{if(!g){if(s.stateNode===null)throw Error(C(166));return Ca(s),null}i=Mt.current,Fs(s)?hr(s):(i=Mm(M,g,h),s.stateNode=i,ml(s))}return Ca(s),null;case 5:if(ri(s),M=s.type,i!==null&&s.stateNode!=null)i.memoizedProps!==g&&ml(s);else{if(!g){if(s.stateNode===null)throw Error(C(166));return Ca(s),null}if(z=Mt.current,Fs(s))hr(s);else{var G=Kd(Ot.current);switch(z){case 1:z=G.createElementNS("http://www.w3.org/2000/svg",M);break;case 2:z=G.createElementNS("http://www.w3.org/1998/Math/MathML",M);break;default:switch(M){case"svg":z=G.createElementNS("http://www.w3.org/2000/svg",M);break;case"math":z=G.createElementNS("http://www.w3.org/1998/Math/MathML",M);break;case"script":z=G.createElement("div"),z.innerHTML="<script><\/script>",z=z.removeChild(z.firstChild);break;case"select":z=typeof g.is=="string"?G.createElement("select",{is:g.is}):G.createElement("select"),g.multiple?z.multiple=!0:g.size&&(z.size=g.size);break;default:z=typeof g.is=="string"?G.createElement(M,{is:g.is}):G.createElement(M)}}z[Ri]=s,z[ut]=g;e:for(G=s.child;G!==null;){if(G.tag===5||G.tag===6)z.appendChild(G.stateNode);else if(G.tag!==4&&G.tag!==27&&G.child!==null){G.child.return=G,G=G.child;continue}if(G===s)break e;for(;G.sibling===null;){if(G.return===null||G.return===s)break e;G=G.return}G.sibling.return=G.return,G=G.sibling}s.stateNode=z;e:switch(on(z,M,g),M){case"button":case"input":case"select":case"textarea":g=!!g.autoFocus;break e;case"img":g=!0;break e;default:g=!1}g&&ml(s)}}return Ca(s),Id(s,s.type,i===null?null:i.memoizedProps,s.pendingProps,h),null;case 6:if(i&&s.stateNode!=null)i.memoizedProps!==g&&ml(s);else{if(typeof g!="string"&&s.stateNode===null)throw Error(C(166));if(i=Ot.current,Fs(s)){if(i=s.stateNode,h=s.memoizedProps,g=null,M=Ha,M!==null)switch(M.tag){case 27:case 5:g=M.memoizedProps}i[Ri]=s,i=!!(i.nodeValue===h||g!==null&&g.suppressHydrationWarning===!0||sp(i.nodeValue,h)),i||Yn(s,!0)}else i=Kd(i).createTextNode(g),i[Ri]=s,s.stateNode=i}return Ca(s),null;case 31:if(h=s.memoizedState,i===null||i.memoizedState!==null){if(g=Fs(s),h!==null){if(i===null){if(!g)throw Error(C(318));if(i=s.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(C(557));i[Ri]=s}else Gs(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Ca(s),i=!1}else h=Us(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=h),i=!0;if(!i)return s.flags&256?(pr(s),s):(pr(s),null);if((s.flags&128)!==0)throw Error(C(558))}return Ca(s),null;case 13:if(g=s.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(M=Fs(s),g!==null&&g.dehydrated!==null){if(i===null){if(!M)throw Error(C(318));if(M=s.memoizedState,M=M!==null?M.dehydrated:null,!M)throw Error(C(317));M[Ri]=s}else Gs(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Ca(s),M=!1}else M=Us(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=M),M=!0;if(!M)return s.flags&256?(pr(s),s):(pr(s),null)}return pr(s),(s.flags&128)!==0?(s.lanes=h,s):(h=g!==null,i=i!==null&&i.memoizedState!==null,h&&(g=s.child,M=null,g.alternate!==null&&g.alternate.memoizedState!==null&&g.alternate.memoizedState.cachePool!==null&&(M=g.alternate.memoizedState.cachePool.pool),z=null,g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(z=g.memoizedState.cachePool.pool),z!==M&&(g.flags|=2048)),h!==i&&h&&(s.child.flags|=8192),Lu(s,s.updateQueue),Ca(s),null);case 4:return jt(),i===null&&Hd(s.stateNode.containerInfo),Ca(s),null;case 10:return Xr(s.type),Ca(s),null;case 19:if(Ue(fa),g=s.memoizedState,g===null)return Ca(s),null;if(M=(s.flags&128)!==0,z=g.rendering,z===null)if(M)Ou(g,!1);else{if(Ya!==0||i!==null&&(i.flags&128)!==0)for(i=s.child;i!==null;){if(z=ca(i),z!==null){for(s.flags|=128,Ou(g,!1),i=z.updateQueue,s.updateQueue=i,Lu(s,i),s.subtreeFlags=0,i=h,h=s.child;h!==null;)Sd(h,i),h=h.sibling;return We(fa,fa.current&1|2),Ti&&js(s,g.treeForkCount),s.child}i=i.sibling}g.tail!==null&&Pi()>tu&&(s.flags|=128,M=!0,Ou(g,!1),s.lanes=4194304)}else{if(!M)if(i=ca(z),i!==null){if(s.flags|=128,M=!0,i=i.updateQueue,s.updateQueue=i,Lu(s,i),Ou(g,!0),g.tail===null&&g.tailMode==="hidden"&&!z.alternate&&!Ti)return Ca(s),null}else 2*Pi()-g.renderingStartTime>tu&&h!==536870912&&(s.flags|=128,M=!0,Ou(g,!1),s.lanes=4194304);g.isBackwards?(z.sibling=s.child,s.child=z):(i=g.last,i!==null?i.sibling=z:s.child=z,g.last=z)}return g.tail!==null?(i=g.tail,g.rendering=i,g.tail=i.sibling,g.renderingStartTime=Pi(),i.sibling=null,h=fa.current,We(fa,M?h&1|2:h&1),Ti&&js(s,g.treeForkCount),i):(Ca(s),null);case 22:case 23:return pr(s),$l(),g=s.memoizedState!==null,i!==null?i.memoizedState!==null!==g&&(s.flags|=8192):g&&(s.flags|=8192),g?(h&536870912)!==0&&(s.flags&128)===0&&(Ca(s),s.subtreeFlags&6&&(s.flags|=8192)):Ca(s),h=s.updateQueue,h!==null&&Lu(s,h.retryQueue),h=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(h=i.memoizedState.cachePool.pool),g=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(g=s.memoizedState.cachePool.pool),g!==h&&(s.flags|=2048),i!==null&&Ue(bo),null;case 24:return h=null,i!==null&&(h=i.memoizedState.cache),s.memoizedState.cache!==h&&(s.flags|=2048),Xr(oa),Ca(s),null;case 25:return null;case 30:return null}throw Error(C(156,s.tag))}function ig(i,s){switch(Fl(s),s.tag){case 1:return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 3:return Xr(oa),jt(),i=s.flags,(i&65536)!==0&&(i&128)===0?(s.flags=i&-65537|128,s):null;case 26:case 27:case 5:return ri(s),null;case 31:if(s.memoizedState!==null){if(pr(s),s.alternate===null)throw Error(C(340));Gs()}return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 13:if(pr(s),i=s.memoizedState,i!==null&&i.dehydrated!==null){if(s.alternate===null)throw Error(C(340));Gs()}return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 19:return Ue(fa),null;case 4:return jt(),null;case 10:return Xr(s.type),null;case 22:case 23:return pr(s),$l(),i!==null&&Ue(bo),i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 24:return Xr(oa),null;case 25:return null;default:return null}}function Jp(i,s){switch(Fl(s),s.tag){case 3:Xr(oa),jt();break;case 26:case 27:case 5:ri(s);break;case 4:jt();break;case 31:s.memoizedState!==null&&pr(s);break;case 13:pr(s);break;case 19:Ue(fa);break;case 10:Xr(s.type);break;case 22:case 23:pr(s),$l(),i!==null&&Ue(bo);break;case 24:Xr(oa)}}function Ql(i,s){try{var h=s.updateQueue,g=h!==null?h.lastEffect:null;if(g!==null){var M=g.next;h=M;do{if((h.tag&i)===i){g=void 0;var z=h.create,G=h.inst;g=z(),G.destroy=g}h=h.next}while(h!==M)}}catch(Q){ea(s,s.return,Q)}}function Ro(i,s,h){try{var g=s.updateQueue,M=g!==null?g.lastEffect:null;if(M!==null){var z=M.next;g=z;do{if((g.tag&i)===i){var G=g.inst,Q=G.destroy;if(Q!==void 0){G.destroy=void 0,M=s;var _e=h,Ge=Q;try{Ge()}catch(tt){ea(M,_e,tt)}}}g=g.next}while(g!==z)}}catch(tt){ea(s,s.return,tt)}}function zf(i){var s=i.updateQueue;if(s!==null){var h=i.stateNode;try{Gc(s,h)}catch(g){ea(i,i.return,g)}}}function Kl(i,s,h){h.props=ts(i.type,i.memoizedProps),h.state=i.memoizedState;try{h.componentWillUnmount()}catch(g){ea(i,s,g)}}function gl(i,s){try{var h=i.ref;if(h!==null){switch(i.tag){case 26:case 27:case 5:var g=i.stateNode;break;case 30:g=i.stateNode;break;default:g=i.stateNode}typeof h=="function"?i.refCleanup=h(g):h.current=g}}catch(M){ea(i,s,M)}}function Do(i,s){var h=i.ref,g=i.refCleanup;if(h!==null)if(typeof g=="function")try{g()}catch(M){ea(i,s,M)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof h=="function")try{h(null)}catch(M){ea(i,s,M)}else h.current=null}function em(i){var s=i.type,h=i.memoizedProps,g=i.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":h.autoFocus&&g.focus();break e;case"img":h.src?g.src=h.src:h.srcSet&&(g.srcset=h.srcSet)}}catch(M){ea(i,i.return,M)}}function If(i,s,h){try{var g=i.stateNode;nu(g,i.type,h,s),g[ut]=s}catch(M){ea(i,i.return,M)}}function tm(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27&&io(i.type)||i.tag===4}function Rf(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||tm(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.tag===27&&io(i.type)||i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function Df(i,s,h){var g=i.tag;if(g===5||g===6)i=i.stateNode,s?(h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h).insertBefore(i,s):(s=h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h,s.appendChild(i),h=h._reactRootContainer,h!=null||s.onclick!==null||(s.onclick=nr));else if(g!==4&&(g===27&&io(i.type)&&(h=i.stateNode,s=null),i=i.child,i!==null))for(Df(i,s,h),i=i.sibling;i!==null;)Df(i,s,h),i=i.sibling}function Rd(i,s,h){var g=i.tag;if(g===5||g===6)i=i.stateNode,s?h.insertBefore(i,s):h.appendChild(i);else if(g!==4&&(g===27&&io(i.type)&&(h=i.stateNode),i=i.child,i!==null))for(Rd(i,s,h),i=i.sibling;i!==null;)Rd(i,s,h),i=i.sibling}function Dd(i){var s=i.stateNode,h=i.memoizedProps;try{for(var g=i.type,M=s.attributes;M.length;)s.removeAttributeNode(M[0]);on(s,g,h),s[Ri]=i,s[ut]=h}catch(z){ea(i,i.return,z)}}var _l=!1,sn=!1,Xc=!1,im=typeof WeakSet=="function"?WeakSet:Set,Ci=null;function Bu(i,s){if(i=i.containerInfo,Wd=$t,i=Di(i),wu(i)){if("selectionStart"in i)var h={start:i.selectionStart,end:i.selectionEnd};else e:{h=(h=i.ownerDocument)&&h.defaultView||window;var g=h.getSelection&&h.getSelection();if(g&&g.rangeCount!==0){h=g.anchorNode;var M=g.anchorOffset,z=g.focusNode;g=g.focusOffset;try{h.nodeType,z.nodeType}catch{h=null;break e}var G=0,Q=-1,_e=-1,Ge=0,tt=0,ot=i,qe=null;t:for(;;){for(var Xe;ot!==h||M!==0&&ot.nodeType!==3||(Q=G+M),ot!==z||g!==0&&ot.nodeType!==3||(_e=G+g),ot.nodeType===3&&(G+=ot.nodeValue.length),(Xe=ot.firstChild)!==null;)qe=ot,ot=Xe;for(;;){if(ot===i)break t;if(qe===h&&++Ge===M&&(Q=G),qe===z&&++tt===g&&(_e=G),(Xe=ot.nextSibling)!==null)break;ot=qe,qe=ot.parentNode}ot=Xe}h=Q===-1||_e===-1?null:{start:Q,end:_e}}else h=null}h=h||{start:0,end:0}}else h=null;for(Qd={focusedElem:i,selectionRange:h},$t=!1,Ci=s;Ci!==null;)if(s=Ci,i=s.child,(s.subtreeFlags&1028)!==0&&i!==null)i.return=s,Ci=i;else for(;Ci!==null;){switch(s=Ci,z=s.alternate,i=s.flags,s.tag){case 0:if((i&4)!==0&&(i=s.updateQueue,i=i!==null?i.events:null,i!==null))for(h=0;h<i.length;h++)M=i[h],M.ref.impl=M.nextImpl;break;case 11:case 15:break;case 1:if((i&1024)!==0&&z!==null){i=void 0,h=s,M=z.memoizedProps,z=z.memoizedState,g=h.stateNode;try{var Ft=ts(h.type,M);i=g.getSnapshotBeforeUpdate(Ft,z),g.__reactInternalSnapshotBeforeUpdate=i}catch(ii){ea(h,h.return,ii)}}break;case 3:if((i&1024)!==0){if(i=s.stateNode.containerInfo,h=i.nodeType,h===9)Yu(i);else if(h===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":Yu(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((i&1024)!==0)throw Error(C(163))}if(i=s.sibling,i!==null){i.return=s.return,Ci=i;break}Ci=s.return}}function kf(i,s,h){var g=h.flags;switch(h.tag){case 0:case 11:case 15:yl(i,h),g&4&&Ql(5,h);break;case 1:if(yl(i,h),g&4)if(i=h.stateNode,s===null)try{i.componentDidMount()}catch(G){ea(h,h.return,G)}else{var M=ts(h.type,s.memoizedProps);s=s.memoizedState;try{i.componentDidUpdate(M,s,i.__reactInternalSnapshotBeforeUpdate)}catch(G){ea(h,h.return,G)}}g&64&&zf(h),g&512&&gl(h,h.return);break;case 3:if(yl(i,h),g&64&&(i=h.updateQueue,i!==null)){if(s=null,h.child!==null)switch(h.child.tag){case 27:case 5:s=h.child.stateNode;break;case 1:s=h.child.stateNode}try{Gc(i,s)}catch(G){ea(h,h.return,G)}}break;case 27:s===null&&g&4&&Dd(h);case 26:case 5:yl(i,h),s===null&&g&4&&em(h),g&512&&gl(h,h.return);break;case 12:yl(i,h);break;case 31:yl(i,h),g&4&&Nu(i,h);break;case 13:yl(i,h),g&4&&kd(i,h),g&64&&(i=h.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&(h=og.bind(null,h),On(i,h))));break;case 22:if(g=h.memoizedState!==null||_l,!g){s=s!==null&&s.memoizedState!==null||sn,M=_l;var z=sn;_l=g,(sn=s)&&!z?is(i,h,(h.subtreeFlags&8772)!==0):yl(i,h),_l=M,sn=z}break;case 30:break;default:yl(i,h)}}function Gh(i){var s=i.alternate;s!==null&&(i.alternate=null,Gh(s)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(s=i.stateNode,s!==null&&no(s)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var ba=null,Ln=!1;function ko(i,s,h){for(h=h.child;h!==null;)Lf(i,s,h),h=h.sibling}function Lf(i,s,h){if(fe&&typeof fe.onCommitFiberUnmount=="function")try{fe.onCommitFiberUnmount(ce,h)}catch{}switch(h.tag){case 26:sn||Do(h,s),ko(i,s,h),h.memoizedState?h.memoizedState.count--:h.stateNode&&(h=h.stateNode,h.parentNode.removeChild(h));break;case 27:sn||Do(h,s);var g=ba,M=Ln;io(h.type)&&(ba=h.stateNode,Ln=!1),ko(i,s,h),Wu(h.stateNode),ba=g,Ln=M;break;case 5:sn||Do(h,s);case 6:if(g=ba,M=Ln,ba=null,ko(i,s,h),ba=g,Ln=M,ba!==null)if(Ln)try{(ba.nodeType===9?ba.body:ba.nodeName==="HTML"?ba.ownerDocument.body:ba).removeChild(h.stateNode)}catch(z){ea(h,s,z)}else try{ba.removeChild(h.stateNode)}catch(z){ea(h,s,z)}break;case 18:ba!==null&&(Ln?(i=ba,up(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,h.stateNode),ir(i)):up(ba,h.stateNode));break;case 4:g=ba,M=Ln,ba=h.stateNode.containerInfo,Ln=!0,ko(i,s,h),ba=g,Ln=M;break;case 0:case 11:case 14:case 15:Ro(2,h,s),sn||Ro(4,h,s),ko(i,s,h);break;case 1:sn||(Do(h,s),g=h.stateNode,typeof g.componentWillUnmount=="function"&&Kl(h,s,g)),ko(i,s,h);break;case 21:ko(i,s,h);break;case 22:sn=(g=sn)||h.memoizedState!==null,ko(i,s,h),sn=g;break;default:ko(i,s,h)}}function Nu(i,s){if(s.memoizedState===null&&(i=s.alternate,i!==null&&(i=i.memoizedState,i!==null))){i=i.dehydrated;try{ir(i)}catch(h){ea(s,s.return,h)}}}function kd(i,s){if(s.memoizedState===null&&(i=s.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{ir(i)}catch(h){ea(s,s.return,h)}}function ju(i){switch(i.tag){case 31:case 13:case 19:var s=i.stateNode;return s===null&&(s=i.stateNode=new im),s;case 22:return i=i.stateNode,s=i._retryCache,s===null&&(s=i._retryCache=new im),s;default:throw Error(C(435,i.tag))}}function Yc(i,s){var h=ju(i);s.forEach(function(g){if(!h.has(g)){h.add(g);var M=lg.bind(null,i,g);g.then(M,M)}})}function Mn(i,s){var h=s.deletions;if(h!==null)for(var g=0;g<h.length;g++){var M=h[g],z=i,G=s,Q=G;e:for(;Q!==null;){switch(Q.tag){case 27:if(io(Q.type)){ba=Q.stateNode,Ln=!1;break e}break;case 5:ba=Q.stateNode,Ln=!1;break e;case 3:case 4:ba=Q.stateNode.containerInfo,Ln=!0;break e}Q=Q.return}if(ba===null)throw Error(C(160));Lf(z,G,M),ba=null,Ln=!1,z=M.alternate,z!==null&&(z.return=null),M.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)am(s,i),s=s.sibling}var _r=null;function am(i,s){var h=i.alternate,g=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:Mn(s,i),yr(i),g&4&&(Ro(3,i,i.return),Ql(3,i),Ro(5,i,i.return));break;case 1:Mn(s,i),yr(i),g&512&&(sn||h===null||Do(h,h.return)),g&64&&_l&&(i=i.updateQueue,i!==null&&(g=i.callbacks,g!==null&&(h=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=h===null?g:h.concat(g))));break;case 26:var M=_r;if(Mn(s,i),yr(i),g&512&&(sn||h===null||Do(h,h.return)),g&4){var z=h!==null?h.memoizedState:null;if(g=i.memoizedState,h===null)if(g===null)if(i.stateNode===null){e:{g=i.type,h=i.memoizedProps,M=M.ownerDocument||M;t:switch(g){case"title":z=M.getElementsByTagName("title")[0],(!z||z[ni]||z[Ri]||z.namespaceURI==="http://www.w3.org/2000/svg"||z.hasAttribute("itemprop"))&&(z=M.createElement(g),M.head.insertBefore(z,M.querySelector("head > title"))),on(z,g,h),z[Ri]=i,Ma(z),g=z;break e;case"link":var G=O("link","href",M).get(g+(h.href||""));if(G){for(var Q=0;Q<G.length;Q++)if(z=G[Q],z.getAttribute("href")===(h.href==null||h.href===""?null:h.href)&&z.getAttribute("rel")===(h.rel==null?null:h.rel)&&z.getAttribute("title")===(h.title==null?null:h.title)&&z.getAttribute("crossorigin")===(h.crossOrigin==null?null:h.crossOrigin)){G.splice(Q,1);break t}}z=M.createElement(g),on(z,g,h),M.head.appendChild(z);break;case"meta":if(G=O("meta","content",M).get(g+(h.content||""))){for(Q=0;Q<G.length;Q++)if(z=G[Q],z.getAttribute("content")===(h.content==null?null:""+h.content)&&z.getAttribute("name")===(h.name==null?null:h.name)&&z.getAttribute("property")===(h.property==null?null:h.property)&&z.getAttribute("http-equiv")===(h.httpEquiv==null?null:h.httpEquiv)&&z.getAttribute("charset")===(h.charSet==null?null:h.charSet)){G.splice(Q,1);break t}}z=M.createElement(g),on(z,g,h),M.head.appendChild(z);break;default:throw Error(C(468,g))}z[Ri]=i,Ma(z),g=z}i.stateNode=g}else U(M,i.type,i.stateNode);else i.stateNode=v(M,g,i.memoizedProps);else z!==g?(z===null?h.stateNode!==null&&(h=h.stateNode,h.parentNode.removeChild(h)):z.count--,g===null?U(M,i.type,i.stateNode):v(M,g,i.memoizedProps)):g===null&&i.stateNode!==null&&If(i,i.memoizedProps,h.memoizedProps)}break;case 27:Mn(s,i),yr(i),g&512&&(sn||h===null||Do(h,h.return)),h!==null&&g&4&&If(i,i.memoizedProps,h.memoizedProps);break;case 5:if(Mn(s,i),yr(i),g&512&&(sn||h===null||Do(h,h.return)),i.flags&32){M=i.stateNode;try{hs(M,"")}catch(Ft){ea(i,i.return,Ft)}}g&4&&i.stateNode!=null&&(M=i.memoizedProps,If(i,M,h!==null?h.memoizedProps:M)),g&1024&&(Xc=!0);break;case 6:if(Mn(s,i),yr(i),g&4){if(i.stateNode===null)throw Error(C(162));g=i.memoizedProps,h=i.stateNode;try{h.nodeValue=g}catch(Ft){ea(i,i.return,Ft)}}break;case 3:if(R=null,M=_r,_r=nd(s.containerInfo),Mn(s,i),_r=M,yr(i),g&4&&h!==null&&h.memoizedState.isDehydrated)try{ir(s.containerInfo)}catch(Ft){ea(i,i.return,Ft)}Xc&&(Xc=!1,Jl(i));break;case 4:g=_r,_r=nd(i.stateNode.containerInfo),Mn(s,i),yr(i),_r=g;break;case 12:Mn(s,i),yr(i);break;case 31:Mn(s,i),yr(i),g&4&&(g=i.updateQueue,g!==null&&(i.updateQueue=null,Yc(i,g)));break;case 13:Mn(s,i),yr(i),i.child.flags&8192&&i.memoizedState!==null!=(h!==null&&h.memoizedState!==null)&&($h=Pi()),g&4&&(g=i.updateQueue,g!==null&&(i.updateQueue=null,Yc(i,g)));break;case 22:M=i.memoizedState!==null;var _e=h!==null&&h.memoizedState!==null,Ge=_l,tt=sn;if(_l=Ge||M,sn=tt||_e,Mn(s,i),sn=tt,_l=Ge,yr(i),g&8192)e:for(s=i.stateNode,s._visibility=M?s._visibility&-2:s._visibility|1,M&&(h===null||_e||_l||sn||ec(i)),h=null,s=i;;){if(s.tag===5||s.tag===26){if(h===null){_e=h=s;try{if(z=_e.stateNode,M)G=z.style,typeof G.setProperty=="function"?G.setProperty("display","none","important"):G.display="none";else{Q=_e.stateNode;var ot=_e.memoizedProps.style,qe=ot!=null&&ot.hasOwnProperty("display")?ot.display:null;Q.style.display=qe==null||typeof qe=="boolean"?"":(""+qe).trim()}}catch(Ft){ea(_e,_e.return,Ft)}}}else if(s.tag===6){if(h===null){_e=s;try{_e.stateNode.nodeValue=M?"":_e.memoizedProps}catch(Ft){ea(_e,_e.return,Ft)}}}else if(s.tag===18){if(h===null){_e=s;try{var Xe=_e.stateNode;M?ad(Xe,!0):ad(_e.stateNode,!1)}catch(Ft){ea(_e,_e.return,Ft)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===i)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break e;for(;s.sibling===null;){if(s.return===null||s.return===i)break e;h===s&&(h=null),s=s.return}h===s&&(h=null),s.sibling.return=s.return,s=s.sibling}g&4&&(g=i.updateQueue,g!==null&&(h=g.retryQueue,h!==null&&(g.retryQueue=null,Yc(i,h))));break;case 19:Mn(s,i),yr(i),g&4&&(g=i.updateQueue,g!==null&&(i.updateQueue=null,Yc(i,g)));break;case 30:break;case 21:break;default:Mn(s,i),yr(i)}}function yr(i){var s=i.flags;if(s&2){try{for(var h,g=i.return;g!==null;){if(tm(g)){h=g;break}g=g.return}if(h==null)throw Error(C(160));switch(h.tag){case 27:var M=h.stateNode,z=Rf(i);Rd(i,z,M);break;case 5:var G=h.stateNode;h.flags&32&&(hs(G,""),h.flags&=-33);var Q=Rf(i);Rd(i,Q,G);break;case 3:case 4:var _e=h.stateNode.containerInfo,Ge=Rf(i);Df(i,Ge,_e);break;default:throw Error(C(161))}}catch(tt){ea(i,i.return,tt)}i.flags&=-3}s&4096&&(i.flags&=-4097)}function Jl(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var s=i;Jl(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),i=i.sibling}}function yl(i,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)kf(i,s.alternate,s),s=s.sibling}function ec(i){for(i=i.child;i!==null;){var s=i;switch(s.tag){case 0:case 11:case 14:case 15:Ro(4,s,s.return),ec(s);break;case 1:Do(s,s.return);var h=s.stateNode;typeof h.componentWillUnmount=="function"&&Kl(s,s.return,h),ec(s);break;case 27:Wu(s.stateNode);case 26:case 5:Do(s,s.return),ec(s);break;case 22:s.memoizedState===null&&ec(s);break;case 30:ec(s);break;default:ec(s)}i=i.sibling}}function is(i,s,h){for(h=h&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var g=s.alternate,M=i,z=s,G=z.flags;switch(z.tag){case 0:case 11:case 15:is(M,z,h),Ql(4,z);break;case 1:if(is(M,z,h),g=z,M=g.stateNode,typeof M.componentDidMount=="function")try{M.componentDidMount()}catch(Ge){ea(g,g.return,Ge)}if(g=z,M=g.updateQueue,M!==null){var Q=g.stateNode;try{var _e=M.shared.hiddenCallbacks;if(_e!==null)for(M.shared.hiddenCallbacks=null,M=0;M<_e.length;M++)Yr(_e[M],Q)}catch(Ge){ea(g,g.return,Ge)}}h&&G&64&&zf(z),gl(z,z.return);break;case 27:Dd(z);case 26:case 5:is(M,z,h),h&&g===null&&G&4&&em(z),gl(z,z.return);break;case 12:is(M,z,h);break;case 31:is(M,z,h),h&&G&4&&Nu(M,z);break;case 13:is(M,z,h),h&&G&4&&kd(M,z);break;case 22:z.memoizedState===null&&is(M,z,h),gl(z,z.return);break;case 30:break;default:is(M,z,h)}s=s.sibling}}function Uh(i,s){var h=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(h=i.memoizedState.cachePool.pool),i=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(i=s.memoizedState.cachePool.pool),i!==h&&(i!=null&&i.refCount++,h!=null&&Rn(h))}function Ld(i,s){i=null,s.alternate!==null&&(i=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==i&&(s.refCount++,i!=null&&Rn(i))}function Ts(i,s,h,g){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)nm(i,s,h,g),s=s.sibling}function nm(i,s,h,g){var M=s.flags;switch(s.tag){case 0:case 11:case 15:Ts(i,s,h,g),M&2048&&Ql(9,s);break;case 1:Ts(i,s,h,g);break;case 3:Ts(i,s,h,g),M&2048&&(i=null,s.alternate!==null&&(i=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==i&&(s.refCount++,i!=null&&Rn(i)));break;case 12:if(M&2048){Ts(i,s,h,g),i=s.stateNode;try{var z=s.memoizedProps,G=z.id,Q=z.onPostCommit;typeof Q=="function"&&Q(G,s.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(_e){ea(s,s.return,_e)}}else Ts(i,s,h,g);break;case 31:Ts(i,s,h,g);break;case 13:Ts(i,s,h,g);break;case 23:break;case 22:z=s.stateNode,G=s.alternate,s.memoizedState!==null?z._visibility&2?Ts(i,s,h,g):Vh(i,s):z._visibility&2?Ts(i,s,h,g):(z._visibility|=2,Fu(i,s,h,g,(s.subtreeFlags&10256)!==0||!1)),M&2048&&Uh(G,s);break;case 24:Ts(i,s,h,g),M&2048&&Ld(s.alternate,s);break;default:Ts(i,s,h,g)}}function Fu(i,s,h,g,M){for(M=M&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var z=i,G=s,Q=h,_e=g,Ge=G.flags;switch(G.tag){case 0:case 11:case 15:Fu(z,G,Q,_e,M),Ql(8,G);break;case 23:break;case 22:var tt=G.stateNode;G.memoizedState!==null?tt._visibility&2?Fu(z,G,Q,_e,M):Vh(z,G):(tt._visibility|=2,Fu(z,G,Q,_e,M)),M&&Ge&2048&&Uh(G.alternate,G);break;case 24:Fu(z,G,Q,_e,M),M&&Ge&2048&&Ld(G.alternate,G);break;default:Fu(z,G,Q,_e,M)}s=s.sibling}}function Vh(i,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var h=i,g=s,M=g.flags;switch(g.tag){case 22:Vh(h,g),M&2048&&Uh(g.alternate,g);break;case 24:Vh(h,g),M&2048&&Ld(g.alternate,g);break;default:Vh(h,g)}s=s.sibling}}var qh=8192;function Gu(i,s,h){if(i.subtreeFlags&qh)for(i=i.child;i!==null;)Wc(i,s,h),i=i.sibling}function Wc(i,s,h){switch(i.tag){case 26:Gu(i,s,h),i.flags&qh&&i.memoizedState!==null&&Y(h,_r,i.memoizedState,i.memoizedProps);break;case 5:Gu(i,s,h);break;case 3:case 4:var g=_r;_r=nd(i.stateNode.containerInfo),Gu(i,s,h),_r=g;break;case 22:i.memoizedState===null&&(g=i.alternate,g!==null&&g.memoizedState!==null?(g=qh,qh=16777216,Gu(i,s,h),qh=g):Gu(i,s,h));break;default:Gu(i,s,h)}}function rm(i){var s=i.alternate;if(s!==null&&(i=s.child,i!==null)){s.child=null;do s=i.sibling,i.sibling=null,i=s;while(i!==null)}}function Zh(i){var s=i.deletions;if((i.flags&16)!==0){if(s!==null)for(var h=0;h<s.length;h++){var g=s[h];Ci=g,Bf(g,i)}rm(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)Of(i),i=i.sibling}function Of(i){switch(i.tag){case 0:case 11:case 15:Zh(i),i.flags&2048&&Ro(9,i,i.return);break;case 3:Zh(i);break;case 12:Zh(i);break;case 22:var s=i.stateNode;i.memoizedState!==null&&s._visibility&2&&(i.return===null||i.return.tag!==13)?(s._visibility&=-3,Od(i)):Zh(i);break;default:Zh(i)}}function Od(i){var s=i.deletions;if((i.flags&16)!==0){if(s!==null)for(var h=0;h<s.length;h++){var g=s[h];Ci=g,Bf(g,i)}rm(i)}for(i=i.child;i!==null;){switch(s=i,s.tag){case 0:case 11:case 15:Ro(8,s,s.return),Od(s);break;case 22:h=s.stateNode,h._visibility&2&&(h._visibility&=-3,Od(s));break;default:Od(s)}i=i.sibling}}function Bf(i,s){for(;Ci!==null;){var h=Ci;switch(h.tag){case 0:case 11:case 15:Ro(8,h,s);break;case 23:case 22:if(h.memoizedState!==null&&h.memoizedState.cachePool!==null){var g=h.memoizedState.cachePool.pool;g!=null&&g.refCount++}break;case 24:Rn(h.memoizedState.cache)}if(g=h.child,g!==null)g.return=h,Ci=g;else e:for(h=i;Ci!==null;){g=Ci;var M=g.sibling,z=g.return;if(Gh(g),g===h){Ci=null;break e}if(M!==null){M.return=z,Ci=M;break e}Ci=z}}}var ag={getCacheForType:function(i){var s=_n(oa),h=s.data.get(i);return h===void 0&&(h=i(),s.data.set(i,h)),h},cacheSignal:function(){return _n(oa).controller.signal}},Nf=typeof WeakMap=="function"?WeakMap:Map,Gi=0,ha=null,ki=null,Bi=0,ra=0,Dr=null,tc=!1,Uu=!1,Qc=!1,Lo=0,Ya=0,ic=0,Kc=0,jf=0,as=0,Jc=0,eu=null,vr=null,Bd=!1,$h=0,sm=0,tu=1/0,Nd=null,vl=null,Tn=0,ac=null,Vu=null,Oo=0,Ff=0,Gf=null,qu=null,Ba=0,Hh=null;function kr(){return(Gi&2)!==0&&Bi!==0?Bi&-Bi:He.T!==null?rc():Gr()}function Uf(){if(as===0)if((Bi&536870912)===0||Ti){var i=zt;zt<<=1,(zt&3932160)===0&&(zt=262144),as=i}else as=536870912;return i=la.current,i!==null&&(i.flags|=32),as}function er(i,s,h){(i===ha&&(ra===2||ra===9)||i.cancelPendingCommit!==null)&&(Zu(i,0),nc(i,Bi,as,!1)),za(i,h),((Gi&2)===0||i!==ha)&&(i===ha&&((Gi&2)===0&&(Kc|=h),Ya===4&&nc(i,Bi,as,!1)),eo(i))}function iu(i,s,h){if((Gi&6)!==0)throw Error(C(327));var g=!h&&(s&127)===0&&(s&i.expiredLanes)===0||zi(i,s),M=g?hm(i,s):Zf(i,s,!0),z=g;do{if(M===0){Uu&&!g&&nc(i,s,0,!1);break}else{if(h=i.current.alternate,z&&!ng(h)){M=Zf(i,s,!1),z=!1;continue}if(M===2){if(z=s,i.errorRecoveryDisabledLanes&z)var G=0;else G=i.pendingLanes&-536870913,G=G!==0?G:G&536870912?536870912:0;if(G!==0){s=G;e:{var Q=i;M=eu;var _e=Q.current.memoizedState.isDehydrated;if(_e&&(Zu(Q,G).flags|=256),G=Zf(Q,G,!1),G!==2){if(Qc&&!_e){Q.errorRecoveryDisabledLanes|=z,Kc|=z,M=4;break e}z=vr,vr=M,z!==null&&(vr===null?vr=z:vr.push.apply(vr,z))}M=G}if(z=!1,M!==2)continue}}if(M===1){Zu(i,0),nc(i,s,0,!0);break}e:{switch(g=i,z=M,z){case 0:case 1:throw Error(C(345));case 4:if((s&4194048)!==s)break;case 6:nc(g,s,as,!tc);break e;case 2:vr=null;break;case 3:case 5:break;default:throw Error(C(329))}if((s&62914560)===s&&(M=$h+300-Pi(),10<M)){if(nc(g,s,as,!tc),_i(g,0,!0)!==0)break e;Oo=s,g.timeoutHandle=cp(Vf.bind(null,g,h,vr,Nd,Bd,s,as,Kc,Jc,tc,z,"Throttled",-0,0),M);break e}Vf(g,h,vr,Nd,Bd,s,as,Kc,Jc,tc,z,null,-0,0)}}break}while(!0);eo(i)}function Vf(i,s,h,g,M,z,G,Q,_e,Ge,tt,ot,qe,Xe){if(i.timeoutHandle=-1,ot=s.subtreeFlags,ot&8192||(ot&16785408)===16785408){ot={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:nr},Wc(s,z,ot);var Ft=(z&62914560)===z?$h-Pi():(z&4194048)===z?sm-Pi():0;if(Ft=se(ot,Ft),Ft!==null){Oo=z,i.cancelPendingCommit=Ft(Yh.bind(null,i,s,z,h,g,M,G,Q,_e,tt,ot,null,qe,Xe)),nc(i,z,G,!Ge);return}}Yh(i,s,z,h,g,M,G,Q,_e)}function ng(i){for(var s=i;;){var h=s.tag;if((h===0||h===11||h===15)&&s.flags&16384&&(h=s.updateQueue,h!==null&&(h=h.stores,h!==null)))for(var g=0;g<h.length;g++){var M=h[g],z=M.getSnapshot;M=M.value;try{if(!jn(z(),M))return!1}catch{return!1}}if(h=s.child,s.subtreeFlags&16384&&h!==null)h.return=s,s=h;else{if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function nc(i,s,h,g){s&=~jf,s&=~Kc,i.suspendedLanes|=s,i.pingedLanes&=~s,g&&(i.warmLanes|=s),g=i.expirationTimes;for(var M=s;0<M;){var z=31-Ie(M),G=1<<z;g[z]=-1,M&=~G}h!==0&&hn(i,h,s)}function jd(){return(Gi&6)===0?(au(0),!1):!0}function qf(){if(ki!==null){if(ra===0)var i=ki.return;else i=ki,Hr=vs=null,c(i),To=null,ql=0,i=ki;for(;i!==null;)Jp(i.alternate,i),i=i.return;ki=null}}function Zu(i,s){var h=i.timeoutHandle;h!==-1&&(i.timeoutHandle=-1,fg(h)),h=i.cancelPendingCommit,h!==null&&(i.cancelPendingCommit=null,h()),Oo=0,qf(),ha=i,ki=h=cr(i.current,null),Bi=s,ra=0,Dr=null,tc=!1,Uu=zi(i,s),Qc=!1,Jc=as=jf=Kc=ic=Ya=0,vr=eu=null,Bd=!1,(s&8)!==0&&(s|=s&32);var g=i.entangledLanes;if(g!==0)for(i=i.entanglements,g&=s;0<g;){var M=31-Ie(g),z=1<<M;s|=i[M],g&=~z}return Lo=s,el(),h}function om(i,s){ti=null,He.H=fl,s===sl||s===wo?(s=Ah(),ra=3):s===Oc?(s=Ah(),ra=4):ra=s===kh?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,Dr=s,ki===null&&(Ya=1,Rh(i,Gn(s,i.current)))}function lm(){var i=la.current;return i===null?!0:(Bi&4194048)===Bi?fr===null:(Bi&62914560)===Bi||(Bi&536870912)!==0?i===fr:!1}function cm(){var i=He.H;return He.H=fl,i===null?fl:i}function um(){var i=He.A;return He.A=ag,i}function Fd(){Ya=4,tc||(Bi&4194048)!==Bi&&la.current!==null||(Uu=!0),(ic&134217727)===0&&(Kc&134217727)===0||ha===null||nc(ha,Bi,as,!1)}function Zf(i,s,h){var g=Gi;Gi|=2;var M=cm(),z=um();(ha!==i||Bi!==s)&&(Nd=null,Zu(i,s)),s=!1;var G=Ya;e:do try{if(ra!==0&&ki!==null){var Q=ki,_e=Dr;switch(ra){case 8:qf(),G=6;break e;case 3:case 2:case 9:case 6:la.current===null&&(s=!0);var Ge=ra;if(ra=0,Dr=null,Bo(i,Q,_e,Ge),h&&Uu){G=0;break e}break;default:Ge=ra,ra=0,Dr=null,Bo(i,Q,_e,Ge)}}rg(),G=Ya;break}catch(tt){om(i,tt)}while(!0);return s&&i.shellSuspendCounter++,Hr=vs=null,Gi=g,He.H=M,He.A=z,ki===null&&(ha=null,Bi=0,el()),G}function rg(){for(;ki!==null;)Hf(ki)}function hm(i,s){var h=Gi;Gi|=2;var g=cm(),M=um();ha!==i||Bi!==s?(Nd=null,tu=Pi()+500,Zu(i,s)):Uu=zi(i,s);e:do try{if(ra!==0&&ki!==null){s=ki;var z=Dr;t:switch(ra){case 1:ra=0,Dr=null,Bo(i,s,z,1);break;case 2:case 9:if(Mo(z)){ra=0,Dr=null,xl(s);break}s=function(){ra!==2&&ra!==9||ha!==i||(ra=7),eo(i)},z.then(s,s);break e;case 3:ra=7;break e;case 4:ra=5;break e;case 7:Mo(z)?(ra=0,Dr=null,xl(s)):(ra=0,Dr=null,Bo(i,s,z,7));break;case 5:var G=null;switch(ki.tag){case 26:G=ki.memoizedState;case 5:case 27:var Q=ki;if(G?Z(G):Q.stateNode.complete){ra=0,Dr=null;var _e=Q.sibling;if(_e!==null)ki=_e;else{var Ge=Q.return;Ge!==null?(ki=Ge,bl(Ge)):ki=null}break t}}ra=0,Dr=null,Bo(i,s,z,5);break;case 6:ra=0,Dr=null,Bo(i,s,z,6);break;case 8:qf(),Ya=6;break e;default:throw Error(C(462))}}$f();break}catch(tt){om(i,tt)}while(!0);return Hr=vs=null,He.H=g,He.A=M,Gi=h,ki!==null?0:(ha=null,Bi=0,el(),Ya)}function $f(){for(;ki!==null&&!Ja();)Hf(ki)}function Hf(i){var s=Qp(i.alternate,i,Lo);i.memoizedProps=i.pendingProps,s===null?bl(i):ki=s}function xl(i){var s=i,h=s.alternate;switch(s.tag){case 15:case 0:s=Tf(h,s,s.pendingProps,s.type,void 0,Bi);break;case 11:s=Tf(h,s,s.pendingProps,s.type.render,s.ref,Bi);break;case 5:c(s);default:Jp(h,s),s=ki=Sd(s,Lo),s=Qp(h,s,Lo)}i.memoizedProps=i.pendingProps,s===null?bl(i):ki=s}function Bo(i,s,h,g){Hr=vs=null,c(s),To=null,ql=0;var M=s.return;try{if(Jm(i,M,s,h,Bi)){Ya=1,Rh(i,Gn(h,i.current)),ki=null;return}}catch(z){if(M!==null)throw ki=M,z;Ya=1,Rh(i,Gn(h,i.current)),ki=null;return}s.flags&32768?(Ti||g===1?i=!0:Uu||(Bi&536870912)!==0?i=!1:(tc=i=!0,(g===2||g===9||g===3||g===6)&&(g=la.current,g!==null&&g.tag===13&&(g.flags|=16384))),Xh(s,i)):bl(s)}function bl(i){var s=i;do{if((s.flags&32768)!==0){Xh(s,tc);return}i=s.return;var h=tg(s.alternate,s,Lo);if(h!==null){ki=h;return}if(s=s.sibling,s!==null){ki=s;return}ki=s=i}while(s!==null);Ya===0&&(Ya=5)}function Xh(i,s){do{var h=ig(i.alternate,i);if(h!==null){h.flags&=32767,ki=h;return}if(h=i.return,h!==null&&(h.flags|=32768,h.subtreeFlags=0,h.deletions=null),!s&&(i=i.sibling,i!==null)){ki=i;return}ki=i=h}while(i!==null);Ya=6,ki=null}function Yh(i,s,h,g,M,z,G,Q,_e){i.cancelPendingCommit=null;do Gd();while(Tn!==0);if((Gi&6)!==0)throw Error(C(327));if(s!==null){if(s===i.current)throw Error(C(177));if(z=s.lanes|s.childLanes,z|=Jo,qa(i,h,z,G,Q,_e),i===ha&&(ki=ha=null,Bi=0),Vu=s,ac=i,Oo=h,Ff=z,Gf=M,qu=g,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(i.callbackNode=null,i.callbackPriority=0,cg(ya,function(){return Wf(),null})):(i.callbackNode=null,i.callbackPriority=0),g=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||g){g=He.T,He.T=null,M=at.p,at.p=2,G=Gi,Gi|=4;try{Bu(i,s,h)}finally{Gi=G,at.p=M,He.T=g}}Tn=1,dm(),fm(),Xf()}}function dm(){if(Tn===1){Tn=0;var i=ac,s=Vu,h=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||h){h=He.T,He.T=null;var g=at.p;at.p=2;var M=Gi;Gi|=4;try{am(s,i);var z=Qd,G=Di(i.containerInfo),Q=z.focusedElem,_e=z.selectionRange;if(G!==Q&&Q&&Q.ownerDocument&&bu(Q.ownerDocument.documentElement,Q)){if(_e!==null&&wu(Q)){var Ge=_e.start,tt=_e.end;if(tt===void 0&&(tt=Ge),"selectionStart"in Q)Q.selectionStart=Ge,Q.selectionEnd=Math.min(tt,Q.value.length);else{var ot=Q.ownerDocument||document,qe=ot&&ot.defaultView||window;if(qe.getSelection){var Xe=qe.getSelection(),Ft=Q.textContent.length,ii=Math.min(_e.start,Ft),ma=_e.end===void 0?ii:Math.min(_e.end,Ft);!Xe.extend&&ii>ma&&(G=ma,ma=ii,ii=G);var ze=xu(Q,ii),Te=xu(Q,ma);if(ze&&Te&&(Xe.rangeCount!==1||Xe.anchorNode!==ze.node||Xe.anchorOffset!==ze.offset||Xe.focusNode!==Te.node||Xe.focusOffset!==Te.offset)){var Fe=ot.createRange();Fe.setStart(ze.node,ze.offset),Xe.removeAllRanges(),ii>ma?(Xe.addRange(Fe),Xe.extend(Te.node,Te.offset)):(Fe.setEnd(Te.node,Te.offset),Xe.addRange(Fe))}}}}for(ot=[],Xe=Q;Xe=Xe.parentNode;)Xe.nodeType===1&&ot.push({element:Xe,left:Xe.scrollLeft,top:Xe.scrollTop});for(typeof Q.focus=="function"&&Q.focus(),Q=0;Q<ot.length;Q++){var nt=ot[Q];nt.element.scrollLeft=nt.left,nt.element.scrollTop=nt.top}}$t=!!Wd,Qd=Wd=null}finally{Gi=M,at.p=g,He.T=h}}i.current=s,Tn=2}}function fm(){if(Tn===2){Tn=0;var i=ac,s=Vu,h=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||h){h=He.T,He.T=null;var g=at.p;at.p=2;var M=Gi;Gi|=4;try{kf(i,s.alternate,s)}finally{Gi=M,at.p=g,He.T=h}}Tn=3}}function Xf(){if(Tn===4||Tn===3){Tn=0,An();var i=ac,s=Vu,h=Oo,g=qu;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?Tn=5:(Tn=0,Vu=ac=null,Yf(i,i.pendingLanes));var M=i.pendingLanes;if(M===0&&(vl=null),st(h),s=s.stateNode,fe&&typeof fe.onCommitFiberRoot=="function")try{fe.onCommitFiberRoot(ce,s,void 0,(s.current.flags&128)===128)}catch{}if(g!==null){s=He.T,M=at.p,at.p=2,He.T=null;try{for(var z=i.onRecoverableError,G=0;G<g.length;G++){var Q=g[G];z(Q.value,{componentStack:Q.stack})}}finally{He.T=s,at.p=M}}(Oo&3)!==0&&Gd(),eo(i),M=i.pendingLanes,(h&261930)!==0&&(M&42)!==0?i===Hh?Ba++:(Ba=0,Hh=i):Ba=0,au(0)}}function Yf(i,s){(i.pooledCacheLanes&=s)===0&&(s=i.pooledCache,s!=null&&(i.pooledCache=null,Rn(s)))}function Gd(){return dm(),fm(),Xf(),Wf()}function Wf(){if(Tn!==5)return!1;var i=ac,s=Ff;Ff=0;var h=st(Oo),g=He.T,M=at.p;try{at.p=32>h?32:h,He.T=null,h=Gf,Gf=null;var z=ac,G=Oo;if(Tn=0,Vu=ac=null,Oo=0,(Gi&6)!==0)throw Error(C(331));var Q=Gi;if(Gi|=4,Of(z.current),nm(z,z.current,G,h),Gi=Q,au(0,!1),fe&&typeof fe.onPostCommitFiberRoot=="function")try{fe.onPostCommitFiberRoot(ce,z)}catch{}return!0}finally{at.p=M,He.T=g,Yf(i,s)}}function Qf(i,s,h){s=Gn(h,s),s=Ed(i.stateNode,s,2),i=Ir(i,s,2),i!==null&&(za(i,2),eo(i))}function ea(i,s,h){if(i.tag===3)Qf(i,i,h);else for(;s!==null;){if(s.tag===3){Qf(s,i,h);break}else if(s.tag===1){var g=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof g.componentDidCatch=="function"&&(vl===null||!vl.has(g))){i=Gn(h,i),h=qp(2),g=Ir(s,h,2),g!==null&&(Cd(h,g,s,i),za(g,2),eo(g));break}}s=s.return}}function Wh(i,s,h){var g=i.pingCache;if(g===null){g=i.pingCache=new Nf;var M=new Set;g.set(s,M)}else M=g.get(s),M===void 0&&(M=new Set,g.set(s,M));M.has(h)||(Qc=!0,M.add(h),i=sg.bind(null,i,s,h),s.then(i,i))}function sg(i,s,h){var g=i.pingCache;g!==null&&g.delete(s),i.pingedLanes|=i.suspendedLanes&h,i.warmLanes&=~h,ha===i&&(Bi&h)===h&&(Ya===4||Ya===3&&(Bi&62914560)===Bi&&300>Pi()-$h?(Gi&2)===0&&Zu(i,0):jf|=h,Jc===Bi&&(Jc=0)),eo(i)}function Kf(i,s){s===0&&(s=Ei()),i=Ar(i,s),i!==null&&(za(i,s),eo(i))}function og(i){var s=i.memoizedState,h=0;s!==null&&(h=s.retryLane),Kf(i,h)}function lg(i,s){var h=0;switch(i.tag){case 31:case 13:var g=i.stateNode,M=i.memoizedState;M!==null&&(h=M.retryLane);break;case 19:g=i.stateNode;break;case 22:g=i.stateNode._retryCache;break;default:throw Error(C(314))}g!==null&&g.delete(s),Kf(i,h)}function cg(i,s){return ia(i,s)}var Ud=null,$u=null,Vd=!1,Qh=!1,Js=!1,xr=0;function eo(i){i!==$u&&i.next===null&&($u===null?Ud=$u=i:$u=$u.next=i),Qh=!0,Vd||(Vd=!0,Jf())}function au(i,s){if(!Js&&Qh){Js=!0;do for(var h=!1,g=Ud;g!==null;){if(i!==0){var M=g.pendingLanes;if(M===0)var z=0;else{var G=g.suspendedLanes,Q=g.pingedLanes;z=(1<<31-Ie(42|i)+1)-1,z&=M&~(G&~Q),z=z&201326741?z&201326741|1:z?z|2:0}z!==0&&(h=!0,Zd(g,z))}else z=Bi,z=_i(g,g===ha?z:0,g.cancelPendingCommit!==null||g.timeoutHandle!==-1),(z&3)===0||zi(g,z)||(h=!0,Zd(g,z));g=g.next}while(h);Js=!1}}function ug(){Kh()}function Kh(){Qh=Vd=!1;var i=0;xr!==0&&vm()&&(i=xr);for(var s=Pi(),h=null,g=Ud;g!==null;){var M=g.next,z=qd(g,s);z===0?(g.next=null,h===null?Ud=M:h.next=M,M===null&&($u=h)):(h=g,(i!==0||(z&3)!==0)&&(Qh=!0)),g=M}Tn!==0&&Tn!==5||au(i),xr!==0&&(xr=0)}function qd(i,s){for(var h=i.suspendedLanes,g=i.pingedLanes,M=i.expirationTimes,z=i.pendingLanes&-62914561;0<z;){var G=31-Ie(z),Q=1<<G,_e=M[G];_e===-1?((Q&h)===0||(Q&g)!==0)&&(M[G]=kt(Q,s)):_e<=s&&(i.expiredLanes|=Q),z&=~Q}if(s=ha,h=Bi,h=_i(i,i===s?h:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),g=i.callbackNode,h===0||i===s&&(ra===2||ra===9)||i.cancelPendingCommit!==null)return g!==null&&g!==null&&qn(g),i.callbackNode=null,i.callbackPriority=0;if((h&3)===0||zi(i,h)){if(s=h&-h,s===i.callbackPriority)return s;switch(g!==null&&qn(g),st(h)){case 2:case 8:h=Sa;break;case 32:h=ya;break;case 268435456:h=H;break;default:h=ya}return g=pm.bind(null,i),h=ia(h,g),i.callbackPriority=s,i.callbackNode=h,s}return g!==null&&g!==null&&qn(g),i.callbackPriority=2,i.callbackNode=null,2}function pm(i,s){if(Tn!==0&&Tn!==5)return i.callbackNode=null,i.callbackPriority=0,null;var h=i.callbackNode;if(Gd()&&i.callbackNode!==h)return null;var g=Bi;return g=_i(i,i===ha?g:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),g===0?null:(iu(i,g,s),qd(i,Pi()),i.callbackNode!=null&&i.callbackNode===h?pm.bind(null,i):null)}function Zd(i,s){if(Gd())return null;iu(i,s,!0)}function Jf(){bm(function(){(Gi&6)!==0?ia(Ui,ug):Kh()})}function rc(){if(xr===0){var i=Sn;i===0&&(i=Je,Je<<=1,(Je&261888)===0&&(Je=256)),xr=i}return xr}function ep(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:hi(""+i)}function tp(i,s){var h=s.ownerDocument.createElement("input");return h.name=s.name,h.value=s.value,i.id&&h.setAttribute("form",i.id),s.parentNode.insertBefore(h,s),i=new FormData(i),h.parentNode.removeChild(h),i}function ip(i,s,h,g,M){if(s==="submit"&&h&&h.stateNode===M){var z=ep((M[ut]||null).action),G=g.submitter;G&&(s=(s=G[ut]||null)?ep(s.formAction):G.getAttribute("formAction"),s!==null&&(z=s,G=null));var Q=new zl("action","action",null,g,M);i.push({event:Q,listeners:[{instance:null,listener:function(){if(g.defaultPrevented){if(xr!==0){var _e=G?tp(M,G):new FormData(M);Rr(h,{pending:!0,data:_e,method:M.method,action:z},null,_e)}}else typeof z=="function"&&(Q.preventDefault(),_e=G?tp(M,G):new FormData(M),Rr(h,{pending:!0,data:_e,method:M.method,action:z},z,_e))},currentTarget:M}]})}}for(var $d=0;$d<Mu.length;$d++){var Hu=Mu[$d],mm=Hu.toLowerCase(),hg=Hu[0].toUpperCase()+Hu.slice(1);or(mm,"on"+hg)}or(Tc,"onAnimationEnd"),or(Ec,"onAnimationIteration"),or(Su,"onAnimationStart"),or("dblclick","onDoubleClick"),or("focusin","onFocus"),or("focusout","onBlur"),or(Ko,"onTransitionRun"),or(Cc,"onTransitionStart"),or(Nl,"onTransitionCancel"),or(sr,"onTransitionEnd"),cs("onMouseEnter",["mouseout","mouseover"]),cs("onMouseLeave",["mouseout","mouseover"]),cs("onPointerEnter",["pointerout","pointerover"]),cs("onPointerLeave",["pointerout","pointerover"]),Zi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Zi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Zi("onBeforeInput",["compositionend","keypress","textInput","paste"]),Zi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Zi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Zi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Jh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),dg=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Jh));function gm(i,s){s=(s&4)!==0;for(var h=0;h<i.length;h++){var g=i[h],M=g.event;g=g.listeners;e:{var z=void 0;if(s)for(var G=g.length-1;0<=G;G--){var Q=g[G],_e=Q.instance,Ge=Q.currentTarget;if(Q=Q.listener,_e!==z&&M.isPropagationStopped())break e;z=Q,M.currentTarget=Ge;try{z(M)}catch(tt){gs(tt)}M.currentTarget=null,z=_e}else for(G=0;G<g.length;G++){if(Q=g[G],_e=Q.instance,Ge=Q.currentTarget,Q=Q.listener,_e!==z&&M.isPropagationStopped())break e;z=Q,M.currentTarget=Ge;try{z(M)}catch(tt){gs(tt)}M.currentTarget=null,z=_e}}}}function Li(i,s){var h=s[li];h===void 0&&(h=s[li]=new Set);var g=i+"__bubble";h.has(g)||(ap(s,i,2,!1),h.add(g))}function ed(i,s,h){var g=0;s&&(g|=4),ap(h,i,g,s)}var to="_reactListening"+Math.random().toString(36).slice(2);function Hd(i){if(!i[to]){i[to]=!0,Ra.forEach(function(h){h!=="selectionchange"&&(dg.has(h)||ed(h,!1,i),ed(h,!0,i))});var s=i.nodeType===9?i:i.ownerDocument;s===null||s[to]||(s[to]=!0,ed("selectionchange",!1,s))}}function ap(i,s,h,g){switch(En(s)){case 2:var M=Wt;break;case 8:M=Zt;break;default:M=Dt}h=M.bind(null,s,h,i),M=void 0,!Nn||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(M=!0),g?M!==void 0?i.addEventListener(s,h,{capture:!0,passive:M}):i.addEventListener(s,h,!0):M!==void 0?i.addEventListener(s,h,{passive:M}):i.addEventListener(s,h,!1)}function Xd(i,s,h,g,M){var z=g;if((s&1)===0&&(s&2)===0&&g!==null)e:for(;;){if(g===null)return;var G=g.tag;if(G===3||G===4){var Q=g.stateNode.containerInfo;if(Q===M)break;if(G===4)for(G=g.return;G!==null;){var _e=G.tag;if((_e===3||_e===4)&&G.stateNode.containerInfo===M)return;G=G.return}for(;Q!==null;){if(G=ls(Q),G===null)return;if(_e=G.tag,_e===5||_e===6||_e===26||_e===27){g=z=G;continue e}Q=Q.parentNode}}g=g.return}sa(function(){var Ge=z,tt=lo(h),ot=[];e:{var qe=Sh.get(i);if(qe!==void 0){var Xe=zl,Ft=i;switch(i){case"keypress":if(Yt(h)===0)break e;case"keydown":case"keyup":Xe=ks;break;case"focusin":Ft="focus",Xe=Xo;break;case"focusout":Ft="blur",Xe=Xo;break;case"beforeblur":case"afterblur":Xe=Xo;break;case"click":if(h.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Xe=Il;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Xe=pn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Xe=vf;break;case Tc:case Ec:case Su:Xe=mn;break;case sr:Xe=xf;break;case"scroll":case"scrollend":Xe=gc;break;case"wheel":Xe=uh;break;case"copy":case"cut":case"paste":Xe=fu;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Xe=lh;break;case"toggle":case"beforetoggle":Xe=Dl}var ii=(s&4)!==0,ma=!ii&&(i==="scroll"||i==="scrollend"),ze=ii?qe!==null?qe+"Capture":null:qe;ii=[];for(var Te=Ge,Fe;Te!==null;){var nt=Te;if(Fe=nt.stateNode,nt=nt.tag,nt!==5&&nt!==26&&nt!==27||Fe===null||ze===null||(nt=ds(Te,ze),nt!=null&&ii.push(Xu(Te,nt,Fe))),ma)break;Te=Te.return}0<ii.length&&(qe=new Xe(qe,Ft,null,h,tt),ot.push({event:qe,listeners:ii}))}}if((s&7)===0){e:{if(qe=i==="mouseover"||i==="pointerover",Xe=i==="mouseout"||i==="pointerout",qe&&h!==Vo&&(Ft=h.relatedTarget||h.fromElement)&&(ls(Ft)||Ft[si]))break e;if((Xe||qe)&&(qe=tt.window===tt?tt:(qe=tt.ownerDocument)?qe.defaultView||qe.parentWindow:window,Xe?(Ft=h.relatedTarget||h.toElement,Xe=Ge,Ft=Ft?ls(Ft):null,Ft!==null&&(ma=D(Ft),ii=Ft.tag,Ft!==ma||ii!==5&&ii!==27&&ii!==6)&&(Ft=null)):(Xe=null,Ft=Ge),Xe!==Ft)){if(ii=Il,nt="onMouseLeave",ze="onMouseEnter",Te="mouse",(i==="pointerout"||i==="pointerover")&&(ii=lh,nt="onPointerLeave",ze="onPointerEnter",Te="pointer"),ma=Xe==null?qe:Ps(Xe),Fe=Ft==null?qe:Ps(Ft),qe=new ii(nt,Te+"leave",Xe,h,tt),qe.target=ma,qe.relatedTarget=Fe,nt=null,ls(tt)===Ge&&(ii=new ii(ze,Te+"enter",Ft,h,tt),ii.target=Fe,ii.relatedTarget=ma,nt=ii),ma=nt,Xe&&Ft)t:{for(ii=np,ze=Xe,Te=Ft,Fe=0,nt=ze;nt;nt=ii(nt))Fe++;nt=0;for(var Ht=Te;Ht;Ht=ii(Ht))nt++;for(;0<Fe-nt;)ze=ii(ze),Fe--;for(;0<nt-Fe;)Te=ii(Te),nt--;for(;Fe--;){if(ze===Te||Te!==null&&ze===Te.alternate){ii=ze;break t}ze=ii(ze),Te=ii(Te)}ii=null}else ii=null;Xe!==null&&rp(ot,qe,Xe,ii,!1),Ft!==null&&ma!==null&&rp(ot,ma,Ft,ii,!0)}}e:{if(qe=Ge?Ps(Ge):window,Xe=qe.nodeName&&qe.nodeName.toLowerCase(),Xe==="select"||Xe==="input"&&qe.type==="file")var Ki=ho;else if(ph(qe))if(mh)Ki=bd;else{Ki=_h;var Ct=vd}else Xe=qe.nodeName,!Xe||Xe.toLowerCase()!=="input"||qe.type!=="checkbox"&&qe.type!=="radio"?Ge&&oo(Ge.elementType)&&(Ki=ho):Ki=xd;if(Ki&&(Ki=Ki(i,Ge))){yu(ot,Ki,h,tt);break e}Ct&&Ct(i,qe,Ge),i==="focusout"&&Ge&&qe.type==="number"&&Ge.memoizedProps.value!=null&&Is(qe,"number",qe.value)}switch(Ct=Ge?Ps(Ge):window,i){case"focusin":(ph(Ct)||Ct.contentEditable==="true")&&(Cr=Ct,Sc=Ge,Mc=null);break;case"focusout":Mc=Sc=Cr=null;break;case"mousedown":xh=!0;break;case"contextmenu":case"mouseup":case"dragend":xh=!1,wd(ot,h,tt);break;case"selectionchange":if(vh)break;case"keydown":case"keyup":wd(ot,h,tt)}var Qt;if(rr)e:{switch(i){case"compositionstart":var xi="onCompositionStart";break e;case"compositionend":xi="onCompositionEnd";break e;case"compositionupdate":xi="onCompositionUpdate";break e}xi=void 0}else qr?vc(i,h)&&(xi="onCompositionEnd"):i==="keydown"&&h.keyCode===229&&(xi="onCompositionStart");xi&&(Yo&&h.locale!=="ko"&&(qr||xi!=="onCompositionStart"?xi==="onCompositionEnd"&&qr&&(Qt=yi()):(Tr=tt,$i="value"in Tr?Tr.value:Tr.textContent,qr=!0)),Ct=td(Ge,xi),0<Ct.length&&(xi=new fd(xi,i,null,h,tt),ot.push({event:xi,listeners:Ct}),Qt?xi.data=Qt:(Qt=md(h),Qt!==null&&(xi.data=Qt)))),(Qt=dh?gd(i,h):fh(i,h))&&(xi=td(Ge,"onBeforeInput"),0<xi.length&&(Ct=new fd("onBeforeInput","beforeinput",null,h,tt),ot.push({event:Ct,listeners:xi}),Ct.data=Qt)),ip(ot,i,Ge,h,tt)}gm(ot,s)})}function Xu(i,s,h){return{instance:i,listener:s,currentTarget:h}}function td(i,s){for(var h=s+"Capture",g=[];i!==null;){var M=i,z=M.stateNode;if(M=M.tag,M!==5&&M!==26&&M!==27||z===null||(M=ds(i,h),M!=null&&g.unshift(Xu(i,M,z)),M=ds(i,s),M!=null&&g.push(Xu(i,M,z))),i.tag===3)return g;i=i.return}return[]}function np(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function rp(i,s,h,g,M){for(var z=s._reactName,G=[];h!==null&&h!==g;){var Q=h,_e=Q.alternate,Ge=Q.stateNode;if(Q=Q.tag,_e!==null&&_e===g)break;Q!==5&&Q!==26&&Q!==27||Ge===null||(_e=Ge,M?(Ge=ds(h,z),Ge!=null&&G.unshift(Xu(h,Ge,_e))):M||(Ge=ds(h,z),Ge!=null&&G.push(Xu(h,Ge,_e)))),h=h.return}G.length!==0&&i.push({event:s,listeners:G})}var id=/\r\n?/g,_m=/\u0000|\uFFFD/g;function Yd(i){return(typeof i=="string"?i:""+i).replace(id,`
`).replace(_m,"")}function sp(i,s){return s=Yd(s),Yd(i)===s}function Ai(i,s,h,g,M,z){switch(h){case"children":typeof g=="string"?s==="body"||s==="textarea"&&g===""||hs(i,g):(typeof g=="number"||typeof g=="bigint")&&s!=="body"&&hs(i,""+g);break;case"className":Al(i,"class",g);break;case"tabIndex":Al(i,"tabindex",g);break;case"dir":case"role":case"viewBox":case"width":case"height":Al(i,h,g);break;case"style":Mi(i,g,z);break;case"data":if(s!=="object"){Al(i,"data",g);break}case"src":case"href":if(g===""&&(s!=="a"||h!=="href")){i.removeAttribute(h);break}if(g==null||typeof g=="function"||typeof g=="symbol"||typeof g=="boolean"){i.removeAttribute(h);break}g=hi(""+g),i.setAttribute(h,g);break;case"action":case"formAction":if(typeof g=="function"){i.setAttribute(h,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof z=="function"&&(h==="formAction"?(s!=="input"&&Ai(i,s,"name",M.name,M,null),Ai(i,s,"formEncType",M.formEncType,M,null),Ai(i,s,"formMethod",M.formMethod,M,null),Ai(i,s,"formTarget",M.formTarget,M,null)):(Ai(i,s,"encType",M.encType,M,null),Ai(i,s,"method",M.method,M,null),Ai(i,s,"target",M.target,M,null)));if(g==null||typeof g=="symbol"||typeof g=="boolean"){i.removeAttribute(h);break}g=hi(""+g),i.setAttribute(h,g);break;case"onClick":g!=null&&(i.onclick=nr);break;case"onScroll":g!=null&&Li("scroll",i);break;case"onScrollEnd":g!=null&&Li("scrollend",i);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(C(61));if(h=g.__html,h!=null){if(M.children!=null)throw Error(C(60));i.innerHTML=h}}break;case"multiple":i.multiple=g&&typeof g!="function"&&typeof g!="symbol";break;case"muted":i.muted=g&&typeof g!="function"&&typeof g!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(g==null||typeof g=="function"||typeof g=="boolean"||typeof g=="symbol"){i.removeAttribute("xlink:href");break}h=hi(""+g),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",h);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":g!=null&&typeof g!="function"&&typeof g!="symbol"?i.setAttribute(h,""+g):i.removeAttribute(h);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":g&&typeof g!="function"&&typeof g!="symbol"?i.setAttribute(h,""):i.removeAttribute(h);break;case"capture":case"download":g===!0?i.setAttribute(h,""):g!==!1&&g!=null&&typeof g!="function"&&typeof g!="symbol"?i.setAttribute(h,g):i.removeAttribute(h);break;case"cols":case"rows":case"size":case"span":g!=null&&typeof g!="function"&&typeof g!="symbol"&&!isNaN(g)&&1<=g?i.setAttribute(h,g):i.removeAttribute(h);break;case"rowSpan":case"start":g==null||typeof g=="function"||typeof g=="symbol"||isNaN(g)?i.removeAttribute(h):i.setAttribute(h,g);break;case"popover":Li("beforetoggle",i),Li("toggle",i),fc(i,"popover",g);break;case"xlinkActuate":us(i,"http://www.w3.org/1999/xlink","xlink:actuate",g);break;case"xlinkArcrole":us(i,"http://www.w3.org/1999/xlink","xlink:arcrole",g);break;case"xlinkRole":us(i,"http://www.w3.org/1999/xlink","xlink:role",g);break;case"xlinkShow":us(i,"http://www.w3.org/1999/xlink","xlink:show",g);break;case"xlinkTitle":us(i,"http://www.w3.org/1999/xlink","xlink:title",g);break;case"xlinkType":us(i,"http://www.w3.org/1999/xlink","xlink:type",g);break;case"xmlBase":us(i,"http://www.w3.org/XML/1998/namespace","xml:base",g);break;case"xmlLang":us(i,"http://www.w3.org/XML/1998/namespace","xml:lang",g);break;case"xmlSpace":us(i,"http://www.w3.org/XML/1998/namespace","xml:space",g);break;case"is":fc(i,"is",g);break;case"innerText":case"textContent":break;default:(!(2<h.length)||h[0]!=="o"&&h[0]!=="O"||h[1]!=="n"&&h[1]!=="N")&&(h=Bn.get(h)||h,fc(i,h,g))}}function sc(i,s,h,g,M,z){switch(h){case"style":Mi(i,g,z);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(C(61));if(h=g.__html,h!=null){if(M.children!=null)throw Error(C(60));i.innerHTML=h}}break;case"children":typeof g=="string"?hs(i,g):(typeof g=="number"||typeof g=="bigint")&&hs(i,""+g);break;case"onScroll":g!=null&&Li("scroll",i);break;case"onScrollEnd":g!=null&&Li("scrollend",i);break;case"onClick":g!=null&&(i.onclick=nr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Hn.hasOwnProperty(h))e:{if(h[0]==="o"&&h[1]==="n"&&(M=h.endsWith("Capture"),s=h.slice(2,M?h.length-7:void 0),z=i[ut]||null,z=z!=null?z[h]:null,typeof z=="function"&&i.removeEventListener(s,z,M),typeof g=="function")){typeof z!="function"&&z!==null&&(h in i?i[h]=null:i.hasAttribute(h)&&i.removeAttribute(h)),i.addEventListener(s,g,M);break e}h in i?i[h]=g:g===!0?i.setAttribute(h,""):fc(i,h,g)}}}function on(i,s,h){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Li("error",i),Li("load",i);var g=!1,M=!1,z;for(z in h)if(h.hasOwnProperty(z)){var G=h[z];if(G!=null)switch(z){case"src":g=!0;break;case"srcSet":M=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(C(137,s));default:Ai(i,s,z,G,h,null)}}M&&Ai(i,s,"srcSet",h.srcSet,h,null),g&&Ai(i,s,"src",h.src,h,null);return;case"input":Li("invalid",i);var Q=z=G=M=null,_e=null,Ge=null;for(g in h)if(h.hasOwnProperty(g)){var tt=h[g];if(tt!=null)switch(g){case"name":M=tt;break;case"type":G=tt;break;case"checked":_e=tt;break;case"defaultChecked":Ge=tt;break;case"value":z=tt;break;case"defaultValue":Q=tt;break;case"children":case"dangerouslySetInnerHTML":if(tt!=null)throw Error(C(137,s));break;default:Ai(i,s,g,tt,h,null)}}sh(i,z,Q,_e,Ge,G,M,!1);return;case"select":Li("invalid",i),g=G=z=null;for(M in h)if(h.hasOwnProperty(M)&&(Q=h[M],Q!=null))switch(M){case"value":z=Q;break;case"defaultValue":G=Q;break;case"multiple":g=Q;default:Ai(i,s,M,Q,h,null)}s=z,h=G,i.multiple=!!g,s!=null?so(i,!!g,s,!1):h!=null&&so(i,!!g,h,!0);return;case"textarea":Li("invalid",i),z=M=g=null;for(G in h)if(h.hasOwnProperty(G)&&(Q=h[G],Q!=null))switch(G){case"value":g=Q;break;case"defaultValue":M=Q;break;case"children":z=Q;break;case"dangerouslySetInnerHTML":if(Q!=null)throw Error(C(91));break;default:Ai(i,s,G,Q,h,null)}Pl(i,g,M,z);return;case"option":for(_e in h)if(h.hasOwnProperty(_e)&&(g=h[_e],g!=null))switch(_e){case"selected":i.selected=g&&typeof g!="function"&&typeof g!="symbol";break;default:Ai(i,s,_e,g,h,null)}return;case"dialog":Li("beforetoggle",i),Li("toggle",i),Li("cancel",i),Li("close",i);break;case"iframe":case"object":Li("load",i);break;case"video":case"audio":for(g=0;g<Jh.length;g++)Li(Jh[g],i);break;case"image":Li("error",i),Li("load",i);break;case"details":Li("toggle",i);break;case"embed":case"source":case"link":Li("error",i),Li("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Ge in h)if(h.hasOwnProperty(Ge)&&(g=h[Ge],g!=null))switch(Ge){case"children":case"dangerouslySetInnerHTML":throw Error(C(137,s));default:Ai(i,s,Ge,g,h,null)}return;default:if(oo(s)){for(tt in h)h.hasOwnProperty(tt)&&(g=h[tt],g!==void 0&&sc(i,s,tt,g,h,void 0));return}}for(Q in h)h.hasOwnProperty(Q)&&(g=h[Q],g!=null&&Ai(i,s,Q,g,h,null))}function nu(i,s,h,g){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var M=null,z=null,G=null,Q=null,_e=null,Ge=null,tt=null;for(Xe in h){var ot=h[Xe];if(h.hasOwnProperty(Xe)&&ot!=null)switch(Xe){case"checked":break;case"value":break;case"defaultValue":_e=ot;default:g.hasOwnProperty(Xe)||Ai(i,s,Xe,null,g,ot)}}for(var qe in g){var Xe=g[qe];if(ot=h[qe],g.hasOwnProperty(qe)&&(Xe!=null||ot!=null))switch(qe){case"type":z=Xe;break;case"name":M=Xe;break;case"checked":Ge=Xe;break;case"defaultChecked":tt=Xe;break;case"value":G=Xe;break;case"defaultValue":Q=Xe;break;case"children":case"dangerouslySetInnerHTML":if(Xe!=null)throw Error(C(137,s));break;default:Xe!==ot&&Ai(i,s,qe,Xe,g,ot)}}mc(i,G,Q,_e,Ge,tt,z,M);return;case"select":Xe=G=Q=qe=null;for(z in h)if(_e=h[z],h.hasOwnProperty(z)&&_e!=null)switch(z){case"value":break;case"multiple":Xe=_e;default:g.hasOwnProperty(z)||Ai(i,s,z,null,g,_e)}for(M in g)if(z=g[M],_e=h[M],g.hasOwnProperty(M)&&(z!=null||_e!=null))switch(M){case"value":qe=z;break;case"defaultValue":Q=z;break;case"multiple":G=z;default:z!==_e&&Ai(i,s,M,z,g,_e)}s=Q,h=G,g=Xe,qe!=null?so(i,!!h,qe,!1):!!g!=!!h&&(s!=null?so(i,!!h,s,!0):so(i,!!h,h?[]:"",!1));return;case"textarea":Xe=qe=null;for(Q in h)if(M=h[Q],h.hasOwnProperty(Q)&&M!=null&&!g.hasOwnProperty(Q))switch(Q){case"value":break;case"children":break;default:Ai(i,s,Q,null,g,M)}for(G in g)if(M=g[G],z=h[G],g.hasOwnProperty(G)&&(M!=null||z!=null))switch(G){case"value":qe=M;break;case"defaultValue":Xe=M;break;case"children":break;case"dangerouslySetInnerHTML":if(M!=null)throw Error(C(91));break;default:M!==z&&Ai(i,s,G,M,g,z)}hd(i,qe,Xe);return;case"option":for(var Ft in h)if(qe=h[Ft],h.hasOwnProperty(Ft)&&qe!=null&&!g.hasOwnProperty(Ft))switch(Ft){case"selected":i.selected=!1;break;default:Ai(i,s,Ft,null,g,qe)}for(_e in g)if(qe=g[_e],Xe=h[_e],g.hasOwnProperty(_e)&&qe!==Xe&&(qe!=null||Xe!=null))switch(_e){case"selected":i.selected=qe&&typeof qe!="function"&&typeof qe!="symbol";break;default:Ai(i,s,_e,qe,g,Xe)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ii in h)qe=h[ii],h.hasOwnProperty(ii)&&qe!=null&&!g.hasOwnProperty(ii)&&Ai(i,s,ii,null,g,qe);for(Ge in g)if(qe=g[Ge],Xe=h[Ge],g.hasOwnProperty(Ge)&&qe!==Xe&&(qe!=null||Xe!=null))switch(Ge){case"children":case"dangerouslySetInnerHTML":if(qe!=null)throw Error(C(137,s));break;default:Ai(i,s,Ge,qe,g,Xe)}return;default:if(oo(s)){for(var ma in h)qe=h[ma],h.hasOwnProperty(ma)&&qe!==void 0&&!g.hasOwnProperty(ma)&&sc(i,s,ma,void 0,g,qe);for(tt in g)qe=g[tt],Xe=h[tt],!g.hasOwnProperty(tt)||qe===Xe||qe===void 0&&Xe===void 0||sc(i,s,tt,qe,g,Xe);return}}for(var ze in h)qe=h[ze],h.hasOwnProperty(ze)&&qe!=null&&!g.hasOwnProperty(ze)&&Ai(i,s,ze,null,g,qe);for(ot in g)qe=g[ot],Xe=h[ot],!g.hasOwnProperty(ot)||qe===Xe||qe==null&&Xe==null||Ai(i,s,ot,qe,g,Xe)}function op(i){switch(i){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function ym(){if(typeof performance.getEntriesByType=="function"){for(var i=0,s=0,h=performance.getEntriesByType("resource"),g=0;g<h.length;g++){var M=h[g],z=M.transferSize,G=M.initiatorType,Q=M.duration;if(z&&Q&&op(G)){for(G=0,Q=M.responseEnd,g+=1;g<h.length;g++){var _e=h[g],Ge=_e.startTime;if(Ge>Q)break;var tt=_e.transferSize,ot=_e.initiatorType;tt&&op(ot)&&(_e=_e.responseEnd,G+=tt*(_e<Q?1:(Q-Ge)/(_e-Ge)))}if(--g,s+=8*(z+G)/(M.duration/1e3),i++,10<i)break}}if(0<i)return s/i/1e6}return navigator.connection&&(i=navigator.connection.downlink,typeof i=="number")?i:5}var Wd=null,Qd=null;function Kd(i){return i.nodeType===9?i:i.ownerDocument}function lp(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function wl(i,s){if(i===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&s==="foreignObject"?0:i}function Jd(i,s){return i==="textarea"||i==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var ef=null;function vm(){var i=window.event;return i&&i.type==="popstate"?i===ef?!1:(ef=i,!0):(ef=null,!1)}var cp=typeof setTimeout=="function"?setTimeout:void 0,fg=typeof clearTimeout=="function"?clearTimeout:void 0,xm=typeof Promise=="function"?Promise:void 0,bm=typeof queueMicrotask=="function"?queueMicrotask:typeof xm<"u"?function(i){return xm.resolve(null).then(i).catch(wm)}:cp;function wm(i){setTimeout(function(){throw i})}function io(i){return i==="head"}function up(i,s){var h=s,g=0;do{var M=h.nextSibling;if(i.removeChild(h),M&&M.nodeType===8)if(h=M.data,h==="/$"||h==="/&"){if(g===0){i.removeChild(M),ir(s);return}g--}else if(h==="$"||h==="$?"||h==="$~"||h==="$!"||h==="&")g++;else if(h==="html")Wu(i.ownerDocument.documentElement);else if(h==="head"){h=i.ownerDocument.head,Wu(h);for(var z=h.firstChild;z;){var G=z.nextSibling,Q=z.nodeName;z[ni]||Q==="SCRIPT"||Q==="STYLE"||Q==="LINK"&&z.rel.toLowerCase()==="stylesheet"||h.removeChild(z),z=G}}else h==="body"&&Wu(i.ownerDocument.body);h=M}while(h);ir(s)}function ad(i,s){var h=i;i=0;do{var g=h.nextSibling;if(h.nodeType===1?s?(h._stashedDisplay=h.style.display,h.style.display="none"):(h.style.display=h._stashedDisplay||"",h.getAttribute("style")===""&&h.removeAttribute("style")):h.nodeType===3&&(s?(h._stashedText=h.nodeValue,h.nodeValue=""):h.nodeValue=h._stashedText||""),g&&g.nodeType===8)if(h=g.data,h==="/$"){if(i===0)break;i--}else h!=="$"&&h!=="$?"&&h!=="$~"&&h!=="$!"||i++;h=g}while(h)}function Yu(i){var s=i.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var h=s;switch(s=s.nextSibling,h.nodeName){case"HTML":case"HEAD":case"BODY":Yu(h),no(h);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(h.rel.toLowerCase()==="stylesheet")continue}i.removeChild(h)}}function tf(i,s,h,g){for(;i.nodeType===1;){var M=h;if(i.nodeName.toLowerCase()!==s.toLowerCase()){if(!g&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(g){if(!i[ni])switch(s){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(z=i.getAttribute("rel"),z==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(z!==M.rel||i.getAttribute("href")!==(M.href==null||M.href===""?null:M.href)||i.getAttribute("crossorigin")!==(M.crossOrigin==null?null:M.crossOrigin)||i.getAttribute("title")!==(M.title==null?null:M.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(z=i.getAttribute("src"),(z!==(M.src==null?null:M.src)||i.getAttribute("type")!==(M.type==null?null:M.type)||i.getAttribute("crossorigin")!==(M.crossOrigin==null?null:M.crossOrigin))&&z&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(s==="input"&&i.type==="hidden"){var z=M.name==null?null:""+M.name;if(M.type==="hidden"&&i.getAttribute("name")===z)return i}else return i;if(i=Lr(i.nextSibling),i===null)break}return null}function pg(i,s,h){if(s==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!h||(i=Lr(i.nextSibling),i===null))return null;return i}function Sm(i,s){for(;i.nodeType!==8;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!s||(i=Lr(i.nextSibling),i===null))return null;return i}function hp(i){return i.data==="$?"||i.data==="$~"}function oc(i){return i.data==="$!"||i.data==="$?"&&i.ownerDocument.readyState!=="loading"}function On(i,s){var h=i.ownerDocument;if(i.data==="$~")i._reactRetry=s;else if(i.data!=="$?"||h.readyState!=="loading")s();else{var g=function(){s(),h.removeEventListener("DOMContentLoaded",g)};h.addEventListener("DOMContentLoaded",g),i._reactRetry=g}}function Lr(i){for(;i!=null;i=i.nextSibling){var s=i.nodeType;if(s===1||s===3)break;if(s===8){if(s=i.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return i}var af=null;function dp(i){i=i.nextSibling;for(var s=0;i;){if(i.nodeType===8){var h=i.data;if(h==="/$"||h==="/&"){if(s===0)return Lr(i.nextSibling);s--}else h!=="$"&&h!=="$!"&&h!=="$?"&&h!=="$~"&&h!=="&"||s++}i=i.nextSibling}return null}function nf(i){i=i.previousSibling;for(var s=0;i;){if(i.nodeType===8){var h=i.data;if(h==="$"||h==="$!"||h==="$?"||h==="$~"||h==="&"){if(s===0)return i;s--}else h!=="/$"&&h!=="/&"||s++}i=i.previousSibling}return null}function Mm(i,s,h){switch(s=Kd(h),i){case"html":if(i=s.documentElement,!i)throw Error(C(452));return i;case"head":if(i=s.head,!i)throw Error(C(453));return i;case"body":if(i=s.body,!i)throw Error(C(454));return i;default:throw Error(C(451))}}function Wu(i){for(var s=i.attributes;s.length;)i.removeAttributeNode(s[0]);no(i)}var ns=new Map,Tm=new Set;function nd(i){return typeof i.getRootNode=="function"?i.getRootNode():i.nodeType===9?i:i.ownerDocument}var ao=at.d;at.d={f:fp,r:Em,D:Cm,C:pp,L:sf,m:rd,X:gp,S:mp,M:_p};function fp(){var i=ao.f(),s=jd();return i||s}function Em(i){var s=Mr(i);s!==null&&s.tag===5&&s.type==="form"?Qn(s):ao.r(i)}var No=typeof document>"u"?null:document;function rf(i,s,h){var g=No;if(g&&typeof s=="string"&&s){var M=dn(s);M='link[rel="'+i+'"][href="'+M+'"]',typeof h=="string"&&(M+='[crossorigin="'+h+'"]'),Tm.has(M)||(Tm.add(M),i={rel:i,crossOrigin:h,href:s},g.querySelector(M)===null&&(s=g.createElement("link"),on(s,"link",i),Ma(s),g.head.appendChild(s)))}}function Cm(i){ao.D(i),rf("dns-prefetch",i,null)}function pp(i,s){ao.C(i,s),rf("preconnect",i,s)}function sf(i,s,h){ao.L(i,s,h);var g=No;if(g&&i&&s){var M='link[rel="preload"][as="'+dn(s)+'"]';s==="image"&&h&&h.imageSrcSet?(M+='[imagesrcset="'+dn(h.imageSrcSet)+'"]',typeof h.imageSizes=="string"&&(M+='[imagesizes="'+dn(h.imageSizes)+'"]')):M+='[href="'+dn(i)+'"]';var z=M;switch(s){case"style":z=n(i);break;case"script":z=d(i)}ns.has(z)||(i=K({rel:"preload",href:s==="image"&&h&&h.imageSrcSet?void 0:i,as:s},h),ns.set(z,i),g.querySelector(M)!==null||s==="style"&&g.querySelector(t(z))||s==="script"&&g.querySelector(_(z))||(s=g.createElement("link"),on(s,"link",i),Ma(s),g.head.appendChild(s)))}}function rd(i,s){ao.m(i,s);var h=No;if(h&&i){var g=s&&typeof s.as=="string"?s.as:"script",M='link[rel="modulepreload"][as="'+dn(g)+'"][href="'+dn(i)+'"]',z=M;switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":z=d(i)}if(!ns.has(z)&&(i=K({rel:"modulepreload",href:i},s),ns.set(z,i),h.querySelector(M)===null)){switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(h.querySelector(_(z)))return}g=h.createElement("link"),on(g,"link",i),Ma(g),h.head.appendChild(g)}}}function mp(i,s,h){ao.S(i,s,h);var g=No;if(g&&i){var M=$n(g).hoistableStyles,z=n(i);s=s||"default";var G=M.get(z);if(!G){var Q={loading:0,preload:null};if(G=g.querySelector(t(z)))Q.loading=5;else{i=K({rel:"stylesheet",href:i,"data-precedence":s},h),(h=ns.get(z))&&S(i,h);var _e=G=g.createElement("link");Ma(_e),on(_e,"link",i),_e._p=new Promise(function(Ge,tt){_e.onload=Ge,_e.onerror=tt}),_e.addEventListener("load",function(){Q.loading|=1}),_e.addEventListener("error",function(){Q.loading|=2}),Q.loading|=4,b(G,s,g)}G={type:"stylesheet",instance:G,count:1,state:Q},M.set(z,G)}}}function gp(i,s){ao.X(i,s);var h=No;if(h&&i){var g=$n(h).hoistableScripts,M=d(i),z=g.get(M);z||(z=h.querySelector(_(M)),z||(i=K({src:i,async:!0},s),(s=ns.get(M))&&I(i,s),z=h.createElement("script"),Ma(z),on(z,"link",i),h.head.appendChild(z)),z={type:"script",instance:z,count:1,state:null},g.set(M,z))}}function _p(i,s){ao.M(i,s);var h=No;if(h&&i){var g=$n(h).hoistableScripts,M=d(i),z=g.get(M);z||(z=h.querySelector(_(M)),z||(i=K({src:i,async:!0,type:"module"},s),(s=ns.get(M))&&I(i,s),z=h.createElement("script"),Ma(z),on(z,"link",i),h.head.appendChild(z)),z={type:"script",instance:z,count:1,state:null},g.set(M,z))}}function Am(i,s,h,g){var M=(M=Ot.current)?nd(M):null;if(!M)throw Error(C(446));switch(i){case"meta":case"title":return null;case"style":return typeof h.precedence=="string"&&typeof h.href=="string"?(s=n(h.href),h=$n(M).hoistableStyles,g=h.get(s),g||(g={type:"style",instance:null,count:0,state:null},h.set(s,g)),g):{type:"void",instance:null,count:0,state:null};case"link":if(h.rel==="stylesheet"&&typeof h.href=="string"&&typeof h.precedence=="string"){i=n(h.href);var z=$n(M).hoistableStyles,G=z.get(i);if(G||(M=M.ownerDocument||M,G={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},z.set(i,G),(z=M.querySelector(t(i)))&&!z._p&&(G.instance=z,G.state.loading=5),ns.has(i)||(h={rel:"preload",as:"style",href:h.href,crossOrigin:h.crossOrigin,integrity:h.integrity,media:h.media,hrefLang:h.hrefLang,referrerPolicy:h.referrerPolicy},ns.set(i,h),z||l(M,i,h,G.state))),s&&g===null)throw Error(C(528,""));return G}if(s&&g!==null)throw Error(C(529,""));return null;case"script":return s=h.async,h=h.src,typeof h=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=d(h),h=$n(M).hoistableScripts,g=h.get(s),g||(g={type:"script",instance:null,count:0,state:null},h.set(s,g)),g):{type:"void",instance:null,count:0,state:null};default:throw Error(C(444,i))}}function n(i){return'href="'+dn(i)+'"'}function t(i){return'link[rel="stylesheet"]['+i+"]"}function a(i){return K({},i,{"data-precedence":i.precedence,precedence:null})}function l(i,s,h,g){i.querySelector('link[rel="preload"][as="style"]['+s+"]")?g.loading=1:(s=i.createElement("link"),g.preload=s,s.addEventListener("load",function(){return g.loading|=1}),s.addEventListener("error",function(){return g.loading|=2}),on(s,"link",h),Ma(s),i.head.appendChild(s))}function d(i){return'[src="'+dn(i)+'"]'}function _(i){return"script[async]"+i}function v(i,s,h){if(s.count++,s.instance===null)switch(s.type){case"style":var g=i.querySelector('style[data-href~="'+dn(h.href)+'"]');if(g)return s.instance=g,Ma(g),g;var M=K({},h,{"data-href":h.href,"data-precedence":h.precedence,href:null,precedence:null});return g=(i.ownerDocument||i).createElement("style"),Ma(g),on(g,"style",M),b(g,h.precedence,i),s.instance=g;case"stylesheet":M=n(h.href);var z=i.querySelector(t(M));if(z)return s.state.loading|=4,s.instance=z,Ma(z),z;g=a(h),(M=ns.get(M))&&S(g,M),z=(i.ownerDocument||i).createElement("link"),Ma(z);var G=z;return G._p=new Promise(function(Q,_e){G.onload=Q,G.onerror=_e}),on(z,"link",g),s.state.loading|=4,b(z,h.precedence,i),s.instance=z;case"script":return z=d(h.src),(M=i.querySelector(_(z)))?(s.instance=M,Ma(M),M):(g=h,(M=ns.get(z))&&(g=K({},h),I(g,M)),i=i.ownerDocument||i,M=i.createElement("script"),Ma(M),on(M,"link",g),i.head.appendChild(M),s.instance=M);case"void":return null;default:throw Error(C(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(g=s.instance,s.state.loading|=4,b(g,h.precedence,i));return s.instance}function b(i,s,h){for(var g=h.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),M=g.length?g[g.length-1]:null,z=M,G=0;G<g.length;G++){var Q=g[G];if(Q.dataset.precedence===s)z=Q;else if(z!==M)break}z?z.parentNode.insertBefore(i,z.nextSibling):(s=h.nodeType===9?h.head:h,s.insertBefore(i,s.firstChild))}function S(i,s){i.crossOrigin==null&&(i.crossOrigin=s.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=s.referrerPolicy),i.title==null&&(i.title=s.title)}function I(i,s){i.crossOrigin==null&&(i.crossOrigin=s.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=s.referrerPolicy),i.integrity==null&&(i.integrity=s.integrity)}var R=null;function O(i,s,h){if(R===null){var g=new Map,M=R=new Map;M.set(h,g)}else M=R,g=M.get(h),g||(g=new Map,M.set(h,g));if(g.has(i))return g;for(g.set(i,null),h=h.getElementsByTagName(i),M=0;M<h.length;M++){var z=h[M];if(!(z[ni]||z[Ri]||i==="link"&&z.getAttribute("rel")==="stylesheet")&&z.namespaceURI!=="http://www.w3.org/2000/svg"){var G=z.getAttribute(s)||"";G=i+G;var Q=g.get(G);Q?Q.push(z):g.set(G,[z])}}return g}function U(i,s,h){i=i.ownerDocument||i,i.head.insertBefore(h,s==="title"?i.querySelector("head > title"):null)}function V(i,s,h){if(h===1||s.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return i=s.disabled,typeof s.precedence=="string"&&i==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function Z(i){return!(i.type==="stylesheet"&&(i.state.loading&3)===0)}function Y(i,s,h,g){if(h.type==="stylesheet"&&(typeof g.media!="string"||matchMedia(g.media).matches!==!1)&&(h.state.loading&4)===0){if(h.instance===null){var M=n(g.href),z=s.querySelector(t(M));if(z){s=z._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(i.count++,i=Ee.bind(i),s.then(i,i)),h.state.loading|=4,h.instance=z,Ma(z);return}z=s.ownerDocument||s,g=a(g),(M=ns.get(M))&&S(g,M),z=z.createElement("link"),Ma(z);var G=z;G._p=new Promise(function(Q,_e){G.onload=Q,G.onerror=_e}),on(z,"link",g),h.instance=z}i.stylesheets===null&&(i.stylesheets=new Map),i.stylesheets.set(h,s),(s=h.state.preload)&&(h.state.loading&3)===0&&(i.count++,h=Ee.bind(i),s.addEventListener("load",h),s.addEventListener("error",h))}}var ie=0;function se(i,s){return i.stylesheets&&i.count===0&&ge(i,i.stylesheets),0<i.count||0<i.imgCount?function(h){var g=setTimeout(function(){if(i.stylesheets&&ge(i,i.stylesheets),i.unsuspend){var z=i.unsuspend;i.unsuspend=null,z()}},6e4+s);0<i.imgBytes&&ie===0&&(ie=62500*ym());var M=setTimeout(function(){if(i.waitingForImages=!1,i.count===0&&(i.stylesheets&&ge(i,i.stylesheets),i.unsuspend)){var z=i.unsuspend;i.unsuspend=null,z()}},(i.imgBytes>ie?50:800)+s);return i.unsuspend=h,function(){i.unsuspend=null,clearTimeout(g),clearTimeout(M)}}:null}function Ee(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)ge(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var de=null;function ge(i,s){i.stylesheets=null,i.unsuspend!==null&&(i.count++,de=new Map,s.forEach(ke,i),de=null,Ee.call(i))}function ke(i,s){if(!(s.state.loading&4)){var h=de.get(i);if(h)var g=h.get(null);else{h=new Map,de.set(i,h);for(var M=i.querySelectorAll("link[data-precedence],style[data-precedence]"),z=0;z<M.length;z++){var G=M[z];(G.nodeName==="LINK"||G.getAttribute("media")!=="not all")&&(h.set(G.dataset.precedence,G),g=G)}g&&h.set(null,g)}M=s.instance,G=M.getAttribute("data-precedence"),z=h.get(G)||g,z===g&&h.set(null,M),h.set(G,M),this.count++,g=Ee.bind(this),M.addEventListener("load",g),M.addEventListener("error",g),z?z.parentNode.insertBefore(M,z.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(M,i.firstChild)),s.state.loading|=4}}var Ve={$$typeof:Ke,Provider:null,Consumer:null,_currentValue:At,_currentValue2:At,_threadCount:0};function rt(i,s,h,g,M,z,G,Q,_e){this.tag=1,this.containerInfo=i,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Fa(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Fa(0),this.hiddenUpdates=Fa(null),this.identifierPrefix=g,this.onUncaughtError=M,this.onCaughtError=z,this.onRecoverableError=G,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=_e,this.incompleteTransitions=new Map}function St(i,s,h,g,M,z,G,Q,_e,Ge,tt,ot){return i=new rt(i,s,h,G,_e,Ge,tt,ot,Q),s=1,z===!0&&(s|=24),z=lr(3,null,null,s),i.current=z,z.stateNode=i,s=Lc(),s.refCount++,i.pooledCache=s,s.refCount++,z.memoizedState={element:g,isDehydrated:h,cache:s},bs(z),i}function pt(i){return i?(i=ui,i):ui}function bt(i,s,h,g,M,z){M=pt(M),g.context===null?g.context=M:g.pendingContext=M,g=Zs(s),g.payload={element:h},z=z===void 0?null:z,z!==null&&(g.callback=z),h=Ir(i,g,s),h!==null&&(er(h,i,s),Ao(h,i,s))}function Nt(i,s){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var h=i.retryLane;i.retryLane=h!==0&&h<s?h:s}}function yt(i,s){Nt(i,s),(i=i.alternate)&&Nt(i,s)}function wt(i){if(i.tag===13||i.tag===31){var s=Ar(i,67108864);s!==null&&er(s,i,67108864),yt(i,67108864)}}function et(i){if(i.tag===13||i.tag===31){var s=kr();s=ji(s);var h=Ar(i,s);h!==null&&er(h,i,s),yt(i,s)}}var $t=!0;function Wt(i,s,h,g){var M=He.T;He.T=null;var z=at.p;try{at.p=2,Dt(i,s,h,g)}finally{at.p=z,He.T=M}}function Zt(i,s,h,g){var M=He.T;He.T=null;var z=at.p;try{at.p=8,Dt(i,s,h,g)}finally{at.p=z,He.T=M}}function Dt(i,s,h,g){if($t){var M=pi(g);if(M===null)Xd(i,s,g,pa,h),Or(i,g);else if(wr(M,i,s,h,g))g.stopPropagation();else if(Or(i,g),s&4&&-1<tr.indexOf(i)){for(;M!==null;){var z=Mr(M);if(z!==null)switch(z.tag){case 3:if(z=z.stateNode,z.current.memoizedState.isDehydrated){var G=Pe(z.pendingLanes);if(G!==0){var Q=z;for(Q.pendingLanes|=2,Q.entangledLanes|=2;G;){var _e=1<<31-Ie(G);Q.entanglements[1]|=_e,G&=~_e}eo(z),(Gi&6)===0&&(tu=Pi()+500,au(0))}}break;case 31:case 13:Q=Ar(z,2),Q!==null&&er(Q,z,2),jd(),yt(z,2)}if(z=pi(g),z===null&&Xd(i,s,g,pa,h),z===M)break;M=z}M!==null&&g.stopPropagation()}else Xd(i,s,g,null,h)}}function pi(i){return i=lo(i),Ga(i)}var pa=null;function Ga(i){if(pa=null,i=ls(i),i!==null){var s=D(i);if(s===null)i=null;else{var h=s.tag;if(h===13){if(i=E(s),i!==null)return i;i=null}else if(h===31){if(i=o(s),i!==null)return i;i=null}else if(h===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;i=null}else s!==i&&(i=null)}}return pa=i,null}function En(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Pn()){case Ui:return 2;case Sa:return 8;case ya:case ve:return 32;case H:return 268435456;default:return 32}default:return 32}}var br=!1,Wa=null,Aa=null,Hi=null,Na=new Map,Ua=new Map,Pa=[],tr="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Or(i,s){switch(i){case"focusin":case"focusout":Wa=null;break;case"dragenter":case"dragleave":Aa=null;break;case"mouseover":case"mouseout":Hi=null;break;case"pointerover":case"pointerout":Na.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ua.delete(s.pointerId)}}function ja(i,s,h,g,M,z){return i===null||i.nativeEvent!==z?(i={blockedOn:s,domEventName:h,eventSystemFlags:g,nativeEvent:z,targetContainers:[M]},s!==null&&(s=Mr(s),s!==null&&wt(s)),i):(i.eventSystemFlags|=g,s=i.targetContainers,M!==null&&s.indexOf(M)===-1&&s.push(M),i)}function wr(i,s,h,g,M){switch(s){case"focusin":return Wa=ja(Wa,i,s,h,g,M),!0;case"dragenter":return Aa=ja(Aa,i,s,h,g,M),!0;case"mouseover":return Hi=ja(Hi,i,s,h,g,M),!0;case"pointerover":var z=M.pointerId;return Na.set(z,ja(Na.get(z)||null,i,s,h,g,M)),!0;case"gotpointercapture":return z=M.pointerId,Ua.set(z,ja(Ua.get(z)||null,i,s,h,g,M)),!0}return!1}function Qa(i){var s=ls(i.target);if(s!==null){var h=D(s);if(h!==null){if(s=h.tag,s===13){if(s=E(h),s!==null){i.blockedOn=s,Zn(i.priority,function(){et(h)});return}}else if(s===31){if(s=o(h),s!==null){i.blockedOn=s,Zn(i.priority,function(){et(h)});return}}else if(s===3&&h.stateNode.current.memoizedState.isDehydrated){i.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Va(i){if(i.blockedOn!==null)return!1;for(var s=i.targetContainers;0<s.length;){var h=pi(i.nativeEvent);if(h===null){h=i.nativeEvent;var g=new h.constructor(h.type,h);Vo=g,h.target.dispatchEvent(g),Vo=null}else return s=Mr(h),s!==null&&wt(s),i.blockedOn=h,!1;s.shift()}return!0}function ln(i,s,h){Va(i)&&h.delete(s)}function Ka(){br=!1,Wa!==null&&Va(Wa)&&(Wa=null),Aa!==null&&Va(Aa)&&(Aa=null),Hi!==null&&Va(Hi)&&(Hi=null),Na.forEach(ln),Ua.forEach(ln)}function ta(i,s){i.blockedOn===s&&(i.blockedOn=null,br||(br=!0,u.unstable_scheduleCallback(u.unstable_NormalPriority,Ka)))}var Br=null;function ru(i){Br!==i&&(Br=i,u.unstable_scheduleCallback(u.unstable_NormalPriority,function(){Br===i&&(Br=null);for(var s=0;s<i.length;s+=3){var h=i[s],g=i[s+1],M=i[s+2];if(typeof g!="function"){if(Ga(g||h)===null)continue;break}var z=Mr(h);z!==null&&(i.splice(s,3),s-=3,Rr(z,{pending:!0,data:M,method:h.method,action:g},g,M))}}))}function ir(i){function s(_e){return ta(_e,i)}Wa!==null&&ta(Wa,i),Aa!==null&&ta(Aa,i),Hi!==null&&ta(Hi,i),Na.forEach(s),Ua.forEach(s);for(var h=0;h<Pa.length;h++){var g=Pa[h];g.blockedOn===i&&(g.blockedOn=null)}for(;0<Pa.length&&(h=Pa[0],h.blockedOn===null);)Qa(h),h.blockedOn===null&&Pa.shift();if(h=(i.ownerDocument||i).$$reactFormReplay,h!=null)for(g=0;g<h.length;g+=3){var M=h[g],z=h[g+1],G=M[ut]||null;if(typeof z=="function")G||ru(h);else if(G){var Q=null;if(z&&z.hasAttribute("formAction")){if(M=z,G=z[ut]||null)Q=G.formAction;else if(Ga(M)!==null)continue}else Q=G.action;typeof Q=="function"?h[g+1]=Q:(h.splice(g,3),g-=3),ru(h)}}}function Pm(){function i(z){z.canIntercept&&z.info==="react-transition"&&z.intercept({handler:function(){return new Promise(function(G){return M=G})},focusReset:"manual",scroll:"manual"})}function s(){M!==null&&(M(),M=null),g||setTimeout(h,20)}function h(){if(!g&&!navigation.transition){var z=navigation.currentEntry;z&&z.url!=null&&navigation.navigate(z.url,{state:z.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var g=!1,M=null;return navigation.addEventListener("navigate",i),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(h,100),function(){g=!0,navigation.removeEventListener("navigate",i),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),M!==null&&(M(),M=null)}}}function lc(i){this._internalRoot=i}jo.prototype.render=lc.prototype.render=function(i){var s=this._internalRoot;if(s===null)throw Error(C(409));var h=s.current,g=kr();bt(h,g,i,s,null,null)},jo.prototype.unmount=lc.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var s=i.containerInfo;bt(i.current,2,null,i,null,null),jd(),s[si]=null}};function jo(i){this._internalRoot=i}jo.prototype.unstable_scheduleHydration=function(i){if(i){var s=Gr();i={blockedOn:null,target:i,priority:s};for(var h=0;h<Pa.length&&s!==0&&s<Pa[h].priority;h++);Pa.splice(h,0,i),h===0&&Qa(i)}};var su=y.version;if(su!=="19.2.0")throw Error(C(527,su,"19.2.0"));at.findDOMNode=function(i){var s=i._reactInternals;if(s===void 0)throw typeof i.render=="function"?Error(C(188)):(i=Object.keys(i).join(","),Error(C(268,i)));return i=j(s),i=i!==null?J(i):null,i=i===null?null:i.stateNode,i};var Qu={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:He,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Sl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Sl.isDisabled&&Sl.supportsFiber)try{ce=Sl.inject(Qu),fe=Sl}catch{}}return vp.createRoot=function(i,s){if(!P(i))throw Error(C(299));var h=!1,g="",M=Mf,z=Vp,G=Td;return s!=null&&(s.unstable_strictMode===!0&&(h=!0),s.identifierPrefix!==void 0&&(g=s.identifierPrefix),s.onUncaughtError!==void 0&&(M=s.onUncaughtError),s.onCaughtError!==void 0&&(z=s.onCaughtError),s.onRecoverableError!==void 0&&(G=s.onRecoverableError)),s=St(i,1,!1,null,null,h,g,null,M,z,G,Pm),i[si]=s.current,Hd(i),new lc(s)},vp.hydrateRoot=function(i,s,h){if(!P(i))throw Error(C(299));var g=!1,M="",z=Mf,G=Vp,Q=Td,_e=null;return h!=null&&(h.unstable_strictMode===!0&&(g=!0),h.identifierPrefix!==void 0&&(M=h.identifierPrefix),h.onUncaughtError!==void 0&&(z=h.onUncaughtError),h.onCaughtError!==void 0&&(G=h.onCaughtError),h.onRecoverableError!==void 0&&(Q=h.onRecoverableError),h.formState!==void 0&&(_e=h.formState)),s=St(i,1,!0,s,h??null,g,M,_e,z,G,Q,Pm),s.context=pt(null),h=s.current,g=kr(),g=ji(g),M=Zs(g),M.callback=null,Ir(h,M,g),h=g,s.current.lanes=h,za(s,h),eo(s),i[si]=s.current,Hd(i),new jo(s)},vp.version="19.2.0",vp}var u_;function By(){if(u_)return gg.exports;u_=1;function u(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(u)}catch(y){console.error(y)}}return u(),gg.exports=Oy(),gg.exports}var Ny=By(),Qe=Bg();/**
 * react-router v7.9.4
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var h_="popstate";function jy(u={}){function y(C,P){let{pathname:D,search:E,hash:o}=C.location;return Cg("",{pathname:D,search:E,hash:o},P.state&&P.state.usr||null,P.state&&P.state.key||"default")}function w(C,P){return typeof P=="string"?P:zp(P)}return Gy(y,w,null,u)}function un(u,y){if(u===!1||u===null||typeof u>"u")throw new Error(y)}function uc(u,y){if(!u){typeof console<"u"&&console.warn(y);try{throw new Error(y)}catch{}}}function Fy(){return Math.random().toString(36).substring(2,10)}function d_(u,y){return{usr:u.state,key:u.key,idx:y}}function Cg(u,y,w=null,C){return{pathname:typeof u=="string"?u:u.pathname,search:"",hash:"",...typeof y=="string"?mf(y):y,state:w,key:y&&y.key||C||Fy()}}function zp({pathname:u="/",search:y="",hash:w=""}){return y&&y!=="?"&&(u+=y.charAt(0)==="?"?y:"?"+y),w&&w!=="#"&&(u+=w.charAt(0)==="#"?w:"#"+w),u}function mf(u){let y={};if(u){let w=u.indexOf("#");w>=0&&(y.hash=u.substring(w),u=u.substring(0,w));let C=u.indexOf("?");C>=0&&(y.search=u.substring(C),u=u.substring(0,C)),u&&(y.pathname=u)}return y}function Gy(u,y,w,C={}){let{window:P=document.defaultView,v5Compat:D=!1}=C,E=P.history,o="POP",B=null,j=J();j==null&&(j=0,E.replaceState({...E.state,idx:j},""));function J(){return(E.state||{idx:null}).idx}function K(){o="POP";let Ae=J(),Ze=Ae==null?null:Ae-j;j=Ae,B&&B({action:o,location:Oe.location,delta:Ze})}function W(Ae,Ze){o="PUSH";let Be=Cg(Oe.location,Ae,Ze);j=J()+1;let Ke=d_(Be,j),vt=Oe.createHref(Be);try{E.pushState(Ke,"",vt)}catch(Et){if(Et instanceof DOMException&&Et.name==="DataCloneError")throw Et;P.location.assign(vt)}D&&B&&B({action:o,location:Oe.location,delta:1})}function ee(Ae,Ze){o="REPLACE";let Be=Cg(Oe.location,Ae,Ze);j=J();let Ke=d_(Be,j),vt=Oe.createHref(Be);E.replaceState(Ke,"",vt),D&&B&&B({action:o,location:Oe.location,delta:0})}function we(Ae){return Uy(Ae)}let Oe={get action(){return o},get location(){return u(P,E)},listen(Ae){if(B)throw new Error("A history only accepts one active listener");return P.addEventListener(h_,K),B=Ae,()=>{P.removeEventListener(h_,K),B=null}},createHref(Ae){return y(P,Ae)},createURL:we,encodeLocation(Ae){let Ze=we(Ae);return{pathname:Ze.pathname,search:Ze.search,hash:Ze.hash}},push:W,replace:ee,go(Ae){return E.go(Ae)}};return Oe}function Uy(u,y=!1){let w="http://localhost";typeof window<"u"&&(w=window.location.origin!=="null"?window.location.origin:window.location.href),un(w,"No window.location.(origin|href) available to create URL");let C=typeof u=="string"?u:zp(u);return C=C.replace(/ $/,"%20"),!y&&C.startsWith("//")&&(C=w+C),new URL(C,w)}function G_(u,y,w="/"){return Vy(u,y,w,!1)}function Vy(u,y,w,C){let P=typeof y=="string"?mf(y):y,D=lu(P.pathname||"/",w);if(D==null)return null;let E=U_(u);qy(E);let o=null;for(let B=0;o==null&&B<E.length;++B){let j=t0(D);o=Jy(E[B],j,C)}return o}function U_(u,y=[],w=[],C="",P=!1){let D=(E,o,B=P,j)=>{let J={relativePath:j===void 0?E.path||"":j,caseSensitive:E.caseSensitive===!0,childrenIndex:o,route:E};if(J.relativePath.startsWith("/")){if(!J.relativePath.startsWith(C)&&B)return;un(J.relativePath.startsWith(C),`Absolute route path "${J.relativePath}" nested under path "${C}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),J.relativePath=J.relativePath.slice(C.length)}let K=ou([C,J.relativePath]),W=w.concat(J);E.children&&E.children.length>0&&(un(E.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${K}".`),U_(E.children,y,W,K,B)),!(E.path==null&&!E.index)&&y.push({path:K,score:Qy(K,E.index),routesMeta:W})};return u.forEach((E,o)=>{if(E.path===""||!E.path?.includes("?"))D(E,o);else for(let B of V_(E.path))D(E,o,!0,B)}),y}function V_(u){let y=u.split("/");if(y.length===0)return[];let[w,...C]=y,P=w.endsWith("?"),D=w.replace(/\?$/,"");if(C.length===0)return P?[D,""]:[D];let E=V_(C.join("/")),o=[];return o.push(...E.map(B=>B===""?D:[D,B].join("/"))),P&&o.push(...E),o.map(B=>u.startsWith("/")&&B===""?"/":B)}function qy(u){u.sort((y,w)=>y.score!==w.score?w.score-y.score:Ky(y.routesMeta.map(C=>C.childrenIndex),w.routesMeta.map(C=>C.childrenIndex)))}var Zy=/^:[\w-]+$/,$y=3,Hy=2,Xy=1,Yy=10,Wy=-2,f_=u=>u==="*";function Qy(u,y){let w=u.split("/"),C=w.length;return w.some(f_)&&(C+=Wy),y&&(C+=Hy),w.filter(P=>!f_(P)).reduce((P,D)=>P+(Zy.test(D)?$y:D===""?Xy:Yy),C)}function Ky(u,y){return u.length===y.length&&u.slice(0,-1).every((C,P)=>C===y[P])?u[u.length-1]-y[y.length-1]:0}function Jy(u,y,w=!1){let{routesMeta:C}=u,P={},D="/",E=[];for(let o=0;o<C.length;++o){let B=C[o],j=o===C.length-1,J=D==="/"?y:y.slice(D.length)||"/",K=Vm({path:B.relativePath,caseSensitive:B.caseSensitive,end:j},J),W=B.route;if(!K&&j&&w&&!C[C.length-1].route.index&&(K=Vm({path:B.relativePath,caseSensitive:B.caseSensitive,end:!1},J)),!K)return null;Object.assign(P,K.params),E.push({params:P,pathname:ou([D,K.pathname]),pathnameBase:r0(ou([D,K.pathnameBase])),route:W}),K.pathnameBase!=="/"&&(D=ou([D,K.pathnameBase]))}return E}function Vm(u,y){typeof u=="string"&&(u={path:u,caseSensitive:!1,end:!0});let[w,C]=e0(u.path,u.caseSensitive,u.end),P=y.match(w);if(!P)return null;let D=P[0],E=D.replace(/(.)\/+$/,"$1"),o=P.slice(1);return{params:C.reduce((j,{paramName:J,isOptional:K},W)=>{if(J==="*"){let we=o[W]||"";E=D.slice(0,D.length-we.length).replace(/(.)\/+$/,"$1")}const ee=o[W];return K&&!ee?j[J]=void 0:j[J]=(ee||"").replace(/%2F/g,"/"),j},{}),pathname:D,pathnameBase:E,pattern:u}}function e0(u,y=!1,w=!0){uc(u==="*"||!u.endsWith("*")||u.endsWith("/*"),`Route path "${u}" will be treated as if it were "${u.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${u.replace(/\*$/,"/*")}".`);let C=[],P="^"+u.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(E,o,B)=>(C.push({paramName:o,isOptional:B!=null}),B?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return u.endsWith("*")?(C.push({paramName:"*"}),P+=u==="*"||u==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):w?P+="\\/*$":u!==""&&u!=="/"&&(P+="(?:(?=\\/|$))"),[new RegExp(P,y?void 0:"i"),C]}function t0(u){try{return u.split("/").map(y=>decodeURIComponent(y).replace(/\//g,"%2F")).join("/")}catch(y){return uc(!1,`The URL path "${u}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${y}).`),u}}function lu(u,y){if(y==="/")return u;if(!u.toLowerCase().startsWith(y.toLowerCase()))return null;let w=y.endsWith("/")?y.length-1:y.length,C=u.charAt(w);return C&&C!=="/"?null:u.slice(w)||"/"}function i0(u,y="/"){let{pathname:w,search:C="",hash:P=""}=typeof u=="string"?mf(u):u;return{pathname:w?w.startsWith("/")?w:a0(w,y):y,search:s0(C),hash:o0(P)}}function a0(u,y){let w=y.replace(/\/+$/,"").split("/");return u.split("/").forEach(P=>{P===".."?w.length>1&&w.pop():P!=="."&&w.push(P)}),w.length>1?w.join("/"):"/"}function bg(u,y,w,C){return`Cannot include a '${u}' character in a manually specified \`to.${y}\` field [${JSON.stringify(C)}].  Please separate it out to the \`to.${w}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function n0(u){return u.filter((y,w)=>w===0||y.route.path&&y.route.path.length>0)}function q_(u){let y=n0(u);return y.map((w,C)=>C===y.length-1?w.pathname:w.pathnameBase)}function Z_(u,y,w,C=!1){let P;typeof u=="string"?P=mf(u):(P={...u},un(!P.pathname||!P.pathname.includes("?"),bg("?","pathname","search",P)),un(!P.pathname||!P.pathname.includes("#"),bg("#","pathname","hash",P)),un(!P.search||!P.search.includes("#"),bg("#","search","hash",P)));let D=u===""||P.pathname==="",E=D?"/":P.pathname,o;if(E==null)o=w;else{let K=y.length-1;if(!C&&E.startsWith("..")){let W=E.split("/");for(;W[0]==="..";)W.shift(),K-=1;P.pathname=W.join("/")}o=K>=0?y[K]:"/"}let B=i0(P,o),j=E&&E!=="/"&&E.endsWith("/"),J=(D||E===".")&&w.endsWith("/");return!B.pathname.endsWith("/")&&(j||J)&&(B.pathname+="/"),B}var ou=u=>u.join("/").replace(/\/\/+/g,"/"),r0=u=>u.replace(/\/+$/,"").replace(/^\/*/,"/"),s0=u=>!u||u==="?"?"":u.startsWith("?")?u:"?"+u,o0=u=>!u||u==="#"?"":u.startsWith("#")?u:"#"+u;function l0(u){return u!=null&&typeof u.status=="number"&&typeof u.statusText=="string"&&typeof u.internal=="boolean"&&"data"in u}var $_=["POST","PUT","PATCH","DELETE"];new Set($_);var c0=["GET",...$_];new Set(c0);var gf=Qe.createContext(null);gf.displayName="DataRouter";var Wm=Qe.createContext(null);Wm.displayName="DataRouterState";Qe.createContext(!1);var H_=Qe.createContext({isTransitioning:!1});H_.displayName="ViewTransition";var u0=Qe.createContext(new Map);u0.displayName="Fetchers";var h0=Qe.createContext(null);h0.displayName="Await";var dc=Qe.createContext(null);dc.displayName="Navigation";var Lp=Qe.createContext(null);Lp.displayName="Location";var cu=Qe.createContext({outlet:null,matches:[],isDataRoute:!1});cu.displayName="Route";var Ng=Qe.createContext(null);Ng.displayName="RouteError";function d0(u,{relative:y}={}){un(Op(),"useHref() may be used only in the context of a <Router> component.");let{basename:w,navigator:C}=Qe.useContext(dc),{hash:P,pathname:D,search:E}=Bp(u,{relative:y}),o=D;return w!=="/"&&(o=D==="/"?w:ou([w,D])),C.createHref({pathname:o,search:E,hash:P})}function Op(){return Qe.useContext(Lp)!=null}function cd(){return un(Op(),"useLocation() may be used only in the context of a <Router> component."),Qe.useContext(Lp).location}var X_="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Y_(u){Qe.useContext(dc).static||Qe.useLayoutEffect(u)}function f0(){let{isDataRoute:u}=Qe.useContext(cu);return u?E0():p0()}function p0(){un(Op(),"useNavigate() may be used only in the context of a <Router> component.");let u=Qe.useContext(gf),{basename:y,navigator:w}=Qe.useContext(dc),{matches:C}=Qe.useContext(cu),{pathname:P}=cd(),D=JSON.stringify(q_(C)),E=Qe.useRef(!1);return Y_(()=>{E.current=!0}),Qe.useCallback((B,j={})=>{if(uc(E.current,X_),!E.current)return;if(typeof B=="number"){w.go(B);return}let J=Z_(B,JSON.parse(D),P,j.relative==="path");u==null&&y!=="/"&&(J.pathname=J.pathname==="/"?y:ou([y,J.pathname])),(j.replace?w.replace:w.push)(J,j.state,j)},[y,w,D,P,u])}Qe.createContext(null);function Bp(u,{relative:y}={}){let{matches:w}=Qe.useContext(cu),{pathname:C}=cd(),P=JSON.stringify(q_(w));return Qe.useMemo(()=>Z_(u,JSON.parse(P),C,y==="path"),[u,P,C,y])}function m0(u,y){return W_(u,y)}function W_(u,y,w,C,P){un(Op(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:D}=Qe.useContext(dc),{matches:E}=Qe.useContext(cu),o=E[E.length-1],B=o?o.params:{},j=o?o.pathname:"/",J=o?o.pathnameBase:"/",K=o&&o.route;{let Be=K&&K.path||"";Q_(j,!K||Be.endsWith("*")||Be.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${j}" (under <Route path="${Be}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${Be}"> to <Route path="${Be==="/"?"*":`${Be}/*`}">.`)}let W=cd(),ee;if(y){let Be=typeof y=="string"?mf(y):y;un(J==="/"||Be.pathname?.startsWith(J),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${J}" but pathname "${Be.pathname}" was given in the \`location\` prop.`),ee=Be}else ee=W;let we=ee.pathname||"/",Oe=we;if(J!=="/"){let Be=J.replace(/^\//,"").split("/");Oe="/"+we.replace(/^\//,"").split("/").slice(Be.length).join("/")}let Ae=G_(u,{pathname:Oe});uc(K||Ae!=null,`No routes matched location "${ee.pathname}${ee.search}${ee.hash}" `),uc(Ae==null||Ae[Ae.length-1].route.element!==void 0||Ae[Ae.length-1].route.Component!==void 0||Ae[Ae.length-1].route.lazy!==void 0,`Matched leaf route at location "${ee.pathname}${ee.search}${ee.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let Ze=x0(Ae&&Ae.map(Be=>Object.assign({},Be,{params:Object.assign({},B,Be.params),pathname:ou([J,D.encodeLocation?D.encodeLocation(Be.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:Be.pathname]),pathnameBase:Be.pathnameBase==="/"?J:ou([J,D.encodeLocation?D.encodeLocation(Be.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:Be.pathnameBase])})),E,w,C,P);return y&&Ze?Qe.createElement(Lp.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...ee},navigationType:"POP"}},Ze):Ze}function g0(){let u=T0(),y=l0(u)?`${u.status} ${u.statusText}`:u instanceof Error?u.message:JSON.stringify(u),w=u instanceof Error?u.stack:null,C="rgba(200,200,200, 0.5)",P={padding:"0.5rem",backgroundColor:C},D={padding:"2px 4px",backgroundColor:C},E=null;return console.error("Error handled by React Router default ErrorBoundary:",u),E=Qe.createElement(Qe.Fragment,null,Qe.createElement("p",null," Hey developer "),Qe.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Qe.createElement("code",{style:D},"ErrorBoundary")," or"," ",Qe.createElement("code",{style:D},"errorElement")," prop on your route.")),Qe.createElement(Qe.Fragment,null,Qe.createElement("h2",null,"Unexpected Application Error!"),Qe.createElement("h3",{style:{fontStyle:"italic"}},y),w?Qe.createElement("pre",{style:P},w):null,E)}var _0=Qe.createElement(g0,null),y0=class extends Qe.Component{constructor(u){super(u),this.state={location:u.location,revalidation:u.revalidation,error:u.error}}static getDerivedStateFromError(u){return{error:u}}static getDerivedStateFromProps(u,y){return y.location!==u.location||y.revalidation!=="idle"&&u.revalidation==="idle"?{error:u.error,location:u.location,revalidation:u.revalidation}:{error:u.error!==void 0?u.error:y.error,location:y.location,revalidation:u.revalidation||y.revalidation}}componentDidCatch(u,y){this.props.unstable_onError?this.props.unstable_onError(u,y):console.error("React Router caught the following error during render",u)}render(){return this.state.error!==void 0?Qe.createElement(cu.Provider,{value:this.props.routeContext},Qe.createElement(Ng.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function v0({routeContext:u,match:y,children:w}){let C=Qe.useContext(gf);return C&&C.static&&C.staticContext&&(y.route.errorElement||y.route.ErrorBoundary)&&(C.staticContext._deepestRenderedBoundaryId=y.route.id),Qe.createElement(cu.Provider,{value:u},w)}function x0(u,y=[],w=null,C=null,P=null){if(u==null){if(!w)return null;if(w.errors)u=w.matches;else if(y.length===0&&!w.initialized&&w.matches.length>0)u=w.matches;else return null}let D=u,E=w?.errors;if(E!=null){let j=D.findIndex(J=>J.route.id&&E?.[J.route.id]!==void 0);un(j>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(E).join(",")}`),D=D.slice(0,Math.min(D.length,j+1))}let o=!1,B=-1;if(w)for(let j=0;j<D.length;j++){let J=D[j];if((J.route.HydrateFallback||J.route.hydrateFallbackElement)&&(B=j),J.route.id){let{loaderData:K,errors:W}=w,ee=J.route.loader&&!K.hasOwnProperty(J.route.id)&&(!W||W[J.route.id]===void 0);if(J.route.lazy||ee){o=!0,B>=0?D=D.slice(0,B+1):D=[D[0]];break}}}return D.reduceRight((j,J,K)=>{let W,ee=!1,we=null,Oe=null;w&&(W=E&&J.route.id?E[J.route.id]:void 0,we=J.route.errorElement||_0,o&&(B<0&&K===0?(Q_("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),ee=!0,Oe=null):B===K&&(ee=!0,Oe=J.route.hydrateFallbackElement||null)));let Ae=y.concat(D.slice(0,K+1)),Ze=()=>{let Be;return W?Be=we:ee?Be=Oe:J.route.Component?Be=Qe.createElement(J.route.Component,null):J.route.element?Be=J.route.element:Be=j,Qe.createElement(v0,{match:J,routeContext:{outlet:j,matches:Ae,isDataRoute:w!=null},children:Be})};return w&&(J.route.ErrorBoundary||J.route.errorElement||K===0)?Qe.createElement(y0,{location:w.location,revalidation:w.revalidation,component:we,error:W,children:Ze(),routeContext:{outlet:null,matches:Ae,isDataRoute:!0},unstable_onError:C}):Ze()},null)}function jg(u){return`${u} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function b0(u){let y=Qe.useContext(gf);return un(y,jg(u)),y}function w0(u){let y=Qe.useContext(Wm);return un(y,jg(u)),y}function S0(u){let y=Qe.useContext(cu);return un(y,jg(u)),y}function Fg(u){let y=S0(u),w=y.matches[y.matches.length-1];return un(w.route.id,`${u} can only be used on routes that contain a unique "id"`),w.route.id}function M0(){return Fg("useRouteId")}function T0(){let u=Qe.useContext(Ng),y=w0("useRouteError"),w=Fg("useRouteError");return u!==void 0?u:y.errors?.[w]}function E0(){let{router:u}=b0("useNavigate"),y=Fg("useNavigate"),w=Qe.useRef(!1);return Y_(()=>{w.current=!0}),Qe.useCallback(async(P,D={})=>{uc(w.current,X_),w.current&&(typeof P=="number"?u.navigate(P):await u.navigate(P,{fromRouteId:y,...D}))},[u,y])}var p_={};function Q_(u,y,w){!y&&!p_[u]&&(p_[u]=!0,uc(!1,w))}Qe.memo(C0);function C0({routes:u,future:y,state:w,unstable_onError:C}){return W_(u,void 0,w,C,y)}function km(u){un(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function A0({basename:u="/",children:y=null,location:w,navigationType:C="POP",navigator:P,static:D=!1}){un(!Op(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let E=u.replace(/^\/*/,"/"),o=Qe.useMemo(()=>({basename:E,navigator:P,static:D,future:{}}),[E,P,D]);typeof w=="string"&&(w=mf(w));let{pathname:B="/",search:j="",hash:J="",state:K=null,key:W="default"}=w,ee=Qe.useMemo(()=>{let we=lu(B,E);return we==null?null:{location:{pathname:we,search:j,hash:J,state:K,key:W},navigationType:C}},[E,B,j,J,K,W,C]);return uc(ee!=null,`<Router basename="${E}"> is not able to match the URL "${B}${j}${J}" because it does not start with the basename, so the <Router> won't render anything.`),ee==null?null:Qe.createElement(dc.Provider,{value:o},Qe.createElement(Lp.Provider,{children:y,value:ee}))}function P0({children:u,location:y}){return m0(Ag(u),y)}function Ag(u,y=[]){let w=[];return Qe.Children.forEach(u,(C,P)=>{if(!Qe.isValidElement(C))return;let D=[...y,P];if(C.type===Qe.Fragment){w.push.apply(w,Ag(C.props.children,D));return}un(C.type===km,`[${typeof C.type=="string"?C.type:C.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),un(!C.props.index||!C.props.children,"An index route cannot have child routes.");let E={id:C.props.id||D.join("-"),caseSensitive:C.props.caseSensitive,element:C.props.element,Component:C.props.Component,index:C.props.index,path:C.props.path,middleware:C.props.middleware,loader:C.props.loader,action:C.props.action,hydrateFallbackElement:C.props.hydrateFallbackElement,HydrateFallback:C.props.HydrateFallback,errorElement:C.props.errorElement,ErrorBoundary:C.props.ErrorBoundary,hasErrorBoundary:C.props.hasErrorBoundary===!0||C.props.ErrorBoundary!=null||C.props.errorElement!=null,shouldRevalidate:C.props.shouldRevalidate,handle:C.props.handle,lazy:C.props.lazy};C.props.children&&(E.children=Ag(C.props.children,D)),w.push(E)}),w}var Lm="get",Om="application/x-www-form-urlencoded";function Qm(u){return u!=null&&typeof u.tagName=="string"}function z0(u){return Qm(u)&&u.tagName.toLowerCase()==="button"}function I0(u){return Qm(u)&&u.tagName.toLowerCase()==="form"}function R0(u){return Qm(u)&&u.tagName.toLowerCase()==="input"}function D0(u){return!!(u.metaKey||u.altKey||u.ctrlKey||u.shiftKey)}function k0(u,y){return u.button===0&&(!y||y==="_self")&&!D0(u)}var zm=null;function L0(){if(zm===null)try{new FormData(document.createElement("form"),0),zm=!1}catch{zm=!0}return zm}var O0=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function wg(u){return u!=null&&!O0.has(u)?(uc(!1,`"${u}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Om}"`),null):u}function B0(u,y){let w,C,P,D,E;if(I0(u)){let o=u.getAttribute("action");C=o?lu(o,y):null,w=u.getAttribute("method")||Lm,P=wg(u.getAttribute("enctype"))||Om,D=new FormData(u)}else if(z0(u)||R0(u)&&(u.type==="submit"||u.type==="image")){let o=u.form;if(o==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let B=u.getAttribute("formaction")||o.getAttribute("action");if(C=B?lu(B,y):null,w=u.getAttribute("formmethod")||o.getAttribute("method")||Lm,P=wg(u.getAttribute("formenctype"))||wg(o.getAttribute("enctype"))||Om,D=new FormData(o,u),!L0()){let{name:j,type:J,value:K}=u;if(J==="image"){let W=j?`${j}.`:"";D.append(`${W}x`,"0"),D.append(`${W}y`,"0")}else j&&D.append(j,K)}}else{if(Qm(u))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');w=Lm,C=null,P=Om,E=u}return D&&P==="text/plain"&&(E=D,D=void 0),{action:C,method:w.toLowerCase(),encType:P,formData:D,body:E}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Gg(u,y){if(u===!1||u===null||typeof u>"u")throw new Error(y)}function N0(u,y,w){let C=typeof u=="string"?new URL(u,typeof window>"u"?"server://singlefetch/":window.location.origin):u;return C.pathname==="/"?C.pathname=`_root.${w}`:y&&lu(C.pathname,y)==="/"?C.pathname=`${y.replace(/\/$/,"")}/_root.${w}`:C.pathname=`${C.pathname.replace(/\/$/,"")}.${w}`,C}async function j0(u,y){if(u.id in y)return y[u.id];try{let w=await import(u.module);return y[u.id]=w,w}catch(w){return console.error(`Error loading route module \`${u.module}\`, reloading page...`),console.error(w),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function F0(u){return u==null?!1:u.href==null?u.rel==="preload"&&typeof u.imageSrcSet=="string"&&typeof u.imageSizes=="string":typeof u.rel=="string"&&typeof u.href=="string"}async function G0(u,y,w){let C=await Promise.all(u.map(async P=>{let D=y.routes[P.route.id];if(D){let E=await j0(D,w);return E.links?E.links():[]}return[]}));return Z0(C.flat(1).filter(F0).filter(P=>P.rel==="stylesheet"||P.rel==="preload").map(P=>P.rel==="stylesheet"?{...P,rel:"prefetch",as:"style"}:{...P,rel:"prefetch"}))}function m_(u,y,w,C,P,D){let E=(B,j)=>w[j]?B.route.id!==w[j].route.id:!0,o=(B,j)=>w[j].pathname!==B.pathname||w[j].route.path?.endsWith("*")&&w[j].params["*"]!==B.params["*"];return D==="assets"?y.filter((B,j)=>E(B,j)||o(B,j)):D==="data"?y.filter((B,j)=>{let J=C.routes[B.route.id];if(!J||!J.hasLoader)return!1;if(E(B,j)||o(B,j))return!0;if(B.route.shouldRevalidate){let K=B.route.shouldRevalidate({currentUrl:new URL(P.pathname+P.search+P.hash,window.origin),currentParams:w[0]?.params||{},nextUrl:new URL(u,window.origin),nextParams:B.params,defaultShouldRevalidate:!0});if(typeof K=="boolean")return K}return!0}):[]}function U0(u,y,{includeHydrateFallback:w}={}){return V0(u.map(C=>{let P=y.routes[C.route.id];if(!P)return[];let D=[P.module];return P.clientActionModule&&(D=D.concat(P.clientActionModule)),P.clientLoaderModule&&(D=D.concat(P.clientLoaderModule)),w&&P.hydrateFallbackModule&&(D=D.concat(P.hydrateFallbackModule)),P.imports&&(D=D.concat(P.imports)),D}).flat(1))}function V0(u){return[...new Set(u)]}function q0(u){let y={},w=Object.keys(u).sort();for(let C of w)y[C]=u[C];return y}function Z0(u,y){let w=new Set;return new Set(y),u.reduce((C,P)=>{let D=JSON.stringify(q0(P));return w.has(D)||(w.add(D),C.push({key:D,link:P})),C},[])}function K_(){let u=Qe.useContext(gf);return Gg(u,"You must render this element inside a <DataRouterContext.Provider> element"),u}function $0(){let u=Qe.useContext(Wm);return Gg(u,"You must render this element inside a <DataRouterStateContext.Provider> element"),u}var Ug=Qe.createContext(void 0);Ug.displayName="FrameworkContext";function J_(){let u=Qe.useContext(Ug);return Gg(u,"You must render this element inside a <HydratedRouter> element"),u}function H0(u,y){let w=Qe.useContext(Ug),[C,P]=Qe.useState(!1),[D,E]=Qe.useState(!1),{onFocus:o,onBlur:B,onMouseEnter:j,onMouseLeave:J,onTouchStart:K}=y,W=Qe.useRef(null);Qe.useEffect(()=>{if(u==="render"&&E(!0),u==="viewport"){let Oe=Ze=>{Ze.forEach(Be=>{E(Be.isIntersecting)})},Ae=new IntersectionObserver(Oe,{threshold:.5});return W.current&&Ae.observe(W.current),()=>{Ae.disconnect()}}},[u]),Qe.useEffect(()=>{if(C){let Oe=setTimeout(()=>{E(!0)},100);return()=>{clearTimeout(Oe)}}},[C]);let ee=()=>{P(!0)},we=()=>{P(!1),E(!1)};return w?u!=="intent"?[D,W,{}]:[D,W,{onFocus:xp(o,ee),onBlur:xp(B,we),onMouseEnter:xp(j,ee),onMouseLeave:xp(J,we),onTouchStart:xp(K,ee)}]:[!1,W,{}]}function xp(u,y){return w=>{u&&u(w),w.defaultPrevented||y(w)}}function X0({page:u,...y}){let{router:w}=K_(),C=Qe.useMemo(()=>G_(w.routes,u,w.basename),[w.routes,u,w.basename]);return C?Qe.createElement(W0,{page:u,matches:C,...y}):null}function Y0(u){let{manifest:y,routeModules:w}=J_(),[C,P]=Qe.useState([]);return Qe.useEffect(()=>{let D=!1;return G0(u,y,w).then(E=>{D||P(E)}),()=>{D=!0}},[u,y,w]),C}function W0({page:u,matches:y,...w}){let C=cd(),{manifest:P,routeModules:D}=J_(),{basename:E}=K_(),{loaderData:o,matches:B}=$0(),j=Qe.useMemo(()=>m_(u,y,B,P,C,"data"),[u,y,B,P,C]),J=Qe.useMemo(()=>m_(u,y,B,P,C,"assets"),[u,y,B,P,C]),K=Qe.useMemo(()=>{if(u===C.pathname+C.search+C.hash)return[];let we=new Set,Oe=!1;if(y.forEach(Ze=>{let Be=P.routes[Ze.route.id];!Be||!Be.hasLoader||(!j.some(Ke=>Ke.route.id===Ze.route.id)&&Ze.route.id in o&&D[Ze.route.id]?.shouldRevalidate||Be.hasClientLoader?Oe=!0:we.add(Ze.route.id))}),we.size===0)return[];let Ae=N0(u,E,"data");return Oe&&we.size>0&&Ae.searchParams.set("_routes",y.filter(Ze=>we.has(Ze.route.id)).map(Ze=>Ze.route.id).join(",")),[Ae.pathname+Ae.search]},[E,o,C,P,j,y,u,D]),W=Qe.useMemo(()=>U0(J,P),[J,P]),ee=Y0(J);return Qe.createElement(Qe.Fragment,null,K.map(we=>Qe.createElement("link",{key:we,rel:"prefetch",as:"fetch",href:we,...w})),W.map(we=>Qe.createElement("link",{key:we,rel:"modulepreload",href:we,...w})),ee.map(({key:we,link:Oe})=>Qe.createElement("link",{key:we,nonce:w.nonce,...Oe})))}function Q0(...u){return y=>{u.forEach(w=>{typeof w=="function"?w(y):w!=null&&(w.current=y)})}}var ey=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{ey&&(window.__reactRouterVersion="7.9.4")}catch{}function K0({basename:u,children:y,window:w}){let C=Qe.useRef();C.current==null&&(C.current=jy({window:w,v5Compat:!0}));let P=C.current,[D,E]=Qe.useState({action:P.action,location:P.location}),o=Qe.useCallback(B=>{Qe.startTransition(()=>E(B))},[E]);return Qe.useLayoutEffect(()=>P.listen(o),[P,o]),Qe.createElement(A0,{basename:u,children:y,location:D.location,navigationType:D.action,navigator:P})}var ty=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Vg=Qe.forwardRef(function({onClick:y,discover:w="render",prefetch:C="none",relative:P,reloadDocument:D,replace:E,state:o,target:B,to:j,preventScrollReset:J,viewTransition:K,...W},ee){let{basename:we}=Qe.useContext(dc),Oe=typeof j=="string"&&ty.test(j),Ae,Ze=!1;if(typeof j=="string"&&Oe&&(Ae=j,ey))try{let Se=new URL(window.location.href),Ye=j.startsWith("//")?new URL(Se.protocol+j):new URL(j),mt=lu(Ye.pathname,we);Ye.origin===Se.origin&&mt!=null?j=mt+Ye.search+Ye.hash:Ze=!0}catch{uc(!1,`<Link to="${j}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let Be=d0(j,{relative:P}),[Ke,vt,Et]=H0(C,W),xt=iv(j,{replace:E,state:o,target:B,preventScrollReset:J,relative:P,viewTransition:K});function lt(Se){y&&y(Se),Se.defaultPrevented||xt(Se)}let xe=Qe.createElement("a",{...W,...Et,href:Ae||Be,onClick:Ze||D?y:lt,ref:Q0(ee,vt),target:B,"data-discover":!Oe&&w==="render"?"true":void 0});return Ke&&!Oe?Qe.createElement(Qe.Fragment,null,xe,Qe.createElement(X0,{page:Be})):xe});Vg.displayName="Link";var J0=Qe.forwardRef(function({"aria-current":y="page",caseSensitive:w=!1,className:C="",end:P=!1,style:D,to:E,viewTransition:o,children:B,...j},J){let K=Bp(E,{relative:j.relative}),W=cd(),ee=Qe.useContext(Wm),{navigator:we,basename:Oe}=Qe.useContext(dc),Ae=ee!=null&&ov(K)&&o===!0,Ze=we.encodeLocation?we.encodeLocation(K).pathname:K.pathname,Be=W.pathname,Ke=ee&&ee.navigation&&ee.navigation.location?ee.navigation.location.pathname:null;w||(Be=Be.toLowerCase(),Ke=Ke?Ke.toLowerCase():null,Ze=Ze.toLowerCase()),Ke&&Oe&&(Ke=lu(Ke,Oe)||Ke);const vt=Ze!=="/"&&Ze.endsWith("/")?Ze.length-1:Ze.length;let Et=Be===Ze||!P&&Be.startsWith(Ze)&&Be.charAt(vt)==="/",xt=Ke!=null&&(Ke===Ze||!P&&Ke.startsWith(Ze)&&Ke.charAt(Ze.length)==="/"),lt={isActive:Et,isPending:xt,isTransitioning:Ae},xe=Et?y:void 0,Se;typeof C=="function"?Se=C(lt):Se=[C,Et?"active":null,xt?"pending":null,Ae?"transitioning":null].filter(Boolean).join(" ");let Ye=typeof D=="function"?D(lt):D;return Qe.createElement(Vg,{...j,"aria-current":xe,className:Se,ref:J,style:Ye,to:E,viewTransition:o},typeof B=="function"?B(lt):B)});J0.displayName="NavLink";var ev=Qe.forwardRef(({discover:u="render",fetcherKey:y,navigate:w,reloadDocument:C,replace:P,state:D,method:E=Lm,action:o,onSubmit:B,relative:j,preventScrollReset:J,viewTransition:K,...W},ee)=>{let we=rv(),Oe=sv(o,{relative:j}),Ae=E.toLowerCase()==="get"?"get":"post",Ze=typeof o=="string"&&ty.test(o),Be=Ke=>{if(B&&B(Ke),Ke.defaultPrevented)return;Ke.preventDefault();let vt=Ke.nativeEvent.submitter,Et=vt?.getAttribute("formmethod")||E;we(vt||Ke.currentTarget,{fetcherKey:y,method:Et,navigate:w,replace:P,state:D,relative:j,preventScrollReset:J,viewTransition:K})};return Qe.createElement("form",{ref:ee,method:Ae,action:Oe,onSubmit:C?B:Be,...W,"data-discover":!Ze&&u==="render"?"true":void 0})});ev.displayName="Form";function tv(u){return`${u} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function iy(u){let y=Qe.useContext(gf);return un(y,tv(u)),y}function iv(u,{target:y,replace:w,state:C,preventScrollReset:P,relative:D,viewTransition:E}={}){let o=f0(),B=cd(),j=Bp(u,{relative:D});return Qe.useCallback(J=>{if(k0(J,y)){J.preventDefault();let K=w!==void 0?w:zp(B)===zp(j);o(u,{replace:K,state:C,preventScrollReset:P,relative:D,viewTransition:E})}},[B,o,j,w,C,y,u,P,D,E])}var av=0,nv=()=>`__${String(++av)}__`;function rv(){let{router:u}=iy("useSubmit"),{basename:y}=Qe.useContext(dc),w=M0();return Qe.useCallback(async(C,P={})=>{let{action:D,method:E,encType:o,formData:B,body:j}=B0(C,y);if(P.navigate===!1){let J=P.fetcherKey||nv();await u.fetch(J,w,P.action||D,{preventScrollReset:P.preventScrollReset,formData:B,body:j,formMethod:P.method||E,formEncType:P.encType||o,flushSync:P.flushSync})}else await u.navigate(P.action||D,{preventScrollReset:P.preventScrollReset,formData:B,body:j,formMethod:P.method||E,formEncType:P.encType||o,replace:P.replace,state:P.state,fromRouteId:w,flushSync:P.flushSync,viewTransition:P.viewTransition})},[u,y,w])}function sv(u,{relative:y}={}){let{basename:w}=Qe.useContext(dc),C=Qe.useContext(cu);un(C,"useFormAction must be used inside a RouteContext");let[P]=C.matches.slice(-1),D={...Bp(u||".",{relative:y})},E=cd();if(u==null){D.search=E.search;let o=new URLSearchParams(D.search),B=o.getAll("index");if(B.some(J=>J==="")){o.delete("index"),B.filter(K=>K).forEach(K=>o.append("index",K));let J=o.toString();D.search=J?`?${J}`:""}}return(!u||u===".")&&P.route.index&&(D.search=D.search?D.search.replace(/^\?/,"?index&"):"?index"),w!=="/"&&(D.pathname=D.pathname==="/"?w:ou([w,D.pathname])),zp(D)}function ov(u,{relative:y}={}){let w=Qe.useContext(H_);un(w!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:C}=iy("useViewTransitionState"),P=Bp(u,{relative:y});if(!w.isTransitioning)return!1;let D=lu(w.currentLocation.pathname,C)||w.currentLocation.pathname,E=lu(w.nextLocation.pathname,C)||w.nextLocation.pathname;return Vm(P.pathname,E)!=null||Vm(P.pathname,D)!=null}var Bm={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.9.0/LICENSE.txt
 */var lv=Bm.exports,g_;function cv(){return g_||(g_=1,(function(u,y){(function(w,C){u.exports=C()})(lv,(function(){var w={},C={};function P(E,o,B){if(C[E]=B,E==="index"){var j="var sharedModule = {}; ("+C.shared+")(sharedModule); ("+C.worker+")(sharedModule);",J={};return C.shared(J),C.index(w,J),typeof window<"u"&&w.setWorkerUrl(window.URL.createObjectURL(new Blob([j],{type:"text/javascript"}))),w}}P("shared",["exports"],(function(E){function o(n,t,a,l){return new(a||(a=Promise))((function(d,_){function v(I){try{S(l.next(I))}catch(R){_(R)}}function b(I){try{S(l.throw(I))}catch(R){_(R)}}function S(I){var R;I.done?d(I.value):(R=I.value,R instanceof a?R:new a((function(O){O(R)}))).then(v,b)}S((l=l.apply(n,t||[])).next())}))}function B(n,t){this.x=n,this.y=t}function j(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var J,K;typeof SuppressedError=="function"&&SuppressedError,B.prototype={clone(){return new B(this.x,this.y)},add(n){return this.clone()._add(n)},sub(n){return this.clone()._sub(n)},multByPoint(n){return this.clone()._multByPoint(n)},divByPoint(n){return this.clone()._divByPoint(n)},mult(n){return this.clone()._mult(n)},div(n){return this.clone()._div(n)},rotate(n){return this.clone()._rotate(n)},rotateAround(n,t){return this.clone()._rotateAround(n,t)},matMult(n){return this.clone()._matMult(n)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(n){return this.x===n.x&&this.y===n.y},dist(n){return Math.sqrt(this.distSqr(n))},distSqr(n){const t=n.x-this.x,a=n.y-this.y;return t*t+a*a},angle(){return Math.atan2(this.y,this.x)},angleTo(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith(n){return this.angleWithSep(n.x,n.y)},angleWithSep(n,t){return Math.atan2(this.x*t-this.y*n,this.x*n+this.y*t)},_matMult(n){const t=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=t,this},_add(n){return this.x+=n.x,this.y+=n.y,this},_sub(n){return this.x-=n.x,this.y-=n.y,this},_mult(n){return this.x*=n,this.y*=n,this},_div(n){return this.x/=n,this.y/=n,this},_multByPoint(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint(n){return this.x/=n.x,this.y/=n.y,this},_unit(){return this._div(this.mag()),this},_perp(){const n=this.y;return this.y=this.x,this.x=-n,this},_rotate(n){const t=Math.cos(n),a=Math.sin(n),l=a*this.x+t*this.y;return this.x=t*this.x-a*this.y,this.y=l,this},_rotateAround(n,t){const a=Math.cos(n),l=Math.sin(n),d=t.y+l*(this.x-t.x)+a*(this.y-t.y);return this.x=t.x+a*(this.x-t.x)-l*(this.y-t.y),this.y=d,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:B},B.convert=function(n){if(n instanceof B)return n;if(Array.isArray(n))return new B(+n[0],+n[1]);if(n.x!==void 0&&n.y!==void 0)return new B(+n.x,+n.y);throw new Error("Expected [x, y] or {x, y} point format")};var W=(function(){if(K)return J;function n(t,a,l,d){this.cx=3*t,this.bx=3*(l-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(d-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=a,this.p2x=l,this.p2y=d}return K=1,J=n,n.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,a){if(a===void 0&&(a=1e-6),t<0)return 0;if(t>1)return 1;for(var l=t,d=0;d<8;d++){var _=this.sampleCurveX(l)-t;if(Math.abs(_)<a)return l;var v=this.sampleCurveDerivativeX(l);if(Math.abs(v)<1e-6)break;l-=_/v}var b=0,S=1;for(l=t,d=0;d<20&&(_=this.sampleCurveX(l),!(Math.abs(_-t)<a));d++)t>_?b=l:S=l,l=.5*(S-b)+b;return l},solve:function(t,a){return this.sampleCurveY(this.solveCurveX(t,a))}},J})(),ee=j(W);let we,Oe;function Ae(){return we==null&&(we=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),we}function Ze(){if(Oe==null&&(Oe=!1,Ae())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let l=0;l<25;l++){const d=4*l;t.fillStyle=`rgb(${d},${d+1},${d+2})`,t.fillRect(l%5,Math.floor(l/5),1,1)}const a=t.getImageData(0,0,5,5).data;for(let l=0;l<100;l++)if(l%4!=3&&a[l]!==l){Oe=!0;break}}}return Oe||!1}var Be=1e-6,Ke=typeof Float32Array<"u"?Float32Array:Array;function vt(){var n=new Ke(9);return Ke!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function Et(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function xt(){var n=new Ke(3);return Ke!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function lt(n){var t=n[0],a=n[1],l=n[2];return Math.sqrt(t*t+a*a+l*l)}function xe(n,t,a){var l=new Ke(3);return l[0]=n,l[1]=t,l[2]=a,l}function Se(n,t,a){return n[0]=t[0]+a[0],n[1]=t[1]+a[1],n[2]=t[2]+a[2],n}function Ye(n,t,a){return n[0]=t[0]*a,n[1]=t[1]*a,n[2]=t[2]*a,n}function mt(n,t,a){var l=t[0],d=t[1],_=t[2],v=a[0],b=a[1],S=a[2];return n[0]=d*S-_*b,n[1]=_*v-l*S,n[2]=l*b-d*v,n}var gt,Gt=lt;function Oi(n,t,a){var l=t[0],d=t[1],_=t[2],v=t[3];return n[0]=a[0]*l+a[4]*d+a[8]*_+a[12]*v,n[1]=a[1]*l+a[5]*d+a[9]*_+a[13]*v,n[2]=a[2]*l+a[6]*d+a[10]*_+a[14]*v,n[3]=a[3]*l+a[7]*d+a[11]*_+a[15]*v,n}function Xi(){var n=new Ke(4);return Ke!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function He(n,t,a,l){var d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",_=Math.PI/360;t*=_,l*=_,a*=_;var v=Math.sin(t),b=Math.cos(t),S=Math.sin(a),I=Math.cos(a),R=Math.sin(l),O=Math.cos(l);switch(d){case"xyz":n[0]=v*I*O+b*S*R,n[1]=b*S*O-v*I*R,n[2]=b*I*R+v*S*O,n[3]=b*I*O-v*S*R;break;case"xzy":n[0]=v*I*O-b*S*R,n[1]=b*S*O-v*I*R,n[2]=b*I*R+v*S*O,n[3]=b*I*O+v*S*R;break;case"yxz":n[0]=v*I*O+b*S*R,n[1]=b*S*O-v*I*R,n[2]=b*I*R-v*S*O,n[3]=b*I*O+v*S*R;break;case"yzx":n[0]=v*I*O+b*S*R,n[1]=b*S*O+v*I*R,n[2]=b*I*R-v*S*O,n[3]=b*I*O-v*S*R;break;case"zxy":n[0]=v*I*O-b*S*R,n[1]=b*S*O+v*I*R,n[2]=b*I*R+v*S*O,n[3]=b*I*O-v*S*R;break;case"zyx":n[0]=v*I*O-b*S*R,n[1]=b*S*O+v*I*R,n[2]=b*I*R-v*S*O,n[3]=b*I*O+v*S*R;break;default:throw new Error("Unknown angle order "+d)}return n}function at(){var n=new Ke(2);return Ke!=Float32Array&&(n[0]=0,n[1]=0),n}function At(n,t){var a=new Ke(2);return a[0]=n,a[1]=t,a}xt(),gt=new Ke(4),Ke!=Float32Array&&(gt[0]=0,gt[1]=0,gt[2]=0,gt[3]=0),xt(),xe(1,0,0),xe(0,1,0),Xi(),Xi(),vt(),at();const ft=8192;function Kt(n,t,a){return t*(ft/(n.tileSize*Math.pow(2,a-n.tileID.overscaledZ)))}function pe(n,t){return(n%t+t)%t}function Ue(n,t,a){return n*(1-a)+t*a}function We(n){if(n<=0)return 0;if(n>=1)return 1;const t=n*n,a=t*n;return 4*(n<.5?a:3*(n-t)+a-.75)}function Mt(n,t,a,l){const d=new ee(n,t,a,l);return _=>d.solve(_)}const Lt=Mt(.25,.1,.25,1);function Ot(n,t,a){return Math.min(a,Math.max(t,n))}function ai(n,t,a){const l=a-t,d=((n-t)%l+l)%l+t;return d===t?a:d}function Ut(n,...t){for(const a of t)for(const l in a)n[l]=a[l];return n}let jt=1;function Ni(n,t,a){const l={};for(const d in n)l[d]=t.call(this,n[d],d,n);return l}function ri(n,t,a){const l={};for(const d in n)t.call(this,n[d],d,n)&&(l[d]=n[d]);return l}function mi(n){return Array.isArray(n)?n.map(mi):typeof n=="object"&&n?Ni(n,mi):n}const di={};function Xt(n){di[n]||(typeof console<"u"&&console.warn(n),di[n]=!0)}function fi(n,t,a){return(a.y-n.y)*(t.x-n.x)>(t.y-n.y)*(a.x-n.x)}function Jt(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let wa=null;function Si(n){if(wa==null){const t=n.navigator?n.navigator.userAgent:null;wa=!!n.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return wa}function gi(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const ia="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function qn(n,t,a,l,d){return o(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const _=new VideoFrame(n,{timestamp:0});try{const v=_?.format;if(!v||!v.startsWith("BGR")&&!v.startsWith("RGB"))throw new Error(`Unrecognized format ${v}`);const b=v.startsWith("BGR"),S=new Uint8ClampedArray(l*d*4);if(yield _.copyTo(S,(function(I,R,O,U,V){const Z=4*Math.max(-R,0),Y=(Math.max(0,O)-O)*U*4+Z,ie=4*U,se=Math.max(0,R),Ee=Math.max(0,O);return{rect:{x:se,y:Ee,width:Math.min(I.width,R+U)-se,height:Math.min(I.height,O+V)-Ee},layout:[{offset:Y,stride:ie}]}})(n,t,a,l,d)),b)for(let I=0;I<S.length;I+=4){const R=S[I];S[I]=S[I+2],S[I+2]=R}return S}finally{_.close()}}))}let Ja,An;function Pi(n,t,a,l){return n.addEventListener(t,a,l),{unsubscribe:()=>{n.removeEventListener(t,a,l)}}}function Pn(n){return n*Math.PI/180}function Ui(n){return n/Math.PI*180}const Sa={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},ya={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},ve="AbortError";function H(){return new Error(ve)}const $={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function te(n){return $.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}const ce="global-dispatcher";class fe extends Error{constructor(t,a,l,d){super(`AJAXError: ${a} (${t}): ${l}`),this.status=t,this.statusText=a,this.url=l,this.body=d}}const be=()=>Jt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Ie=function(n,t){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const l=te(n.url);if(l)return l(n,t);if(Jt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:ce},t)}if(!(/^file:/.test(a=n.url)||/^file:/.test(be())&&!/^\w+:/.test(a))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(l,d){return o(this,void 0,void 0,(function*(){const _=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,cache:l.cache,referrer:be(),signal:d.signal});let v,b;l.type!=="json"||_.headers.has("Accept")||_.headers.set("Accept","application/json");try{v=yield fetch(_)}catch(I){throw new fe(0,I.message,l.url,new Blob)}if(!v.ok){const I=yield v.blob();throw new fe(v.status,v.statusText,l.url,I)}b=l.type==="arrayBuffer"||l.type==="image"?v.arrayBuffer():l.type==="json"?v.json():v.text();const S=yield b;if(d.signal.aborted)throw H();return{data:S,cacheControl:v.headers.get("Cache-Control"),expires:v.headers.get("Expires")}}))})(n,t);if(Jt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:ce},t)}var a;return(function(l,d){return new Promise(((_,v)=>{var b;const S=new XMLHttpRequest;S.open(l.method||"GET",l.url,!0),l.type!=="arrayBuffer"&&l.type!=="image"||(S.responseType="arraybuffer");for(const I in l.headers)S.setRequestHeader(I,l.headers[I]);l.type==="json"&&(S.responseType="text",!((b=l.headers)===null||b===void 0)&&b.Accept||S.setRequestHeader("Accept","application/json")),S.withCredentials=l.credentials==="include",S.onerror=()=>{v(new Error(S.statusText))},S.onload=()=>{if(!d.signal.aborted)if((S.status>=200&&S.status<300||S.status===0)&&S.response!==null){let I=S.response;if(l.type==="json")try{I=JSON.parse(S.response)}catch(R){return void v(R)}_({data:I,cacheControl:S.getResponseHeader("Cache-Control"),expires:S.getResponseHeader("Expires")})}else{const I=new Blob([S.response],{type:S.getResponseHeader("Content-Type")});v(new fe(S.status,S.statusText,l.url,I))}},d.signal.addEventListener("abort",(()=>{S.abort(),v(H())})),S.send(l.body)}))})(n,t)};function Ce(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const t=new URL(n),a=window.location;return t.protocol===a.protocol&&t.host===a.host}function $e(n,t,a){a[n]&&a[n].indexOf(t)!==-1||(a[n]=a[n]||[],a[n].push(t))}function ct(n,t,a){if(a&&a[n]){const l=a[n].indexOf(t);l!==-1&&a[n].splice(l,1)}}class Je{constructor(t,a={}){Ut(this,a),this.type=t}}class zt extends Je{constructor(t,a={}){super("error",Ut({error:t},a))}}class Vt{on(t,a){return this._listeners=this._listeners||{},$e(t,a,this._listeners),{unsubscribe:()=>{this.off(t,a)}}}off(t,a){return ct(t,a,this._listeners),ct(t,a,this._oneTimeListeners),this}once(t,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},$e(t,a,this._oneTimeListeners),this):new Promise((l=>this.once(t,l)))}fire(t,a){typeof t=="string"&&(t=new Je(t,a||{}));const l=t.type;if(this.listens(l)){t.target=this;const d=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const b of d)b.call(this,t);const _=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const b of _)ct(l,b,this._oneTimeListeners),b.call(this,t);const v=this._eventedParent;v&&(Ut(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(t))}else t instanceof zt&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,a){return this._eventedParent=t,this._eventedParentData=a,this}}var Pe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"array",value:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const _i=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function zi(n,t){const a={};for(const l in n)l!=="ref"&&(a[l]=n[l]);return _i.forEach((l=>{l in t&&(a[l]=t[l])})),a}function kt(n,t){if(Array.isArray(n)){if(!Array.isArray(t)||n.length!==t.length)return!1;for(let a=0;a<n.length;a++)if(!kt(n[a],t[a]))return!1;return!0}if(typeof n=="object"&&n!==null&&t!==null){if(typeof t!="object"||Object.keys(n).length!==Object.keys(t).length)return!1;for(const a in n)if(!kt(n[a],t[a]))return!1;return!0}return n===t}function Ei(n,t){n.push(t)}function Fa(n,t,a){Ei(a,{command:"addSource",args:[n,t[n]]})}function za(n,t,a){Ei(t,{command:"removeSource",args:[n]}),a[n]=!0}function qa(n,t,a,l){za(n,a,l),Fa(n,t,a)}function hn(n,t,a){let l;for(l in n[a])if(Object.prototype.hasOwnProperty.call(n[a],l)&&l!=="data"&&!kt(n[a][l],t[a][l]))return!1;for(l in t[a])if(Object.prototype.hasOwnProperty.call(t[a],l)&&l!=="data"&&!kt(n[a][l],t[a][l]))return!1;return!0}function Ji(n,t,a,l,d,_){n=n||{},t=t||{};for(const v in n)Object.prototype.hasOwnProperty.call(n,v)&&(kt(n[v],t[v])||a.push({command:_,args:[l,v,t[v],d]}));for(const v in t)Object.prototype.hasOwnProperty.call(t,v)&&!Object.prototype.hasOwnProperty.call(n,v)&&(kt(n[v],t[v])||a.push({command:_,args:[l,v,t[v],d]}))}function Za(n){return n.id}function ji(n,t){return n[t.id]=t,n}class st{constructor(t,a,l,d){this.message=(t?`${t}: `:"")+l,d&&(this.identifier=d),a!=null&&a.__line__&&(this.line=a.__line__)}}function Gr(n,...t){for(const a of t)for(const l in a)n[l]=a[l];return n}class Zn extends Error{constructor(t,a){super(a),this.message=a,this.key=t}}class $a{constructor(t,a=[]){this.parent=t,this.bindings={};for(const[l,d]of a)this.bindings[l]=d}concat(t){return new $a(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Ri={kind:"null"},ut={kind:"number"},si={kind:"string"},li={kind:"boolean"},ar={kind:"color"},os={kind:"projectionDefinition"},Ur={kind:"object"},ni={kind:"value"},no={kind:"collator"},ls={kind:"formatted"},Mr={kind:"padding"},Ps={kind:"colorArray"},$n={kind:"numberArray"},Ma={kind:"resolvedImage"},Ra={kind:"variableAnchorOffsetCollection"};function Hn(n,t){return{kind:"array",itemType:n,N:t}}function Zi(n){if(n.kind==="array"){const t=Zi(n.itemType);return typeof n.N=="number"?`array<${t}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${t}>`}return n.kind}const cs=[Ri,ut,si,li,ar,os,ls,Ur,Hn(ni),Mr,$n,Ps,Ma,Ra];function Cl(n,t){if(t.kind==="error")return null;if(n.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Cl(n.itemType,t.itemType))&&(typeof n.N!="number"||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if(n.kind==="value"){for(const a of cs)if(!Cl(a,t))return null}}return`Expected ${Zi(n)} but found ${Zi(t)} instead.`}function hu(n,t){return t.some((a=>a.kind===n.kind))}function ro(n,t){return t.some((a=>a==="null"?n===null:a==="array"?Array.isArray(n):a==="object"?n&&!Array.isArray(n)&&typeof n=="object":a===typeof n))}function zs(n,t){return n.kind==="array"&&t.kind==="array"?n.itemType.kind===t.itemType.kind&&typeof n.N=="number":n.kind===t.kind}const fc=.96422,Al=.82521,us=4/29,bn=6/29,ah=3*bn*bn,yf=bn*bn*bn,nh=Math.PI/180,ud=180/Math.PI;function pc(n){return(n%=360)<0&&(n+=360),n}function rh([n,t,a,l]){let d,_;const v=mc((.2225045*(n=dn(n))+.7168786*(t=dn(t))+.0606169*(a=dn(a)))/1);n===t&&t===a?d=_=v:(d=mc((.4360747*n+.3850649*t+.1430804*a)/fc),_=mc((.0139322*n+.0971045*t+.7141733*a)/Al));const b=116*v-16;return[b<0?0:b,500*(d-v),200*(v-_),l]}function dn(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function mc(n){return n>yf?Math.pow(n,1/3):n/ah+us}function sh([n,t,a,l]){let d=(n+16)/116,_=isNaN(t)?d:d+t/500,v=isNaN(a)?d:d-a/200;return d=1*so(d),_=fc*so(_),v=Al*so(v),[Is(3.1338561*_-1.6168667*d-.4906146*v),Is(-.9787684*_+1.9161415*d+.033454*v),Is(.0719453*_-.2289914*d+1.4052427*v),l]}function Is(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function so(n){return n>bn?n*n*n:ah*(n-us)}const hd=Object.hasOwn||function(n,t){return Object.prototype.hasOwnProperty.call(n,t)};function Pl(n,t){return hd(n,t)?n[t]:void 0}function hs(n){return parseInt(n.padEnd(2,n),16)/255}function oh(n,t){return zn(t?n/100:n,0,1)}function zn(n,t,a){return Math.min(Math.max(t,n),a)}function Mi(n){return!n.some(Number.isNaN)}const oo={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Bn(n,t,a){return n+a*(t-n)}function Uo(n,t,a){return n.map(((l,d)=>Bn(l,t[d],a)))}class hi{constructor(t,a,l,d=1,_=!0){this.r=t,this.g=a,this.b=l,this.a=d,_||(this.r*=d,this.g*=d,this.b*=d,d||this.overwriteGetter("rgb",[t,a,l,d]))}static parse(t){if(t instanceof hi)return t;if(typeof t!="string")return;const a=(function(l){if((l=l.toLowerCase().trim())==="transparent")return[0,0,0,0];const d=Pl(oo,l);if(d){const[v,b,S]=d;return[v/255,b/255,S/255,1]}if(l.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(l)){const v=l.length<6?1:2;let b=1;return[hs(l.slice(b,b+=v)),hs(l.slice(b,b+=v)),hs(l.slice(b,b+=v)),hs(l.slice(b,b+v)||"ff")]}if(l.startsWith("rgb")){const v=l.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[b,S,I,R,O,U,V,Z,Y,ie,se,Ee]=v,de=[R||" ",V||" ",ie].join("");if(de==="  "||de==="  /"||de===",,"||de===",,,"){const ge=[I,U,Y].join(""),ke=ge==="%%%"?100:ge===""?255:0;if(ke){const Ve=[zn(+S/ke,0,1),zn(+O/ke,0,1),zn(+Z/ke,0,1),se?oh(+se,Ee):1];if(Mi(Ve))return Ve}}return}}const _=l.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[v,b,S,I,R,O,U,V,Z]=_,Y=[S||" ",R||" ",U].join("");if(Y==="  "||Y==="  /"||Y===",,"||Y===",,,"){const ie=[+b,zn(+I,0,100),zn(+O,0,100),V?oh(+V,Z):1];if(Mi(ie))return(function([se,Ee,de,ge]){function ke(Ve){const rt=(Ve+se/30)%12,St=Ee*Math.min(de,1-de);return de-St*Math.max(-1,Math.min(rt-3,9-rt,1))}return se=pc(se),Ee/=100,de/=100,[ke(0),ke(8),ke(4),ge]})(ie)}}})(t);return a?new hi(...a,!1):void 0}get rgb(){const{r:t,g:a,b:l,a:d}=this,_=d||1/0;return this.overwriteGetter("rgb",[t/_,a/_,l/_,d])}get hcl(){return this.overwriteGetter("hcl",(function(t){const[a,l,d,_]=rh(t),v=Math.sqrt(l*l+d*d);return[Math.round(1e4*v)?pc(Math.atan2(d,l)*ud):NaN,v,a,_]})(this.rgb))}get lab(){return this.overwriteGetter("lab",rh(this.rgb))}overwriteGetter(t,a){return Object.defineProperty(this,t,{value:a}),a}toString(){const[t,a,l,d]=this.rgb;return`rgba(${[t,a,l].map((_=>Math.round(255*_))).join(",")},${d})`}static interpolate(t,a,l,d="rgb"){switch(d){case"rgb":{const[_,v,b,S]=Uo(t.rgb,a.rgb,l);return new hi(_,v,b,S,!1)}case"hcl":{const[_,v,b,S]=t.hcl,[I,R,O,U]=a.hcl;let V,Z;if(isNaN(_)||isNaN(I))isNaN(_)?isNaN(I)?V=NaN:(V=I,b!==1&&b!==0||(Z=R)):(V=_,O!==1&&O!==0||(Z=v));else{let de=I-_;I>_&&de>180?de-=360:I<_&&_-I>180&&(de+=360),V=_+l*de}const[Y,ie,se,Ee]=(function([de,ge,ke,Ve]){return de=isNaN(de)?0:de*nh,sh([ke,Math.cos(de)*ge,Math.sin(de)*ge,Ve])})([V,Z??Bn(v,R,l),Bn(b,O,l),Bn(S,U,l)]);return new hi(Y,ie,se,Ee,!1)}case"lab":{const[_,v,b,S]=sh(Uo(t.lab,a.lab,l));return new hi(_,v,b,S,!1)}}}}hi.black=new hi(0,0,0,1),hi.white=new hi(1,1,1,1),hi.transparent=new hi(0,0,0,0),hi.red=new hi(1,0,0,1);class nr{constructor(t,a,l){this.sensitivity=t?a?"variant":"case":a?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,a){return this.collator.compare(t,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Vo=["bottom","center","top"];class lo{constructor(t,a,l,d,_,v){this.text=t,this.image=a,this.scale=l,this.fontStack=d,this.textColor=_,this.verticalAlign=v}}class en{constructor(t){this.sections=t}static fromString(t){return new en([new lo(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((t=>t.text.length!==0||t.image&&t.image.name.length!==0))}static factory(t){return t instanceof en?t:en.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map((t=>t.text)).join("")}}class Da{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Da)return t;if(typeof t=="number")return new Da([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const a of t)if(typeof a!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Da(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,a,l){return new Da(Uo(t.values,a.values,l))}}class tn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof tn)return t;if(typeof t=="number")return new tn([t]);if(Array.isArray(t)){for(const a of t)if(typeof a!="number")return;return new tn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,a,l){return new tn(Uo(t.values,a.values,l))}}class an{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof an)return t;if(typeof t=="string"){const l=hi.parse(t);return l?new an([l]):void 0}if(!Array.isArray(t))return;const a=[];for(const l of t){if(typeof l!="string")return;const d=hi.parse(l);if(!d)return;a.push(d)}return new an(a)}toString(){return JSON.stringify(this.values)}static interpolate(t,a,l,d="rgb"){const _=[];if(t.values.length!=a.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${a.values.length}), cannot interpolate.`);for(let v=0;v<t.values.length;v++)_.push(hi.interpolate(t.values[v],a.values[v],l,d));return new an(_)}}class sa extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}const ds=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ia{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Ia)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let a=0;a<t.length;a+=2){const l=t[a],d=t[a+1];if(typeof l!="string"||!ds.has(l)||!Array.isArray(d)||d.length!==2||typeof d[0]!="number"||typeof d[1]!="number")return}return new Ia(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,a,l){const d=t.values,_=a.values;if(d.length!==_.length)throw new sa(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${a.toString()}`);const v=[];for(let b=0;b<d.length;b+=2){if(d[b]!==_[b])throw new sa(`Cannot interpolate values containing mismatched anchors. from[${b}]: ${d[b]}, to[${b}]: ${_[b]}`);v.push(d[b]);const[S,I]=d[b+1],[R,O]=_[b+1];v.push([Bn(S,R,l),Bn(I,O,l)])}return new Ia(v)}}class Nn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Nn({name:t,available:!1}):null}}class fn{constructor(t,a,l){this.from=t,this.to=a,this.transition=l}static interpolate(t,a,l){return new fn(t,a,l)}static parse(t){return t instanceof fn?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new fn(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new fn(t.from,t.to,t.transition):typeof t=="string"?new fn(t,t,1):void 0}}function Tr(n,t,a,l){return typeof n=="number"&&n>=0&&n<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof a=="number"&&a>=0&&a<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[n,t,a,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[n,t,a,l]:[n,t,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function $i(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof fn||n instanceof hi||n instanceof nr||n instanceof en||n instanceof Da||n instanceof tn||n instanceof an||n instanceof Ia||n instanceof Nn)return!0;if(Array.isArray(n)){for(const t of n)if(!$i(t))return!1;return!0}if(typeof n=="object"){for(const t in n)if(!$i(n[t]))return!1;return!0}return!1}function da(n){if(n===null)return Ri;if(typeof n=="string")return si;if(typeof n=="boolean")return li;if(typeof n=="number")return ut;if(n instanceof hi)return ar;if(n instanceof fn)return os;if(n instanceof nr)return no;if(n instanceof en)return ls;if(n instanceof Da)return Mr;if(n instanceof tn)return $n;if(n instanceof an)return Ps;if(n instanceof Ia)return Ra;if(n instanceof Nn)return Ma;if(Array.isArray(n)){const t=n.length;let a;for(const l of n){const d=da(l);if(a){if(a===d)continue;a=ni;break}a=d}return Hn(a||ni,t)}return Ur}function yi(n){const t=typeof n;return n===null?"":t==="string"||t==="number"||t==="boolean"?String(n):n instanceof hi||n instanceof fn||n instanceof en||n instanceof Da||n instanceof tn||n instanceof an||n instanceof Ia||n instanceof Nn?n.toString():JSON.stringify(n)}class Yt{constructor(t,a){this.type=t,this.value=a}static parse(t,a){if(t.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!$i(t[1]))return a.error("invalid value");const l=t[1];let d=da(l);const _=a.expectedType;return d.kind!=="array"||d.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(d=_),new Yt(d,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Rs={string:si,number:ut,boolean:li,object:Ur};class ci{constructor(t,a){this.type=t,this.args=a}static parse(t,a){if(t.length<2)return a.error("Expected at least one argument.");let l,d=1;const _=t[0];if(_==="array"){let b,S;if(t.length>2){const I=t[1];if(typeof I!="string"||!(I in Rs)||I==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);b=Rs[I],d++}else b=ni;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return a.error('The length argument to "array" must be a positive integer literal',2);S=t[2],d++}l=Hn(b,S)}else{if(!Rs[_])throw new Error(`Types doesn't contain name = ${_}`);l=Rs[_]}const v=[];for(;d<t.length;d++){const b=a.parse(t[d],d,ni);if(!b)return null;v.push(b)}return new ci(l,v)}evaluate(t){for(let a=0;a<this.args.length;a++){const l=this.args[a].evaluate(t);if(!Cl(this.type,da(l)))return l;if(a===this.args.length-1)throw new sa(`Expected value to be of type ${Zi(this.type)}, but found ${Zi(da(l))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const wn={"to-boolean":li,"to-color":ar,"to-number":ut,"to-string":si};class ka{constructor(t,a){this.type=t,this.args=a}static parse(t,a){if(t.length<2)return a.error("Expected at least one argument.");const l=t[0];if(!wn[l])throw new Error(`Can't parse ${l} as it is not part of the known types`);if((l==="to-boolean"||l==="to-string")&&t.length!==2)return a.error("Expected one argument.");const d=wn[l],_=[];for(let v=1;v<t.length;v++){const b=a.parse(t[v],v,ni);if(!b)return null;_.push(b)}return new ka(d,_)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let a,l;for(const d of this.args){if(a=d.evaluate(t),l=null,a instanceof hi)return a;if(typeof a=="string"){const _=t.parseColor(a);if(_)return _}else if(Array.isArray(a)&&(l=a.length<3||a.length>4?`Invalid rgba value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:Tr(a[0],a[1],a[2],a[3]),!l))return new hi(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new sa(l||`Could not parse color from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"padding":{let a;for(const l of this.args){a=l.evaluate(t);const d=Da.parse(a);if(d)return d}throw new sa(`Could not parse padding from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"numberArray":{let a;for(const l of this.args){a=l.evaluate(t);const d=tn.parse(a);if(d)return d}throw new sa(`Could not parse numberArray from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"colorArray":{let a;for(const l of this.args){a=l.evaluate(t);const d=an.parse(a);if(d)return d}throw new sa(`Could not parse colorArray from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"variableAnchorOffsetCollection":{let a;for(const l of this.args){a=l.evaluate(t);const d=Ia.parse(a);if(d)return d}throw new sa(`Could not parse variableAnchorOffsetCollection from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"number":{let a=null;for(const l of this.args){if(a=l.evaluate(t),a===null)return 0;const d=Number(a);if(!isNaN(d))return d}throw new sa(`Could not convert ${JSON.stringify(a)} to number.`)}case"formatted":return en.fromString(yi(this.args[0].evaluate(t)));case"resolvedImage":return Nn.fromString(yi(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return yi(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const zl=["Unknown","Point","LineString","Polygon"];class Ds{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?zl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let a=this._parseColorCache.get(t);return a||(a=hi.parse(t),this._parseColorCache.set(t,a)),a}}class gc{constructor(t,a,l=[],d,_=new $a,v=[]){this.registry=t,this.path=l,this.key=l.map((b=>`[${b}]`)).join(""),this.scope=_,this.errors=v,this.expectedType=d,this._isConstant=a}parse(t,a,l,d,_={}){return a?this.concat(a,l,d)._parse(t,_):this._parse(t,_)}_parse(t,a){function l(d,_,v){return v==="assert"?new ci(_,[d]):v==="coerce"?new ka(_,[d]):d}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=t[0];if(typeof d!="string")return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const _=this.registry[d];if(_){let v=_.parse(t,this);if(!v)return null;if(this.expectedType){const b=this.expectedType,S=v.type;if(b.kind!=="string"&&b.kind!=="number"&&b.kind!=="boolean"&&b.kind!=="object"&&b.kind!=="array"||S.kind!=="value"){if(b.kind==="projectionDefinition"&&["string","array"].includes(S.kind)||["color","formatted","resolvedImage"].includes(b.kind)&&["value","string"].includes(S.kind)||["padding","numberArray"].includes(b.kind)&&["value","number","array"].includes(S.kind)||b.kind==="colorArray"&&["value","string","array"].includes(S.kind)||b.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(S.kind))v=l(v,b,a.typeAnnotation||"coerce");else if(this.checkSubtype(b,S))return null}else v=l(v,b,a.typeAnnotation||"assert")}if(!(v instanceof Yt)&&v.type.kind!=="resolvedImage"&&this._isConstant(v)){const b=new Ds;try{v=new Yt(v.type,v.evaluate(b))}catch(S){return this.error(S.message),null}}return v}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,a,l){const d=typeof t=="number"?this.path.concat(t):this.path,_=l?this.scope.concat(l):this.scope;return new gc(this.registry,this._isConstant,d,a||null,_,this.errors)}error(t,...a){const l=`${this.key}${a.map((d=>`[${d}]`)).join("")}`;this.errors.push(new Zn(l,t))}checkSubtype(t,a){const l=Cl(t,a);return l&&this.error(l),l}}class co{constructor(t,a){this.type=a.type,this.bindings=[].concat(t),this.result=a}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const a of this.bindings)t(a[1]);t(this.result)}static parse(t,a){if(t.length<4)return a.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const l=[];for(let _=1;_<t.length-1;_+=2){const v=t[_];if(typeof v!="string")return a.error(`Expected string, but found ${typeof v} instead.`,_);if(/[^a-zA-Z0-9_]/.test(v))return a.error("Variable names must contain only alphanumeric characters or '_'.",_);const b=a.parse(t[_+1],_+1);if(!b)return null;l.push([v,b])}const d=a.parse(t[t.length-1],t.length-1,a.expectedType,l);return d?new co(l,d):null}outputDefined(){return this.result.outputDefined()}}class qo{constructor(t,a){this.type=a.type,this.name=t,this.boundExpression=a}static parse(t,a){if(t.length!==2||typeof t[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");const l=t[1];return a.scope.has(l)?new qo(l,a.scope.get(l)):a.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Zo{constructor(t,a,l){this.type=t,this.index=a,this.input=l}static parse(t,a){if(t.length!==3)return a.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=a.parse(t[1],1,ut),d=a.parse(t[2],2,Hn(a.expectedType||ni));return l&&d?new Zo(d.type.itemType,l,d):null}evaluate(t){const a=this.index.evaluate(t),l=this.input.evaluate(t);if(a<0)throw new sa(`Array index out of bounds: ${a} < 0.`);if(a>=l.length)throw new sa(`Array index out of bounds: ${a} > ${l.length-1}.`);if(a!==Math.floor(a))throw new sa(`Array index must be an integer, but found ${a} instead.`);return l[a]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class $o{constructor(t,a){this.type=li,this.needle=t,this.haystack=a}static parse(t,a){if(t.length!==3)return a.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=a.parse(t[1],1,ni),d=a.parse(t[2],2,ni);return l&&d?hu(l.type,[li,si,ut,Ri,ni])?new $o(l,d):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Zi(l.type)} instead`):null}evaluate(t){const a=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(!l)return!1;if(!ro(a,["boolean","string","number","null"]))throw new sa(`Expected first argument to be of type boolean, string, number or null, but found ${Zi(da(a))} instead.`);if(!ro(l,["string","array"]))throw new sa(`Expected second argument to be of type array or string, but found ${Zi(da(l))} instead.`);return l.indexOf(a)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Il{constructor(t,a,l){this.type=ut,this.needle=t,this.haystack=a,this.fromIndex=l}static parse(t,a){if(t.length<=2||t.length>=5)return a.error(`Expected 2 or 3 arguments, but found ${t.length-1} instead.`);const l=a.parse(t[1],1,ni),d=a.parse(t[2],2,ni);if(!l||!d)return null;if(!hu(l.type,[li,si,ut,Ri,ni]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Zi(l.type)} instead`);if(t.length===4){const _=a.parse(t[3],3,ut);return _?new Il(l,d,_):null}return new Il(l,d)}evaluate(t){const a=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(!ro(a,["boolean","string","number","null"]))throw new sa(`Expected first argument to be of type boolean, string, number or null, but found ${Zi(da(a))} instead.`);let d;if(this.fromIndex&&(d=this.fromIndex.evaluate(t)),ro(l,["string"])){const _=l.indexOf(a,d);return _===-1?-1:[...l.slice(0,_)].length}if(ro(l,["array"]))return l.indexOf(a,d);throw new sa(`Expected second argument to be of type array or string, but found ${Zi(da(l))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class fs{constructor(t,a,l,d,_,v){this.inputType=t,this.type=a,this.input=l,this.cases=d,this.outputs=_,this.otherwise=v}static parse(t,a){if(t.length<5)return a.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return a.error("Expected an even number of arguments.");let l,d;a.expectedType&&a.expectedType.kind!=="value"&&(d=a.expectedType);const _={},v=[];for(let I=2;I<t.length-1;I+=2){let R=t[I];const O=t[I+1];Array.isArray(R)||(R=[R]);const U=a.concat(I);if(R.length===0)return U.error("Expected at least one branch label.");for(const Z of R){if(typeof Z!="number"&&typeof Z!="string")return U.error("Branch labels must be numbers or strings.");if(typeof Z=="number"&&Math.abs(Z)>Number.MAX_SAFE_INTEGER)return U.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Z=="number"&&Math.floor(Z)!==Z)return U.error("Numeric branch labels must be integer values.");if(l){if(U.checkSubtype(l,da(Z)))return null}else l=da(Z);if(_[String(Z)]!==void 0)return U.error("Branch labels must be unique.");_[String(Z)]=v.length}const V=a.parse(O,I,d);if(!V)return null;d=d||V.type,v.push(V)}const b=a.parse(t[1],1,ni);if(!b)return null;const S=a.parse(t[t.length-1],t.length-1,d);return S?b.type.kind!=="value"&&a.concat(1).checkSubtype(l,b.type)?null:new fs(l,d,b,_,v,S):null}evaluate(t){const a=this.input.evaluate(t);return(da(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}}class pn{constructor(t,a,l){this.type=t,this.branches=a,this.otherwise=l}static parse(t,a){if(t.length<4)return a.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return a.error("Expected an odd number of arguments.");let l;a.expectedType&&a.expectedType.kind!=="value"&&(l=a.expectedType);const d=[];for(let v=1;v<t.length-1;v+=2){const b=a.parse(t[v],v,li);if(!b)return null;const S=a.parse(t[v+1],v+1,l);if(!S)return null;d.push([b,S]),l=l||S.type}const _=a.parse(t[t.length-1],t.length-1,l);if(!_)return null;if(!l)throw new Error("Can't infer output type");return new pn(l,d,_)}evaluate(t){for(const[a,l]of this.branches)if(a.evaluate(t))return l.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[a,l]of this.branches)t(a),t(l);t(this.otherwise)}outputDefined(){return this.branches.every((([t,a])=>a.outputDefined()))&&this.otherwise.outputDefined()}}class Ho{constructor(t,a,l,d){this.type=t,this.input=a,this.beginIndex=l,this.endIndex=d}static parse(t,a){if(t.length<=2||t.length>=5)return a.error(`Expected 2 or 3 arguments, but found ${t.length-1} instead.`);const l=a.parse(t[1],1,ni),d=a.parse(t[2],2,ut);if(!l||!d)return null;if(!hu(l.type,[Hn(ni),si,ni]))return a.error(`Expected first argument to be of type array or string, but found ${Zi(l.type)} instead`);if(t.length===4){const _=a.parse(t[3],3,ut);return _?new Ho(l.type,l,d,_):null}return new Ho(l.type,l,d)}evaluate(t){const a=this.input.evaluate(t),l=this.beginIndex.evaluate(t);let d;if(this.endIndex&&(d=this.endIndex.evaluate(t)),ro(a,["string"]))return[...a].slice(l,d).join("");if(ro(a,["array"]))return a.slice(l,d);throw new sa(`Expected first argument to be of type array or string, but found ${Zi(da(a))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Xo(n,t){const a=n.length-1;let l,d,_=0,v=a,b=0;for(;_<=v;)if(b=Math.floor((_+v)/2),l=n[b],d=n[b+1],l<=t){if(b===a||t<d)return b;_=b+1}else{if(!(l>t))throw new sa("Input is not a number.");v=b-1}return 0}class uo{constructor(t,a,l){this.type=t,this.input=a,this.labels=[],this.outputs=[];for(const[d,_]of l)this.labels.push(d),this.outputs.push(_)}static parse(t,a){if(t.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return a.error("Expected an even number of arguments.");const l=a.parse(t[1],1,ut);if(!l)return null;const d=[];let _=null;a.expectedType&&a.expectedType.kind!=="value"&&(_=a.expectedType);for(let v=1;v<t.length;v+=2){const b=v===1?-1/0:t[v],S=t[v+1],I=v,R=v+1;if(typeof b!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(d.length&&d[d.length-1][0]>=b)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const O=a.parse(S,R,_);if(!O)return null;_=_||O.type,d.push([b,O])}return new uo(_,l,d)}evaluate(t){const a=this.labels,l=this.outputs;if(a.length===1)return l[0].evaluate(t);const d=this.input.evaluate(t);if(d<=a[0])return l[0].evaluate(t);const _=a.length;return d>=a[_-1]?l[_-1].evaluate(t):l[Xo(a,d)].evaluate(t)}eachChild(t){t(this.input);for(const a of this.outputs)t(a)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function mn(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var du,fu,dd=(function(){if(fu)return du;function n(t,a,l,d){this.cx=3*t,this.bx=3*(l-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(d-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=a,this.p2x=l,this.p2y=d}return fu=1,du=n,n.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,a){if(a===void 0&&(a=1e-6),t<0)return 0;if(t>1)return 1;for(var l=t,d=0;d<8;d++){var _=this.sampleCurveX(l)-t;if(Math.abs(_)<a)return l;var v=this.sampleCurveDerivativeX(l);if(Math.abs(v)<1e-6)break;l-=_/v}var b=0,S=1;for(l=t,d=0;d<20&&(_=this.sampleCurveX(l),!(Math.abs(_-t)<a));d++)t>_?b=l:S=l,l=.5*(S-b)+b;return l},solve:function(t,a){return this.sampleCurveY(this.solveCurveX(t,a))}},du})(),fd=mn(dd);class nn{constructor(t,a,l,d,_){this.type=t,this.operator=a,this.interpolation=l,this.input=d,this.labels=[],this.outputs=[];for(const[v,b]of _)this.labels.push(v),this.outputs.push(b)}static interpolationFactor(t,a,l,d){let _=0;if(t.name==="exponential")_=Rl(a,t.base,l,d);else if(t.name==="linear")_=Rl(a,1,l,d);else if(t.name==="cubic-bezier"){const v=t.controlPoints;_=new fd(v[0],v[1],v[2],v[3]).solve(Rl(a,1,l,d))}return _}static parse(t,a){let[l,d,_,...v]=t;if(!Array.isArray(d)||d.length===0)return a.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const I=d[1];if(typeof I!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:I}}else{if(d[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const I=d.slice(1);if(I.length!==4||I.some((R=>typeof R!="number"||R<0||R>1)))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:I}}}if(t.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(_=a.parse(_,2,ut),!_)return null;const b=[];let S=null;l!=="interpolate-hcl"&&l!=="interpolate-lab"||a.expectedType==Ps?a.expectedType&&a.expectedType.kind!=="value"&&(S=a.expectedType):S=ar;for(let I=0;I<v.length;I+=2){const R=v[I],O=v[I+1],U=I+3,V=I+4;if(typeof R!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(b.length&&b[b.length-1][0]>=R)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',U);const Z=a.parse(O,V,S);if(!Z)return null;S=S||Z.type,b.push([R,Z])}return zs(S,ut)||zs(S,os)||zs(S,ar)||zs(S,Mr)||zs(S,$n)||zs(S,Ps)||zs(S,Ra)||zs(S,Hn(ut))?new nn(S,l,d,_,b):a.error(`Type ${Zi(S)} is not interpolatable.`)}evaluate(t){const a=this.labels,l=this.outputs;if(a.length===1)return l[0].evaluate(t);const d=this.input.evaluate(t);if(d<=a[0])return l[0].evaluate(t);const _=a.length;if(d>=a[_-1])return l[_-1].evaluate(t);const v=Xo(a,d),b=nn.interpolationFactor(this.interpolation,d,a[v],a[v+1]),S=l[v].evaluate(t),I=l[v+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Bn(S,I,b);case"color":return hi.interpolate(S,I,b);case"padding":return Da.interpolate(S,I,b);case"colorArray":return an.interpolate(S,I,b);case"numberArray":return tn.interpolate(S,I,b);case"variableAnchorOffsetCollection":return Ia.interpolate(S,I,b);case"array":return Uo(S,I,b);case"projectionDefinition":return fn.interpolate(S,I,b)}case"interpolate-hcl":switch(this.type.kind){case"color":return hi.interpolate(S,I,b,"hcl");case"colorArray":return an.interpolate(S,I,b,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return hi.interpolate(S,I,b,"lab");case"colorArray":return an.interpolate(S,I,b,"lab")}}}eachChild(t){t(this.input);for(const a of this.outputs)t(a)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function Rl(n,t,a,l){const d=l-a,_=n-a;return d===0?0:t===1?_/d:(Math.pow(t,_)-1)/(Math.pow(t,d)-1)}const Er={color:hi.interpolate,number:Bn,padding:Da.interpolate,numberArray:tn.interpolate,colorArray:an.interpolate,variableAnchorOffsetCollection:Ia.interpolate,array:Uo};class pu{constructor(t,a){this.type=t,this.args=a}static parse(t,a){if(t.length<2)return a.error("Expected at least one argument.");let l=null;const d=a.expectedType;d&&d.kind!=="value"&&(l=d);const _=[];for(const b of t.slice(1)){const S=a.parse(b,1+_.length,l,void 0,{typeAnnotation:"omit"});if(!S)return null;l=l||S.type,_.push(S)}if(!l)throw new Error("No output type");const v=d&&_.some((b=>Cl(d,b.type)));return new pu(v?ni:l,_)}evaluate(t){let a,l=null,d=0;for(const _ of this.args)if(d++,l=_.evaluate(t),l&&l instanceof Nn&&!l.available&&(a||(a=l.name),l=null,d===this.args.length&&(l=a)),l!==null)break;return l}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}function _c(n,t){return n==="=="||n==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function yc(n,t,a,l){return l.compare(t,a)===0}function ks(n,t,a){const l=n!=="=="&&n!=="!=";return class ay{constructor(_,v,b){this.type=li,this.lhs=_,this.rhs=v,this.collator=b,this.hasUntypedArgument=_.type.kind==="value"||v.type.kind==="value"}static parse(_,v){if(_.length!==3&&_.length!==4)return v.error("Expected two or three arguments.");const b=_[0];let S=v.parse(_[1],1,ni);if(!S)return null;if(!_c(b,S.type))return v.concat(1).error(`"${b}" comparisons are not supported for type '${Zi(S.type)}'.`);let I=v.parse(_[2],2,ni);if(!I)return null;if(!_c(b,I.type))return v.concat(2).error(`"${b}" comparisons are not supported for type '${Zi(I.type)}'.`);if(S.type.kind!==I.type.kind&&S.type.kind!=="value"&&I.type.kind!=="value")return v.error(`Cannot compare types '${Zi(S.type)}' and '${Zi(I.type)}'.`);l&&(S.type.kind==="value"&&I.type.kind!=="value"?S=new ci(I.type,[S]):S.type.kind!=="value"&&I.type.kind==="value"&&(I=new ci(S.type,[I])));let R=null;if(_.length===4){if(S.type.kind!=="string"&&I.type.kind!=="string"&&S.type.kind!=="value"&&I.type.kind!=="value")return v.error("Cannot use collator to compare non-string types.");if(R=v.parse(_[3],3,no),!R)return null}return new ay(S,I,R)}evaluate(_){const v=this.lhs.evaluate(_),b=this.rhs.evaluate(_);if(l&&this.hasUntypedArgument){const S=da(v),I=da(b);if(S.kind!==I.kind||S.kind!=="string"&&S.kind!=="number")throw new sa(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${S.kind}, ${I.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const S=da(v),I=da(b);if(S.kind!=="string"||I.kind!=="string")return t(_,v,b)}return this.collator?a(_,v,b,this.collator.evaluate(_)):t(_,v,b)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}}}const Vr=ks("==",(function(n,t,a){return t===a}),yc),lh=ks("!=",(function(n,t,a){return t!==a}),(function(n,t,a,l){return!yc(0,t,a,l)})),mu=ks("<",(function(n,t,a){return t<a}),(function(n,t,a,l){return l.compare(t,a)<0})),vf=ks(">",(function(n,t,a){return t>a}),(function(n,t,a,l){return l.compare(t,a)>0})),ch=ks("<=",(function(n,t,a){return t<=a}),(function(n,t,a,l){return l.compare(t,a)<=0})),xf=ks(">=",(function(n,t,a){return t>=a}),(function(n,t,a,l){return l.compare(t,a)>=0}));class gu{constructor(t,a,l){this.type=no,this.locale=l,this.caseSensitive=t,this.diacriticSensitive=a}static parse(t,a){if(t.length!==2)return a.error("Expected one argument.");const l=t[1];if(typeof l!="object"||Array.isArray(l))return a.error("Collator options argument must be an object.");const d=a.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,li);if(!d)return null;const _=a.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,li);if(!_)return null;let v=null;return l.locale&&(v=a.parse(l.locale,1,si),!v)?null:new gu(d,_,v)}evaluate(t){return new nr(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class uh{constructor(t,a,l,d,_){this.type=si,this.number=t,this.locale=a,this.currency=l,this.minFractionDigits=d,this.maxFractionDigits=_}static parse(t,a){if(t.length!==3)return a.error("Expected two arguments.");const l=a.parse(t[1],1,ut);if(!l)return null;const d=t[2];if(typeof d!="object"||Array.isArray(d))return a.error("NumberFormat options argument must be an object.");let _=null;if(d.locale&&(_=a.parse(d.locale,1,si),!_))return null;let v=null;if(d.currency&&(v=a.parse(d.currency,1,si),!v))return null;let b=null;if(d["min-fraction-digits"]&&(b=a.parse(d["min-fraction-digits"],1,ut),!b))return null;let S=null;return d["max-fraction-digits"]&&(S=a.parse(d["max-fraction-digits"],1,ut),!S)?null:new uh(l,_,v,b,S)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class _u{constructor(t){this.type=ls,this.sections=t}static parse(t,a){if(t.length<2)return a.error("Expected at least one argument.");const l=t[1];if(!Array.isArray(l)&&typeof l=="object")return a.error("First argument must be an image or text section.");const d=[];let _=!1;for(let v=1;v<=t.length-1;++v){const b=t[v];if(_&&typeof b=="object"&&!Array.isArray(b)){_=!1;let S=null;if(b["font-scale"]&&(S=a.parse(b["font-scale"],1,ut),!S))return null;let I=null;if(b["text-font"]&&(I=a.parse(b["text-font"],1,Hn(si)),!I))return null;let R=null;if(b["text-color"]&&(R=a.parse(b["text-color"],1,ar),!R))return null;let O=null;if(b["vertical-align"]){if(typeof b["vertical-align"]=="string"&&!Vo.includes(b["vertical-align"]))return a.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${b["vertical-align"]}' instead.`);if(O=a.parse(b["vertical-align"],1,si),!O)return null}const U=d[d.length-1];U.scale=S,U.font=I,U.textColor=R,U.verticalAlign=O}else{const S=a.parse(t[v],1,ni);if(!S)return null;const I=S.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,d.push({content:S,scale:null,font:null,textColor:null,verticalAlign:null})}}return new _u(d)}evaluate(t){return new en(this.sections.map((a=>{const l=a.content.evaluate(t);return da(l)===Ma?new lo("",l,null,null,null,a.verticalAlign?a.verticalAlign.evaluate(t):null):new lo(yi(l),null,a.scale?a.scale.evaluate(t):null,a.font?a.font.evaluate(t).join(","):null,a.textColor?a.textColor.evaluate(t):null,a.verticalAlign?a.verticalAlign.evaluate(t):null)})))}eachChild(t){for(const a of this.sections)t(a.content),a.scale&&t(a.scale),a.font&&t(a.font),a.textColor&&t(a.textColor),a.verticalAlign&&t(a.verticalAlign)}outputDefined(){return!1}}class Dl{constructor(t){this.type=Ma,this.input=t}static parse(t,a){if(t.length!==2)return a.error("Expected two arguments.");const l=a.parse(t[1],1,si);return l?new Dl(l):a.error("No image name provided.")}evaluate(t){const a=this.input.evaluate(t),l=Nn.fromString(a);return l&&t.availableImages&&(l.available=t.availableImages.indexOf(a)>-1),l}eachChild(t){t(this.input)}outputDefined(){return!1}}class hh{constructor(t){this.type=ut,this.input=t}static parse(t,a){if(t.length!==2)return a.error(`Expected 1 argument, but found ${t.length-1} instead.`);const l=a.parse(t[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${Zi(l.type)} instead.`):new hh(l):null}evaluate(t){const a=this.input.evaluate(t);if(typeof a=="string")return[...a].length;if(Array.isArray(a))return a.length;throw new sa(`Expected value to be of type string or array, but found ${Zi(da(a))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const rr=8192;function kl(n,t){const a=(180+n[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,d=Math.pow(2,t.z);return[Math.round(a*d*rr),Math.round(l*d*rr)]}function dh(n,t){const a=Math.pow(2,t.z);return[(d=(n[0]/rr+t.x)/a,360*d-180),(l=(n[1]/rr+t.y)/a,360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90)];var l,d}function Yo(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function Ll(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function pd(n,t,a){const l=n[0]-t[0],d=n[1]-t[1],_=n[0]-a[0],v=n[1]-a[1];return l*v-_*d==0&&l*_<=0&&d*v<=0}function vc(n,t,a,l){return(d=[l[0]-a[0],l[1]-a[1]])[0]*(_=[t[0]-n[0],t[1]-n[1]])[1]-d[1]*_[0]!=0&&!(!ph(n,t,a,l)||!ph(a,l,n,t));var d,_}function md(n,t,a){for(const l of a)for(let d=0;d<l.length-1;++d)if(vc(n,t,l[d],l[d+1]))return!0;return!1}function qr(n,t,a=!1){let l=!1;for(const b of t)for(let S=0;S<b.length-1;S++){if(pd(n,b[S],b[S+1]))return a;(_=b[S])[1]>(d=n)[1]!=(v=b[S+1])[1]>d[1]&&d[0]<(v[0]-_[0])*(d[1]-_[1])/(v[1]-_[1])+_[0]&&(l=!l)}var d,_,v;return l}function gd(n,t){for(const a of t)if(qr(n,a))return!0;return!1}function fh(n,t){for(const a of n)if(!qr(a,t))return!1;for(let a=0;a<n.length-1;++a)if(md(n[a],n[a+1],t))return!1;return!0}function _d(n,t){for(const a of t)if(fh(n,a))return!0;return!1}function ph(n,t,a,l){const d=l[0]-a[0],_=l[1]-a[1],v=(n[0]-a[0])*_-d*(n[1]-a[1]),b=(t[0]-a[0])*_-d*(t[1]-a[1]);return v>0&&b<0||v<0&&b>0}function yu(n,t,a){const l=[];for(let d=0;d<n.length;d++){const _=[];for(let v=0;v<n[d].length;v++){const b=kl(n[d][v],a);Yo(t,b),_.push(b)}l.push(_)}return l}function Ol(n,t,a){const l=[];for(let d=0;d<n.length;d++){const _=yu(n[d],t,a);l.push(_)}return l}function Bl(n,t,a,l){if(n[0]<a[0]||n[0]>a[2]){const d=.5*l;let _=n[0]-a[0]>d?-l:a[0]-n[0]>d?l:0;_===0&&(_=n[0]-a[2]>d?-l:a[2]-n[0]>d?l:0),n[0]+=_}Yo(t,n)}function xc(n,t,a,l){const d=Math.pow(2,l.z)*rr,_=[l.x*rr,l.y*rr],v=[];for(const b of n)for(const S of b){const I=[S.x+_[0],S.y+_[1]];Bl(I,t,a,d),v.push(I)}return v}function bc(n,t,a,l){const d=Math.pow(2,l.z)*rr,_=[l.x*rr,l.y*rr],v=[];for(const S of n){const I=[];for(const R of S){const O=[R.x+_[0],R.y+_[1]];Yo(t,O),I.push(O)}v.push(I)}if(t[2]-t[0]<=d/2){(b=t)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const S of v)for(const I of S)Bl(I,t,a,d)}var b;return v}class ho{constructor(t,a){this.type=li,this.geojson=t,this.geometries=a}static parse(t,a){if(t.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if($i(t[1])){const l=t[1];if(l.type==="FeatureCollection"){const d=[];for(const _ of l.features){const{type:v,coordinates:b}=_.geometry;v==="Polygon"&&d.push(b),v==="MultiPolygon"&&d.push(...b)}if(d.length)return new ho(l,{type:"MultiPolygon",coordinates:d})}else if(l.type==="Feature"){const d=l.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new ho(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new ho(l,l)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(a,l){const d=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],v=a.canonicalID();if(l.type==="Polygon"){const b=yu(l.coordinates,_,v),S=xc(a.geometry(),d,_,v);if(!Ll(d,_))return!1;for(const I of S)if(!qr(I,b))return!1}if(l.type==="MultiPolygon"){const b=Ol(l.coordinates,_,v),S=xc(a.geometry(),d,_,v);if(!Ll(d,_))return!1;for(const I of S)if(!gd(I,b))return!1}return!0})(t,this.geometries);if(t.geometryType()==="LineString")return(function(a,l){const d=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],v=a.canonicalID();if(l.type==="Polygon"){const b=yu(l.coordinates,_,v),S=bc(a.geometry(),d,_,v);if(!Ll(d,_))return!1;for(const I of S)if(!fh(I,b))return!1}if(l.type==="MultiPolygon"){const b=Ol(l.coordinates,_,v),S=bc(a.geometry(),d,_,v);if(!Ll(d,_))return!1;for(const I of S)if(!_d(I,b))return!1}return!0})(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let mh=class{constructor(n=[],t=(a,l)=>a<l?-1:a>l?1:0){if(this.data=n,this.length=this.data.length,this.compare=t,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:t,compare:a}=this,l=t[n];for(;n>0;){const d=n-1>>1,_=t[d];if(a(l,_)>=0)break;t[n]=_,n=d}t[n]=l}_down(n){const{data:t,compare:a}=this,l=this.length>>1,d=t[n];for(;n<l;){let _=1+(n<<1);const v=_+1;if(v<this.length&&a(t[v],t[_])<0&&(_=v),a(t[_],d)>=0)break;t[n]=t[_],n=_}t[n]=d}};function vu(n,t,a=0,l=n.length-1,d=gh){for(;l>a;){if(l-a>600){const S=l-a+1,I=t-a+1,R=Math.log(S),O=.5*Math.exp(2*R/3),U=.5*Math.sqrt(R*O*(S-O)/S)*(I-S/2<0?-1:1);vu(n,t,Math.max(a,Math.floor(t-I*O/S+U)),Math.min(l,Math.floor(t+(S-I)*O/S+U)),d)}const _=n[t];let v=a,b=l;for(Ls(n,a,t),d(n[l],_)>0&&Ls(n,a,l);v<b;){for(Ls(n,v,b),v++,b--;d(n[v],_)<0;)v++;for(;d(n[b],_)>0;)b--}d(n[a],_)===0?Ls(n,a,b):(b++,Ls(n,b,l)),b<=t&&(a=b+1),t<=b&&(l=b-1)}}function Ls(n,t,a){const l=n[t];n[t]=n[a],n[a]=l}function gh(n,t){return n<t?-1:n>t?1:0}function wc(n,t){if(n.length<=1)return[n];const a=[];let l,d;for(const _ of n){const v=vd(_);v!==0&&(_.area=Math.abs(v),d===void 0&&(d=v<0),d===v<0?(l&&a.push(l),l=[_]):l.push(_))}if(l&&a.push(l),t>1)for(let _=0;_<a.length;_++)a[_].length<=t||(vu(a[_],t,1,a[_].length-1,yd),a[_]=a[_].slice(0,t));return a}function yd(n,t){return t.area-n.area}function vd(n){let t=0;for(let a,l,d=0,_=n.length,v=_-1;d<_;v=d++)a=n[d],l=n[v],t+=(l.x-a.x)*(a.y+l.y);return t}const _h=1/298.257223563,xd=_h*(2-_h),bd=Math.PI/180;class yh{constructor(t){const a=6378.137*bd*1e3,l=Math.cos(t*bd),d=1/(1-xd*(1-l*l)),_=Math.sqrt(d);this.kx=a*_*l,this.ky=a*_*d*(1-xd)}distance(t,a){const l=this.wrap(t[0]-a[0])*this.kx,d=(t[1]-a[1])*this.ky;return Math.sqrt(l*l+d*d)}pointOnLine(t,a){let l,d,_,v,b=1/0;for(let S=0;S<t.length-1;S++){let I=t[S][0],R=t[S][1],O=this.wrap(t[S+1][0]-I)*this.kx,U=(t[S+1][1]-R)*this.ky,V=0;O===0&&U===0||(V=(this.wrap(a[0]-I)*this.kx*O+(a[1]-R)*this.ky*U)/(O*O+U*U),V>1?(I=t[S+1][0],R=t[S+1][1]):V>0&&(I+=O/this.kx*V,R+=U/this.ky*V)),O=this.wrap(a[0]-I)*this.kx,U=(a[1]-R)*this.ky;const Z=O*O+U*U;Z<b&&(b=Z,l=I,d=R,_=S,v=V)}return{point:[l,d],index:_,t:Math.max(0,Math.min(1,v))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function jn(n,t){return t[0]-n[0]}function fo(n){return n[1]-n[0]+1}function ps(n,t){return n[1]>=n[0]&&n[1]<t}function xu(n,t){if(n[0]>n[1])return[null,null];const a=fo(n);if(t){if(a===2)return[n,null];const d=Math.floor(a/2);return[[n[0],n[0]+d],[n[0]+d,n[1]]]}if(a===1)return[n,null];const l=Math.floor(a/2)-1;return[[n[0],n[0]+l],[n[0]+l+1,n[1]]]}function bu(n,t){if(!ps(t,n.length))return[1/0,1/0,-1/0,-1/0];const a=[1/0,1/0,-1/0,-1/0];for(let l=t[0];l<=t[1];++l)Yo(a,n[l]);return a}function Di(n){const t=[1/0,1/0,-1/0,-1/0];for(const a of n)for(const l of a)Yo(t,l);return t}function wu(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function vh(n,t,a){if(!wu(n)||!wu(t))return NaN;let l=0,d=0;return n[2]<t[0]&&(l=t[0]-n[2]),n[0]>t[2]&&(l=n[0]-t[2]),n[1]>t[3]&&(d=n[1]-t[3]),n[3]<t[1]&&(d=t[1]-n[3]),a.distance([0,0],[l,d])}function Cr(n,t,a){const l=a.pointOnLine(t,n);return a.distance(n,l.point)}function Sc(n,t,a,l,d){const _=Math.min(Cr(n,[a,l],d),Cr(t,[a,l],d)),v=Math.min(Cr(a,[n,t],d),Cr(l,[n,t],d));return Math.min(_,v)}function Mc(n,t,a,l,d){if(!ps(t,n.length)||!ps(l,a.length))return 1/0;let _=1/0;for(let v=t[0];v<t[1];++v){const b=n[v],S=n[v+1];for(let I=l[0];I<l[1];++I){const R=a[I],O=a[I+1];if(vc(b,S,R,O))return 0;_=Math.min(_,Sc(b,S,R,O,d))}}return _}function xh(n,t,a,l,d){if(!ps(t,n.length)||!ps(l,a.length))return NaN;let _=1/0;for(let v=t[0];v<=t[1];++v)for(let b=l[0];b<=l[1];++b)if(_=Math.min(_,d.distance(n[v],a[b])),_===0)return _;return _}function wd(n,t,a){if(qr(n,t,!0))return 0;let l=1/0;for(const d of t){const _=d[0],v=d[d.length-1];if(_!==v&&(l=Math.min(l,Cr(n,[v,_],a)),l===0))return l;const b=a.pointOnLine(d,n);if(l=Math.min(l,a.distance(n,b.point)),l===0)return l}return l}function Wo(n,t,a,l){if(!ps(t,n.length))return NaN;for(let _=t[0];_<=t[1];++_)if(qr(n[_],a,!0))return 0;let d=1/0;for(let _=t[0];_<t[1];++_){const v=n[_],b=n[_+1];for(const S of a)for(let I=0,R=S.length,O=R-1;I<R;O=I++){const U=S[O],V=S[I];if(vc(v,b,U,V))return 0;d=Math.min(d,Sc(v,b,U,V,l))}}return d}function Qo(n,t){for(const a of n)for(const l of a)if(qr(l,t,!0))return!0;return!1}function bh(n,t,a,l=1/0){const d=Di(n),_=Di(t);if(l!==1/0&&vh(d,_,a)>=l)return l;if(Ll(d,_)){if(Qo(n,t))return 0}else if(Qo(t,n))return 0;let v=1/0;for(const b of n)for(let S=0,I=b.length,R=I-1;S<I;R=S++){const O=b[R],U=b[S];for(const V of t)for(let Z=0,Y=V.length,ie=Y-1;Z<Y;ie=Z++){const se=V[ie],Ee=V[Z];if(vc(O,U,se,Ee))return 0;v=Math.min(v,Sc(O,U,se,Ee,a))}}return v}function wh(n,t,a,l,d,_){if(!_)return;const v=vh(bu(l,_),d,a);v<t&&n.push([v,_,[0,0]])}function ms(n,t,a,l,d,_,v){if(!_||!v)return;const b=vh(bu(l,_),bu(d,v),a);b<t&&n.push([b,_,v])}function Tc(n,t,a,l,d=1/0){let _=Math.min(l.distance(n[0],a[0][0]),d);if(_===0)return _;const v=new mh([[0,[0,n.length-1],[0,0]]],jn),b=Di(a);for(;v.length>0;){const S=v.pop();if(S[0]>=_)continue;const I=S[1],R=t?50:100;if(fo(I)<=R){if(!ps(I,n.length))return NaN;if(t){const O=Wo(n,I,a,l);if(isNaN(O)||O===0)return O;_=Math.min(_,O)}else for(let O=I[0];O<=I[1];++O){const U=wd(n[O],a,l);if(_=Math.min(_,U),_===0)return 0}}else{const O=xu(I,t);wh(v,_,l,n,b,O[0]),wh(v,_,l,n,b,O[1])}}return _}function Ec(n,t,a,l,d,_=1/0){let v=Math.min(_,d.distance(n[0],a[0]));if(v===0)return v;const b=new mh([[0,[0,n.length-1],[0,a.length-1]]],jn);for(;b.length>0;){const S=b.pop();if(S[0]>=v)continue;const I=S[1],R=S[2],O=t?50:100,U=l?50:100;if(fo(I)<=O&&fo(R)<=U){if(!ps(I,n.length)&&ps(R,a.length))return NaN;let V;if(t&&l)V=Mc(n,I,a,R,d),v=Math.min(v,V);else if(t&&!l){const Z=n.slice(I[0],I[1]+1);for(let Y=R[0];Y<=R[1];++Y)if(V=Cr(a[Y],Z,d),v=Math.min(v,V),v===0)return v}else if(!t&&l){const Z=a.slice(R[0],R[1]+1);for(let Y=I[0];Y<=I[1];++Y)if(V=Cr(n[Y],Z,d),v=Math.min(v,V),v===0)return v}else V=xh(n,I,a,R,d),v=Math.min(v,V)}else{const V=xu(I,t),Z=xu(R,l);ms(b,v,d,n,a,V[0],Z[0]),ms(b,v,d,n,a,V[0],Z[1]),ms(b,v,d,n,a,V[1],Z[0]),ms(b,v,d,n,a,V[1],Z[1])}}return v}function Su(n){return n.type==="MultiPolygon"?n.coordinates.map((t=>({type:"Polygon",coordinates:t}))):n.type==="MultiLineString"?n.coordinates.map((t=>({type:"LineString",coordinates:t}))):n.type==="MultiPoint"?n.coordinates.map((t=>({type:"Point",coordinates:t}))):[n]}class Ko{constructor(t,a){this.type=ut,this.geojson=t,this.geometries=a}static parse(t,a){if(t.length!==2)return a.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if($i(t[1])){const l=t[1];if(l.type==="FeatureCollection")return new Ko(l,l.features.map((d=>Su(d.geometry))).flat());if(l.type==="Feature")return new Ko(l,Su(l.geometry));if("type"in l&&"coordinates"in l)return new Ko(l,Su(l))}return a.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(a,l){const d=a.geometry(),_=d.flat().map((S=>dh([S.x,S.y],a.canonical)));if(d.length===0)return NaN;const v=new yh(_[0][1]);let b=1/0;for(const S of l){switch(S.type){case"Point":b=Math.min(b,Ec(_,!1,[S.coordinates],!1,v,b));break;case"LineString":b=Math.min(b,Ec(_,!1,S.coordinates,!0,v,b));break;case"Polygon":b=Math.min(b,Tc(_,!1,S.coordinates,v,b))}if(b===0)return b}return b})(t,this.geometries);if(t.geometryType()==="LineString")return(function(a,l){const d=a.geometry(),_=d.flat().map((S=>dh([S.x,S.y],a.canonical)));if(d.length===0)return NaN;const v=new yh(_[0][1]);let b=1/0;for(const S of l){switch(S.type){case"Point":b=Math.min(b,Ec(_,!0,[S.coordinates],!1,v,b));break;case"LineString":b=Math.min(b,Ec(_,!0,S.coordinates,!0,v,b));break;case"Polygon":b=Math.min(b,Tc(_,!0,S.coordinates,v,b))}if(b===0)return b}return b})(t,this.geometries);if(t.geometryType()==="Polygon")return(function(a,l){const d=a.geometry();if(d.length===0||d[0].length===0)return NaN;const _=wc(d,0).map((S=>S.map((I=>I.map((R=>dh([R.x,R.y],a.canonical))))))),v=new yh(_[0][0][0][1]);let b=1/0;for(const S of l)for(const I of _){switch(S.type){case"Point":b=Math.min(b,Tc([S.coordinates],!1,I,v,b));break;case"LineString":b=Math.min(b,Tc(S.coordinates,!0,I,v,b));break;case"Polygon":b=Math.min(b,bh(I,S.coordinates,v,b))}if(b===0)return b}return b})(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Cc{constructor(t){this.type=ni,this.key=t}static parse(t,a){if(t.length!==2)return a.error(`Expected 1 argument, but found ${t.length-1} instead.`);const l=t[1];return l==null?a.error("Global state property must be defined."):typeof l!="string"?a.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new Cc(l)}evaluate(t){var a;const l=(a=t.globals)===null||a===void 0?void 0:a.globalState;return l&&Object.keys(l).length!==0?Pl(l,this.key):null}eachChild(){}outputDefined(){return!1}}const Nl={"==":Vr,"!=":lh,">":vf,"<":mu,">=":xf,"<=":ch,array:ci,at:Zo,boolean:ci,case:pn,coalesce:pu,collator:gu,format:_u,image:Dl,in:$o,"index-of":Il,interpolate:nn,"interpolate-hcl":nn,"interpolate-lab":nn,length:hh,let:co,literal:Yt,match:fs,number:ci,"number-format":uh,object:ci,slice:Ho,step:uo,string:ci,"to-boolean":ka,"to-color":ka,"to-number":ka,"to-string":ka,var:qo,within:ho,distance:Ko,"global-state":Cc};class sr{constructor(t,a,l,d){this.name=t,this.type=a,this._evaluate=l,this.args=d}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,a){const l=t[0],d=sr.definitions[l];if(!d)return a.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(d)?d[0]:d.type,v=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,b=v.filter((([I])=>!Array.isArray(I)||I.length===t.length-1));let S=null;for(const[I,R]of b){S=new gc(a.registry,Fn,a.path,null,a.scope);const O=[];let U=!1;for(let V=1;V<t.length;V++){const Z=t[V],Y=Array.isArray(I)?I[V-1]:I.type,ie=S.parse(Z,1+O.length,Y);if(!ie){U=!0;break}O.push(ie)}if(!U)if(Array.isArray(I)&&I.length!==O.length)S.error(`Expected ${I.length} arguments, but found ${O.length} instead.`);else{for(let V=0;V<O.length;V++){const Z=Array.isArray(I)?I[V]:I.type,Y=O[V];S.concat(V+1).checkSubtype(Z,Y.type)}if(S.errors.length===0)return new sr(l,_,R,O)}}if(b.length===1)a.errors.push(...S.errors);else{const I=(b.length?b:v).map((([O])=>{return U=O,Array.isArray(U)?`(${U.map(Zi).join(", ")})`:`(${Zi(U.type)}...)`;var U})).join(" | "),R=[];for(let O=1;O<t.length;O++){const U=a.parse(t[O],1+R.length);if(!U)return null;R.push(Zi(U.type))}a.error(`Expected arguments of type ${I}, but found (${R.join(", ")}) instead.`)}return null}static register(t,a){sr.definitions=a;for(const l in a)t[l]=sr}}function Sh(n,[t,a,l,d]){t=t.evaluate(n),a=a.evaluate(n),l=l.evaluate(n);const _=d?d.evaluate(n):1,v=Tr(t,a,l,_);if(v)throw new sa(v);return new hi(t/255,a/255,l/255,_,!1)}function Mu(n,t){return n in t}function or(n,t){const a=t[n];return a===void 0?null:a}function gs(n){return{type:n}}function Fn(n){if(n instanceof qo)return Fn(n.boundExpression);if(n instanceof sr&&n.name==="error"||n instanceof gu||n instanceof ho||n instanceof Ko||n instanceof Cc)return!1;const t=n instanceof ka||n instanceof ci;let a=!0;return n.eachChild((l=>{a=t?a&&Fn(l):a&&l instanceof Yt})),!!a&&Os(n)&&el(n,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Os(n){if(n instanceof sr&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof ho||n instanceof Ko)return!1;let t=!0;return n.eachChild((a=>{t&&!Os(a)&&(t=!1)})),t}function Jo(n){if(n instanceof sr&&n.name==="feature-state")return!1;let t=!0;return n.eachChild((a=>{t&&!Jo(a)&&(t=!1)})),t}function el(n,t){if(n instanceof sr&&t.indexOf(n.name)>=0)return!1;let a=!0;return n.eachChild((l=>{a&&!el(l,t)&&(a=!1)})),a}function Ac(n){return{result:"success",value:n}}function po(n){return{result:"error",value:n}}function Ar(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function Mh(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function mo(n){return!!n.expression&&n.expression.interpolated}function ui(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function Tu(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&da(n)===Ur}function lr(n){return n}function Pc(n,t){const a=n.stops&&typeof n.stops[0][0]=="object",l=a||!(a||n.property!==void 0),d=n.type||(mo(t)?"exponential":"interval"),_=(function(R){switch(R.type){case"color":return hi.parse;case"padding":return Da.parse;case"numberArray":return tn.parse;case"colorArray":return an.parse;default:return null}})(t);if(_&&((n=Gr({},n)).stops&&(n.stops=n.stops.map((R=>[R[0],_(R[1])]))),n.default=_(n.default?n.default:t.default)),n.colorSpace&&(v=n.colorSpace)!=="rgb"&&v!=="hcl"&&v!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var v;const b=(function(R){switch(R){case"exponential":return Bs;case"interval":return tl;case"categorical":return Sd;case"identity":return Th;default:throw new Error(`Unknown function type "${R}"`)}})(d);let S,I;if(d==="categorical"){S=Object.create(null);for(const R of n.stops)S[R[0]]=R[1];I=typeof n.stops[0][0]}if(a){const R={},O=[];for(let Z=0;Z<n.stops.length;Z++){const Y=n.stops[Z],ie=Y[0].zoom;R[ie]===void 0&&(R[ie]={zoom:ie,type:n.type,property:n.property,default:n.default,stops:[]},O.push(ie)),R[ie].stops.push([Y[0].value,Y[1]])}const U=[];for(const Z of O)U.push([R[Z].zoom,Pc(R[Z],t)]);const V={name:"linear"};return{kind:"composite",interpolationType:V,interpolationFactor:nn.interpolationFactor.bind(void 0,V),zoomStops:U.map((Z=>Z[0])),evaluate:({zoom:Z},Y)=>Bs({stops:U,base:n.base},t,Z).evaluate(Z,Y)}}if(l){const R=d==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:R,interpolationFactor:nn.interpolationFactor.bind(void 0,R),zoomStops:n.stops.map((O=>O[0])),evaluate:({zoom:O})=>b(n,t,O,S,I)}}return{kind:"source",evaluate(R,O){const U=O&&O.properties?O.properties[n.property]:void 0;return U===void 0?cr(n.default,t.default):b(n,t,U,S,I)}}}function cr(n,t,a){return n!==void 0?n:t!==void 0?t:a!==void 0?a:void 0}function Sd(n,t,a,l,d){return cr(typeof a===d?l[a]:void 0,n.default,t.default)}function tl(n,t,a){if(ui(a)!=="number")return cr(n.default,t.default);const l=n.stops.length;if(l===1||a<=n.stops[0][0])return n.stops[0][1];if(a>=n.stops[l-1][0])return n.stops[l-1][1];const d=Xo(n.stops.map((_=>_[0])),a);return n.stops[d][1]}function Bs(n,t,a){const l=n.base!==void 0?n.base:1;if(ui(a)!=="number")return cr(n.default,t.default);const d=n.stops.length;if(d===1||a<=n.stops[0][0])return n.stops[0][1];if(a>=n.stops[d-1][0])return n.stops[d-1][1];const _=Xo(n.stops.map((R=>R[0])),a),v=(function(R,O,U,V){const Z=V-U,Y=R-U;return Z===0?0:O===1?Y/Z:(Math.pow(O,Y)-1)/(Math.pow(O,Z)-1)})(a,l,n.stops[_][0],n.stops[_+1][0]),b=n.stops[_][1],S=n.stops[_+1][1],I=Er[t.type]||lr;return typeof b.evaluate=="function"?{evaluate(...R){const O=b.evaluate.apply(void 0,R),U=S.evaluate.apply(void 0,R);if(O!==void 0&&U!==void 0)return I(O,U,v,n.colorSpace)}}:I(b,S,v,n.colorSpace)}function Th(n,t,a){switch(t.type){case"color":a=hi.parse(a);break;case"formatted":a=en.fromString(a.toString());break;case"resolvedImage":a=Nn.fromString(a.toString());break;case"padding":a=Da.parse(a);break;case"colorArray":a=an.parse(a);break;case"numberArray":a=tn.parse(a);break;default:ui(a)===t.type||t.type==="enum"&&t.values[a]||(a=void 0)}return cr(a,n.default,t.default)}sr.register(Nl,{error:[{kind:"error"},[si],(n,[t])=>{throw new sa(t.evaluate(n))}],typeof:[si,[ni],(n,[t])=>Zi(da(t.evaluate(n)))],"to-rgba":[Hn(ut,4),[ar],(n,[t])=>{const[a,l,d,_]=t.evaluate(n).rgb;return[255*a,255*l,255*d,_]}],rgb:[ar,[ut,ut,ut],Sh],rgba:[ar,[ut,ut,ut,ut],Sh],has:{type:li,overloads:[[[si],(n,[t])=>Mu(t.evaluate(n),n.properties())],[[si,Ur],(n,[t,a])=>Mu(t.evaluate(n),a.evaluate(n))]]},get:{type:ni,overloads:[[[si],(n,[t])=>or(t.evaluate(n),n.properties())],[[si,Ur],(n,[t,a])=>or(t.evaluate(n),a.evaluate(n))]]},"feature-state":[ni,[si],(n,[t])=>or(t.evaluate(n),n.featureState||{})],properties:[Ur,[],n=>n.properties()],"geometry-type":[si,[],n=>n.geometryType()],id:[ni,[],n=>n.id()],zoom:[ut,[],n=>n.globals.zoom],"heatmap-density":[ut,[],n=>n.globals.heatmapDensity||0],elevation:[ut,[],n=>n.globals.elevation||0],"line-progress":[ut,[],n=>n.globals.lineProgress||0],accumulated:[ni,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[ut,gs(ut),(n,t)=>{let a=0;for(const l of t)a+=l.evaluate(n);return a}],"*":[ut,gs(ut),(n,t)=>{let a=1;for(const l of t)a*=l.evaluate(n);return a}],"-":{type:ut,overloads:[[[ut,ut],(n,[t,a])=>t.evaluate(n)-a.evaluate(n)],[[ut],(n,[t])=>-t.evaluate(n)]]},"/":[ut,[ut,ut],(n,[t,a])=>t.evaluate(n)/a.evaluate(n)],"%":[ut,[ut,ut],(n,[t,a])=>t.evaluate(n)%a.evaluate(n)],ln2:[ut,[],()=>Math.LN2],pi:[ut,[],()=>Math.PI],e:[ut,[],()=>Math.E],"^":[ut,[ut,ut],(n,[t,a])=>Math.pow(t.evaluate(n),a.evaluate(n))],sqrt:[ut,[ut],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[ut,[ut],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[ut,[ut],(n,[t])=>Math.log(t.evaluate(n))],log2:[ut,[ut],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[ut,[ut],(n,[t])=>Math.sin(t.evaluate(n))],cos:[ut,[ut],(n,[t])=>Math.cos(t.evaluate(n))],tan:[ut,[ut],(n,[t])=>Math.tan(t.evaluate(n))],asin:[ut,[ut],(n,[t])=>Math.asin(t.evaluate(n))],acos:[ut,[ut],(n,[t])=>Math.acos(t.evaluate(n))],atan:[ut,[ut],(n,[t])=>Math.atan(t.evaluate(n))],min:[ut,gs(ut),(n,t)=>Math.min(...t.map((a=>a.evaluate(n))))],max:[ut,gs(ut),(n,t)=>Math.max(...t.map((a=>a.evaluate(n))))],abs:[ut,[ut],(n,[t])=>Math.abs(t.evaluate(n))],round:[ut,[ut],(n,[t])=>{const a=t.evaluate(n);return a<0?-Math.round(-a):Math.round(a)}],floor:[ut,[ut],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[ut,[ut],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[li,[si,ni],(n,[t,a])=>n.properties()[t.value]===a.value],"filter-id-==":[li,[ni],(n,[t])=>n.id()===t.value],"filter-type-==":[li,[si],(n,[t])=>n.geometryType()===t.value],"filter-<":[li,[si,ni],(n,[t,a])=>{const l=n.properties()[t.value],d=a.value;return typeof l==typeof d&&l<d}],"filter-id-<":[li,[ni],(n,[t])=>{const a=n.id(),l=t.value;return typeof a==typeof l&&a<l}],"filter->":[li,[si,ni],(n,[t,a])=>{const l=n.properties()[t.value],d=a.value;return typeof l==typeof d&&l>d}],"filter-id->":[li,[ni],(n,[t])=>{const a=n.id(),l=t.value;return typeof a==typeof l&&a>l}],"filter-<=":[li,[si,ni],(n,[t,a])=>{const l=n.properties()[t.value],d=a.value;return typeof l==typeof d&&l<=d}],"filter-id-<=":[li,[ni],(n,[t])=>{const a=n.id(),l=t.value;return typeof a==typeof l&&a<=l}],"filter->=":[li,[si,ni],(n,[t,a])=>{const l=n.properties()[t.value],d=a.value;return typeof l==typeof d&&l>=d}],"filter-id->=":[li,[ni],(n,[t])=>{const a=n.id(),l=t.value;return typeof a==typeof l&&a>=l}],"filter-has":[li,[ni],(n,[t])=>t.value in n.properties()],"filter-has-id":[li,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[li,[Hn(si)],(n,[t])=>t.value.indexOf(n.geometryType())>=0],"filter-id-in":[li,[Hn(ni)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[li,[si,Hn(ni)],(n,[t,a])=>a.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[li,[si,Hn(ni)],(n,[t,a])=>(function(l,d,_,v){for(;_<=v;){const b=_+v>>1;if(d[b]===l)return!0;d[b]>l?v=b-1:_=b+1}return!1})(n.properties()[t.value],a.value,0,a.value.length-1)],all:{type:li,overloads:[[[li,li],(n,[t,a])=>t.evaluate(n)&&a.evaluate(n)],[gs(li),(n,t)=>{for(const a of t)if(!a.evaluate(n))return!1;return!0}]]},any:{type:li,overloads:[[[li,li],(n,[t,a])=>t.evaluate(n)||a.evaluate(n)],[gs(li),(n,t)=>{for(const a of t)if(a.evaluate(n))return!0;return!1}]]},"!":[li,[li],(n,[t])=>!t.evaluate(n)],"is-supported-script":[li,[si],(n,[t])=>{const a=n.globals&&n.globals.isSupportedScript;return!a||a(t.evaluate(n))}],upcase:[si,[si],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[si,[si],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[si,gs(ni),(n,t)=>t.map((a=>yi(a.evaluate(n)))).join("")],"resolved-locale":[si,[no],(n,[t])=>t.evaluate(n).resolvedLocale()]});class Eu{constructor(t,a,l){this.expression=t,this._warningHistory={},this._evaluator=new Ds,this._defaultValue=a?(function(d){if(d.type==="color"&&Tu(d.default))return new hi(0,0,0,0);switch(d.type){case"color":return hi.parse(d.default)||null;case"padding":return Da.parse(d.default)||null;case"numberArray":return tn.parse(d.default)||null;case"colorArray":return an.parse(d.default)||null;case"variableAnchorOffsetCollection":return Ia.parse(d.default)||null;case"projectionDefinition":return fn.parse(d.default)||null;default:return d.default===void 0?null:d.default}})(a):null,this._enumValues=a&&a.type==="enum"?a.values:null,this._globalState=l}evaluateWithoutErrorHandling(t,a,l,d,_,v){return this._globalState&&(t=gn(t,this._globalState)),this._evaluator.globals=t,this._evaluator.feature=a,this._evaluator.featureState=l,this._evaluator.canonical=d,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=v,this.expression.evaluate(this._evaluator)}evaluate(t,a,l,d,_,v){this._globalState&&(t=gn(t,this._globalState)),this._evaluator.globals=t,this._evaluator.feature=a||null,this._evaluator.featureState=l||null,this._evaluator.canonical=d,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=v||null;try{const b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new sa(`Expected value to be one of ${Object.keys(this._enumValues).map((S=>JSON.stringify(S))).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function jl(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Nl}function zc(n,t,a){const l=new gc(Nl,Fn,[],t?(function(_){const v={color:ar,string:si,number:ut,enum:si,boolean:li,formatted:ls,padding:Mr,numberArray:$n,colorArray:Ps,projectionDefinition:os,resolvedImage:Ma,variableAnchorOffsetCollection:Ra};return _.type==="array"?Hn(v[_.value]||ni,_.length):v[_.type]})(t):void 0),d=l.parse(n,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?Ac(new Eu(d,t,a)):po(l.errors)}class Gn{constructor(t,a,l){this.kind=t,this._styleExpression=a,this.isStateDependent=t!=="constant"&&!Jo(a.expression),this.globalStateRefs=In(a.expression),this._globalState=l}evaluateWithoutErrorHandling(t,a,l,d,_,v){return this._globalState&&(t=gn(t,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(t,a,l,d,_,v)}evaluate(t,a,l,d,_,v){return this._globalState&&(t=gn(t,this._globalState)),this._styleExpression.evaluate(t,a,l,d,_,v)}}class Ns{constructor(t,a,l,d,_){this.kind=t,this.zoomStops=l,this._styleExpression=a,this.isStateDependent=t!=="camera"&&!Jo(a.expression),this.globalStateRefs=In(a.expression),this.interpolationType=d,this._globalState=_}evaluateWithoutErrorHandling(t,a,l,d,_,v){return this._globalState&&(t=gn(t,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(t,a,l,d,_,v)}evaluate(t,a,l,d,_,v){return this._globalState&&(t=gn(t,this._globalState)),this._styleExpression.evaluate(t,a,l,d,_,v)}interpolationFactor(t,a,l){return this.interpolationType?nn.interpolationFactor(this.interpolationType,t,a,l):0}}function go(n,t,a){const l=zc(n,t,a);if(l.result==="error")return l;const d=l.value.expression,_=Os(d);if(!_&&!Ar(t))return po([new Zn("","data expressions not supported")]);const v=el(d,["zoom"]);if(!v&&!Mh(t))return po([new Zn("","zoom expressions not supported")]);const b=_o(d);return b||v?b instanceof Zn?po([b]):b instanceof nn&&!mo(t)?po([new Zn("",'"interpolate" expressions cannot be used with this property')]):Ac(b?new Ns(_?"camera":"composite",l.value,b.labels,b instanceof nn?b.interpolation:void 0,a):new Gn(_?"constant":"source",l.value,a)):po([new Zn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class il{constructor(t,a){this._parameters=t,this._specification=a,Gr(this,Pc(this._parameters,this._specification))}static deserialize(t){return new il(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function _o(n){let t=null;if(n instanceof co)t=_o(n.result);else if(n instanceof pu){for(const a of n.args)if(t=_o(a),t)break}else(n instanceof uo||n instanceof nn)&&n.input instanceof sr&&n.input.name==="zoom"&&(t=n);return t instanceof Zn||n.eachChild((a=>{const l=_o(a);l instanceof Zn?t=l:!t&&l?t=new Zn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&l&&t!==l&&(t=new Zn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function In(n,t=new Set){return n instanceof Cc&&t.add(n.key),n.eachChild((a=>{In(a,t)})),t}function gn(n,t){const{zoom:a,heatmapDensity:l,elevation:d,lineProgress:_,isSupportedScript:v,accumulated:b}=n??{};return{zoom:a,heatmapDensity:l,elevation:d,lineProgress:_,isSupportedScript:v,accumulated:b,globalState:t}}function Zr(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const t of n.slice(1))if(!Zr(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const _s={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Xn(n,t){if(n==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Zr(n)||(n=al(n));const a=zc(n,_s,t);if(a.result==="error")throw new Error(a.value.map((l=>`${l.key}: ${l.message}`)).join(", "));return{filter:(l,d,_)=>a.value.evaluate(l,d,{},_),needGeometry:Eh(n),getGlobalStateRefs:()=>In(a.value.expression)}}function js(n,t){return n<t?-1:n>t?1:0}function Eh(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let t=1;t<n.length;t++)if(Eh(n[t]))return!0;return!1}function al(n){if(!n)return!0;const t=n[0];return n.length<=1?t!=="any":t==="=="?Fl(n[1],n[2],"=="):t==="!="?Yi(Fl(n[1],n[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Fl(n[1],n[2],t):t==="any"?(a=n.slice(1),["any"].concat(a.map(al))):t==="all"?["all"].concat(n.slice(1).map(al)):t==="none"?["all"].concat(n.slice(1).map(al).map(Yi)):t==="in"?Ic(n[1],n.slice(2)):t==="!in"?Yi(Ic(n[1],n.slice(2))):t==="has"?Ha(n[1]):t!=="!has"||Yi(Ha(n[1]));var a}function Fl(n,t,a){switch(n){case"$type":return[`filter-type-${a}`,t];case"$id":return[`filter-id-${a}`,t];default:return[`filter-${a}`,n,t]}}function Ic(n,t){if(t.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((a=>typeof a!=typeof t[0]))?["filter-in-large",n,["literal",t.sort(js)]]:["filter-in-small",n,["literal",t]]}}function Ha(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Yi(n){return["!",n]}function Ti(n){const t=typeof n;if(t==="number"||t==="boolean"||t==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let d="[";for(const _ of n)d+=`${Ti(_)},`;return`${d}]`}const a=Object.keys(n).sort();let l="{";for(let d=0;d<a.length;d++)l+=`${JSON.stringify(a[d])}:${Ti(n[a[d]])},`;return`${l}}`}function $r(n){let t="";for(const a of _i)t+=`/${Ti(n[a])}`;return t}function ur(n){const t=n.value;return t?[new st(n.key,t,"constants have been deprecated as of v8")]:[]}function Ta(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Yn(n){if(Array.isArray(n))return n.map(Yn);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const t={};for(const a in n)t[a]=Yn(n[a]);return t}return Ta(n)}function hr(n){const t=n.key,a=n.value,l=n.valueSpec||{},d=n.objectElementValidators||{},_=n.style,v=n.styleSpec,b=n.validateSpec;let S=[];const I=ui(a);if(I!=="object")return[new st(t,a,`object expected, ${I} found`)];for(const R in a){const O=R.split(".")[0],U=Pl(l,O)||l["*"];let V;if(Pl(d,O))V=d[O];else if(Pl(l,O))V=b;else if(d["*"])V=d["*"];else{if(!l["*"]){S.push(new st(t,a[R],`unknown property "${R}"`));continue}V=b}S=S.concat(V({key:(t&&`${t}.`)+R,value:a[R],valueSpec:U,style:_,styleSpec:v,object:a,objectKey:R,validateSpec:b},a))}for(const R in l)d[R]||l[R].required&&l[R].default===void 0&&a[R]===void 0&&S.push(new st(t,a,`missing required property "${R}"`));return S}function Cu(n){const t=n.value,a=n.valueSpec,l=n.style,d=n.styleSpec,_=n.key,v=n.arrayElementValidator||n.validateSpec;if(ui(t)!=="array")return[new st(_,t,`array expected, ${ui(t)} found`)];if(a.length&&t.length!==a.length)return[new st(_,t,`array length ${a.length} expected, length ${t.length} found`)];if(a["min-length"]&&t.length<a["min-length"])return[new st(_,t,`array length at least ${a["min-length"]} expected, length ${t.length} found`)];let b={type:a.value,values:a.values};d.$version<7&&(b.function=a.function),ui(a.value)==="object"&&(b=a.value);let S=[];for(let I=0;I<t.length;I++)S=S.concat(v({array:t,arrayIndex:I,value:t[I],valueSpec:b,validateSpec:n.validateSpec,style:l,styleSpec:d,key:`${_}[${I}]`}));return S}function Fs(n){const t=n.key,a=n.value,l=n.valueSpec;let d=ui(a);return d==="number"&&a!=a&&(d="NaN"),d!=="number"?[new st(t,a,`number expected, ${d} found`)]:"minimum"in l&&a<l.minimum?[new st(t,a,`${a} is less than the minimum value ${l.minimum}`)]:"maximum"in l&&a>l.maximum?[new st(t,a,`${a} is greater than the maximum value ${l.maximum}`)]:[]}function Gs(n){const t=n.valueSpec,a=Ta(n.value.type);let l,d,_,v={};const b=a!=="categorical"&&n.value.property===void 0,S=!b,I=ui(n.value.stops)==="array"&&ui(n.value.stops[0])==="array"&&ui(n.value.stops[0][0])==="object",R=hr({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(V){if(a==="identity")return[new st(V.key,V.value,'identity function may not have a "stops" property')];let Z=[];const Y=V.value;return Z=Z.concat(Cu({key:V.key,value:Y,valueSpec:V.valueSpec,validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:O})),ui(Y)==="array"&&Y.length===0&&Z.push(new st(V.key,Y,"array must have at least one stop")),Z},default:function(V){return V.validateSpec({key:V.key,value:V.value,valueSpec:t,validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec})}}});return a==="identity"&&b&&R.push(new st(n.key,n.value,'missing required property "property"')),a==="identity"||n.value.stops||R.push(new st(n.key,n.value,'missing required property "stops"')),a==="exponential"&&n.valueSpec.expression&&!mo(n.valueSpec)&&R.push(new st(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(S&&!Ar(n.valueSpec)?R.push(new st(n.key,n.value,"property functions not supported")):b&&!Mh(n.valueSpec)&&R.push(new st(n.key,n.value,"zoom functions not supported"))),a!=="categorical"&&!I||n.value.property!==void 0||R.push(new st(n.key,n.value,'"property" property is required')),R;function O(V){let Z=[];const Y=V.value,ie=V.key;if(ui(Y)!=="array")return[new st(ie,Y,`array expected, ${ui(Y)} found`)];if(Y.length!==2)return[new st(ie,Y,`array length 2 expected, length ${Y.length} found`)];if(I){if(ui(Y[0])!=="object")return[new st(ie,Y,`object expected, ${ui(Y[0])} found`)];if(Y[0].zoom===void 0)return[new st(ie,Y,"object stop key must have zoom")];if(Y[0].value===void 0)return[new st(ie,Y,"object stop key must have value")];if(_&&_>Ta(Y[0].zoom))return[new st(ie,Y[0].zoom,"stop zoom values must appear in ascending order")];Ta(Y[0].zoom)!==_&&(_=Ta(Y[0].zoom),d=void 0,v={}),Z=Z.concat(hr({key:`${ie}[0]`,value:Y[0],valueSpec:{zoom:{}},validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:Fs,value:U}}))}else Z=Z.concat(U({key:`${ie}[0]`,value:Y[0],validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec},Y));return jl(Yn(Y[1]))?Z.concat([new st(`${ie}[1]`,Y[1],"expressions are not allowed in function stops.")]):Z.concat(V.validateSpec({key:`${ie}[1]`,value:Y[1],valueSpec:t,validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec}))}function U(V,Z){const Y=ui(V.value),ie=Ta(V.value),se=V.value!==null?V.value:Z;if(l){if(Y!==l)return[new st(V.key,se,`${Y} stop domain type must match previous stop domain type ${l}`)]}else l=Y;if(Y!=="number"&&Y!=="string"&&Y!=="boolean")return[new st(V.key,se,"stop domain value must be a number, string, or boolean")];if(Y!=="number"&&a!=="categorical"){let Ee=`number expected, ${Y} found`;return Ar(t)&&a===void 0&&(Ee+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new st(V.key,se,Ee)]}return a!=="categorical"||Y!=="number"||isFinite(ie)&&Math.floor(ie)===ie?a!=="categorical"&&Y==="number"&&d!==void 0&&ie<d?[new st(V.key,se,"stop domain values must appear in ascending order")]:(d=ie,a==="categorical"&&ie in v?[new st(V.key,se,"stop domain values must be unique")]:(v[ie]=!0,[])):[new st(V.key,se,`integer expected, found ${ie}`)]}}function Us(n){const t=(n.expressionContext==="property"?go:zc)(Yn(n.value),n.valueSpec);if(t.result==="error")return t.value.map((l=>new st(`${n.key}${l.key}`,n.value,l.message)));const a=t.value.expression||t.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!a.outputDefined())return[new st(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!Jo(a))return[new st(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!Jo(a))return[new st(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!el(a,["zoom","feature-state"]))return[new st(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!Os(a))return[new st(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ys(n){const t=n.key,a=n.value,l=ui(a);return l!=="string"?[new st(t,a,`color expected, ${l} found`)]:hi.parse(String(a))?[]:[new st(t,a,`color expected, "${a}" found`)]}function nl(n){const t=n.key,a=n.value,l=n.valueSpec,d=[];return Array.isArray(l.values)?l.values.indexOf(Ta(a))===-1&&d.push(new st(t,a,`expected one of [${l.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(l.values).indexOf(Ta(a))===-1&&d.push(new st(t,a,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(a)} found`)),d}function vs(n){return Zr(Yn(n.value))?Us(Gr({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Hr(n)}function Hr(n){const t=n.value,a=n.key;if(ui(t)!=="array")return[new st(a,t,`array expected, ${ui(t)} found`)];const l=n.styleSpec;let d,_=[];if(t.length<1)return[new st(a,t,"filter array must have at least 1 element")];switch(_=_.concat(nl({key:`${a}[0]`,value:t[0],valueSpec:l.filter_operator,style:n.style,styleSpec:n.styleSpec})),Ta(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Ta(t[1])==="$type"&&_.push(new st(a,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&_.push(new st(a,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(d=ui(t[1]),d!=="string"&&_.push(new st(`${a}[1]`,t[1],`string expected, ${d} found`)));for(let v=2;v<t.length;v++)d=ui(t[v]),Ta(t[1])==="$type"?_=_.concat(nl({key:`${a}[${v}]`,value:t[v],valueSpec:l.geometry_type,style:n.style,styleSpec:n.styleSpec})):d!=="string"&&d!=="number"&&d!=="boolean"&&_.push(new st(`${a}[${v}]`,t[v],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let v=1;v<t.length;v++)_=_.concat(Hr({key:`${a}[${v}]`,value:t[v],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":d=ui(t[1]),t.length!==2?_.push(new st(a,t,`filter array for "${t[0]}" operator must have 2 elements`)):d!=="string"&&_.push(new st(`${a}[1]`,t[1],`string expected, ${d} found`))}return _}function Vs(n,t){const a=n.key,l=n.validateSpec,d=n.style,_=n.styleSpec,v=n.value,b=n.objectKey,S=_[`${t}_${n.layerType}`];if(!S)return[];const I=b.match(/^(.*)-transition$/);if(t==="paint"&&I&&S[I[1]]&&S[I[1]].transition)return l({key:a,value:v,valueSpec:_.transition,style:d,styleSpec:_});const R=n.valueSpec||S[b];if(!R)return[new st(a,v,`unknown property "${b}"`)];let O;if(ui(v)==="string"&&Ar(R)&&!R.tokens&&(O=/^{([^}]+)}$/.exec(v)))return[new st(a,v,`"${b}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(O[1])} }\`.`)];const U=[];return n.layerType==="symbol"&&(b==="text-field"&&d&&!d.glyphs&&U.push(new st(a,v,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&Tu(Yn(v))&&Ta(v.type)==="identity"&&U.push(new st(a,v,'"text-font" does not support identity functions'))),U.concat(l({key:n.key,value:v,valueSpec:R,style:d,styleSpec:_,expressionContext:"property",propertyType:t,propertyKey:b}))}function Xr(n){return Vs(n,"paint")}function Rc(n){return Vs(n,"layout")}function yo(n){let t=[];const a=n.value,l=n.key,d=n.style,_=n.styleSpec;if(ui(a)!=="object")return[new st(l,a,`object expected, ${ui(a)} found`)];a.type||a.ref||t.push(new st(l,a,'either "type" or "ref" is required'));let v=Ta(a.type);const b=Ta(a.ref);if(a.id){const S=Ta(a.id);for(let I=0;I<n.arrayIndex;I++){const R=d.layers[I];Ta(R.id)===S&&t.push(new st(l,a.id,`duplicate layer id "${a.id}", previously used at line ${R.id.__line__}`))}}if("ref"in a){let S;["type","source","source-layer","filter","layout"].forEach((I=>{I in a&&t.push(new st(l,a[I],`"${I}" is prohibited for ref layers`))})),d.layers.forEach((I=>{Ta(I.id)===b&&(S=I)})),S?S.ref?t.push(new st(l,a.ref,"ref cannot reference another ref layer")):v=Ta(S.type):t.push(new st(l,a.ref,`ref layer "${b}" not found`))}else if(v!=="background")if(a.source){const S=d.sources&&d.sources[a.source],I=S&&Ta(S.type);S?I==="vector"&&v==="raster"?t.push(new st(l,a.source,`layer "${a.id}" requires a raster source`)):I!=="raster-dem"&&v==="hillshade"||I!=="raster-dem"&&v==="color-relief"?t.push(new st(l,a.source,`layer "${a.id}" requires a raster-dem source`)):I==="raster"&&v!=="raster"?t.push(new st(l,a.source,`layer "${a.id}" requires a vector source`)):I!=="vector"||a["source-layer"]?I==="raster-dem"&&v!=="hillshade"&&v!=="color-relief"?t.push(new st(l,a.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):v!=="line"||!a.paint||!a.paint["line-gradient"]||I==="geojson"&&S.lineMetrics||t.push(new st(l,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new st(l,a,`layer "${a.id}" must specify a "source-layer"`)):t.push(new st(l,a.source,`source "${a.source}" not found`))}else t.push(new st(l,a,'missing required property "source"'));return t=t.concat(hr({key:l,value:a,valueSpec:_.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${l}.type`,value:a.type,valueSpec:_.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:a,objectKey:"type"}),filter:vs,layout:S=>hr({layer:a,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":I=>Rc(Gr({layerType:v},I))}}),paint:S=>hr({layer:a,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":I=>Xr(Gr({layerType:v},I))}})}})),t}function Pr(n){const t=n.value,a=n.key,l=ui(t);return l!=="string"?[new st(a,t,`string expected, ${l} found`)]:[]}const Dc={promoteId:function({key:n,value:t}){if(ui(t)==="string")return Pr({key:n,value:t});{const a=[];for(const l in t)a.push(...Pr({key:`${n}.${l}`,value:t[l]}));return a}}};function vo(n){const t=n.value,a=n.key,l=n.styleSpec,d=n.style,_=n.validateSpec;if(!t.type)return[new st(a,t,'"type" is required')];const v=Ta(t.type);let b;switch(v){case"vector":case"raster":return b=hr({key:a,value:t,valueSpec:l[`source_${v.replace("-","_")}`],style:n.style,styleSpec:l,objectElementValidators:Dc,validateSpec:_}),b;case"raster-dem":return b=(function(S){var I;const R=(I=S.sourceName)!==null&&I!==void 0?I:"",O=S.value,U=S.styleSpec,V=U.source_raster_dem,Z=S.style;let Y=[];const ie=ui(O);if(O===void 0)return Y;if(ie!=="object")return Y.push(new st("source_raster_dem",O,`object expected, ${ie} found`)),Y;const se=Ta(O.encoding)==="custom",Ee=["redFactor","greenFactor","blueFactor","baseShift"],de=S.value.encoding?`"${S.value.encoding}"`:"Default";for(const ge in O)!se&&Ee.includes(ge)?Y.push(new st(ge,O[ge],`In "${R}": "${ge}" is only valid when "encoding" is set to "custom". ${de} encoding found`)):V[ge]?Y=Y.concat(S.validateSpec({key:ge,value:O[ge],valueSpec:V[ge],validateSpec:S.validateSpec,style:Z,styleSpec:U})):Y.push(new st(ge,O[ge],`unknown property "${ge}"`));return Y})({sourceName:a,value:t,style:n.style,styleSpec:l,validateSpec:_}),b;case"geojson":if(b=hr({key:a,value:t,valueSpec:l.source_geojson,style:d,styleSpec:l,validateSpec:_,objectElementValidators:Dc}),t.cluster)for(const S in t.clusterProperties){const[I,R]=t.clusterProperties[S],O=typeof I=="string"?[I,["accumulated"],["get",S]]:I;b.push(...Us({key:`${a}.${S}.map`,value:R,expressionContext:"cluster-map"})),b.push(...Us({key:`${a}.${S}.reduce`,value:O,expressionContext:"cluster-reduce"}))}return b;case"video":return hr({key:a,value:t,valueSpec:l.source_video,style:d,validateSpec:_,styleSpec:l});case"image":return hr({key:a,value:t,valueSpec:l.source_image,style:d,validateSpec:_,styleSpec:l});case"canvas":return[new st(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return nl({key:`${a}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function _n(n){const t=n.value,a=n.styleSpec,l=a.light,d=n.style;let _=[];const v=ui(t);if(t===void 0)return _;if(v!=="object")return _=_.concat([new st("light",t,`object expected, ${v} found`)]),_;for(const b in t){const S=b.match(/^(.*)-transition$/);_=_.concat(S&&l[S[1]]&&l[S[1]].transition?n.validateSpec({key:b,value:t[b],valueSpec:a.transition,validateSpec:n.validateSpec,style:d,styleSpec:a}):l[b]?n.validateSpec({key:b,value:t[b],valueSpec:l[b],validateSpec:n.validateSpec,style:d,styleSpec:a}):[new st(b,t[b],`unknown property "${b}"`)])}return _}function kc(n){const t=n.value,a=n.styleSpec,l=a.sky,d=n.style,_=ui(t);if(t===void 0)return[];if(_!=="object")return[new st("sky",t,`object expected, ${_} found`)];let v=[];for(const b in t)v=v.concat(l[b]?n.validateSpec({key:b,value:t[b],valueSpec:l[b],style:d,styleSpec:a}):[new st(b,t[b],`unknown property "${b}"`)]);return v}function Ch(n){const t=n.value,a=n.styleSpec,l=a.terrain,d=n.style;let _=[];const v=ui(t);if(t===void 0)return _;if(v!=="object")return _=_.concat([new st("terrain",t,`object expected, ${v} found`)]),_;for(const b in t)_=_.concat(l[b]?n.validateSpec({key:b,value:t[b],valueSpec:l[b],validateSpec:n.validateSpec,style:d,styleSpec:a}):[new st(b,t[b],`unknown property "${b}"`)]);return _}function Gl(n){let t=[];const a=n.value,l=n.key;if(Array.isArray(a)){const d=[],_=[];for(const v in a)a[v].id&&d.includes(a[v].id)&&t.push(new st(l,a,`all the sprites' ids must be unique, but ${a[v].id} is duplicated`)),d.push(a[v].id),a[v].url&&_.includes(a[v].url)&&t.push(new st(l,a,`all the sprites' URLs must be unique, but ${a[v].url} is duplicated`)),_.push(a[v].url),t=t.concat(hr({key:`${l}[${v}]`,value:a[v],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return t}return Pr({key:l,value:a})}function Ul(n){return t=n.value,t&&t.constructor===Object?[]:[new st(n.key,n.value,`object expected, ${ui(n.value)} found`)];var t}const Wn={"*":()=>[],array:Cu,boolean:function(n){const t=n.value,a=n.key,l=ui(t);return l!=="boolean"?[new st(a,t,`boolean expected, ${l} found`)]:[]},number:Fs,color:ys,constants:ur,enum:nl,filter:vs,function:Gs,layer:yo,object:hr,source:vo,light:_n,sky:kc,terrain:Ch,projection:function(n){const t=n.value,a=n.styleSpec,l=a.projection,d=n.style,_=ui(t);if(t===void 0)return[];if(_!=="object")return[new st("projection",t,`object expected, ${_} found`)];let v=[];for(const b in t)v=v.concat(l[b]?n.validateSpec({key:b,value:t[b],valueSpec:l[b],style:d,styleSpec:a}):[new st(b,t[b],`unknown property "${b}"`)]);return v},projectionDefinition:function(n){const t=n.key;let a=n.value;a=a instanceof String?a.valueOf():a;const l=ui(a);return l!=="array"||(function(d){return Array.isArray(d)&&d.length===3&&typeof d[0]=="string"&&typeof d[1]=="string"&&typeof d[2]=="number"})(a)||(function(d){return!!["interpolate","step","literal"].includes(d[0])})(a)?["array","string"].includes(l)?[]:[new st(t,a,`projection expected, invalid type "${l}" found`)]:[new st(t,a,`projection expected, invalid array ${JSON.stringify(a)} found`)]},string:Pr,formatted:function(n){return Pr(n).length===0?[]:Us(n)},resolvedImage:function(n){return Pr(n).length===0?[]:Us(n)},padding:function(n){const t=n.key,a=n.value;if(ui(a)==="array"){if(a.length<1||a.length>4)return[new st(t,a,`padding requires 1 to 4 values; ${a.length} values found`)];const l={type:"number"};let d=[];for(let _=0;_<a.length;_++)d=d.concat(n.validateSpec({key:`${t}[${_}]`,value:a[_],validateSpec:n.validateSpec,valueSpec:l}));return d}return Fs({key:t,value:a,valueSpec:{}})},numberArray:function(n){const t=n.key,a=n.value;if(ui(a)==="array"){const l={type:"number"};if(a.length<1)return[new st(t,a,"array length at least 1 expected, length 0 found")];let d=[];for(let _=0;_<a.length;_++)d=d.concat(n.validateSpec({key:`${t}[${_}]`,value:a[_],validateSpec:n.validateSpec,valueSpec:l}));return d}return Fs({key:t,value:a,valueSpec:{}})},colorArray:function(n){const t=n.key,a=n.value;if(ui(a)==="array"){if(a.length<1)return[new st(t,a,"array length at least 1 expected, length 0 found")];let l=[];for(let d=0;d<a.length;d++)l=l.concat(ys({key:`${t}[${d}]`,value:a[d]}));return l}return ys({key:t,value:a})},variableAnchorOffsetCollection:function(n){const t=n.key,a=n.value,l=ui(a),d=n.styleSpec;if(l!=="array"||a.length<1||a.length%2!=0)return[new st(t,a,"variableAnchorOffsetCollection requires a non-empty array of even length")];let _=[];for(let v=0;v<a.length;v+=2)_=_.concat(nl({key:`${t}[${v}]`,value:a[v],valueSpec:d.layout_symbol["text-anchor"]})),_=_.concat(Cu({key:`${t}[${v+1}]`,value:a[v+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:d}));return _},sprite:Gl,state:Ul};function oa(n){const t=n.value,a=n.valueSpec,l=n.styleSpec;return n.validateSpec=oa,a.expression&&Tu(Ta(t))?Gs(n):a.expression&&jl(Yn(t))?Us(n):a.type&&Wn[a.type]?Wn[a.type](n):hr(Gr({},n,{valueSpec:a.type?l[a.type]:a}))}function Lc(n){const t=n.value,a=n.key,l=Pr(n);return l.length||(t.indexOf("{fontstack}")===-1&&l.push(new st(a,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&l.push(new st(a,t,'"glyphs" url must include a "{range}" token'))),l}function Rn(n,t=Pe){let a=[];return a=a.concat(oa({key:"",value:n,valueSpec:t.$root,styleSpec:t,style:n,validateSpec:oa,objectElementValidators:{glyphs:Lc,"*":()=>[]}})),n.constants&&(a=a.concat(ur({key:"constants",value:n.constants}))),xo(a)}function Un(n){return function(t){return n(Object.assign({},t,{validateSpec:oa}))}}function xo(n){return[].concat(n).sort(((t,a)=>t.line-a.line))}function Sn(n){return function(...t){return xo(n.apply(this,t))}}Rn.source=Sn(Un(vo)),Rn.sprite=Sn(Un(Gl)),Rn.glyphs=Sn(Un(Lc)),Rn.light=Sn(Un(_n)),Rn.sky=Sn(Un(kc)),Rn.terrain=Sn(Un(Ch)),Rn.state=Sn(Un(Ul)),Rn.layer=Sn(Un(yo)),Rn.filter=Sn(Un(vs)),Rn.paintProperty=Sn(Un(Xr)),Rn.layoutProperty=Sn(Un(Rc));const dr=Rn,bf=dr.light,Au=dr.sky,wf=dr.paintProperty,Vl=dr.layoutProperty;function bo(n,t){let a=!1;if(t&&t.length)for(const l of t)n.fire(new zt(new Error(l.message))),a=!0;return a}class rl{constructor(t,a,l){const d=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const v=new Int32Array(this.arrayBuffer);t=v[0],this.d=(a=v[1])+2*(l=v[2]);for(let S=0;S<this.d*this.d;S++){const I=v[3+S],R=v[3+S+1];d.push(I===R?null:v.subarray(I,R))}const b=v[3+d.length+1];this.keys=v.subarray(v[3+d.length],b),this.bboxes=v.subarray(b),this.insert=this._insertReadonly}else{this.d=a+2*l;for(let v=0;v<this.d*this.d;v++)d.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=t,this.padding=l,this.scale=a/t,this.uid=0;const _=l/a*t;this.min=-_,this.max=t+_}insert(t,a,l,d,_){this._forEachCell(a,l,d,_,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(a),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(_)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,a,l,d,_,v){this.cells[_].push(v)}query(t,a,l,d,_){const v=this.min,b=this.max;if(t<=v&&a<=v&&b<=l&&b<=d&&!_)return Array.prototype.slice.call(this.keys);{const S=[];return this._forEachCell(t,a,l,d,this._queryCell,S,{},_),S}}_queryCell(t,a,l,d,_,v,b,S){const I=this.cells[_];if(I!==null){const R=this.keys,O=this.bboxes;for(let U=0;U<I.length;U++){const V=I[U];if(b[V]===void 0){const Z=4*V;(S?S(O[Z+0],O[Z+1],O[Z+2],O[Z+3]):t<=O[Z+2]&&a<=O[Z+3]&&l>=O[Z+0]&&d>=O[Z+1])?(b[V]=!0,v.push(R[V])):b[V]=!1}}}}_forEachCell(t,a,l,d,_,v,b,S){const I=this._convertToCellCoord(t),R=this._convertToCellCoord(a),O=this._convertToCellCoord(l),U=this._convertToCellCoord(d);for(let V=I;V<=O;V++)for(let Z=R;Z<=U;Z++){const Y=this.d*Z+V;if((!S||S(this._convertFromCellCoord(V),this._convertFromCellCoord(Z),this._convertFromCellCoord(V+1),this._convertFromCellCoord(Z+1)))&&_.call(this,t,a,l,d,Y,v,b,S))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,a=3+this.cells.length+1+1;let l=0;for(let v=0;v<this.cells.length;v++)l+=this.cells[v].length;const d=new Int32Array(a+l+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;let _=a;for(let v=0;v<t.length;v++){const b=t[v];d[3+v]=_,d.set(b,_),_+=b.length}return d[3+t.length]=_,d.set(this.keys,_),_+=this.keys.length,d[3+t.length+1]=_,d.set(this.bboxes,_),_+=this.bboxes.length,d.buffer}static serialize(t,a){const l=t.toArrayBuffer();return a&&a.push(l),{buffer:l}}static deserialize(t){return new rl(t.buffer)}}const zr={};function Tt(n,t,a={}){if(zr[n])throw new Error(`${n} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:n,writeable:!1}),zr[n]={klass:t,omit:a.omit||[],shallow:a.shallow||[]}}Tt("Object",Object),Tt("Set",Set),Tt("TransferableGridIndex",rl),Tt("Color",hi),Tt("Error",Error),Tt("AJAXError",fe),Tt("ResolvedImage",Nn),Tt("StylePropertyFunction",il),Tt("StyleExpression",Eu,{omit:["_evaluator"]}),Tt("ZoomDependentExpression",Ns),Tt("ZoomConstantExpression",Gn),Tt("CompoundExpression",sr,{omit:["_evaluate"]});for(const n in Nl)Nl[n]._classRegistryKey||Tt(`Expression_${n}`,Nl[n]);function sl(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Oc(n){return n.$name||n.constructor._classRegistryKey}function wo(n){return!(function(t){if(t===null||typeof t!="object")return!1;const a=Oc(t);return!(!a||a==="Object")})(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||sl(n)||gi(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function So(n,t){if(wo(n))return(sl(n)||gi(n))&&t&&t.push(n),ArrayBuffer.isView(n)&&t&&t.push(n.buffer),n instanceof ImageData&&t&&t.push(n.data.buffer),n;if(Array.isArray(n)){const _=[];for(const v of n)_.push(So(v,t));return _}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);const a=Oc(n);if(!a)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!zr[a])throw new Error(`${a} is not registered.`);const{klass:l}=zr[a],d=l.serialize?l.serialize(n,t):{};if(l.serialize){if(t&&d===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const _ in n){if(!n.hasOwnProperty(_)||zr[a].omit.indexOf(_)>=0)continue;const v=n[_];d[_]=zr[a].shallow.indexOf(_)>=0?v:So(v,t)}n instanceof Error&&(d.message=n.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(d.$name=a),d}function Mo(n){if(wo(n))return n;if(Array.isArray(n))return n.map(Mo);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);const t=Oc(n)||"Object";if(!zr[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:a}=zr[t];if(!a)throw new Error(`can't deserialize unregistered class ${t}`);if(a.deserialize)return a.deserialize(n);const l=Object.create(a.prototype);for(const d of Object.keys(n)){if(d==="$name")continue;const _=n[d];l[d]=zr[t].shallow.indexOf(d)>=0?_:Mo(_)}return l}class ol{constructor(){this.first=!0}update(t,a){const l=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=a):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=a),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=l,!0))}}const oi={"Latin-1 Supplement":n=>n>=128&&n<=255,"Hangul Jamo":n=>n>=4352&&n<=4607,Khmer:n=>n>=6016&&n<=6143,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Kanbun:n=>n>=12688&&n<=12703,"CJK Strokes":n=>n>=12736&&n<=12783,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Hangul Syllables":n=>n>=44032&&n<=55215,"Private Use Area":n=>n>=57344&&n<=63743,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function xs(n){for(const t of n)if(Eo(t.charCodeAt(0)))return!0;return!1}function Ah(n){for(const t of n)if(!ql(t.charCodeAt(0)))return!1;return!0}function Bc(n){const t=n.map((a=>{try{return new RegExp(`\\p{sc=${a}}`,"u").source}catch{return null}})).filter((a=>a));return new RegExp(t.join("|"),"u")}const To=Bc(["Arab","Dupl","Mong","Ougr","Syrc"]);function ql(n){return!To.test(String.fromCodePoint(n))}const Nc=Bc(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Eo(n){return!(n!==746&&n!==747&&(n<4352||!(oi["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||oi["CJK Compatibility"](n)||oi["CJK Strokes"](n)||!(!oi["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||oi["Enclosed CJK Letters and Months"](n)||oi["Ideographic Description Characters"](n)||oi.Kanbun(n)||oi.Katakana(n)&&n!==12540||!(!oi["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!oi["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||oi["Vertical Forms"](n)||oi["Yijing Hexagram Symbols"](n)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(n))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(n))||Nc.test(String.fromCodePoint(n)))))}function jc(n){return!(Eo(n)||(function(t){return!!(oi["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||oi["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||oi["Letterlike Symbols"](t)||oi["Number Forms"](t)||oi["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||oi["Control Pictures"](t)&&t!==9251||oi["Optical Character Recognition"](t)||oi["Enclosed Alphanumerics"](t)||oi["Geometric Shapes"](t)||oi["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||oi["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||oi["CJK Symbols and Punctuation"](t)||oi.Katakana(t)||oi["Private Use Area"](t)||oi["CJK Compatibility Forms"](t)||oi["Small Form Variants"](t)||oi["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)})(n))}const Ph=Bc(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Co(n){return Ph.test(String.fromCodePoint(n))}function zh(n,t){return!(!t&&Co(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||oi.Khmer(n))}function qs(n){for(const t of n)if(Co(t.charCodeAt(0)))return!0;return!1}const bs=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){if(bs.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(n,t){return o(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(n.pluginStatus!=="loading")return this.setState(n),n;const a=n.pluginURL,l=new Promise((_=>{this.loadScriptResolve=_}));t(a);const d=new Promise((_=>setTimeout((()=>_()),this.TIMEOUT)));if(yield Promise.race([l,d]),this.isParsed()){const _={pluginStatus:"loaded",pluginURL:a};return this.setState(_),_}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${a}`)}))}};class Wi{constructor(t,a){this.isSupportedScript=Zs,this.zoom=t,a?(this.now=a.now||0,this.fadeDuration=a.fadeDuration||0,this.zoomHistory=a.zoomHistory||new ol,this.transition=a.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ol,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,a=t-Math.floor(t),l=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:a+(1-a)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*a}}}function Zs(n){return(function(t,a){for(const l of t)if(!zh(l.charCodeAt(0),a))return!1;return!0})(n,bs.getRTLTextPluginStatus()==="loaded")}class Ir{constructor(t,a,l){this.property=t,this.value=a,this.expression=(function(d,_,v){if(Tu(d))return new il(d,_);if(jl(d)){const b=go(d,_,v);if(b.result==="error")throw new Error(b.value.map((S=>`${S.key}: ${S.message}`)).join(", "));return b.value}{let b=d;return _.type==="color"&&typeof d=="string"?b=hi.parse(d):_.type!=="padding"||typeof d!="number"&&!Array.isArray(d)?_.type!=="numberArray"||typeof d!="number"&&!Array.isArray(d)?_.type!=="colorArray"||typeof d!="string"&&!Array.isArray(d)?_.type==="variableAnchorOffsetCollection"&&Array.isArray(d)?b=Ia.parse(d):_.type==="projectionDefinition"&&typeof d=="string"&&(b=fn.parse(d)):b=an.parse(d):b=tn.parse(d):b=Da.parse(d),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>b}}})(a===void 0?t.specification.default:a,t.specification,l)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(t,a,l){return this.property.possiblyEvaluate(this,t,a,l)}}class Ao{constructor(t,a){this.property=t,this.value=new Ir(t,void 0,a)}transitioned(t,a){return new ll(this.property,this.value,a,Ut({},t.transition,this.transition),t.now)}untransitioned(){return new ll(this.property,this.value,null,{},0)}}class Fc{constructor(t,a){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._globalState=a}getValue(t){return mi(this._values[t].value.value)}setValue(t,a){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Ao(this._values[t].property,this._globalState)),this._values[t].value=new Ir(this._values[t].property,a===null?void 0:mi(a),this._globalState)}getTransition(t){return mi(this._values[t].transition)}setTransition(t,a){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Ao(this._values[t].property,this._globalState)),this._values[t].transition=mi(a)||void 0}serialize(){const t={};for(const a of Object.keys(this._values)){const l=this.getValue(a);l!==void 0&&(t[a]=l);const d=this.getTransition(a);d!==void 0&&(t[`${a}-transition`]=d)}return t}transitioned(t,a){const l=new Zl(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].transitioned(t,a._values[d]);return l}untransitioned(){const t=new Zl(this._properties);for(const a of Object.keys(this._values))t._values[a]=this._values[a].untransitioned();return t}}class ll{constructor(t,a,l,d,_){this.property=t,this.value=a,this.begin=_+d.delay||0,this.end=this.begin+d.duration||0,t.specification.transition&&(d.delay||d.duration)&&(this.prior=l)}possiblyEvaluate(t,a,l){const d=t.now||0,_=this.value.possiblyEvaluate(t,a,l),v=this.prior;if(v){if(d>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(d<this.begin)return v.possiblyEvaluate(t,a,l);{const b=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(t,a,l),_,We(b))}}return _}}class Zl{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,a,l){const d=new Gc(this._properties);for(const _ of Object.keys(this._values))d._values[_]=this._values[_].possiblyEvaluate(t,a,l);return d}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class cl{constructor(t,a){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._globalState=a}hasValue(t){return this._values[t].value!==void 0}getValue(t){return mi(this._values[t].value)}setValue(t,a){this._values[t]=new Ir(this._values[t].property,a===null?void 0:mi(a),this._globalState)}serialize(){const t={};for(const a of Object.keys(this._values)){const l=this.getValue(a);l!==void 0&&(t[a]=l)}return t}possiblyEvaluate(t,a,l){const d=new Gc(this._properties);for(const _ of Object.keys(this._values))d._values[_]=this._values[_].possiblyEvaluate(t,a,l);return d}}class Yr{constructor(t,a,l){this.property=t,this.value=a,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,a,l,d){return this.property.evaluate(this.value,this.parameters,t,a,l,d)}}class Gc{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Pt{constructor(t){this.specification=t}possiblyEvaluate(t,a){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(a)}interpolate(t,a,l){const d=Er[this.specification.type];return d?d(t,a,l):t}}class qt{constructor(t,a){this.specification=t,this.overrides=a}possiblyEvaluate(t,a,l,d){return new Yr(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(a,null,{},l,d)}:t.expression,a)}interpolate(t,a,l){if(t.value.kind!=="constant"||a.value.kind!=="constant")return t;if(t.value.value===void 0||a.value.value===void 0)return new Yr(this,{kind:"constant",value:void 0},t.parameters);const d=Er[this.specification.type];if(d){const _=d(t.value.value,a.value.value,l);return new Yr(this,{kind:"constant",value:_},t.parameters)}return t}evaluate(t,a,l,d,_,v){return t.kind==="constant"?t.value:t.evaluate(a,l,d,_,v)}}class ul extends qt{possiblyEvaluate(t,a,l,d){if(t.value===void 0)return new Yr(this,{kind:"constant",value:void 0},a);if(t.expression.kind==="constant"){const _=t.expression.evaluate(a,null,{},l,d),v=t.property.specification.type==="resolvedImage"&&typeof _!="string"?_.name:_,b=this._calculate(v,v,v,a);return new Yr(this,{kind:"constant",value:b},a)}if(t.expression.kind==="camera"){const _=this._calculate(t.expression.evaluate({zoom:a.zoom-1}),t.expression.evaluate({zoom:a.zoom}),t.expression.evaluate({zoom:a.zoom+1}),a);return new Yr(this,{kind:"constant",value:_},a)}return new Yr(this,t.expression,a)}evaluate(t,a,l,d,_,v){if(t.kind==="source"){const b=t.evaluate(a,l,d,_,v);return this._calculate(b,b,b,a)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(a.zoom)-1},l,d),t.evaluate({zoom:Math.floor(a.zoom)},l,d),t.evaluate({zoom:Math.floor(a.zoom)+1},l,d),a):t.value}_calculate(t,a,l,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:t,to:a}:{from:l,to:a}}interpolate(t){return t}}class Pu{constructor(t){this.specification=t}possiblyEvaluate(t,a,l,d){if(t.value!==void 0){if(t.expression.kind==="constant"){const _=t.expression.evaluate(a,null,{},l,d);return this._calculate(_,_,_,a)}return this._calculate(t.expression.evaluate(new Wi(Math.floor(a.zoom-1),a)),t.expression.evaluate(new Wi(Math.floor(a.zoom),a)),t.expression.evaluate(new Wi(Math.floor(a.zoom+1),a)),a)}}_calculate(t,a,l,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:t,to:a}:{from:l,to:a}}interpolate(t){return t}}class $l{constructor(t){this.specification=t}possiblyEvaluate(t,a,l,d){return!!t.expression.evaluate(a,null,{},l,d)}interpolate(){return!1}}class la{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const a in t){const l=t[a];l.specification.overridable&&this.overridableProperties.push(a);const d=this.defaultPropertyValues[a]=new Ir(l,void 0,void 0),_=this.defaultTransitionablePropertyValues[a]=new Ao(l,void 0);this.defaultTransitioningPropertyValues[a]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=d.possiblyEvaluate({})}}}Tt("DataDrivenProperty",qt),Tt("DataConstantProperty",Pt),Tt("CrossFadedDataDrivenProperty",ul),Tt("CrossFadedProperty",Pu),Tt("ColorRampProperty",$l);const fr="-transition";class yn extends Vt{constructor(t,a,l){if(super(),this.id=t.id,this.type=t.type,this._globalState=l,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter,this._featureFilter=Xn(t.filter,l)),a.layout&&(this._unevaluatedLayout=new cl(a.layout,l)),a.paint)){this._transitionablePaint=new Fc(a.paint,l);for(const d in t.paint)this.setPaintProperty(d,t.paint[d],{validate:!1});for(const d in t.layout)this.setLayoutProperty(d,t.layout[d],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Gc(a.paint)}}setFilter(t){this.filter=t,this._featureFilter=Xn(t,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}getLayoutAffectingGlobalStateRefs(){const t=new Set;if(this._unevaluatedLayout)for(const a in this._unevaluatedLayout._values){const l=this._unevaluatedLayout._values[a];for(const d of l.getGlobalStateRefs())t.add(d)}for(const a of this._featureFilter.getGlobalStateRefs())t.add(a);return t}getPaintAffectingGlobalStateRefs(){var t;const a=new globalThis.Map;if(this._transitionablePaint)for(const l in this._transitionablePaint._values){const d=this._transitionablePaint._values[l].value;for(const _ of d.getGlobalStateRefs()){const v=(t=a.get(_))!==null&&t!==void 0?t:[];v.push({name:l,value:d.value}),a.set(_,v)}}return a}setLayoutProperty(t,a,l={}){a!=null&&this._validate(Vl,`layers.${this.id}.layout.${t}`,t,a,l)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,a):this.visibility=a)}getPaintProperty(t){return t.endsWith(fr)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,a,l={}){if(a!=null&&this._validate(wf,`layers.${this.id}.paint.${t}`,t,a,l))return!1;if(t.endsWith(fr))return this._transitionablePaint.setTransition(t.slice(0,-11),a||void 0),!1;{const d=this._transitionablePaint._values[t],_=d.property.specification["property-type"]==="cross-faded-data-driven",v=d.value.isDataDriven(),b=d.value;this._transitionablePaint.setValue(t,a),this._handleSpecialPaintPropertyUpdate(t);const S=this._transitionablePaint._values[t].value;return S.isDataDriven()||v||_||this._handleOverridablePaintPropertyUpdate(t,b,S)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,a,l){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,a){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,a)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),ri(t,((a,l)=>!(a===void 0||l==="layout"&&!Object.keys(a).length||l==="paint"&&!Object.keys(a).length)))}_validate(t,a,l,d,_={}){return(!_||_.validate!==!1)&&bo(this,t.call(dr,{key:a,layerType:this.type,objectKey:l,value:d,styleSpec:Pe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const a=this.paint.get(t);if(a instanceof Yr&&Ar(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}return!1}}let $s;var Md={get paint(){return $s=$s||new la({"raster-opacity":new Pt(Pe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Pt(Pe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Pt(Pe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Pt(Pe.paint_raster["raster-brightness-max"]),"raster-saturation":new Pt(Pe.paint_raster["raster-saturation"]),"raster-contrast":new Pt(Pe.paint_raster["raster-contrast"]),"raster-resampling":new Pt(Pe.paint_raster["raster-resampling"]),"raster-fade-duration":new Pt(Pe.paint_raster["raster-fade-duration"])})}};class Po extends yn{constructor(t,a){super(t,Md,a)}}const pr={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class fa{constructor(t,a){this._structArray=t,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ca{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,a){return t._trim(),a&&(t.isTransferred=!0,a.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const a=Object.create(this.prototype);return a.arrayBuffer=t.arrayBuffer,a.length=t.length,a.capacity=t.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Qi(n,t=1){let a=0,l=0;return{members:n.map((d=>{const _=pr[d.type].BYTES_PER_ELEMENT,v=a=ti(a,Math.max(t,_)),b=d.components||1;return l=Math.max(l,_),a+=_*b,{name:d.name,type:d.type,components:b,offset:v}})),size:ti(a,Math.max(l,t)),alignment:t}}function ti(n,t){return Math.ceil(n/t)*t}class Fi extends ca{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a){const l=this.length;return this.resize(l+1),this.emplace(l,t,a)}emplace(t,a,l){const d=2*t;return this.int16[d+0]=a,this.int16[d+1]=l,t}}Fi.prototype.bytesPerElement=4,Tt("StructArrayLayout2i4",Fi);class va extends ca{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,l){const d=this.length;return this.resize(d+1),this.emplace(d,t,a,l)}emplace(t,a,l,d){const _=3*t;return this.int16[_+0]=a,this.int16[_+1]=l,this.int16[_+2]=d,t}}va.prototype.bytesPerElement=6,Tt("StructArrayLayout3i6",va);class hl extends ca{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,l,d){const _=this.length;return this.resize(_+1),this.emplace(_,t,a,l,d)}emplace(t,a,l,d,_){const v=4*t;return this.int16[v+0]=a,this.int16[v+1]=l,this.int16[v+2]=d,this.int16[v+3]=_,t}}hl.prototype.bytesPerElement=8,Tt("StructArrayLayout4i8",hl);class ws extends ca{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,l,d,_,v){const b=this.length;return this.resize(b+1),this.emplace(b,t,a,l,d,_,v)}emplace(t,a,l,d,_,v,b){const S=6*t;return this.int16[S+0]=a,this.int16[S+1]=l,this.int16[S+2]=d,this.int16[S+3]=_,this.int16[S+4]=v,this.int16[S+5]=b,t}}ws.prototype.bytesPerElement=12,Tt("StructArrayLayout2i4i12",ws);class Hs extends ca{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,l,d,_,v){const b=this.length;return this.resize(b+1),this.emplace(b,t,a,l,d,_,v)}emplace(t,a,l,d,_,v,b){const S=4*t,I=8*t;return this.int16[S+0]=a,this.int16[S+1]=l,this.uint8[I+4]=d,this.uint8[I+5]=_,this.uint8[I+6]=v,this.uint8[I+7]=b,t}}Hs.prototype.bytesPerElement=8,Tt("StructArrayLayout2i4ub8",Hs);class Wr extends ca{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a){const l=this.length;return this.resize(l+1),this.emplace(l,t,a)}emplace(t,a,l){const d=2*t;return this.float32[d+0]=a,this.float32[d+1]=l,t}}Wr.prototype.bytesPerElement=8,Tt("StructArrayLayout2f8",Wr);class Qr extends ca{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,l,d,_,v,b,S,I,R){const O=this.length;return this.resize(O+1),this.emplace(O,t,a,l,d,_,v,b,S,I,R)}emplace(t,a,l,d,_,v,b,S,I,R,O){const U=10*t;return this.uint16[U+0]=a,this.uint16[U+1]=l,this.uint16[U+2]=d,this.uint16[U+3]=_,this.uint16[U+4]=v,this.uint16[U+5]=b,this.uint16[U+6]=S,this.uint16[U+7]=I,this.uint16[U+8]=R,this.uint16[U+9]=O,t}}Qr.prototype.bytesPerElement=20,Tt("StructArrayLayout10ui20",Qr);class zo extends ca{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,l,d,_,v,b,S){const I=this.length;return this.resize(I+1),this.emplace(I,t,a,l,d,_,v,b,S)}emplace(t,a,l,d,_,v,b,S,I){const R=8*t;return this.uint16[R+0]=a,this.uint16[R+1]=l,this.uint16[R+2]=d,this.uint16[R+3]=_,this.uint16[R+4]=v,this.uint16[R+5]=b,this.uint16[R+6]=S,this.uint16[R+7]=I,t}}zo.prototype.bytesPerElement=16,Tt("StructArrayLayout8ui16",zo);class zu extends ca{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,l,d,_,v,b,S,I,R,O,U){const V=this.length;return this.resize(V+1),this.emplace(V,t,a,l,d,_,v,b,S,I,R,O,U)}emplace(t,a,l,d,_,v,b,S,I,R,O,U,V){const Z=12*t;return this.int16[Z+0]=a,this.int16[Z+1]=l,this.int16[Z+2]=d,this.int16[Z+3]=_,this.uint16[Z+4]=v,this.uint16[Z+5]=b,this.uint16[Z+6]=S,this.uint16[Z+7]=I,this.int16[Z+8]=R,this.int16[Z+9]=O,this.int16[Z+10]=U,this.int16[Z+11]=V,t}}zu.prototype.bytesPerElement=24,Tt("StructArrayLayout4i4ui4i24",zu);class aa extends ca{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,l){const d=this.length;return this.resize(d+1),this.emplace(d,t,a,l)}emplace(t,a,l,d){const _=3*t;return this.float32[_+0]=a,this.float32[_+1]=l,this.float32[_+2]=d,t}}aa.prototype.bytesPerElement=12,Tt("StructArrayLayout3f12",aa);class Uc extends ca{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const a=this.length;return this.resize(a+1),this.emplace(a,t)}emplace(t,a){return this.uint32[1*t+0]=a,t}}Uc.prototype.bytesPerElement=4,Tt("StructArrayLayout1ul4",Uc);class Vc extends ca{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,l,d,_,v,b,S,I){const R=this.length;return this.resize(R+1),this.emplace(R,t,a,l,d,_,v,b,S,I)}emplace(t,a,l,d,_,v,b,S,I,R){const O=10*t,U=5*t;return this.int16[O+0]=a,this.int16[O+1]=l,this.int16[O+2]=d,this.int16[O+3]=_,this.int16[O+4]=v,this.int16[O+5]=b,this.uint32[U+3]=S,this.uint16[O+8]=I,this.uint16[O+9]=R,t}}Vc.prototype.bytesPerElement=20,Tt("StructArrayLayout6i1ul2ui20",Vc);class qc extends ca{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,l,d,_,v){const b=this.length;return this.resize(b+1),this.emplace(b,t,a,l,d,_,v)}emplace(t,a,l,d,_,v,b){const S=6*t;return this.int16[S+0]=a,this.int16[S+1]=l,this.int16[S+2]=d,this.int16[S+3]=_,this.int16[S+4]=v,this.int16[S+5]=b,t}}qc.prototype.bytesPerElement=12,Tt("StructArrayLayout2i2i2i12",qc);class Iu extends ca{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,l,d,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,a,l,d,_)}emplace(t,a,l,d,_,v){const b=4*t,S=8*t;return this.float32[b+0]=a,this.float32[b+1]=l,this.float32[b+2]=d,this.int16[S+6]=_,this.int16[S+7]=v,t}}Iu.prototype.bytesPerElement=16,Tt("StructArrayLayout2f1f2i16",Iu);class p extends ca{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,l,d,_,v){const b=this.length;return this.resize(b+1),this.emplace(b,t,a,l,d,_,v)}emplace(t,a,l,d,_,v,b){const S=16*t,I=4*t,R=8*t;return this.uint8[S+0]=a,this.uint8[S+1]=l,this.float32[I+1]=d,this.float32[I+2]=_,this.int16[R+6]=v,this.int16[R+7]=b,t}}p.prototype.bytesPerElement=16,Tt("StructArrayLayout2ub2f2i16",p);class e extends ca{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,l){const d=this.length;return this.resize(d+1),this.emplace(d,t,a,l)}emplace(t,a,l,d){const _=3*t;return this.uint16[_+0]=a,this.uint16[_+1]=l,this.uint16[_+2]=d,t}}e.prototype.bytesPerElement=6,Tt("StructArrayLayout3ui6",e);class r extends ca{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,l,d,_,v,b,S,I,R,O,U,V,Z,Y,ie,se){const Ee=this.length;return this.resize(Ee+1),this.emplace(Ee,t,a,l,d,_,v,b,S,I,R,O,U,V,Z,Y,ie,se)}emplace(t,a,l,d,_,v,b,S,I,R,O,U,V,Z,Y,ie,se,Ee){const de=24*t,ge=12*t,ke=48*t;return this.int16[de+0]=a,this.int16[de+1]=l,this.uint16[de+2]=d,this.uint16[de+3]=_,this.uint32[ge+2]=v,this.uint32[ge+3]=b,this.uint32[ge+4]=S,this.uint16[de+10]=I,this.uint16[de+11]=R,this.uint16[de+12]=O,this.float32[ge+7]=U,this.float32[ge+8]=V,this.uint8[ke+36]=Z,this.uint8[ke+37]=Y,this.uint8[ke+38]=ie,this.uint32[ge+10]=se,this.int16[de+22]=Ee,t}}r.prototype.bytesPerElement=48,Tt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",r);class c extends ca{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,l,d,_,v,b,S,I,R,O,U,V,Z,Y,ie,se,Ee,de,ge,ke,Ve,rt,St,pt,bt,Nt,yt){const wt=this.length;return this.resize(wt+1),this.emplace(wt,t,a,l,d,_,v,b,S,I,R,O,U,V,Z,Y,ie,se,Ee,de,ge,ke,Ve,rt,St,pt,bt,Nt,yt)}emplace(t,a,l,d,_,v,b,S,I,R,O,U,V,Z,Y,ie,se,Ee,de,ge,ke,Ve,rt,St,pt,bt,Nt,yt,wt){const et=32*t,$t=16*t;return this.int16[et+0]=a,this.int16[et+1]=l,this.int16[et+2]=d,this.int16[et+3]=_,this.int16[et+4]=v,this.int16[et+5]=b,this.int16[et+6]=S,this.int16[et+7]=I,this.uint16[et+8]=R,this.uint16[et+9]=O,this.uint16[et+10]=U,this.uint16[et+11]=V,this.uint16[et+12]=Z,this.uint16[et+13]=Y,this.uint16[et+14]=ie,this.uint16[et+15]=se,this.uint16[et+16]=Ee,this.uint16[et+17]=de,this.uint16[et+18]=ge,this.uint16[et+19]=ke,this.uint16[et+20]=Ve,this.uint16[et+21]=rt,this.uint16[et+22]=St,this.uint32[$t+12]=pt,this.float32[$t+13]=bt,this.float32[$t+14]=Nt,this.uint16[et+30]=yt,this.uint16[et+31]=wt,t}}c.prototype.bytesPerElement=64,Tt("StructArrayLayout8i15ui1ul2f2ui64",c);class f extends ca{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const a=this.length;return this.resize(a+1),this.emplace(a,t)}emplace(t,a){return this.float32[1*t+0]=a,t}}f.prototype.bytesPerElement=4,Tt("StructArrayLayout1f4",f);class m extends ca{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,l){const d=this.length;return this.resize(d+1),this.emplace(d,t,a,l)}emplace(t,a,l,d){const _=3*t;return this.uint16[6*t+0]=a,this.float32[_+1]=l,this.float32[_+2]=d,t}}m.prototype.bytesPerElement=12,Tt("StructArrayLayout1ui2f12",m);class x extends ca{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,l){const d=this.length;return this.resize(d+1),this.emplace(d,t,a,l)}emplace(t,a,l,d){const _=4*t;return this.uint32[2*t+0]=a,this.uint16[_+2]=l,this.uint16[_+3]=d,t}}x.prototype.bytesPerElement=8,Tt("StructArrayLayout1ul2ui8",x);class T extends ca{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a){const l=this.length;return this.resize(l+1),this.emplace(l,t,a)}emplace(t,a,l){const d=2*t;return this.uint16[d+0]=a,this.uint16[d+1]=l,t}}T.prototype.bytesPerElement=4,Tt("StructArrayLayout2ui4",T);class A extends ca{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const a=this.length;return this.resize(a+1),this.emplace(a,t)}emplace(t,a){return this.uint16[1*t+0]=a,t}}A.prototype.bytesPerElement=2,Tt("StructArrayLayout1ui2",A);class k extends ca{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,l,d){const _=this.length;return this.resize(_+1),this.emplace(_,t,a,l,d)}emplace(t,a,l,d,_){const v=4*t;return this.float32[v+0]=a,this.float32[v+1]=l,this.float32[v+2]=d,this.float32[v+3]=_,t}}k.prototype.bytesPerElement=16,Tt("StructArrayLayout4f16",k);class L extends fa{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new B(this.anchorPointX,this.anchorPointY)}}L.prototype.size=20;class F extends Vc{get(t){return new L(this,t)}}Tt("CollisionBoxArray",F);class N extends fa{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}N.prototype.size=48;class q extends r{get(t){return new N(this,t)}}Tt("PlacedSymbolArray",q);class X extends fa{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}X.prototype.size=64;class ae extends c{get(t){return new X(this,t)}}Tt("SymbolInstanceArray",ae);class ne extends f{getoffsetX(t){return this.float32[1*t+0]}}Tt("GlyphOffsetArray",ne);class re extends va{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Tt("SymbolLineVertexArray",re);class oe extends fa{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}oe.prototype.size=12;class ue extends m{get(t){return new oe(this,t)}}Tt("TextAnchorOffsetArray",ue);class le extends fa{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}le.prototype.size=8;class me extends x{get(t){return new le(this,t)}}Tt("FeatureIndexArray",me);class ye extends Fi{}class he extends Fi{}class Me extends Fi{}class je extends ws{}class De extends Hs{}class Le extends Wr{}class Ne extends Qr{}class ht extends zo{}class dt extends zu{}class it extends aa{}class Rt extends Uc{}class ei extends qc{}class Ii extends p{}class Vi extends e{}class qi extends T{}const ua=Qi([{name:"a_pos",components:2,type:"Int16"}],4),{members:na}=ua;class vi{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,a,l,d){const _=this.segments[this.segments.length-1];return t>vi.MAX_VERTEX_ARRAY_LENGTH&&Xt(`Max vertices per segment is ${vi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${vi.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!_||_.vertexLength+t>vi.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==d?this.createNewSegment(a,l,d):_}createNewSegment(t,a,l){const d={vertexOffset:t.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0,vaos:{}};return l!==void 0&&(d.sortKey=l),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(d),d}getOrCreateLatestSegment(t,a,l){return this.prepareSegment(0,t,a,l)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const a in t.vaos)t.vaos[a].destroy()}static simpleSegment(t,a,l,d){return new vi([{vertexOffset:t,primitiveOffset:a,vertexLength:l,primitiveLength:d,vaos:{},sortKey:0}])}}function xa(n,t){return 256*(n=Ot(Math.floor(n),0,255))+Ot(Math.floor(t),0,255)}vi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Tt("SegmentVector",vi);const vn=Qi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),La=Qi([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var Oa,Dn,Xs,mr={exports:{}},Ys={exports:{}},Io={exports:{}},Hl=(function(){if(Xs)return mr.exports;Xs=1;var n=(Oa||(Oa=1,Ys.exports=function(a,l){var d,_,v,b,S,I,R,O;for(_=a.length-(d=3&a.length),v=l,S=3432918353,I=461845907,O=0;O<_;)R=255&a.charCodeAt(O)|(255&a.charCodeAt(++O))<<8|(255&a.charCodeAt(++O))<<16|(255&a.charCodeAt(++O))<<24,++O,v=27492+(65535&(b=5*(65535&(v=(v^=R=(65535&(R=(R=(65535&R)*S+(((R>>>16)*S&65535)<<16)&4294967295)<<15|R>>>17))*I+(((R>>>16)*I&65535)<<16)&4294967295)<<13|v>>>19))+((5*(v>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(R=0,d){case 3:R^=(255&a.charCodeAt(O+2))<<16;case 2:R^=(255&a.charCodeAt(O+1))<<8;case 1:v^=R=(65535&(R=(R=(65535&(R^=255&a.charCodeAt(O)))*S+(((R>>>16)*S&65535)<<16)&4294967295)<<15|R>>>17))*I+(((R>>>16)*I&65535)<<16)&4294967295}return v^=a.length,v=2246822507*(65535&(v^=v>>>16))+((2246822507*(v>>>16)&65535)<<16)&4294967295,v=3266489909*(65535&(v^=v>>>13))+((3266489909*(v>>>16)&65535)<<16)&4294967295,(v^=v>>>16)>>>0}),Ys.exports),t=(Dn||(Dn=1,Io.exports=function(a,l){for(var d,_=a.length,v=l^_,b=0;_>=4;)d=1540483477*(65535&(d=255&a.charCodeAt(b)|(255&a.charCodeAt(++b))<<8|(255&a.charCodeAt(++b))<<16|(255&a.charCodeAt(++b))<<24))+((1540483477*(d>>>16)&65535)<<16),v=1540483477*(65535&v)+((1540483477*(v>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),_-=4,++b;switch(_){case 3:v^=(255&a.charCodeAt(b+2))<<16;case 2:v^=(255&a.charCodeAt(b+1))<<8;case 1:v=1540483477*(65535&(v^=255&a.charCodeAt(b)))+((1540483477*(v>>>16)&65535)<<16)}return v=1540483477*(65535&(v^=v>>>13))+((1540483477*(v>>>16)&65535)<<16),(v^=v>>>15)>>>0}),Io.exports);return mr.exports=n,mr.exports.murmur3=n,mr.exports.murmur2=t,mr.exports})(),dl=j(Hl);class Ss{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,a,l,d){this.ids.push(gr(t)),this.positions.push(a,l,d)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const a=gr(t);let l=0,d=this.ids.length-1;for(;l<d;){const v=l+d>>1;this.ids[v]>=a?d=v:l=v+1}const _=[];for(;this.ids[l]===a;)_.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return _}static serialize(t,a){const l=new Float64Array(t.ids),d=new Uint32Array(t.positions);return Rr(l,d,0,l.length-1),a&&a.push(l.buffer,d.buffer),{ids:l,positions:d}}static deserialize(t){const a=new Ss;return a.ids=t.ids,a.positions=t.positions,a.indexed=!0,a}}function gr(n){const t=+n;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:dl(String(n))}function Rr(n,t,a,l){for(;a<l;){const d=n[a+l>>1];let _=a-1,v=l+1;for(;;){do _++;while(n[_]<d);do v--;while(n[v]>d);if(_>=v)break;Kr(n,_,v),Kr(t,3*_,3*v),Kr(t,3*_+1,3*v+1),Kr(t,3*_+2,3*v+2)}v-a<l-v?(Rr(n,t,a,v),a=v+1):(Rr(n,t,v+1,l),l=v)}}function Kr(n,t,a){const l=n[t];n[t]=n[a],n[a]=l}Tt("FeaturePositionMap",Ss);class Qn{constructor(t,a){this.gl=t.gl,this.location=a}}class Ea extends Qn{constructor(t,a){super(t,a),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Xa extends Qn{constructor(t,a){super(t,a),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Kn extends Qn{constructor(t,a){super(t,a),this.current=hi.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const xn=new Float32Array(16);function Ih(n){return[xa(255*n.r,255*n.g),xa(255*n.b,255*n.a)]}class Xl{constructor(t,a,l){this.value=t,this.uniformNames=a.map((d=>`u_${d}`)),this.type=l}setUniform(t,a,l){t.set(l.constantOr(this.value))}getBinding(t,a,l){return this.type==="color"?new Kn(t,a):new Ea(t,a)}}class Jr{constructor(t,a){this.uniformNames=a.map((l=>`u_${l}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,a){this.pixelRatioFrom=a.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=a.tlbr,this.patternTo=t.tlbr}setConstantDashPositions(t,a){this.dashTo=[0,t.y,t.height,t.width],this.dashFrom=[0,a.y,a.height,a.width]}setUniform(t,a,l,d){let _=null;d==="u_pattern_to"?_=this.patternTo:d==="u_pattern_from"?_=this.patternFrom:d==="u_dasharray_to"?_=this.dashTo:d==="u_dasharray_from"?_=this.dashFrom:d==="u_pixel_ratio_to"?_=this.pixelRatioTo:d==="u_pixel_ratio_from"&&(_=this.pixelRatioFrom),_!==null&&t.set(_)}getBinding(t,a,l){return l.substr(0,9)==="u_pattern"||l.substr(0,12)==="u_dasharray_"?new Xa(t,a):new Ea(t,a)}}class es{constructor(t,a,l,d){this.expression=t,this.type=l,this.maxValue=0,this.paintVertexAttributes=a.map((_=>({name:`a_${_}`,type:"Float32",components:l==="color"?2:1,offset:0}))),this.paintVertexArray=new d}populatePaintArray(t,a,l){const d=this.paintVertexArray.length,_=this.expression.evaluate(new Wi(0,l),a,{},l.canonical,[],l.formattedSection);this.paintVertexArray.resize(t),this._setPaintValue(d,t,_)}updatePaintArray(t,a,l,d,_){const v=this.expression.evaluate(new Wi(0,_),l,d);this._setPaintValue(t,a,v)}_setPaintValue(t,a,l){if(this.type==="color"){const d=Ih(l);for(let _=t;_<a;_++)this.paintVertexArray.emplace(_,d[0],d[1])}else{for(let d=t;d<a;d++)this.paintVertexArray.emplace(d,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Jn{constructor(t,a,l,d,_,v){this.expression=t,this.uniformNames=a.map((b=>`u_${b}_t`)),this.type=l,this.useIntegerZoom=d,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=a.map((b=>({name:`a_${b}`,type:"Float32",components:l==="color"?4:2,offset:0}))),this.paintVertexArray=new v}populatePaintArray(t,a,l){const d=this.expression.evaluate(new Wi(this.zoom,l),a,{},l.canonical,[],l.formattedSection),_=this.expression.evaluate(new Wi(this.zoom+1,l),a,{},l.canonical,[],l.formattedSection),v=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(v,t,d,_)}updatePaintArray(t,a,l,d,_){const v=this.expression.evaluate(new Wi(this.zoom,_),l,d),b=this.expression.evaluate(new Wi(this.zoom+1,_),l,d);this._setPaintValue(t,a,v,b)}_setPaintValue(t,a,l,d){if(this.type==="color"){const _=Ih(l),v=Ih(d);for(let b=t;b<a;b++)this.paintVertexArray.emplace(b,_[0],_[1],v[0],v[1])}else{for(let _=t;_<a;_++)this.paintVertexArray.emplace(_,l,d);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(d))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,a){const l=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,d=Ot(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);t.set(d)}getBinding(t,a,l){return new Ea(t,a)}}class Ws{constructor(t,a,l,d,_,v){this.expression=t,this.type=a,this.useIntegerZoom=l,this.zoom=d,this.layerId=v,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(t,a,l){const d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(d,t,this.getPositionIds(a),l)}updatePaintArray(t,a,l,d,_){this._setPaintValues(t,a,this.getPositionIds(l),_)}_setPaintValues(t,a,l,d){const _=this.getPositions(d);if(!_||!l)return;const v=_[l.min],b=_[l.mid],S=_[l.max];if(v&&b&&S)for(let I=t;I<a;I++)this.emplace(this.zoomInPaintVertexArray,I,b,v),this.emplace(this.zoomOutPaintVertexArray,I,b,S)}upload(t){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const a=this.getVertexAttributes();this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,a,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,a,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Qs extends Ws{getPositions(t){return t.imagePositions}getPositionIds(t){return t.patterns&&t.patterns[this.layerId]}getVertexAttributes(){return vn.members}emplace(t,a,l,d){t.emplace(a,l.tlbr[0],l.tlbr[1],l.tlbr[2],l.tlbr[3],d.tlbr[0],d.tlbr[1],d.tlbr[2],d.tlbr[3],l.pixelRatio,d.pixelRatio)}}class fl extends Ws{getPositions(t){return t.dashPositions}getPositionIds(t){return t.dashes&&t.dashes[this.layerId]}getVertexAttributes(){return La.members}emplace(t,a,l,d){t.emplace(a,0,l.y,l.height,l.width,0,d.y,d.height,d.width)}}class Ru{constructor(t,a,l){this.binders={},this._buffers=[];const d=[];for(const _ in t.paint._values){if(!l(_))continue;const v=t.paint.get(_);if(!(v instanceof Yr&&Ar(v.property.specification)))continue;const b=Du(_,t.type),S=v.value,I=v.property.specification.type,R=v.property.useIntegerZoom,O=v.property.specification["property-type"],U=O==="cross-faded"||O==="cross-faded-data-driven";if(S.kind==="constant")this.binders[_]=U?new Jr(S.value,b):new Xl(S.value,b,I),d.push(`/u_${_}`);else if(S.kind==="source"||U){const V=Zc(_,I,"source");this.binders[_]=U?_==="line-dasharray"?new fl(S,I,R,a,V,t.id):new Qs(S,I,R,a,V,t.id):new es(S,b,I,V),d.push(`/a_${_}`)}else{const V=Zc(_,I,"composite");this.binders[_]=new Jn(S,b,I,R,a,V),d.push(`/z_${_}`)}}this.cacheKey=d.sort().join("")}getMaxValue(t){const a=this.binders[t];return a instanceof es||a instanceof Jn?a.maxValue:0}populatePaintArrays(t,a,l){for(const d in this.binders){const _=this.binders[d];(_ instanceof es||_ instanceof Jn||_ instanceof Ws)&&_.populatePaintArray(t,a,l)}}setConstantPatternPositions(t,a){for(const l in this.binders){const d=this.binders[l];d instanceof Jr&&d.setConstantPatternPositions(t,a)}}setConstantDashPositions(t,a){for(const l in this.binders){const d=this.binders[l];d instanceof Jr&&d.setConstantDashPositions(t,a)}}updatePaintArrays(t,a,l,d,_){let v=!1;for(const b in t){const S=a.getPositions(b);for(const I of S){const R=l.feature(I.index);for(const O in this.binders){const U=this.binders[O];if((U instanceof es||U instanceof Jn||U instanceof Ws)&&U.expression.isStateDependent===!0){const V=d.paint.get(O);U.expression=V.value,U.updatePaintArray(I.start,I.end,R,t[b],_),v=!0}}}}return v}defines(){const t=[];for(const a in this.binders){const l=this.binders[a];(l instanceof Xl||l instanceof Jr)&&t.push(...l.uniformNames.map((d=>`#define HAS_UNIFORM_${d}`)))}return t}getBinderAttributes(){const t=[];for(const a in this.binders){const l=this.binders[a];if(l instanceof es||l instanceof Jn)for(let d=0;d<l.paintVertexAttributes.length;d++)t.push(l.paintVertexAttributes[d].name);else if(l instanceof Ws){const d=l.getVertexAttributes();for(const _ of d)t.push(_.name)}}return t}getBinderUniforms(){const t=[];for(const a in this.binders){const l=this.binders[a];if(l instanceof Xl||l instanceof Jr||l instanceof Jn)for(const d of l.uniformNames)t.push(d)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,a){const l=[];for(const d in this.binders){const _=this.binders[d];if(_ instanceof Xl||_ instanceof Jr||_ instanceof Jn){for(const v of _.uniformNames)if(a[v]){const b=_.getBinding(t,a[v],v);l.push({name:v,property:d,binding:b})}}}return l}setUniforms(t,a,l,d){for(const{name:_,property:v,binding:b}of a)this.binders[v].setUniform(b,d,l.get(v),_)}updatePaintBuffers(t){this._buffers=[];for(const a in this.binders){const l=this.binders[a];if(t&&l instanceof Ws){const d=t.fromScale===2?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(l instanceof es||l instanceof Jn)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(t){for(const a in this.binders){const l=this.binders[a];(l instanceof es||l instanceof Jn||l instanceof Ws)&&l.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const a=this.binders[t];(a instanceof es||a instanceof Jn||a instanceof Ws)&&a.destroy()}}}class Ms{constructor(t,a,l=()=>!0){this.programConfigurations={};for(const d of t)this.programConfigurations[d.id]=new Ru(d,a,l);this.needsUpload=!1,this._featureMap=new Ss,this._bufferOffset=0}populatePaintArrays(t,a,l,d){for(const _ in this.programConfigurations)this.programConfigurations[_].populatePaintArrays(t,a,d);a.id!==void 0&&this._featureMap.add(a.id,l,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,a,l,d){for(const _ of l)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(t,this._featureMap,a,_,d)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Du(n,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${t}-`,"").replace(/-/g,"_")]}function Zc(n,t,a){const l={color:{source:Wr,composite:k},number:{source:f,composite:Wr}},d=(function(_){return{"line-pattern":{source:Ne,composite:Ne},"fill-pattern":{source:Ne,composite:Ne},"fill-extrusion-pattern":{source:Ne,composite:Ne},"line-dasharray":{source:ht,composite:ht}}[_]})(n);return d&&d[a]||l[t][a]}Tt("ConstantBinder",Xl),Tt("CrossFadedConstantBinder",Jr),Tt("SourceExpressionBinder",es),Tt("CrossFadedPatternBinder",Qs),Tt("CrossFadedDasharrayBinder",fl),Tt("CompositeExpressionBinder",Jn),Tt("ProgramConfiguration",Ru,{omit:["_buffers"]}),Tt("ProgramConfigurationSet",Ms);const pl=Math.pow(2,14)-1,Sf=-pl-1;function Yl(n){const t=ft/n.extent,a=n.loadGeometry();for(let l=0;l<a.length;l++){const d=a[l];for(let _=0;_<d.length;_++){const v=d[_],b=Math.round(v.x*t),S=Math.round(v.y*t);v.x=Ot(b,Sf,pl),v.y=Ot(S,Sf,pl),(b<v.x||b>v.x+1||S<v.y||S>v.y+1)&&Xt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return a}function ts(n,t){return{type:n.type,id:n.id,properties:n.properties,geometry:t?Yl(n):[]}}const Mf=-32768;function Vp(n,t,a,l,d){n.emplaceBack(Mf+8*t+l,Mf+8*a+d)}class Td{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((a=>a.id)),this.index=t.index,this.hasDependencies=!1,this.layoutVertexArray=new he,this.indexArray=new Vi,this.segments=new vi,this.programConfigurations=new Ms(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id))}populate(t,a,l){const d=this.layers[0],_=[];let v=null,b=!1,S=d.type==="heatmap";if(d.type==="circle"){const R=d;v=R.layout.get("circle-sort-key"),b=!v.isConstant(),S=S||R.paint.get("circle-pitch-alignment")==="map"}const I=S?a.subdivisionGranularity.circle:1;for(const{feature:R,id:O,index:U,sourceLayerIndex:V}of t){const Z=this.layers[0]._featureFilter.needGeometry,Y=ts(R,Z);if(!this.layers[0]._featureFilter.filter(new Wi(this.zoom),Y,l))continue;const ie=b?v.evaluate(Y,{},l):void 0,se={id:O,properties:R.properties,type:R.type,sourceLayerIndex:V,index:U,geometry:Z?Y.geometry:Yl(R),patterns:{},sortKey:ie};_.push(se)}b&&_.sort(((R,O)=>R.sortKey-O.sortKey));for(const R of _){const{geometry:O,index:U,sourceLayerIndex:V}=R,Z=t[U].feature;this.addFeature(R,O,U,l,I),a.featureIndex.insert(Z,O,U,V,this.index)}}update(t,a,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,{imagePositions:l})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,na),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,a,l,d,_=1){let v;switch(_){case 1:v=[0,7];break;case 3:v=[0,2,5,7];break;case 5:v=[0,1,3,4,6,7];break;case 7:v=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${_}; valid values are 1, 3, 5, 7.`)}const b=v.length;for(const S of a)for(const I of S){const R=I.x,O=I.y;if(R<0||R>=ft||O<0||O>=ft)continue;const U=this.segments.prepareSegment(b*b,this.layoutVertexArray,this.indexArray,t.sortKey),V=U.vertexLength;for(let Z=0;Z<b;Z++)for(let Y=0;Y<b;Y++)Vp(this.layoutVertexArray,R,O,v[Y],v[Z]);for(let Z=0;Z<b-1;Z++)for(let Y=0;Y<b-1;Y++){const ie=V+Z*b+Y,se=V+(Z+1)*b+Y;this.indexArray.emplaceBack(ie,se+1,ie+1),this.indexArray.emplaceBack(ie,se,se+1)}U.vertexLength+=b*b,U.primitiveLength+=(b-1)*(b-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,{imagePositions:{},canonical:d})}}function Rh(n,t){for(let a=0;a<n.length;a++)if($c(t,n[a]))return!0;for(let a=0;a<t.length;a++)if($c(n,t[a]))return!0;return!!Cd(n,t)}function Dh(n,t,a){return!!$c(n,t)||!!kh(t,n,a)}function Ed(n,t){if(n.length===1)return kn(t,n[0]);for(let a=0;a<t.length;a++){const l=t[a];for(let d=0;d<l.length;d++)if($c(n,l[d]))return!0}for(let a=0;a<n.length;a++)if(kn(t,n[a]))return!0;for(let a=0;a<t.length;a++)if(Cd(n,t[a]))return!0;return!1}function qp(n,t,a){if(n.length>1){if(Cd(n,t))return!0;for(let l=0;l<t.length;l++)if(kh(t[l],n,a))return!0}for(let l=0;l<n.length;l++)if(kh(n[l],t,a))return!0;return!1}function Cd(n,t){if(n.length===0||t.length===0)return!1;for(let a=0;a<n.length-1;a++){const l=n[a],d=n[a+1];for(let _=0;_<t.length-1;_++)if(Jm(l,d,t[_],t[_+1]))return!0}return!1}function Jm(n,t,a,l){return fi(n,a,l)!==fi(t,a,l)&&fi(n,t,a)!==fi(n,t,l)}function kh(n,t,a){const l=a*a;if(t.length===1)return n.distSqr(t[0])<l;for(let d=1;d<t.length;d++)if(rn(n,t[d-1],t[d])<l)return!0;return!1}function rn(n,t,a){const l=t.distSqr(a);if(l===0)return n.distSqr(t);const d=((n.x-t.x)*(a.x-t.x)+(n.y-t.y)*(a.y-t.y))/l;return n.distSqr(d<0?t:d>1?a:a.sub(t)._mult(d)._add(t))}function kn(n,t){let a,l,d,_=!1;for(let v=0;v<n.length;v++){a=n[v];for(let b=0,S=a.length-1;b<a.length;S=b++)l=a[b],d=a[S],l.y>t.y!=d.y>t.y&&t.x<(d.x-l.x)*(t.y-l.y)/(d.y-l.y)+l.x&&(_=!_)}return _}function $c(n,t){let a=!1;for(let l=0,d=n.length-1;l<n.length;d=l++){const _=n[l],v=n[d];_.y>t.y!=v.y>t.y&&t.x<(v.x-_.x)*(t.y-_.y)/(v.y-_.y)+_.x&&(a=!a)}return a}function Zp(n,t,a){const l=a[0],d=a[2];if(n.x<l.x&&t.x<l.x||n.x>d.x&&t.x>d.x||n.y<l.y&&t.y<l.y||n.y>d.y&&t.y>d.y)return!1;const _=fi(n,t,a[0]);return _!==fi(n,t,a[1])||_!==fi(n,t,a[2])||_!==fi(n,t,a[3])}function Hc(n,t,a){const l=t.paint.get(n).value;return l.kind==="constant"?l.value:a.programConfigurations.get(t.id).getMaxValue(n)}function Lh(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function Wl(n,t,a,l,d){if(!t[0]&&!t[1])return n;const _=B.convert(t)._mult(d);a==="viewport"&&_._rotate(-l);const v=[];for(let b=0;b<n.length;b++)v.push(n[b].sub(_));return v}function $p({queryGeometry:n,size:t},a){return Dh(n,a,t)}function Ad({queryGeometry:n,size:t,transform:a,unwrappedTileID:l,getElevation:d},_){return Dh(n,_,t*(a.projectTileCoordinates(_.x,_.y,l,d).signedDistanceFromCamera/a.cameraToCenterDistance))}function Hp({queryGeometry:n,size:t,transform:a,unwrappedTileID:l,getElevation:d},_){const v=a.projectTileCoordinates(_.x,_.y,l,d).signedDistanceFromCamera,b=t*(a.cameraToCenterDistance/v);return Dh(n,Bh(_,a,l,d),b)}function eg({queryGeometry:n,size:t,transform:a,unwrappedTileID:l,getElevation:d},_){return Dh(n,Bh(_,a,l,d),t)}function Oh({queryGeometry:n,size:t,transform:a,unwrappedTileID:l,getElevation:d,pitchAlignment:_="map",pitchScale:v="map"},b){const S=_==="map"?v==="map"?$p:Ad:v==="map"?Hp:eg,I={queryGeometry:n,size:t,transform:a,unwrappedTileID:l,getElevation:d};for(const R of b)for(const O of R)if(S(I,O))return!0;return!1}function Bh(n,t,a,l){const d=t.projectTileCoordinates(n.x,n.y,a,l).point;return new B((.5*d.x+.5)*t.width,(.5*-d.y+.5)*t.height)}let Tf,Ef;Tt("CircleBucket",Td,{omit:["layers"]});var Xp={get paint(){return Ef=Ef||new la({"circle-radius":new qt(Pe.paint_circle["circle-radius"]),"circle-color":new qt(Pe.paint_circle["circle-color"]),"circle-blur":new qt(Pe.paint_circle["circle-blur"]),"circle-opacity":new qt(Pe.paint_circle["circle-opacity"]),"circle-translate":new Pt(Pe.paint_circle["circle-translate"]),"circle-translate-anchor":new Pt(Pe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Pt(Pe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Pt(Pe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new qt(Pe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new qt(Pe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new qt(Pe.paint_circle["circle-stroke-opacity"])})},get layout(){return Tf=Tf||new la({"circle-sort-key":new qt(Pe.layout_circle["circle-sort-key"])})}};class Cf extends yn{constructor(t,a){super(t,Xp,a)}createBucket(t){return new Td(t)}queryRadius(t){const a=t;return Hc("circle-radius",this,a)+Hc("circle-stroke-width",this,a)+Lh(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:a,featureState:l,geometry:d,transform:_,pixelsToTileUnits:v,unwrappedTileID:b,getElevation:S}){const I=Wl(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-_.bearingInRadians,v),R=this.paint.get("circle-radius").evaluate(a,l)+this.paint.get("circle-stroke-width").evaluate(a,l),O=this.paint.get("circle-pitch-scale"),U=this.paint.get("circle-pitch-alignment");let V,Z;return U==="map"?(V=I,Z=R*v):(V=(function(Y,ie,se,Ee){return Y.map((de=>Bh(de,ie,se,Ee)))})(I,_,b,S),Z=R),Oh({queryGeometry:V,size:Z,transform:_,unwrappedTileID:b,getElevation:S,pitchAlignment:U,pitchScale:O},d)}}class Pd extends Td{}let zd;Tt("HeatmapBucket",Pd,{omit:["layers"]});var Yp={get paint(){return zd=zd||new la({"heatmap-radius":new qt(Pe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new qt(Pe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Pt(Pe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new $l(Pe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Pt(Pe.paint_heatmap["heatmap-opacity"])})}};function Nh(n,{width:t,height:a},l,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==t*a*l)throw new RangeError(`mismatched image size. expected: ${d.length} but got: ${t*a*l}`)}else d=new Uint8Array(t*a*l);return n.width=t,n.height=a,n.data=d,n}function jh(n,{width:t,height:a},l){if(t===n.width&&a===n.height)return;const d=Nh({},{width:t,height:a},l);Fh(n,d,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,t),height:Math.min(n.height,a)},l),n.width=t,n.height=a,n.data=d.data}function Fh(n,t,a,l,d,_){if(d.width===0||d.height===0)return t;if(d.width>n.width||d.height>n.height||a.x>n.width-d.width||a.y>n.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>t.width||d.height>t.height||l.x>t.width-d.width||l.y>t.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const v=n.data,b=t.data;if(v===b)throw new Error("srcData equals dstData, so image is already copied");for(let S=0;S<d.height;S++){const I=((a.y+S)*n.width+a.x)*_,R=((l.y+S)*t.width+l.x)*_;for(let O=0;O<d.width*_;O++)b[R+O]=v[I+O]}return t}class ku{constructor(t,a){Nh(this,t,1,a)}resize(t){jh(this,t,1)}clone(){return new ku({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,a,l,d,_){Fh(t,a,l,d,_,1)}}class Vn{constructor(t,a){Nh(this,t,4,a)}resize(t){jh(this,t,4)}replace(t,a){a?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Vn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,a,l,d,_){Fh(t,a,l,d,_,4)}setPixel(t,a,l){const d=4*(t*this.width+a);this.data[d+0]=Math.round(255*l.r/l.a),this.data[d+1]=Math.round(255*l.g/l.a),this.data[d+2]=Math.round(255*l.b/l.a),this.data[d+3]=Math.round(255*l.a)}}function Af(n){const t={},a=n.resolution||256,l=n.clips?n.clips.length:1,d=n.image||new Vn({width:a,height:l});if(Math.log(a)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${a}`);const _=(v,b,S)=>{t[n.evaluationKey]=S;const I=n.expression.evaluate(t);d.setPixel(v/4/a,b/4,I)};if(n.clips)for(let v=0,b=0;v<l;++v,b+=4*a)for(let S=0,I=0;S<a;S++,I+=4){const R=S/(a-1),{start:O,end:U}=n.clips[v];_(b,I,O*(1-R)+U*R)}else for(let v=0,b=0;v<a;v++,b+=4)_(0,b,v/(a-1));return d}Tt("AlphaImage",ku),Tt("RGBAImage",Vn);const Ks="big-fb";class Pf extends yn{createBucket(t){return new Pd(t)}constructor(t,a){super(t,Yp,a),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Af({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Ks)&&this.heatmapFbos.delete(Ks)}queryRadius(t){return Hc("heatmap-radius",this,t)}queryIntersectsFeature({queryGeometry:t,feature:a,featureState:l,geometry:d,transform:_,pixelsToTileUnits:v,unwrappedTileID:b,getElevation:S}){return Oh({queryGeometry:t,size:this.paint.get("heatmap-radius").evaluate(a,l)*v,transform:_,unwrappedTileID:b,getElevation:S},d)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Wp;var Qp={get paint(){return Wp=Wp||new la({"hillshade-illumination-direction":new Pt(Pe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Pt(Pe.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Pt(Pe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Pt(Pe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Pt(Pe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Pt(Pe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Pt(Pe.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Pt(Pe.paint_hillshade["hillshade-method"])})}};class ml extends yn{constructor(t,a){super(t,Qp,a),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,a=this.paint.get("hillshade-illumination-altitude").values,l=this.paint.get("hillshade-highlight-color").values,d=this.paint.get("hillshade-shadow-color").values;const _=Math.max(t.length,a.length,l.length,d.length);t=t.concat(Array(_-t.length).fill(t.at(-1))),a=a.concat(Array(_-a.length).fill(a.at(-1))),l=l.concat(Array(_-l.length).fill(l.at(-1))),d=d.concat(Array(_-d.length).fill(d.at(-1)));const v=a.map(Pn);return{directionRadians:t.map(Pn),altitudeRadians:v,shadowColor:d,highlightColor:l}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let Id;var Kp={get paint(){return Id=Id||new la({"color-relief-opacity":new Pt(Pe["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new $l(Pe["paint_color-relief"]["color-relief-color"])})}};class Lu{constructor(t,a,l,d){this.context=t,this.format=l,this.texture=t.gl.createTexture(),this.update(a,d)}update(t,a,l){const{width:d,height:_}=t,v=!(this.size&&this.size[0]===d&&this.size[1]===_||l),{context:b}=this,{gl:S}=b;if(this.useMipmap=!!(a&&a.useMipmap),S.bindTexture(S.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===S.RGBA&&(!a||a.premultiply!==!1)),v)this.size=[d,_],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||gi(t)?S.texImage2D(S.TEXTURE_2D,0,this.format,this.format,S.UNSIGNED_BYTE,t):S.texImage2D(S.TEXTURE_2D,0,this.format,d,_,0,this.format,S.UNSIGNED_BYTE,t.data);else{const{x:I,y:R}=l||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||gi(t)?S.texSubImage2D(S.TEXTURE_2D,0,I,R,S.RGBA,S.UNSIGNED_BYTE,t):S.texSubImage2D(S.TEXTURE_2D,0,I,R,d,_,S.RGBA,S.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&S.generateMipmap(S.TEXTURE_2D),b.pixelStoreUnpackFlipY.setDefault(),b.pixelStoreUnpack.setDefault(),b.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,a,l){const{context:d}=this,{gl:_}=d;_.bindTexture(_.TEXTURE_2D,this.texture),l!==_.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=_.LINEAR),t!==this.filter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,t),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,l||t),this.filter=t),a!==this.wrap&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,a),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Ou{constructor(t,a,l,d=1,_=1,v=1,b=0){if(this.uid=t,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(l&&!["mapbox","terrarium","custom"].includes(l))return void Xt(`"${l}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=a.height;const S=this.dim=a.height-2;switch(this.data=new Uint32Array(a.data.buffer),l){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=d,this.greenFactor=_,this.blueFactor=v,this.baseShift=b;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let I=0;I<S;I++)this.data[this._idx(-1,I)]=this.data[this._idx(0,I)],this.data[this._idx(S,I)]=this.data[this._idx(S-1,I)],this.data[this._idx(I,-1)]=this.data[this._idx(I,0)],this.data[this._idx(I,S)]=this.data[this._idx(I,S-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(S,-1)]=this.data[this._idx(S-1,0)],this.data[this._idx(-1,S)]=this.data[this._idx(0,S-1)],this.data[this._idx(S,S)]=this.data[this._idx(S-1,S-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let I=0;I<S;I++)for(let R=0;R<S;R++){const O=this.get(I,R);O>this.max&&(this.max=O),O<this.min&&(this.min=O)}}get(t,a){const l=new Uint8Array(this.data.buffer),d=4*this._idx(t,a);return this.unpack(l[d],l[d+1],l[d+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,a){if(t<-1||t>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(t+1)}unpack(t,a,l){return t*this.redFactor+a*this.greenFactor+l*this.blueFactor-this.baseShift}pack(t){return Ca(t,this.getUnpackVector())}getPixels(){return new Vn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,a,l){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let d=a*this.dim,_=a*this.dim+this.dim,v=l*this.dim,b=l*this.dim+this.dim;switch(a){case-1:d=_-1;break;case 1:_=d+1}switch(l){case-1:v=b-1;break;case 1:b=v+1}const S=-a*this.dim,I=-l*this.dim;for(let R=v;R<b;R++)for(let O=d;O<_;O++)this.data[this._idx(O,R)]=t.data[this._idx(O+S,R+I)]}}function Ca(n,t){const a=t[0],l=t[1],d=t[2],_=t[3],v=Math.min(a,l,d),b=Math.round((n+_)/v);return{r:Math.floor(b*v/a)%256,g:Math.floor(b*v/l)%256,b:Math.floor(b*v/d)%256}}Tt("DEMData",Ou);class tg extends yn{constructor(t,a){super(t,Kp,a)}_createColorRamp(t){const a={elevationStops:[],colorStops:[]},l=this._transitionablePaint._values["color-relief-color"].value.expression;if(l instanceof Gn&&l._styleExpression.expression instanceof nn){this.colorRampExpression=l;const v=l._styleExpression.expression;a.elevationStops=v.labels,a.colorStops=[];for(const b of a.elevationStops)a.colorStops.push(v.evaluate({globals:{elevation:b}}))}if(a.elevationStops.length<1&&(a.elevationStops=[0],a.colorStops=[hi.transparent]),a.elevationStops.length<2&&(a.elevationStops.push(a.elevationStops[0]+1),a.colorStops.push(a.colorStops[0])),a.elevationStops.length<=t)return a;const d={elevationStops:[],colorStops:[]},_=(a.elevationStops.length-1)/(t-1);for(let v=0;v<a.elevationStops.length-.5;v+=_)d.elevationStops.push(a.elevationStops[Math.round(v)]),d.colorStops.push(a.colorStops[Math.round(v)]);return Xt(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),d}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(t,a,l){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const d=this._createColorRamp(a),_=new Vn({width:d.colorStops.length,height:1}),v=new Vn({width:d.colorStops.length,height:1});for(let b=0;b<d.elevationStops.length;b++){const S=Ca(d.elevationStops[b],l);v.setPixel(0,b,new hi(S.r/255,S.g/255,S.b/255,1)),_.setPixel(0,b,d.colorStops[b])}return this.colorRampTextures={elevationTexture:new Lu(t,v,t.gl.RGBA),colorTexture:new Lu(t,_,t.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const ig=Qi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Jp}=ig;function Ql(n,t,a){const l=a.patternDependencies;let d=!1;for(const _ of t){const v=_.paint.get(`${n}-pattern`);v.isConstant()||(d=!0);const b=v.constantOr(null);b&&(d=!0,l[b.to]=!0,l[b.from]=!0)}return d}function Ro(n,t,a,l,d){const{zoom:_}=l,v=d.patternDependencies;for(const b of t){const S=b.paint.get(`${n}-pattern`).value;if(S.kind!=="constant"){let I=S.evaluate({zoom:_-1},a,{},d.availableImages),R=S.evaluate({zoom:_},a,{},d.availableImages),O=S.evaluate({zoom:_+1},a,{},d.availableImages);I=I&&I.name?I.name:I,R=R&&R.name?R.name:R,O=O&&O.name?O.name:O,v[I]=!0,v[R]=!0,v[O]=!0,a.patterns[b.id]={min:I,mid:R,max:O}}}return a}function zf(n,t,a,l,d){let _;if(d===(function(v,b,S,I){let R=0;for(let O=b,U=S-I;O<S;O+=I)R+=(v[U]-v[O])*(v[O+1]+v[U+1]),U=O;return R})(n,t,a,l)>0)for(let v=t;v<a;v+=l)_=Lf(v/l|0,n[v],n[v+1],_);else for(let v=a-l;v>=t;v-=l)_=Lf(v/l|0,n[v],n[v+1],_);return _&&Bu(_,_.next)&&(Nu(_),_=_.next),_}function Kl(n,t){if(!n)return n;t||(t=n);let a,l=n;do if(a=!1,l.steiner||!Bu(l,l.next)&&Ci(l.prev,l,l.next)!==0)l=l.next;else{if(Nu(l),l=t=l.prev,l===l.next)break;a=!0}while(a||l!==t);return t}function gl(n,t,a,l,d,_,v){if(!n)return;!v&&_&&(function(S,I,R,O){let U=S;do U.z===0&&(U.z=Dd(U.x,U.y,I,R,O)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next;while(U!==S);U.prevZ.nextZ=null,U.prevZ=null,(function(V){let Z,Y=1;do{let ie,se=V;V=null;let Ee=null;for(Z=0;se;){Z++;let de=se,ge=0;for(let Ve=0;Ve<Y&&(ge++,de=de.nextZ,de);Ve++);let ke=Y;for(;ge>0||ke>0&&de;)ge!==0&&(ke===0||!de||se.z<=de.z)?(ie=se,se=se.nextZ,ge--):(ie=de,de=de.nextZ,ke--),Ee?Ee.nextZ=ie:V=ie,ie.prevZ=Ee,Ee=ie;se=de}Ee.nextZ=null,Y*=2}while(Z>1)})(U)})(n,l,d,_);let b=n;for(;n.prev!==n.next;){const S=n.prev,I=n.next;if(_?em(n,l,d,_):Do(n))t.push(S.i,n.i,I.i),Nu(n),n=I.next,b=I.next;else if((n=I)===b){v?v===1?gl(n=If(Kl(n),t),t,a,l,d,_,2):v===2&&tm(n,t,a,l,d,_):gl(Kl(n),t,a,l,d,_,1);break}}}function Do(n){const t=n.prev,a=n,l=n.next;if(Ci(t,a,l)>=0)return!1;const d=t.x,_=a.x,v=l.x,b=t.y,S=a.y,I=l.y,R=Math.min(d,_,v),O=Math.min(b,S,I),U=Math.max(d,_,v),V=Math.max(b,S,I);let Z=l.next;for(;Z!==t;){if(Z.x>=R&&Z.x<=U&&Z.y>=O&&Z.y<=V&&Xc(d,b,_,S,v,I,Z.x,Z.y)&&Ci(Z.prev,Z,Z.next)>=0)return!1;Z=Z.next}return!0}function em(n,t,a,l){const d=n.prev,_=n,v=n.next;if(Ci(d,_,v)>=0)return!1;const b=d.x,S=_.x,I=v.x,R=d.y,O=_.y,U=v.y,V=Math.min(b,S,I),Z=Math.min(R,O,U),Y=Math.max(b,S,I),ie=Math.max(R,O,U),se=Dd(V,Z,t,a,l),Ee=Dd(Y,ie,t,a,l);let de=n.prevZ,ge=n.nextZ;for(;de&&de.z>=se&&ge&&ge.z<=Ee;){if(de.x>=V&&de.x<=Y&&de.y>=Z&&de.y<=ie&&de!==d&&de!==v&&Xc(b,R,S,O,I,U,de.x,de.y)&&Ci(de.prev,de,de.next)>=0||(de=de.prevZ,ge.x>=V&&ge.x<=Y&&ge.y>=Z&&ge.y<=ie&&ge!==d&&ge!==v&&Xc(b,R,S,O,I,U,ge.x,ge.y)&&Ci(ge.prev,ge,ge.next)>=0))return!1;ge=ge.nextZ}for(;de&&de.z>=se;){if(de.x>=V&&de.x<=Y&&de.y>=Z&&de.y<=ie&&de!==d&&de!==v&&Xc(b,R,S,O,I,U,de.x,de.y)&&Ci(de.prev,de,de.next)>=0)return!1;de=de.prevZ}for(;ge&&ge.z<=Ee;){if(ge.x>=V&&ge.x<=Y&&ge.y>=Z&&ge.y<=ie&&ge!==d&&ge!==v&&Xc(b,R,S,O,I,U,ge.x,ge.y)&&Ci(ge.prev,ge,ge.next)>=0)return!1;ge=ge.nextZ}return!0}function If(n,t){let a=n;do{const l=a.prev,d=a.next.next;!Bu(l,d)&&kf(l,a,a.next,d)&&Ln(l,d)&&Ln(d,l)&&(t.push(l.i,a.i,d.i),Nu(a),Nu(a.next),a=n=d),a=a.next}while(a!==n);return Kl(a)}function tm(n,t,a,l,d,_){let v=n;do{let b=v.next.next;for(;b!==v.prev;){if(v.i!==b.i&&im(v,b)){let S=ko(v,b);return v=Kl(v,v.next),S=Kl(S,S.next),gl(v,t,a,l,d,_,0),void gl(S,t,a,l,d,_,0)}b=b.next}v=v.next}while(v!==n)}function Rf(n,t){let a=n.x-t.x;return a===0&&(a=n.y-t.y,a===0)&&(a=(n.next.y-n.y)/(n.next.x-n.x)-(t.next.y-t.y)/(t.next.x-t.x)),a}function Df(n,t){const a=(function(d,_){let v=_;const b=d.x,S=d.y;let I,R=-1/0;if(Bu(d,v))return v;do{if(Bu(d,v.next))return v.next;if(S<=v.y&&S>=v.next.y&&v.next.y!==v.y){const Y=v.x+(S-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(Y<=b&&Y>R&&(R=Y,I=v.x<v.next.x?v:v.next,Y===b))return I}v=v.next}while(v!==_);if(!I)return null;const O=I,U=I.x,V=I.y;let Z=1/0;v=I;do{if(b>=v.x&&v.x>=U&&b!==v.x&&sn(S<V?b:R,S,U,V,S<V?R:b,S,v.x,v.y)){const Y=Math.abs(S-v.y)/(b-v.x);Ln(v,d)&&(Y<Z||Y===Z&&(v.x>I.x||v.x===I.x&&Rd(I,v)))&&(I=v,Z=Y)}v=v.next}while(v!==O);return I})(n,t);if(!a)return t;const l=ko(a,n);return Kl(l,l.next),Kl(a,a.next)}function Rd(n,t){return Ci(n.prev,n,t.prev)<0&&Ci(t.next,n,n.next)<0}function Dd(n,t,a,l,d){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-a)*d|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-l)*d|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function _l(n){let t=n,a=n;do(t.x<a.x||t.x===a.x&&t.y<a.y)&&(a=t),t=t.next;while(t!==n);return a}function sn(n,t,a,l,d,_,v,b){return(d-v)*(t-b)>=(n-v)*(_-b)&&(n-v)*(l-b)>=(a-v)*(t-b)&&(a-v)*(_-b)>=(d-v)*(l-b)}function Xc(n,t,a,l,d,_,v,b){return!(n===v&&t===b)&&sn(n,t,a,l,d,_,v,b)}function im(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!(function(a,l){let d=a;do{if(d.i!==a.i&&d.next.i!==a.i&&d.i!==l.i&&d.next.i!==l.i&&kf(d,d.next,a,l))return!0;d=d.next}while(d!==a);return!1})(n,t)&&(Ln(n,t)&&Ln(t,n)&&(function(a,l){let d=a,_=!1;const v=(a.x+l.x)/2,b=(a.y+l.y)/2;do d.y>b!=d.next.y>b&&d.next.y!==d.y&&v<(d.next.x-d.x)*(b-d.y)/(d.next.y-d.y)+d.x&&(_=!_),d=d.next;while(d!==a);return _})(n,t)&&(Ci(n.prev,n,t.prev)||Ci(n,t.prev,t))||Bu(n,t)&&Ci(n.prev,n,n.next)>0&&Ci(t.prev,t,t.next)>0)}function Ci(n,t,a){return(t.y-n.y)*(a.x-t.x)-(t.x-n.x)*(a.y-t.y)}function Bu(n,t){return n.x===t.x&&n.y===t.y}function kf(n,t,a,l){const d=ba(Ci(n,t,a)),_=ba(Ci(n,t,l)),v=ba(Ci(a,l,n)),b=ba(Ci(a,l,t));return d!==_&&v!==b||!(d!==0||!Gh(n,a,t))||!(_!==0||!Gh(n,l,t))||!(v!==0||!Gh(a,n,l))||!(b!==0||!Gh(a,t,l))}function Gh(n,t,a){return t.x<=Math.max(n.x,a.x)&&t.x>=Math.min(n.x,a.x)&&t.y<=Math.max(n.y,a.y)&&t.y>=Math.min(n.y,a.y)}function ba(n){return n>0?1:n<0?-1:0}function Ln(n,t){return Ci(n.prev,n,n.next)<0?Ci(n,t,n.next)>=0&&Ci(n,n.prev,t)>=0:Ci(n,t,n.prev)<0||Ci(n,n.next,t)<0}function ko(n,t){const a=kd(n.i,n.x,n.y),l=kd(t.i,t.x,t.y),d=n.next,_=t.prev;return n.next=t,t.prev=n,a.next=d,d.prev=a,l.next=a,a.prev=l,_.next=l,l.prev=_,l}function Lf(n,t,a,l){const d=kd(n,t,a);return l?(d.next=l.next,d.prev=l,l.next.prev=d,l.next=d):(d.prev=d,d.next=d),d}function Nu(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function kd(n,t,a){return{i:n,x:t,y:a,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class ju{constructor(t,a){if(a>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=a}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class Yc{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}Yc.noSubdivision=new Yc({fill:new ju(0,0),line:new ju(0,0),tile:new ju(0,0),stencil:new ju(0,0),circle:1}),Tt("SubdivisionGranularityExpression",ju),Tt("SubdivisionGranularitySetting",Yc);const Mn=-32768,_r=32767;class am{constructor(t,a){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=ft/t,this._canonical=a}_getKey(t,a){return(t+=32768)<<16|a+32768}_vertexToIndex(t,a){if(t<-32768||a<-32768||t>32767||a>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const l=0|Math.round(t),d=0|Math.round(a),_=this._getKey(l,d);if(this._vertexDictionary.has(_))return this._vertexDictionary.get(_);const v=this._vertexBuffer.length/2;return this._vertexDictionary.set(_,v),this._vertexBuffer.push(l,d),v}_subdivideTrianglesScanline(t){if(this._granularity<2)return(function(d,_){const v=[];for(let b=0;b<_.length;b+=3){const S=_[b],I=_[b+1],R=_[b+2],O=d[2*S],U=d[2*S+1];(d[2*I]-O)*(d[2*R+1]-U)-(d[2*I+1]-U)*(d[2*R]-O)>0?(v.push(S),v.push(R),v.push(I)):(v.push(S),v.push(I),v.push(R))}return v})(this._vertexBuffer,t);const a=[],l=t.length;for(let d=0;d<l;d+=3){const _=[t[d+0],t[d+1],t[d+2]],v=[this._vertexBuffer[2*t[d+0]+0],this._vertexBuffer[2*t[d+0]+1],this._vertexBuffer[2*t[d+1]+0],this._vertexBuffer[2*t[d+1]+1],this._vertexBuffer[2*t[d+2]+0],this._vertexBuffer[2*t[d+2]+1]];let b=1/0,S=1/0,I=-1/0,R=-1/0;for(let Y=0;Y<3;Y++){const ie=v[2*Y],se=v[2*Y+1];b=Math.min(b,ie),I=Math.max(I,ie),S=Math.min(S,se),R=Math.max(R,se)}if(b===I||S===R)continue;const O=Math.floor(b/this._granularityCellSize),U=Math.ceil(I/this._granularityCellSize),V=Math.floor(S/this._granularityCellSize),Z=Math.ceil(R/this._granularityCellSize);if(O!==U||V!==Z)for(let Y=V;Y<Z;Y++){const ie=this._scanlineGenerateVertexRingForCellRow(Y,v,_);yl(this._vertexBuffer,ie,a)}else a.push(..._)}return a}_scanlineGenerateVertexRingForCellRow(t,a,l){const d=t*this._granularityCellSize,_=d+this._granularityCellSize,v=[];for(let b=0;b<3;b++){const S=a[2*b],I=a[2*b+1],R=a[2*(b+1)%6],O=a[(2*(b+1)+1)%6],U=a[2*(b+2)%6],V=a[(2*(b+2)+1)%6],Z=R-S,Y=O-I,ie=Z===0,se=Y===0,Ee=(d-I)/Y,de=(_-I)/Y,ge=Math.min(Ee,de),ke=Math.max(Ee,de);if(!se&&(ge>=1||ke<=0)||se&&(I<d||I>_)){O>=d&&O<=_&&v.push(l[(b+1)%3]);continue}!se&&ge>0&&v.push(this._vertexToIndex(S+Z*ge,I+Y*ge));const Ve=S+Z*Math.max(ge,0),rt=S+Z*Math.min(ke,1);ie||this._generateIntraEdgeVertices(v,S,I,R,O,Ve,rt),!se&&ke<1&&v.push(this._vertexToIndex(S+Z*ke,I+Y*ke)),(se||O>=d&&O<=_)&&v.push(l[(b+1)%3]),!se&&(O<=d||O>=_)&&this._generateInterEdgeVertices(v,S,I,R,O,U,V,rt,d,_)}return v}_generateIntraEdgeVertices(t,a,l,d,_,v,b){const S=d-a,I=_-l,R=I===0,O=R?Math.min(a,d):Math.min(v,b),U=R?Math.max(a,d):Math.max(v,b),V=Math.floor(O/this._granularityCellSize)+1,Z=Math.ceil(U/this._granularityCellSize)-1;if(R?a<d:v<b)for(let Y=V;Y<=Z;Y++){const ie=Y*this._granularityCellSize;t.push(this._vertexToIndex(ie,l+I*(ie-a)/S))}else for(let Y=Z;Y>=V;Y--){const ie=Y*this._granularityCellSize;t.push(this._vertexToIndex(ie,l+I*(ie-a)/S))}}_generateInterEdgeVertices(t,a,l,d,_,v,b,S,I,R){const O=_-l,U=v-d,V=b-_,Z=(I-_)/V,Y=(R-_)/V,ie=Math.min(Z,Y),se=Math.max(Z,Y),Ee=d+U*ie;let de=Math.floor(Math.min(Ee,S)/this._granularityCellSize)+1,ge=Math.ceil(Math.max(Ee,S)/this._granularityCellSize)-1,ke=S<Ee;const Ve=V===0;if(Ve&&(b===I||b===R))return;if(Ve||ie>=1||se<=0){const St=l-b,pt=v+(a-v)*Math.min((I-b)/St,(R-b)/St);de=Math.floor(Math.min(pt,S)/this._granularityCellSize)+1,ge=Math.ceil(Math.max(pt,S)/this._granularityCellSize)-1,ke=S<pt}const rt=O>0?R:I;if(ke)for(let St=de;St<=ge;St++)t.push(this._vertexToIndex(St*this._granularityCellSize,rt));else for(let St=ge;St>=de;St--)t.push(this._vertexToIndex(St*this._granularityCellSize,rt))}_generateOutline(t){const a=[];for(const l of t){const d=Jl(l,this._granularity,!0),_=this._pointArrayToIndices(d),v=[];for(let b=1;b<_.length;b++)v.push(_[b-1]),v.push(_[b]);a.push(v)}return a}_handlePoles(t){let a=!1,l=!1;this._canonical&&(this._canonical.y===0&&(a=!0),this._canonical.y===(1<<this._canonical.z)-1&&(l=!0)),(a||l)&&this._fillPoles(t,a,l)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let a=0;a<t.length;a+=2){const l=t[a+1];l===Mn&&(t[a+1]=-32767),l===_r&&(t[a+1]=32766)}}_generatePoleQuad(t,a,l,d,_,v){d>_!=(v===Mn)?(t.push(a),t.push(l),t.push(this._vertexToIndex(d,v)),t.push(l),t.push(this._vertexToIndex(_,v)),t.push(this._vertexToIndex(d,v))):(t.push(l),t.push(a),t.push(this._vertexToIndex(d,v)),t.push(this._vertexToIndex(_,v)),t.push(l),t.push(this._vertexToIndex(d,v)))}_fillPoles(t,a,l){const d=this._vertexBuffer,_=ft,v=t.length;for(let b=2;b<v;b+=3){const S=t[b-2],I=t[b-1],R=t[b],O=d[2*S],U=d[2*S+1],V=d[2*I],Z=d[2*I+1],Y=d[2*R],ie=d[2*R+1];a&&(U===0&&Z===0&&this._generatePoleQuad(t,S,I,O,V,Mn),Z===0&&ie===0&&this._generatePoleQuad(t,I,R,V,Y,Mn),ie===0&&U===0&&this._generatePoleQuad(t,R,S,Y,O,Mn)),l&&(U===_&&Z===_&&this._generatePoleQuad(t,S,I,O,V,_r),Z===_&&ie===_&&this._generatePoleQuad(t,I,R,V,Y,_r),ie===_&&U===_&&this._generatePoleQuad(t,R,S,Y,O,_r))}}_initializeVertices(t){for(let a=0;a<t.length;a+=2)this._vertexToIndex(t[a],t[a+1])}subdividePolygonInternal(t,a){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:l,holeIndices:d}=(function(b){const S=[],I=[];for(const R of b)if(R.length!==0){R!==b[0]&&S.push(I.length/2);for(let O=0;O<R.length;O++)I.push(R[O].x),I.push(R[O].y)}return{flattened:I,holeIndices:S}})(t);let _;this._initializeVertices(l);try{const b=(function(I,R,O=2){const U=R&&R.length,V=U?R[0]*O:I.length;let Z=zf(I,0,V,O,!0);const Y=[];if(!Z||Z.next===Z.prev)return Y;let ie,se,Ee;if(U&&(Z=(function(de,ge,ke,Ve){const rt=[];for(let St=0,pt=ge.length;St<pt;St++){const bt=zf(de,ge[St]*Ve,St<pt-1?ge[St+1]*Ve:de.length,Ve,!1);bt===bt.next&&(bt.steiner=!0),rt.push(_l(bt))}rt.sort(Rf);for(let St=0;St<rt.length;St++)ke=Df(rt[St],ke);return ke})(I,R,Z,O)),I.length>80*O){ie=I[0],se=I[1];let de=ie,ge=se;for(let ke=O;ke<V;ke+=O){const Ve=I[ke],rt=I[ke+1];Ve<ie&&(ie=Ve),rt<se&&(se=rt),Ve>de&&(de=Ve),rt>ge&&(ge=rt)}Ee=Math.max(de-ie,ge-se),Ee=Ee!==0?32767/Ee:0}return gl(Z,Y,O,ie,se,Ee,0),Y})(l,d),S=this._convertIndices(l,b);_=this._subdivideTrianglesScanline(S)}catch(b){console.error(b)}let v=[];return a&&(v=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(_),{verticesFlattened:this._vertexBuffer,indicesTriangles:_,indicesLineList:v}}_convertIndices(t,a){const l=[];for(let d=0;d<a.length;d++)l.push(this._vertexToIndex(t[2*a[d]],t[2*a[d]+1]));return l}_pointArrayToIndices(t){const a=[];for(let l=0;l<t.length;l++){const d=t[l];a.push(this._vertexToIndex(d.x,d.y))}return a}}function yr(n,t,a,l=!0){return new am(a,t).subdividePolygonInternal(n,l)}function Jl(n,t,a=!1){if(!n||n.length<1)return[];if(n.length<2)return[];const l=n[0],d=n[n.length-1],_=a&&(l.x!==d.x||l.y!==d.y);if(t<2)return _?[...n,n[0]]:[...n];const v=Math.floor(ft/t),b=[];b.push(new B(n[0].x,n[0].y));const S=n.length,I=_?S:S-1;for(let R=0;R<I;R++){const O=n[R],U=R<S-1?n[R+1]:n[0],V=O.x,Z=O.y,Y=U.x,ie=U.y,se=V!==Y,Ee=Z!==ie;if(!se&&!Ee)continue;const de=Y-V,ge=ie-Z,ke=Math.abs(de),Ve=Math.abs(ge);let rt=V,St=Z;for(;;){const bt=de>0?(Math.floor(rt/v)+1)*v:(Math.ceil(rt/v)-1)*v,Nt=ge>0?(Math.floor(St/v)+1)*v:(Math.ceil(St/v)-1)*v,yt=Math.abs(rt-bt),wt=Math.abs(St-Nt),et=Math.abs(rt-Y),$t=Math.abs(St-ie),Wt=se?yt/ke:Number.POSITIVE_INFINITY,Zt=Ee?wt/Ve:Number.POSITIVE_INFINITY;if((et<=yt||!se)&&($t<=wt||!Ee))break;if(Wt<Zt&&se||!Ee){rt=bt,St+=ge*Wt;const Dt=new B(rt,Math.round(St));b[b.length-1].x===Dt.x&&b[b.length-1].y===Dt.y||b.push(Dt)}else{rt+=de*Zt,St=Nt;const Dt=new B(Math.round(rt),St);b[b.length-1].x===Dt.x&&b[b.length-1].y===Dt.y||b.push(Dt)}}const pt=new B(Y,ie);b[b.length-1].x===pt.x&&b[b.length-1].y===pt.y||b.push(pt)}return b}function yl(n,t,a){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let l=0,d=n[2*t[0]];for(let S=1;S<t.length;S++){const I=n[2*t[S]];I<d&&(d=I,l=S)}const _=t.length;let v=l,b=(v+1)%_;for(;;){const S=v-1>=0?v-1:_-1,I=(b+1)%_,R=n[2*t[S]],O=n[2*t[I]],U=n[2*t[v]],V=n[2*t[v]+1],Z=n[2*t[b]+1];let Y=!1;if(R<O)Y=!0;else if(R>O)Y=!1;else{const ie=Z-V,se=-(n[2*t[b]]-U),Ee=V<Z?1:-1;((R-U)*ie+(n[2*t[S]+1]-V)*se)*Ee>((O-U)*ie+(n[2*t[I]+1]-V)*se)*Ee&&(Y=!0)}if(Y){const ie=t[S],se=t[v],Ee=t[b];ie!==se&&ie!==Ee&&se!==Ee&&a.push(Ee,se,ie),v--,v<0&&(v=_-1)}else{const ie=t[I],se=t[v],Ee=t[b];ie!==se&&ie!==Ee&&se!==Ee&&a.push(Ee,se,ie),b++,b>=_&&(b=0)}if(S===I)break}}function ec(n,t,a,l,d,_,v,b,S){const I=d.length/2,R=v&&b&&S;if(I<vi.MAX_VERTEX_ARRAY_LENGTH){const O=t.prepareSegment(I,a,l),U=O.vertexLength;for(let Y=0;Y<_.length;Y+=3)l.emplaceBack(U+_[Y],U+_[Y+1],U+_[Y+2]);let V,Z;O.vertexLength+=I,O.primitiveLength+=_.length/3,R&&(Z=v.prepareSegment(I,a,b),V=Z.vertexLength,Z.vertexLength+=I);for(let Y=0;Y<d.length;Y+=2)n(d[Y],d[Y+1]);if(R)for(let Y=0;Y<S.length;Y++){const ie=S[Y];for(let se=1;se<ie.length;se+=2)b.emplaceBack(V+ie[se-1],V+ie[se]);Z.primitiveLength+=ie.length/2}}else(function(O,U,V,Z,Y,ie){const se=[];for(let Ve=0;Ve<Z.length/2;Ve++)se.push(-1);const Ee={count:0};let de=0,ge=O.getOrCreateLatestSegment(U,V),ke=ge.vertexLength;for(let Ve=2;Ve<Y.length;Ve+=3){const rt=Y[Ve-2],St=Y[Ve-1],pt=Y[Ve];let bt=se[rt]<de,Nt=se[St]<de,yt=se[pt]<de;ge.vertexLength+((bt?1:0)+(Nt?1:0)+(yt?1:0))>vi.MAX_VERTEX_ARRAY_LENGTH&&(ge=O.createNewSegment(U,V),de=Ee.count,bt=!0,Nt=!0,yt=!0,ke=0);const wt=is(se,Z,ie,Ee,rt,bt,ge),et=is(se,Z,ie,Ee,St,Nt,ge),$t=is(se,Z,ie,Ee,pt,yt,ge);V.emplaceBack(ke+wt-de,ke+et-de,ke+$t-de),ge.primitiveLength++}})(t,a,l,d,_,n),R&&(function(O,U,V,Z,Y,ie){const se=[];for(let Ve=0;Ve<Z.length/2;Ve++)se.push(-1);const Ee={count:0};let de=0,ge=O.getOrCreateLatestSegment(U,V),ke=ge.vertexLength;for(let Ve=0;Ve<Y.length;Ve++){const rt=Y[Ve];for(let St=1;St<Y[Ve].length;St+=2){const pt=rt[St-1],bt=rt[St];let Nt=se[pt]<de,yt=se[bt]<de;ge.vertexLength+((Nt?1:0)+(yt?1:0))>vi.MAX_VERTEX_ARRAY_LENGTH&&(ge=O.createNewSegment(U,V),de=Ee.count,Nt=!0,yt=!0,ke=0);const wt=is(se,Z,ie,Ee,pt,Nt,ge),et=is(se,Z,ie,Ee,bt,yt,ge);V.emplaceBack(ke+wt-de,ke+et-de),ge.primitiveLength++}}})(v,a,b,d,S,n),t.forceNewSegmentOnNextPrepare(),v?.forceNewSegmentOnNextPrepare()}function is(n,t,a,l,d,_,v){if(_){const b=l.count;return a(t[2*d],t[2*d+1]),n[d]=l.count,l.count++,v.vertexLength++,b}return n[d]}class Uh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((a=>a.id)),this.index=t.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new Me,this.indexArray=new Vi,this.indexArray2=new qi,this.programConfigurations=new Ms(t.layers,t.zoom),this.segments=new vi,this.segments2=new vi,this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id))}populate(t,a,l){this.hasDependencies=Ql("fill",this.layers,a);const d=this.layers[0].layout.get("fill-sort-key"),_=!d.isConstant(),v=[];for(const{feature:b,id:S,index:I,sourceLayerIndex:R}of t){const O=this.layers[0]._featureFilter.needGeometry,U=ts(b,O);if(!this.layers[0]._featureFilter.filter(new Wi(this.zoom),U,l))continue;const V=_?d.evaluate(U,{},l,a.availableImages):void 0,Z={id:S,properties:b.properties,type:b.type,sourceLayerIndex:R,index:I,geometry:O?U.geometry:Yl(b),patterns:{},sortKey:V};v.push(Z)}_&&v.sort(((b,S)=>b.sortKey-S.sortKey));for(const b of v){const{geometry:S,index:I,sourceLayerIndex:R}=b;if(this.hasDependencies){const O=Ro("fill",this.layers,b,{zoom:this.zoom},a);this.patternFeatures.push(O)}else this.addFeature(b,S,I,l,{},a.subdivisionGranularity);a.featureIndex.insert(t[I].feature,S,I,R,this.index)}}update(t,a,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,{imagePositions:l})}addFeatures(t,a,l){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,a,l,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Jp),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,a,l,d,_,v){for(const b of wc(a,500)){const S=yr(b,d,v.fill.getGranularityForZoomLevel(d.z)),I=this.layoutVertexArray;ec(((R,O)=>{I.emplaceBack(R,O)}),this.segments,this.layoutVertexArray,this.indexArray,S.verticesFlattened,S.indicesTriangles,this.segments2,this.indexArray2,S.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,{imagePositions:_,canonical:d})}}let Ld,Ts;Tt("FillBucket",Uh,{omit:["layers","patternFeatures"]});var nm={get paint(){return Ts=Ts||new la({"fill-antialias":new Pt(Pe.paint_fill["fill-antialias"]),"fill-opacity":new qt(Pe.paint_fill["fill-opacity"]),"fill-color":new qt(Pe.paint_fill["fill-color"]),"fill-outline-color":new qt(Pe.paint_fill["fill-outline-color"]),"fill-translate":new Pt(Pe.paint_fill["fill-translate"]),"fill-translate-anchor":new Pt(Pe.paint_fill["fill-translate-anchor"]),"fill-pattern":new ul(Pe.paint_fill["fill-pattern"])})},get layout(){return Ld=Ld||new la({"fill-sort-key":new qt(Pe.layout_fill["fill-sort-key"])})}};class Fu extends yn{constructor(t,a){super(t,nm,a)}recalculate(t,a){super.recalculate(t,a);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Uh(t)}queryRadius(){return Lh(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:a,transform:l,pixelsToTileUnits:d}){return Ed(Wl(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-l.bearingInRadians,d),a)}isTileClipped(){return!0}}const Vh=Qi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),qh=Qi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Gu}=Vh;class Wc{constructor(t,a,l,d,_){this.properties={},this.extent=l,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=d,this._values=_,t.readFields(rm,this,a)}loadGeometry(){const t=this._pbf;t.pos=this._geometry;const a=t.readVarint()+t.pos,l=[];let d,_=1,v=0,b=0,S=0;for(;t.pos<a;){if(v<=0){const I=t.readVarint();_=7&I,v=I>>3}if(v--,_===1||_===2)b+=t.readSVarint(),S+=t.readSVarint(),_===1&&(d&&l.push(d),d=[]),d&&d.push(new B(b,S));else{if(_!==7)throw new Error(`unknown command ${_}`);d&&d.push(d[0].clone())}}return d&&l.push(d),l}bbox(){const t=this._pbf;t.pos=this._geometry;const a=t.readVarint()+t.pos;let l=1,d=0,_=0,v=0,b=1/0,S=-1/0,I=1/0,R=-1/0;for(;t.pos<a;){if(d<=0){const O=t.readVarint();l=7&O,d=O>>3}if(d--,l===1||l===2)_+=t.readSVarint(),v+=t.readSVarint(),_<b&&(b=_),_>S&&(S=_),v<I&&(I=v),v>R&&(R=v);else if(l!==7)throw new Error(`unknown command ${l}`)}return[b,I,S,R]}toGeoJSON(t,a,l){const d=this.extent*Math.pow(2,l),_=this.extent*t,v=this.extent*a,b=this.loadGeometry();function S(U){return[360*(U.x+_)/d-180,360/Math.PI*Math.atan(Math.exp((1-2*(U.y+v)/d)*Math.PI))-90]}function I(U){return U.map(S)}let R;if(this.type===1){const U=[];for(const Z of b)U.push(Z[0]);const V=I(U);R=U.length===1?{type:"Point",coordinates:V[0]}:{type:"MultiPoint",coordinates:V}}else if(this.type===2){const U=b.map(I);R=U.length===1?{type:"LineString",coordinates:U[0]}:{type:"MultiLineString",coordinates:U}}else{if(this.type!==3)throw new Error("unknown feature type");{const U=(function(Z){const Y=Z.length;if(Y<=1)return[Z];const ie=[];let se,Ee;for(let de=0;de<Y;de++){const ge=Zh(Z[de]);ge!==0&&(Ee===void 0&&(Ee=ge<0),Ee===ge<0?(se&&ie.push(se),se=[Z[de]]):se&&se.push(Z[de]))}return se&&ie.push(se),ie})(b),V=[];for(const Z of U)V.push(Z.map(I));R=V.length===1?{type:"Polygon",coordinates:V[0]}:{type:"MultiPolygon",coordinates:V}}}const O={type:"Feature",geometry:R,properties:this.properties};return this.id!=null&&(O.id=this.id),O}}function rm(n,t,a){n===1?t.id=a.readVarint():n===2?(function(l,d){const _=l.readVarint()+l.pos;for(;l.pos<_;){const v=d._keys[l.readVarint()],b=d._values[l.readVarint()];d.properties[v]=b}})(a,t):n===3?t.type=a.readVarint():n===4&&(t._geometry=a.pos)}function Zh(n){let t=0;for(let a,l,d=0,_=n.length,v=_-1;d<_;v=d++)a=n[d],l=n[v],t+=(l.x-a.x)*(a.y+l.y);return t}Wc.types=["Unknown","Point","LineString","Polygon"];class Of{constructor(t,a){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Od,this,a),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];const a=this._pbf.readVarint()+this._pbf.pos;return new Wc(this._pbf,a,this.extent,this._keys,this._values)}}function Od(n,t,a){n===15?t.version=a.readVarint():n===1?t.name=a.readString():n===5?t.extent=a.readVarint():n===2?t._features.push(a.pos):n===3?t._keys.push(a.readString()):n===4&&t._values.push((function(l){let d=null;const _=l.readVarint()+l.pos;for(;l.pos<_;){const v=l.readVarint()>>3;d=v===1?l.readString():v===2?l.readFloat():v===3?l.readDouble():v===4?l.readVarint64():v===5?l.readVarint():v===6?l.readSVarint():v===7?l.readBoolean():null}if(d==null)throw new Error("unknown feature value");return d})(a))}class Bf{constructor(t,a){this.layers=t.readFields(ag,{},a)}}function ag(n,t,a){if(n===3){const l=new Of(a,a.readVarint()+a.pos);l.length&&(t[l.name]=l)}}const Nf=Math.pow(2,13);function Gi(n,t,a,l,d,_,v,b){n.emplaceBack(t,a,2*Math.floor(l*Nf)+v,d*Nf*2,_*Nf*2,Math.round(b))}class ha{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((a=>a.id)),this.index=t.index,this.hasDependencies=!1,this.layoutVertexArray=new je,this.centroidVertexArray=new ye,this.indexArray=new Vi,this.programConfigurations=new Ms(t.layers,t.zoom),this.segments=new vi,this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id))}populate(t,a,l){this.features=[],this.hasDependencies=Ql("fill-extrusion",this.layers,a);for(const{feature:d,id:_,index:v,sourceLayerIndex:b}of t){const S=this.layers[0]._featureFilter.needGeometry,I=ts(d,S);if(!this.layers[0]._featureFilter.filter(new Wi(this.zoom),I,l))continue;const R={id:_,sourceLayerIndex:b,index:v,geometry:S?I.geometry:Yl(d),properties:d.properties,type:d.type,patterns:{}};this.hasDependencies?this.features.push(Ro("fill-extrusion",this.layers,R,{zoom:this.zoom},a)):this.addFeature(R,R.geometry,v,l,{},a.subdivisionGranularity),a.featureIndex.insert(d,R.geometry,v,b,this.index,!0)}}addFeatures(t,a,l){for(const d of this.features){const{geometry:_}=d;this.addFeature(d,_,d.index,a,l,t.subdivisionGranularity)}}update(t,a,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,{imagePositions:l})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Gu),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,qh.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,a,l,d,_,v){for(const b of wc(a,500)){const S={x:0,y:0,sampleCount:0},I=this.layoutVertexArray.length;this.processPolygon(S,d,t,b,v);const R=this.layoutVertexArray.length-I,O=Math.floor(S.x/S.sampleCount),U=Math.floor(S.y/S.sampleCount);for(let V=0;V<R;V++)this.centroidVertexArray.emplaceBack(O,U)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,{imagePositions:_,canonical:d})}processPolygon(t,a,l,d,_){if(d.length<1||ra(d[0]))return;for(const O of d)O.length!==0&&ki(t,O);const v={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},b=_.fill.getGranularityForZoomLevel(a.z),S=Wc.types[l.type]==="Polygon";for(const O of d){if(O.length===0||ra(O))continue;const U=Jl(O,b,S);this._generateSideFaces(U,v)}if(!S)return;const I=yr(d,a,b,!1),R=this.layoutVertexArray;ec(((O,U)=>{Gi(R,O,U,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,I.verticesFlattened,I.indicesTriangles)}_generateSideFaces(t,a){let l=0;for(let d=1;d<t.length;d++){const _=t[d],v=t[d-1];if(Bi(_,v))continue;a.segment.vertexLength+4>vi.MAX_VERTEX_ARRAY_LENGTH&&(a.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const b=_.sub(v)._perp()._unit(),S=v.dist(_);l+S>32768&&(l=0),Gi(this.layoutVertexArray,_.x,_.y,b.x,b.y,0,0,l),Gi(this.layoutVertexArray,_.x,_.y,b.x,b.y,0,1,l),l+=S,Gi(this.layoutVertexArray,v.x,v.y,b.x,b.y,0,0,l),Gi(this.layoutVertexArray,v.x,v.y,b.x,b.y,0,1,l);const I=a.segment.vertexLength;this.indexArray.emplaceBack(I,I+2,I+1),this.indexArray.emplaceBack(I+1,I+2,I+3),a.segment.vertexLength+=4,a.segment.primitiveLength+=2}}}function ki(n,t){for(let a=0;a<t.length;a++){const l=t[a];a===t.length-1&&t[0].x===l.x&&t[0].y===l.y||(n.x+=l.x,n.y+=l.y,n.sampleCount++)}}function Bi(n,t){return n.x===t.x&&(n.x<0||n.x>ft)||n.y===t.y&&(n.y<0||n.y>ft)}function ra(n){return n.every((t=>t.x<0))||n.every((t=>t.x>ft))||n.every((t=>t.y<0))||n.every((t=>t.y>ft))}let Dr;Tt("FillExtrusionBucket",ha,{omit:["layers","features"]});var tc={get paint(){return Dr=Dr||new la({"fill-extrusion-opacity":new Pt(Pe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new qt(Pe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Pt(Pe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Pt(Pe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ul(Pe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new qt(Pe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new qt(Pe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Pt(Pe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Uu extends yn{constructor(t,a){super(t,tc,a)}createBucket(t){return new ha(t)}queryRadius(){return Lh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:a,featureState:l,geometry:d,transform:_,pixelsToTileUnits:v,pixelPosMatrix:b}){const S=Wl(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-_.bearingInRadians,v),I=this.paint.get("fill-extrusion-height").evaluate(a,l),R=this.paint.get("fill-extrusion-base").evaluate(a,l),O=(function(V,Z){const Y=[];for(const ie of V){const se=[ie.x,ie.y,0,1];Oi(se,se,Z),Y.push(new B(se[0]/se[3],se[1]/se[3]))}return Y})(S,b),U=(function(V,Z,Y,ie){const se=[],Ee=[],de=ie[8]*Z,ge=ie[9]*Z,ke=ie[10]*Z,Ve=ie[11]*Z,rt=ie[8]*Y,St=ie[9]*Y,pt=ie[10]*Y,bt=ie[11]*Y;for(const Nt of V){const yt=[],wt=[];for(const et of Nt){const $t=et.x,Wt=et.y,Zt=ie[0]*$t+ie[4]*Wt+ie[12],Dt=ie[1]*$t+ie[5]*Wt+ie[13],pi=ie[2]*$t+ie[6]*Wt+ie[14],pa=ie[3]*$t+ie[7]*Wt+ie[15],Ga=pi+ke,En=pa+Ve,br=Zt+rt,Wa=Dt+St,Aa=pi+pt,Hi=pa+bt,Na=new B((Zt+de)/En,(Dt+ge)/En);Na.z=Ga/En,yt.push(Na);const Ua=new B(br/Hi,Wa/Hi);Ua.z=Aa/Hi,wt.push(Ua)}se.push(yt),Ee.push(wt)}return[se,Ee]})(d,R,I,b);return(function(V,Z,Y){let ie=1/0;Ed(Y,Z)&&(ie=Lo(Y,Z[0]));for(let se=0;se<Z.length;se++){const Ee=Z[se],de=V[se];for(let ge=0;ge<Ee.length-1;ge++){const ke=Ee[ge],Ve=[ke,Ee[ge+1],de[ge+1],de[ge],ke];Rh(Y,Ve)&&(ie=Math.min(ie,Lo(Y,Ve)))}}return ie!==1/0&&ie})(U[0],U[1],O)}}function Qc(n,t){return n.x*t.x+n.y*t.y}function Lo(n,t){if(n.length===1){let a=0;const l=t[a++];let d;for(;!d||l.equals(d);)if(d=t[a++],!d)return 1/0;for(;a<t.length;a++){const _=t[a],v=n[0],b=d.sub(l),S=_.sub(l),I=v.sub(l),R=Qc(b,b),O=Qc(b,S),U=Qc(S,S),V=Qc(I,b),Z=Qc(I,S),Y=R*U-O*O,ie=(U*V-O*Z)/Y,se=(R*Z-O*V)/Y,Ee=l.z*(1-ie-se)+d.z*ie+_.z*se;if(isFinite(Ee))return Ee}return 1/0}{let a=1/0;for(const l of t)a=Math.min(a,l.z);return a}}const Ya=Qi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:ic}=Ya,Kc=Qi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:jf}=Kc,as=Math.cos(Math.PI/180*37.5),Jc=Math.pow(2,14)/.5;class eu{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((a=>a.id)),this.index=t.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((a=>{this.gradients[a.id]={}})),this.layoutVertexArray=new De,this.layoutVertexArray2=new Le,this.indexArray=new Vi,this.programConfigurations=new Ms(t.layers,t.zoom),this.segments=new vi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id))}populate(t,a,l){this.hasDependencies=Ql("line",this.layers,a)||this.hasLineDasharray(this.layers);const d=this.layers[0].layout.get("line-sort-key"),_=!d.isConstant(),v=[];for(const{feature:b,id:S,index:I,sourceLayerIndex:R}of t){const O=this.layers[0]._featureFilter.needGeometry,U=ts(b,O);if(!this.layers[0]._featureFilter.filter(new Wi(this.zoom),U,l))continue;const V=_?d.evaluate(U,{},l):void 0,Z={id:S,properties:b.properties,type:b.type,sourceLayerIndex:R,index:I,geometry:O?U.geometry:Yl(b),patterns:{},dashes:{},sortKey:V};v.push(Z)}_&&v.sort(((b,S)=>b.sortKey-S.sortKey));for(const b of v){const{geometry:S,index:I,sourceLayerIndex:R}=b;this.hasDependencies?(Ql("line",this.layers,a)?Ro("line",this.layers,b,{zoom:this.zoom},a):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,b,this.zoom,a),this.patternFeatures.push(b)):this.addFeature(b,S,I,l,{},{},a.subdivisionGranularity),a.featureIndex.insert(t[I].feature,S,I,R,this.index)}}update(t,a,l,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,{imagePositions:l,dashPositions:d})}addFeatures(t,a,l,d){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,a,l,d,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,jf)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ic),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,a,l,d,_,v,b){const S=this.layers[0].layout,I=S.get("line-join").evaluate(t,{}),R=S.get("line-cap"),O=S.get("line-miter-limit"),U=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const V of a)this.addLine(V,t,I,R,O,U,d,b);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,{imagePositions:_,dashPositions:v,canonical:d})}addLine(t,a,l,d,_,v,b,S){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=Jl(t,b?S.line.getGranularityForZoomLevel(b.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let de=0;de<t.length-1;de++)this.totalDistance+=t[de].dist(t[de+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const I=Wc.types[a.type]==="Polygon";let R=t.length;for(;R>=2&&t[R-1].equals(t[R-2]);)R--;let O=0;for(;O<R-1&&t[O].equals(t[O+1]);)O++;if(R<(I?3:2))return;l==="bevel"&&(_=1.05);const U=this.overscaling<=16?122880/(512*this.overscaling):0,V=this.segments.prepareSegment(10*R,this.layoutVertexArray,this.indexArray);let Z,Y,ie,se,Ee;this.e1=this.e2=-1,I&&(Z=t[R-2],Ee=t[O].sub(Z)._unit()._perp());for(let de=O;de<R;de++){if(ie=de===R-1?I?t[O+1]:void 0:t[de+1],ie&&t[de].equals(ie))continue;Ee&&(se=Ee),Z&&(Y=Z),Z=t[de],Ee=ie?ie.sub(Z)._unit()._perp():se,se=se||Ee;let ge=se.add(Ee);ge.x===0&&ge.y===0||ge._unit();const ke=se.x*Ee.x+se.y*Ee.y,Ve=ge.x*Ee.x+ge.y*Ee.y,rt=Ve!==0?1/Ve:1/0,St=2*Math.sqrt(2-2*Ve),pt=Ve<as&&Y&&ie,bt=se.x*Ee.y-se.y*Ee.x>0;if(pt&&de>O){const wt=Z.dist(Y);if(wt>2*U){const et=Z.sub(Z.sub(Y)._mult(U/wt)._round());this.updateDistance(Y,et),this.addCurrentVertex(et,se,0,0,V),Y=et}}const Nt=Y&&ie;let yt=Nt?l:I?"butt":d;if(Nt&&yt==="round"&&(rt<v?yt="miter":rt<=2&&(yt="fakeround")),yt==="miter"&&rt>_&&(yt="bevel"),yt==="bevel"&&(rt>2&&(yt="flipbevel"),rt<_&&(yt="miter")),Y&&this.updateDistance(Y,Z),yt==="miter")ge._mult(rt),this.addCurrentVertex(Z,ge,0,0,V);else if(yt==="flipbevel"){if(rt>100)ge=Ee.mult(-1);else{const wt=rt*se.add(Ee).mag()/se.sub(Ee).mag();ge._perp()._mult(wt*(bt?-1:1))}this.addCurrentVertex(Z,ge,0,0,V),this.addCurrentVertex(Z,ge.mult(-1),0,0,V)}else if(yt==="bevel"||yt==="fakeround"){const wt=-Math.sqrt(rt*rt-1),et=bt?wt:0,$t=bt?0:wt;if(Y&&this.addCurrentVertex(Z,se,et,$t,V),yt==="fakeround"){const Wt=Math.round(180*St/Math.PI/20);for(let Zt=1;Zt<Wt;Zt++){let Dt=Zt/Wt;if(Dt!==.5){const pa=Dt-.5;Dt+=Dt*pa*(Dt-1)*((1.0904+ke*(ke*(3.55645-1.43519*ke)-3.2452))*pa*pa+(.848013+ke*(.215638*ke-1.06021)))}const pi=Ee.sub(se)._mult(Dt)._add(se)._unit()._mult(bt?-1:1);this.addHalfVertex(Z,pi.x,pi.y,!1,bt,0,V)}}ie&&this.addCurrentVertex(Z,Ee,-et,-$t,V)}else if(yt==="butt")this.addCurrentVertex(Z,ge,0,0,V);else if(yt==="square"){const wt=Y?1:-1;this.addCurrentVertex(Z,ge,wt,wt,V)}else yt==="round"&&(Y&&(this.addCurrentVertex(Z,se,0,0,V),this.addCurrentVertex(Z,se,1,1,V,!0)),ie&&(this.addCurrentVertex(Z,Ee,-1,-1,V,!0),this.addCurrentVertex(Z,Ee,0,0,V)));if(pt&&de<R-1){const wt=Z.dist(ie);if(wt>2*U){const et=Z.add(ie.sub(Z)._mult(U/wt)._round());this.updateDistance(Z,et),this.addCurrentVertex(et,Ee,0,0,V),Z=et}}}}addCurrentVertex(t,a,l,d,_,v=!1){const b=a.y*d-a.x,S=-a.y-a.x*d;this.addHalfVertex(t,a.x+a.y*l,a.y-a.x*l,v,!1,l,_),this.addHalfVertex(t,b,S,v,!0,-d,_),this.distance>Jc/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,a,l,d,_,v))}addHalfVertex({x:t,y:a},l,d,_,v,b,S){const I=.5*(this.lineClips?this.scaledDistance*(Jc-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(_?1:0),(a<<1)+(v?1:0),Math.round(63*l)+128,Math.round(63*d)+128,1+(b===0?0:b<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const R=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,R,this.e2),S.primitiveLength++),v?this.e2=R:this.e1=R}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,a){this.distance+=t.dist(a),this.updateScaledDistance()}hasLineDasharray(t){for(const a of t){const l=a.paint.get("line-dasharray");if(l&&!l.isConstant())return!0}return!1}addLineDashDependencies(t,a,l,d){for(const _ of t){const v=_.paint.get("line-dasharray");if(!v||v.value.kind==="constant")continue;const b=_.layout.get("line-cap")==="round",S={dasharray:v.value.evaluate({zoom:l-1},a,{}),round:b},I={dasharray:v.value.evaluate({zoom:l},a,{}),round:b},R={dasharray:v.value.evaluate({zoom:l+1},a,{}),round:b},O=`${S.dasharray.join(",")},${S.round}`,U=`${I.dasharray.join(",")},${I.round}`,V=`${R.dasharray.join(",")},${R.round}`;d.dashDependencies[O]=S,d.dashDependencies[U]=I,d.dashDependencies[V]=R,a.dashes[_.id]={min:O,mid:U,max:V}}}}let vr,Bd;Tt("LineBucket",eu,{omit:["layers","patternFeatures"]});var $h={get paint(){return Bd=Bd||new la({"line-opacity":new qt(Pe.paint_line["line-opacity"]),"line-color":new qt(Pe.paint_line["line-color"]),"line-translate":new Pt(Pe.paint_line["line-translate"]),"line-translate-anchor":new Pt(Pe.paint_line["line-translate-anchor"]),"line-width":new qt(Pe.paint_line["line-width"]),"line-gap-width":new qt(Pe.paint_line["line-gap-width"]),"line-offset":new qt(Pe.paint_line["line-offset"]),"line-blur":new qt(Pe.paint_line["line-blur"]),"line-dasharray":new ul(Pe.paint_line["line-dasharray"]),"line-pattern":new ul(Pe.paint_line["line-pattern"]),"line-gradient":new $l(Pe.paint_line["line-gradient"])})},get layout(){return vr=vr||new la({"line-cap":new Pt(Pe.layout_line["line-cap"]),"line-join":new qt(Pe.layout_line["line-join"]),"line-miter-limit":new Pt(Pe.layout_line["line-miter-limit"]),"line-round-limit":new Pt(Pe.layout_line["line-round-limit"]),"line-sort-key":new qt(Pe.layout_line["line-sort-key"])})}};class sm extends qt{possiblyEvaluate(t,a){return a=new Wi(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,zoomHistory:a.zoomHistory,transition:a.transition}),super.possiblyEvaluate(t,a)}evaluate(t,a,l,d){return a=Ut({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(t,a,l,d)}}let tu;class Nd extends yn{constructor(t,a){super(t,$h,a),this.gradientVersion=0,tu||(tu=new sm($h.paint.properties["line-width"].specification),tu.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const a=this.gradientExpression();this.stepInterpolant=!!(function(l){return l._styleExpression!==void 0})(a)&&a._styleExpression.expression instanceof uo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,a){super.recalculate(t,a),this.paint._values["line-floorwidth"]=tu.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new eu(t)}queryRadius(t){const a=t,l=vl(Hc("line-width",this,a),Hc("line-gap-width",this,a)),d=Hc("line-offset",this,a);return l/2+Math.abs(d)+Lh(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:a,featureState:l,geometry:d,transform:_,pixelsToTileUnits:v}){const b=Wl(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-_.bearingInRadians,v),S=v/2*vl(this.paint.get("line-width").evaluate(a,l),this.paint.get("line-gap-width").evaluate(a,l)),I=this.paint.get("line-offset").evaluate(a,l);return I&&(d=(function(R,O){const U=[];for(let V=0;V<R.length;V++){const Z=R[V],Y=[];for(let ie=0;ie<Z.length;ie++){const se=Z[ie-1],Ee=Z[ie],de=Z[ie+1],ge=ie===0?new B(0,0):Ee.sub(se)._unit()._perp(),ke=ie===Z.length-1?new B(0,0):de.sub(Ee)._unit()._perp(),Ve=ge._add(ke)._unit(),rt=Ve.x*ke.x+Ve.y*ke.y;rt!==0&&Ve._mult(1/rt),Y.push(Ve._mult(O)._add(Ee))}U.push(Y)}return U})(d,I*v)),(function(R,O,U){for(let V=0;V<O.length;V++){const Z=O[V];if(R.length>=3){for(let Y=0;Y<Z.length;Y++)if($c(R,Z[Y]))return!0}if(qp(R,Z,U))return!0}return!1})(b,d,S)}isTileClipped(){return!0}}function vl(n,t){return t>0?t+2*n:n}const Tn=Qi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),ac=Qi([{name:"a_projected_pos",components:3,type:"Float32"}],4);Qi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Vu=Qi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Qi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Oo=Qi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Ff=Qi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Gf(n,t,a){return n.sections.forEach((l=>{l.text=(function(d,_,v){const b=_.layout.get("text-transform").evaluate(v,{});return b==="uppercase"?d=d.toLocaleUpperCase():b==="lowercase"&&(d=d.toLocaleLowerCase()),bs.applyArabicShaping&&(d=bs.applyArabicShaping(d)),d})(l.text,t,a)})),n}Qi([{name:"triangle",components:3,type:"Uint16"}]),Qi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Qi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Qi([{type:"Float32",name:"offsetX"}]),Qi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Qi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const qu={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Ba=24;const Hh=4294967296,kr=1/Hh,Uf=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class er{constructor(t=new Uint8Array(16)){this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(t,a,l=this.length){for(;this.pos<l;){const d=this.readVarint(),_=d>>3,v=this.pos;this.type=7&d,t(_,a,this),this.pos===v&&this.skip(d)}return a}readMessage(t,a){return this.readFields(t,a,this.readVarint()+this.pos)}readFixed32(){const t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){const t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Hh;return this.pos+=8,t}readSFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Hh;return this.pos+=8,t}readFloat(){const t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){const t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){const a=this.buf;let l,d;return d=a[this.pos++],l=127&d,d<128?l:(d=a[this.pos++],l|=(127&d)<<7,d<128?l:(d=a[this.pos++],l|=(127&d)<<14,d<128?l:(d=a[this.pos++],l|=(127&d)<<21,d<128?l:(d=a[this.pos],l|=(15&d)<<28,(function(_,v,b){const S=b.buf;let I,R;if(R=S[b.pos++],I=(112&R)>>4,R<128||(R=S[b.pos++],I|=(127&R)<<3,R<128)||(R=S[b.pos++],I|=(127&R)<<10,R<128)||(R=S[b.pos++],I|=(127&R)<<17,R<128)||(R=S[b.pos++],I|=(127&R)<<24,R<128)||(R=S[b.pos++],I|=(1&R)<<31,R<128))return iu(_,I,v);throw new Error("Expected varint not more than 10 bytes")})(l,t,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const t=this.readVarint();return t%2==1?(t+1)/-2:t/2}readBoolean(){return!!this.readVarint()}readString(){const t=this.readVarint()+this.pos,a=this.pos;return this.pos=t,t-a>=12&&Uf?Uf.decode(this.buf.subarray(a,t)):(function(l,d,_){let v="",b=d;for(;b<_;){const S=l[b];let I,R,O,U=null,V=S>239?4:S>223?3:S>191?2:1;if(b+V>_)break;V===1?S<128&&(U=S):V===2?(I=l[b+1],(192&I)==128&&(U=(31&S)<<6|63&I,U<=127&&(U=null))):V===3?(I=l[b+1],R=l[b+2],(192&I)==128&&(192&R)==128&&(U=(15&S)<<12|(63&I)<<6|63&R,(U<=2047||U>=55296&&U<=57343)&&(U=null))):V===4&&(I=l[b+1],R=l[b+2],O=l[b+3],(192&I)==128&&(192&R)==128&&(192&O)==128&&(U=(15&S)<<18|(63&I)<<12|(63&R)<<6|63&O,(U<=65535||U>=1114112)&&(U=null))),U===null?(U=65533,V=1):U>65535&&(U-=65536,v+=String.fromCharCode(U>>>10&1023|55296),U=56320|1023&U),v+=String.fromCharCode(U),b+=V}return v})(this.buf,a,t)}readBytes(){const t=this.readVarint()+this.pos,a=this.buf.subarray(this.pos,t);return this.pos=t,a}readPackedVarint(t=[],a){const l=this.readPackedEnd();for(;this.pos<l;)t.push(this.readVarint(a));return t}readPackedSVarint(t=[]){const a=this.readPackedEnd();for(;this.pos<a;)t.push(this.readSVarint());return t}readPackedBoolean(t=[]){const a=this.readPackedEnd();for(;this.pos<a;)t.push(this.readBoolean());return t}readPackedFloat(t=[]){const a=this.readPackedEnd();for(;this.pos<a;)t.push(this.readFloat());return t}readPackedDouble(t=[]){const a=this.readPackedEnd();for(;this.pos<a;)t.push(this.readDouble());return t}readPackedFixed32(t=[]){const a=this.readPackedEnd();for(;this.pos<a;)t.push(this.readFixed32());return t}readPackedSFixed32(t=[]){const a=this.readPackedEnd();for(;this.pos<a;)t.push(this.readSFixed32());return t}readPackedFixed64(t=[]){const a=this.readPackedEnd();for(;this.pos<a;)t.push(this.readFixed64());return t}readPackedSFixed64(t=[]){const a=this.readPackedEnd();for(;this.pos<a;)t.push(this.readSFixed64());return t}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(t){const a=7&t;if(a===0)for(;this.buf[this.pos++]>127;);else if(a===2)this.pos=this.readVarint()+this.pos;else if(a===5)this.pos+=4;else{if(a!==1)throw new Error(`Unimplemented type: ${a}`);this.pos+=8}}writeTag(t,a){this.writeVarint(t<<3|a)}realloc(t){let a=this.length||16;for(;a<this.pos+t;)a*=2;if(a!==this.length){const l=new Uint8Array(a);l.set(this.buf),this.buf=l,this.dataView=new DataView(l.buffer),this.length=a}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*kr),!0),this.pos+=8}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*kr),!0),this.pos+=8}writeVarint(t){(t=+t||0)>268435455||t<0?(function(a,l){let d,_;if(a>=0?(d=a%4294967296|0,_=a/4294967296|0):(d=~(-a%4294967296),_=~(-a/4294967296),4294967295^d?d=d+1|0:(d=0,_=_+1|0)),a>=18446744073709552e3||a<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),(function(v,b,S){S.buf[S.pos++]=127&v|128,v>>>=7,S.buf[S.pos++]=127&v|128,v>>>=7,S.buf[S.pos++]=127&v|128,v>>>=7,S.buf[S.pos++]=127&v|128,S.buf[S.pos]=127&(v>>>=7)})(d,0,l),(function(v,b){const S=(7&v)<<4;b.buf[b.pos++]|=S|((v>>>=3)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v)))))})(_,l)})(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))}writeSVarint(t){this.writeVarint(t<0?2*-t-1:2*t)}writeBoolean(t){this.writeVarint(+t)}writeString(t){t=String(t),this.realloc(4*t.length),this.pos++;const a=this.pos;this.pos=(function(d,_,v){for(let b,S,I=0;I<_.length;I++){if(b=_.charCodeAt(I),b>55295&&b<57344){if(!S){b>56319||I+1===_.length?(d[v++]=239,d[v++]=191,d[v++]=189):S=b;continue}if(b<56320){d[v++]=239,d[v++]=191,d[v++]=189,S=b;continue}b=S-55296<<10|b-56320|65536,S=null}else S&&(d[v++]=239,d[v++]=191,d[v++]=189,S=null);b<128?d[v++]=b:(b<2048?d[v++]=b>>6|192:(b<65536?d[v++]=b>>12|224:(d[v++]=b>>18|240,d[v++]=b>>12&63|128),d[v++]=b>>6&63|128),d[v++]=63&b|128)}return v})(this.buf,t,this.pos);const l=this.pos-a;l>=128&&Vf(a,l,this),this.pos=a-1,this.writeVarint(l),this.pos+=l}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8}writeBytes(t){const a=t.length;this.writeVarint(a),this.realloc(a);for(let l=0;l<a;l++)this.buf[this.pos++]=t[l]}writeRawMessage(t,a){this.pos++;const l=this.pos;t(a,this);const d=this.pos-l;d>=128&&Vf(l,d,this),this.pos=l-1,this.writeVarint(d),this.pos+=d}writeMessage(t,a,l){this.writeTag(t,2),this.writeRawMessage(a,l)}writePackedVarint(t,a){a.length&&this.writeMessage(t,ng,a)}writePackedSVarint(t,a){a.length&&this.writeMessage(t,nc,a)}writePackedBoolean(t,a){a.length&&this.writeMessage(t,Zu,a)}writePackedFloat(t,a){a.length&&this.writeMessage(t,jd,a)}writePackedDouble(t,a){a.length&&this.writeMessage(t,qf,a)}writePackedFixed32(t,a){a.length&&this.writeMessage(t,om,a)}writePackedSFixed32(t,a){a.length&&this.writeMessage(t,lm,a)}writePackedFixed64(t,a){a.length&&this.writeMessage(t,cm,a)}writePackedSFixed64(t,a){a.length&&this.writeMessage(t,um,a)}writeBytesField(t,a){this.writeTag(t,2),this.writeBytes(a)}writeFixed32Field(t,a){this.writeTag(t,5),this.writeFixed32(a)}writeSFixed32Field(t,a){this.writeTag(t,5),this.writeSFixed32(a)}writeFixed64Field(t,a){this.writeTag(t,1),this.writeFixed64(a)}writeSFixed64Field(t,a){this.writeTag(t,1),this.writeSFixed64(a)}writeVarintField(t,a){this.writeTag(t,0),this.writeVarint(a)}writeSVarintField(t,a){this.writeTag(t,0),this.writeSVarint(a)}writeStringField(t,a){this.writeTag(t,2),this.writeString(a)}writeFloatField(t,a){this.writeTag(t,5),this.writeFloat(a)}writeDoubleField(t,a){this.writeTag(t,1),this.writeDouble(a)}writeBooleanField(t,a){this.writeVarintField(t,+a)}}function iu(n,t,a){return a?4294967296*t+(n>>>0):4294967296*(t>>>0)+(n>>>0)}function Vf(n,t,a){const l=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));a.realloc(l);for(let d=a.pos-1;d>=n;d--)a.buf[d+l]=a.buf[d]}function ng(n,t){for(let a=0;a<n.length;a++)t.writeVarint(n[a])}function nc(n,t){for(let a=0;a<n.length;a++)t.writeSVarint(n[a])}function jd(n,t){for(let a=0;a<n.length;a++)t.writeFloat(n[a])}function qf(n,t){for(let a=0;a<n.length;a++)t.writeDouble(n[a])}function Zu(n,t){for(let a=0;a<n.length;a++)t.writeBoolean(n[a])}function om(n,t){for(let a=0;a<n.length;a++)t.writeFixed32(n[a])}function lm(n,t){for(let a=0;a<n.length;a++)t.writeSFixed32(n[a])}function cm(n,t){for(let a=0;a<n.length;a++)t.writeFixed64(n[a])}function um(n,t){for(let a=0;a<n.length;a++)t.writeSFixed64(n[a])}function Fd(n,t,a){n===1&&a.readMessage(Zf,t)}function Zf(n,t,a){if(n===3){const{id:l,bitmap:d,width:_,height:v,left:b,top:S,advance:I}=a.readMessage(rg,{});t.push({id:l,bitmap:new ku({width:_+6,height:v+6},d),metrics:{width:_,height:v,left:b,top:S,advance:I}})}}function rg(n,t,a){n===1?t.id=a.readVarint():n===2?t.bitmap=a.readBytes():n===3?t.width=a.readVarint():n===4?t.height=a.readVarint():n===5?t.left=a.readSVarint():n===6?t.top=a.readSVarint():n===7&&(t.advance=a.readVarint())}function hm(n){let t=0,a=0;for(const v of n)t+=v.w*v.h,a=Math.max(a,v.w);n.sort(((v,b)=>b.h-v.h));const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),a),h:1/0}];let d=0,_=0;for(const v of n)for(let b=l.length-1;b>=0;b--){const S=l[b];if(!(v.w>S.w||v.h>S.h)){if(v.x=S.x,v.y=S.y,_=Math.max(_,v.y+v.h),d=Math.max(d,v.x+v.w),v.w===S.w&&v.h===S.h){const I=l.pop();I&&b<l.length&&(l[b]=I)}else v.h===S.h?(S.x+=v.w,S.w-=v.w):v.w===S.w?(S.y+=v.h,S.h-=v.h):(l.push({x:S.x+v.w,y:S.y,w:S.w-v.w,h:v.h}),S.y+=v.h,S.h-=v.h);break}}return{w:d,h:_,fill:t/(d*_)||0}}class $f{constructor(t,{pixelRatio:a,version:l,stretchX:d,stretchY:_,content:v,textFitWidth:b,textFitHeight:S}){this.paddedRect=t,this.pixelRatio=a,this.stretchX=d,this.stretchY=_,this.content=v,this.version=l,this.textFitWidth=b,this.textFitHeight=S}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Hf{constructor(t,a){const l={},d={};this.haveRenderCallbacks=[];const _=[];this.addImages(t,l,_),this.addImages(a,d,_);const{w:v,h:b}=hm(_),S=new Vn({width:v||1,height:b||1});for(const I in t){const R=t[I],O=l[I].paddedRect;Vn.copy(R.data,S,{x:0,y:0},{x:O.x+1,y:O.y+1},R.data)}for(const I in a){const R=a[I],O=d[I].paddedRect,U=O.x+1,V=O.y+1,Z=R.data.width,Y=R.data.height;Vn.copy(R.data,S,{x:0,y:0},{x:U,y:V},R.data),Vn.copy(R.data,S,{x:0,y:Y-1},{x:U,y:V-1},{width:Z,height:1}),Vn.copy(R.data,S,{x:0,y:0},{x:U,y:V+Y},{width:Z,height:1}),Vn.copy(R.data,S,{x:Z-1,y:0},{x:U-1,y:V},{width:1,height:Y}),Vn.copy(R.data,S,{x:0,y:0},{x:U+Z,y:V},{width:1,height:Y})}this.image=S,this.iconPositions=l,this.patternPositions=d}addImages(t,a,l){for(const d in t){const _=t[d],v={x:0,y:0,w:_.data.width+2,h:_.data.height+2};l.push(v),a[d]=new $f(v,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(t,a){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in t.updatedImages)this.patchUpdatedImage(this.iconPositions[l],t.getImage(l),a),this.patchUpdatedImage(this.patternPositions[l],t.getImage(l),a)}patchUpdatedImage(t,a,l){if(!t||!a||t.version===a.version)return;t.version=a.version;const[d,_]=t.tl;l.update(a.data,void 0,{x:d,y:_})}}var xl;Tt("ImagePosition",$f),Tt("ImageAtlas",Hf),E.ao=void 0,(xl=E.ao||(E.ao={}))[xl.none=0]="none",xl[xl.horizontal=1]="horizontal",xl[xl.vertical=2]="vertical",xl[xl.horizontalOnly=3]="horizontalOnly";class Bo{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,a,l){const d=new Bo;return d.scale=t||1,d.fontStack=a,d.verticalAlign=l||"bottom",d}static forImage(t,a){const l=new Bo;return l.imageName=t,l.verticalAlign=a||"bottom",l}}class bl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,a){const l=new bl;for(let d=0;d<t.sections.length;d++){const _=t.sections[d];_.image?l.addImageSection(_):l.addTextSection(_,a)}return l}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=(function(t){let a="";for(let l=0;l<t.length;l++){const d=t.charCodeAt(l+1)||null,_=t.charCodeAt(l-1)||null;a+=d&&jc(d)&&!qu[t[l+1]]||_&&jc(_)&&!qu[t[l-1]]||!qu[t[l]]?t[l]:qu[t[l]]}return a})(this.text)}trim(){let t=0;for(let l=0;l<this.text.length&&Yh[this.text.charCodeAt(l)];l++)t++;let a=this.text.length;for(let l=this.text.length-1;l>=0&&l>=t&&Yh[this.text.charCodeAt(l)];l--)a--;this.text=this.text.substring(t,a),this.sectionIndex=this.sectionIndex.slice(t,a)}substring(t,a){const l=new bl;return l.text=this.text.substring(t,a),l.sectionIndex=this.sectionIndex.slice(t,a),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,a)=>Math.max(t,this.sections[a].scale)),0)}getMaxImageSize(t){let a=0,l=0;for(let d=0;d<this.length();d++){const _=this.getSection(d);if(_.imageName){const v=t[_.imageName];if(!v)continue;const b=v.displaySize;a=Math.max(a,b[0]),l=Math.max(l,b[1])}}return{maxImageWidth:a,maxImageHeight:l}}addTextSection(t,a){this.text+=t.text,this.sections.push(Bo.forText(t.scale,t.fontStack||a,t.verticalAlign));const l=this.sections.length-1;for(let d=0;d<t.text.length;++d)this.sectionIndex.push(l)}addImageSection(t){const a=t.image?t.image.name:"";if(a.length===0)return void Xt("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(Bo.forImage(a,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):Xt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Xh(n,t,a,l,d,_,v,b,S,I,R,O,U,V,Z){const Y=bl.fromFeature(n,d);let ie;O===E.ao.vertical&&Y.verticalizePunctuation();const{processBidirectionalText:se,processStyledBidirectionalText:Ee}=bs;if(se&&Y.sections.length===1){ie=[];const ke=se(Y.toString(),ea(Y,I,_,t,l,V));for(const Ve of ke){const rt=new bl;rt.text=Ve,rt.sections=Y.sections;for(let St=0;St<Ve.length;St++)rt.sectionIndex.push(0);ie.push(rt)}}else if(Ee){ie=[];const ke=Ee(Y.text,Y.sectionIndex,ea(Y,I,_,t,l,V));for(const Ve of ke){const rt=new bl;rt.text=Ve[0],rt.sectionIndex=Ve[1],rt.sections=Y.sections,ie.push(rt)}}else ie=(function(ke,Ve){const rt=[],St=ke.text;let pt=0;for(const bt of Ve)rt.push(ke.substring(pt,bt)),pt=bt;return pt<St.length&&rt.push(ke.substring(pt,St.length)),rt})(Y,ea(Y,I,_,t,l,V));const de=[],ge={positionedLines:de,text:Y.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:O,iconsInText:!1,verticalizable:!1};return(function(ke,Ve,rt,St,pt,bt,Nt,yt,wt,et,$t,Wt){let Zt=0,Dt=0,pi=0,pa=0;const Ga=yt==="right"?1:yt==="left"?0:.5,En=Ba/Wt;let br=0;for(const Hi of pt){Hi.trim();const Na=Hi.getMaxScale(),Ua={positionedGlyphs:[],lineOffset:0};ke.positionedLines[br]=Ua;const Pa=Ua.positionedGlyphs;let tr=0;if(!Hi.length()){Dt+=bt,++br;continue}const Or=sg(St,Hi,En);for(let wr=0;wr<Hi.length();wr++){const Qa=Hi.getSection(wr),Va=Hi.getSectionIndex(wr),ln=Hi.getCharCode(wr),Ka=og(wt,$t,ln);let ta;if(Qa.imageName){if(ke.iconsInText=!0,Qa.scale=Qa.scale*En,ta=cg(Qa,Ka,Na,Or,St),!ta)continue;tr=Math.max(tr,ta.imageOffset)}else if(ta=lg(Qa,ln,Ka,Or,Ve,rt),!ta)continue;const{rect:Br,metrics:ru,baselineOffset:ir}=ta;Pa.push({glyph:ln,imageName:Qa.imageName,x:Zt,y:Dt+ir+-17,vertical:Ka,scale:Qa.scale,fontStack:Qa.fontStack,sectionIndex:Va,metrics:ru,rect:Br}),Ka?(ke.verticalizable=!0,Zt+=(Qa.imageName?ru.advance:Ba)*Qa.scale+et):Zt+=ru.advance*Qa.scale+et}Pa.length!==0&&(pi=Math.max(Zt-et,pi),Ud(Pa,0,Pa.length-1,Ga)),Zt=0,Ua.lineOffset=Math.max(tr,(Na-1)*Ba);const ja=bt*Na+tr;Dt+=ja,pa=Math.max(ja,pa),++br}const{horizontalAlign:Wa,verticalAlign:Aa}=Wh(Nt);(function(Hi,Na,Ua,Pa,tr,Or,ja,wr,Qa){const Va=(Na-Ua)*tr;let ln=0;ln=Or!==ja?-wr*Pa- -17:-Pa*Qa*ja+.5*ja;for(const Ka of Hi)for(const ta of Ka.positionedGlyphs)ta.x+=Va,ta.y+=ln})(ke.positionedLines,Ga,Wa,Aa,pi,pa,bt,Dt,pt.length),ke.top+=-Aa*Dt,ke.bottom=ke.top+Dt,ke.left+=-Wa*pi,ke.right=ke.left+pi})(ge,t,a,l,ie,v,b,S,O,I,U,Z),!(function(ke){for(const Ve of ke)if(Ve.positionedGlyphs.length!==0)return!1;return!0})(de)&&ge}const Yh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},dm={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},fm={40:!0};function Xf(n,t,a,l,d,_){if(t.imageName){const v=l[t.imageName];return v?v.displaySize[0]*t.scale*Ba/_+d:0}{const v=a[t.fontStack],b=v&&v[n];return b?b.metrics.advance*t.scale+d:0}}function Yf(n,t,a,l){const d=Math.pow(n-t,2);return l?n<t?d/2:2*d:d+Math.abs(a)*a}function Gd(n,t,a){let l=0;return n===10&&(l-=1e4),a&&(l+=150),n!==40&&n!==65288||(l+=50),t!==41&&t!==65289||(l+=50),l}function Wf(n,t,a,l,d,_){let v=null,b=Yf(t,a,d,_);for(const S of l){const I=Yf(t-S.x,a,d,_)+S.badness;I<=b&&(v=S,b=I)}return{index:n,x:t,priorBreak:v,badness:b}}function Qf(n){return n?Qf(n.priorBreak).concat(n.index):[]}function ea(n,t,a,l,d,_){if(!n)return[];const v=[],b=(function(O,U,V,Z,Y,ie){let se=0;for(let Ee=0;Ee<O.length();Ee++){const de=O.getSection(Ee);se+=Xf(O.getCharCode(Ee),de,Z,Y,U,ie)}return se/Math.max(1,Math.ceil(se/V))})(n,t,a,l,d,_),S=n.text.indexOf("")>=0;let I=0;for(let O=0;O<n.length();O++){const U=n.getSection(O),V=n.getCharCode(O);if(Yh[V]||(I+=Xf(V,U,l,d,t,_)),O<n.length()-1){const Z=!((R=V)<11904)&&(!!oi["CJK Compatibility Forms"](R)||!!oi["CJK Compatibility"](R)||!!oi["CJK Strokes"](R)||!!oi["CJK Symbols and Punctuation"](R)||!!oi["Enclosed CJK Letters and Months"](R)||!!oi["Halfwidth and Fullwidth Forms"](R)||!!oi["Ideographic Description Characters"](R)||!!oi["Vertical Forms"](R)||Nc.test(String.fromCodePoint(R)));(dm[V]||Z||U.imageName||O!==n.length()-2&&fm[n.getCharCode(O+1)])&&v.push(Wf(O+1,I,b,v,Gd(V,n.getCharCode(O+1),Z&&S),!1))}}var R;return Qf(Wf(n.length(),I,b,v,0,!0))}function Wh(n){let t=.5,a=.5;switch(n){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:t,verticalAlign:a}}function sg(n,t,a){const l=t.getMaxScale()*Ba,{maxImageWidth:d,maxImageHeight:_}=t.getMaxImageSize(n),v=Math.max(l,_*a);return{verticalLineContentWidth:Math.max(l,d*a),horizontalLineContentHeight:v}}function Kf(n){switch(n){case"top":return 0;case"center":return .5;default:return 1}}function og(n,t,a){return!(n===E.ao.horizontal||!t&&!Eo(a)||t&&(Yh[a]||(l=a,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(l)))));var l}function lg(n,t,a,l,d,_){const v=_[n.fontStack],b=(function(I,R,O,U){if(I&&I.rect)return I;const V=R[O.fontStack],Z=V&&V[U];return Z?{rect:null,metrics:Z.metrics}:null})(v&&v[t],d,n,t);if(b===null)return null;let S;if(a)S=l.verticalLineContentWidth-n.scale*Ba;else{const I=Kf(n.verticalAlign);S=(l.horizontalLineContentHeight-n.scale*Ba)*I}return{rect:b.rect,metrics:b.metrics,baselineOffset:S}}function cg(n,t,a,l,d){const _=d[n.imageName];if(!_)return null;const v=_.paddedRect,b=_.displaySize,S={width:b[0],height:b[1],left:1,top:-3,advance:t?b[1]:b[0]};let I;if(t)I=l.verticalLineContentWidth-b[1]*n.scale;else{const R=Kf(n.verticalAlign);I=(l.horizontalLineContentHeight-b[1]*n.scale)*R}return{rect:v,metrics:S,baselineOffset:I,imageOffset:(t?b[0]:b[1])*n.scale-Ba*a}}function Ud(n,t,a,l){if(l===0)return;const d=n[a],_=(n[a].x+d.metrics.advance*d.scale)*l;for(let v=t;v<=a;v++)n[v].x-=_}function $u(n,t,a){const{horizontalAlign:l,verticalAlign:d}=Wh(a),_=t[0]-n.displaySize[0]*l,v=t[1]-n.displaySize[1]*d;return{image:n,top:v,bottom:v+n.displaySize[1],left:_,right:_+n.displaySize[0]}}function Vd(n){var t,a;let l=n.left,d=n.top,_=n.right-l,v=n.bottom-d;const b=(t=n.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",S=(a=n.image.textFitHeight)!==null&&a!==void 0?a:"stretchOrShrink",I=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(S==="proportional"){if(b==="stretchOnly"&&_/v<I||b==="proportional"){const R=Math.ceil(v*I);l*=R/_,_=R}}else if(b==="proportional"&&S==="stretchOnly"&&I!==0&&_/v>I){const R=Math.ceil(_/I);d*=R/v,v=R}return{x1:l,y1:d,x2:l+_,y2:d+v}}function Qh(n,t,a,l,d,_){const v=n.image;let b;if(v.content){const ie=v.content,se=v.pixelRatio||1;b=[ie[0]/se,ie[1]/se,v.displaySize[0]-ie[2]/se,v.displaySize[1]-ie[3]/se]}const S=t.left*_,I=t.right*_;let R,O,U,V;a==="width"||a==="both"?(V=d[0]+S-l[3],O=d[0]+I+l[1]):(V=d[0]+(S+I-v.displaySize[0])/2,O=V+v.displaySize[0]);const Z=t.top*_,Y=t.bottom*_;return a==="height"||a==="both"?(R=d[1]+Z-l[0],U=d[1]+Y+l[2]):(R=d[1]+(Z+Y-v.displaySize[1])/2,U=R+v.displaySize[1]),{image:v,top:R,right:O,bottom:U,left:V,collisionPadding:b}}const Js=128,xr=32640;function eo(n,t){const{expression:a}=t;if(a.kind==="constant")return{kind:"constant",layoutSize:a.evaluate(new Wi(n+1))};if(a.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:d}=a;let _=0;for(;_<l.length&&l[_]<=n;)_++;_=Math.max(0,_-1);let v=_;for(;v<l.length&&l[v]<n+1;)v++;v=Math.min(l.length-1,v);const b=l[_],S=l[v];return a.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:S,interpolationType:d}:{kind:"camera",minZoom:b,maxZoom:S,minSize:a.evaluate(new Wi(b)),maxSize:a.evaluate(new Wi(S)),interpolationType:d}}}function au(n,t,a){let l="never";const d=n.get(t);return d?l=d:n.get(a)&&(l="always"),l}const ug=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Kh(n,t,a,l,d,_,v,b,S,I,R,O,U){const V=b?Math.min(xr,Math.round(b[0])):0,Z=b?Math.min(xr,Math.round(b[1])):0;n.emplaceBack(t,a,Math.round(32*l),Math.round(32*d),_,v,(V<<1)+(S?1:0),Z,16*I,16*R,256*O,256*U)}function qd(n,t,a){n.emplaceBack(t.x,t.y,a),n.emplaceBack(t.x,t.y,a),n.emplaceBack(t.x,t.y,a),n.emplaceBack(t.x,t.y,a)}function pm(n){for(const t of n.sections)if(qs(t.text))return!0;return!1}class Zd{constructor(t){this.layoutVertexArray=new dt,this.indexArray=new Vi,this.programConfigurations=t,this.segments=new vi,this.dynamicLayoutVertexArray=new it,this.opacityVertexArray=new Rt,this.hasVisibleVertices=!1,this.placedSymbolArray=new q}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,a,l,d){this.isEmpty()||(l&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Tn.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,ac.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,ug,!0),this.opacityVertexBuffer.itemSize=1),(l||d)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Tt("SymbolBuffers",Zd);class Jf{constructor(t,a,l){this.layoutVertexArray=new t,this.layoutAttributes=a,this.indexArray=new l,this.segments=new vi,this.collisionVertexArray=new Ii}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Vu.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Tt("CollisionBuffers",Jf);class rc{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=Si(globalThis)?Math.min(t.overscaling,128):t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((v=>v.id)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=eo(this.zoom,a["text-size"]),this.iconSizeData=eo(this.zoom,a["icon-size"]);const l=this.layers[0].layout,d=l.get("symbol-sort-key"),_=l.get("symbol-z-order");this.canOverlap=au(l,"text-overlap","text-allow-overlap")!=="never"||au(l,"icon-overlap","icon-allow-overlap")!=="never"||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&!d.isConstant(),this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,l.get("symbol-placement")==="point"&&(this.writingModes=l.get("text-writing-mode").map((v=>E.ao[v]))),this.stateDependentLayerIds=this.layers.filter((v=>v.isStateDependent())).map((v=>v.id)),this.sourceID=t.sourceID}createArrays(){this.text=new Zd(new Ms(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new Zd(new Ms(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new ne,this.lineVertexArray=new re,this.symbolInstances=new ae,this.textAnchorOffsets=new ue}calculateGlyphDependencies(t,a,l,d,_){for(let v=0;v<t.length;v++)if(a[t.charCodeAt(v)]=!0,(l||d)&&_){const b=qu[t.charAt(v)];b&&(a[b.charCodeAt(0)]=!0)}}populate(t,a,l){const d=this.layers[0],_=d.layout,v=_.get("text-font"),b=_.get("text-field"),S=_.get("icon-image"),I=(b.value.kind!=="constant"||b.value.value instanceof en&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),R=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,O=_.get("symbol-sort-key");if(this.features=[],!I&&!R)return;const U=a.iconDependencies,V=a.glyphDependencies,Z=a.availableImages,Y=new Wi(this.zoom);for(const{feature:ie,id:se,index:Ee,sourceLayerIndex:de}of t){const ge=d._featureFilter.needGeometry,ke=ts(ie,ge);if(!d._featureFilter.filter(Y,ke,l))continue;let Ve,rt;if(ge||(ke.geometry=Yl(ie)),I){const pt=d.getValueAndResolveTokens("text-field",ke,l,Z),bt=en.factory(pt),Nt=this.hasRTLText=this.hasRTLText||pm(bt);(!Nt||bs.getRTLTextPluginStatus()==="unavailable"||Nt&&bs.isParsed())&&(Ve=Gf(bt,d,ke))}if(R){const pt=d.getValueAndResolveTokens("icon-image",ke,l,Z);rt=pt instanceof Nn?pt:Nn.fromString(pt)}if(!Ve&&!rt)continue;const St=this.sortFeaturesByKey?O.evaluate(ke,{},l):void 0;if(this.features.push({id:se,text:Ve,icon:rt,index:Ee,sourceLayerIndex:de,geometry:ke.geometry,properties:ie.properties,type:Wc.types[ie.type],sortKey:St}),rt&&(U[rt.name]=!0),Ve){const pt=v.evaluate(ke,{},l).join(","),bt=_.get("text-rotation-alignment")!=="viewport"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(E.ao.vertical)>=0;for(const Nt of Ve.sections)if(Nt.image)U[Nt.image.name]=!0;else{const yt=xs(Ve.toString()),wt=Nt.fontStack||pt,et=V[wt]=V[wt]||{};this.calculateGlyphDependencies(Nt.text,et,bt,this.allowVerticalPlacement,yt)}}}_.get("symbol-placement")==="line"&&(this.features=(function(ie){const se={},Ee={},de=[];let ge=0;function ke(pt){de.push(ie[pt]),ge++}function Ve(pt,bt,Nt){const yt=Ee[pt];return delete Ee[pt],Ee[bt]=yt,de[yt].geometry[0].pop(),de[yt].geometry[0]=de[yt].geometry[0].concat(Nt[0]),yt}function rt(pt,bt,Nt){const yt=se[bt];return delete se[bt],se[pt]=yt,de[yt].geometry[0].shift(),de[yt].geometry[0]=Nt[0].concat(de[yt].geometry[0]),yt}function St(pt,bt,Nt){const yt=Nt?bt[0][bt[0].length-1]:bt[0][0];return`${pt}:${yt.x}:${yt.y}`}for(let pt=0;pt<ie.length;pt++){const bt=ie[pt],Nt=bt.geometry,yt=bt.text?bt.text.toString():null;if(!yt){ke(pt);continue}const wt=St(yt,Nt),et=St(yt,Nt,!0);if(wt in Ee&&et in se&&Ee[wt]!==se[et]){const $t=rt(wt,et,Nt),Wt=Ve(wt,et,de[$t].geometry);delete se[wt],delete Ee[et],Ee[St(yt,de[Wt].geometry,!0)]=Wt,de[$t].geometry=null}else wt in Ee?Ve(wt,et,Nt):et in se?rt(wt,et,Nt):(ke(pt),se[wt]=ge-1,Ee[et]=ge-1)}return de.filter((pt=>pt.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((ie,se)=>ie.sortKey-se.sortKey))}update(t,a,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,a,this.layers,{imagePositions:l}),this.icon.programConfigurations.updatePaintArrays(t,a,this.layers,{imagePositions:l}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,a){const l=this.lineVertexArray.length;if(t.segment!==void 0){let d=t.dist(a[t.segment+1]),_=t.dist(a[t.segment]);const v={};for(let b=t.segment+1;b<a.length;b++)v[b]={x:a[b].x,y:a[b].y,tileUnitDistanceFromAnchor:d},b<a.length-1&&(d+=a[b+1].dist(a[b]));for(let b=t.segment||0;b>=0;b--)v[b]={x:a[b].x,y:a[b].y,tileUnitDistanceFromAnchor:_},b>0&&(_+=a[b-1].dist(a[b]));for(let b=0;b<a.length;b++){const S=v[b];this.lineVertexArray.emplaceBack(S.x,S.y,S.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(t,a,l,d,_,v,b,S,I,R,O,U){const V=t.indexArray,Z=t.layoutVertexArray,Y=t.segments.prepareSegment(4*a.length,Z,V,this.canOverlap?v.sortKey:void 0),ie=this.glyphOffsetArray.length,se=Y.vertexLength,Ee=this.allowVerticalPlacement&&b===E.ao.vertical?Math.PI/2:0,de=v.text&&v.text.sections;for(let ge=0;ge<a.length;ge++){const{tl:ke,tr:Ve,bl:rt,br:St,tex:pt,pixelOffsetTL:bt,pixelOffsetBR:Nt,minFontScaleX:yt,minFontScaleY:wt,glyphOffset:et,isSDF:$t,sectionIndex:Wt}=a[ge],Zt=Y.vertexLength,Dt=et[1];Kh(Z,S.x,S.y,ke.x,Dt+ke.y,pt.x,pt.y,l,$t,bt.x,bt.y,yt,wt),Kh(Z,S.x,S.y,Ve.x,Dt+Ve.y,pt.x+pt.w,pt.y,l,$t,Nt.x,bt.y,yt,wt),Kh(Z,S.x,S.y,rt.x,Dt+rt.y,pt.x,pt.y+pt.h,l,$t,bt.x,Nt.y,yt,wt),Kh(Z,S.x,S.y,St.x,Dt+St.y,pt.x+pt.w,pt.y+pt.h,l,$t,Nt.x,Nt.y,yt,wt),qd(t.dynamicLayoutVertexArray,S,Ee),V.emplaceBack(Zt,Zt+2,Zt+1),V.emplaceBack(Zt+1,Zt+2,Zt+3),Y.vertexLength+=4,Y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(et[0]),ge!==a.length-1&&Wt===a[ge+1].sectionIndex||t.programConfigurations.populatePaintArrays(Z.length,v,v.index,{imagePositions:{},canonical:U,formattedSection:de&&de[Wt]})}t.placedSymbolArray.emplaceBack(S.x,S.y,ie,this.glyphOffsetArray.length-ie,se,I,R,S.segment,l?l[0]:0,l?l[1]:0,d[0],d[1],b,0,!1,0,O)}_addCollisionDebugVertex(t,a,l,d,_,v){return a.emplaceBack(0,0),t.emplaceBack(l.x,l.y,d,_,Math.round(v.x),Math.round(v.y))}addCollisionDebugVertices(t,a,l,d,_,v,b){const S=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),I=S.vertexLength,R=_.layoutVertexArray,O=_.collisionVertexArray,U=b.anchorX,V=b.anchorY;this._addCollisionDebugVertex(R,O,v,U,V,new B(t,a)),this._addCollisionDebugVertex(R,O,v,U,V,new B(l,a)),this._addCollisionDebugVertex(R,O,v,U,V,new B(l,d)),this._addCollisionDebugVertex(R,O,v,U,V,new B(t,d)),S.vertexLength+=4;const Z=_.indexArray;Z.emplaceBack(I,I+1),Z.emplaceBack(I+1,I+2),Z.emplaceBack(I+2,I+3),Z.emplaceBack(I+3,I),S.primitiveLength+=4}addDebugCollisionBoxes(t,a,l,d){for(let _=t;_<a;_++){const v=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(v.x1,v.y1,v.x2,v.y2,d?this.textCollisionBox:this.iconCollisionBox,v.anchorPoint,l)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Jf(ei,Oo.members,qi),this.iconCollisionBox=new Jf(ei,Oo.members,qi);for(let t=0;t<this.symbolInstances.length;t++){const a=this.symbolInstances.get(t);this.addDebugCollisionBoxes(a.textBoxStartIndex,a.textBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.iconBoxStartIndex,a.iconBoxEndIndex,a,!1),this.addDebugCollisionBoxes(a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a,!1)}}_deserializeCollisionBoxesForSymbol(t,a,l,d,_,v,b,S,I){const R={};for(let O=a;O<l;O++){const U=t.get(O);R.textBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},R.textFeatureIndex=U.featureIndex;break}for(let O=d;O<_;O++){const U=t.get(O);R.verticalTextBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},R.verticalTextFeatureIndex=U.featureIndex;break}for(let O=v;O<b;O++){const U=t.get(O);R.iconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},R.iconFeatureIndex=U.featureIndex;break}for(let O=S;O<I;O++){const U=t.get(O);R.verticalIconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},R.verticalIconFeatureIndex=U.featureIndex;break}return R}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const l=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,a){const l=t.placedSymbolArray.get(a),d=l.vertexStartIndex+4*l.numGlyphs;for(let _=l.vertexStartIndex;_<d;_+=4)t.indexArray.emplaceBack(_,_+2,_+1),t.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const a=Math.sin(t),l=Math.cos(t),d=[],_=[],v=[];for(let b=0;b<this.symbolInstances.length;++b){v.push(b);const S=this.symbolInstances.get(b);d.push(0|Math.round(a*S.anchorX+l*S.anchorY)),_.push(S.featureIndex)}return v.sort(((b,S)=>d[b]-d[S]||_[S]-_[b])),v}addToSortKeyRanges(t,a){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===a?l.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const l=this.symbolInstances.get(a);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach(((d,_,v)=>{d>=0&&v.indexOf(d)===_&&this.addIndicesForPlacedSymbol(this.text,d)})),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let ep,tp;Tt("SymbolBucket",rc,{omit:["layers","collisionBoxArray","features","compareText"]}),rc.MAX_GLYPHS=65535,rc.addDynamicAttributes=qd;var ip={get paint(){return tp=tp||new la({"icon-opacity":new qt(Pe.paint_symbol["icon-opacity"]),"icon-color":new qt(Pe.paint_symbol["icon-color"]),"icon-halo-color":new qt(Pe.paint_symbol["icon-halo-color"]),"icon-halo-width":new qt(Pe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new qt(Pe.paint_symbol["icon-halo-blur"]),"icon-translate":new Pt(Pe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Pt(Pe.paint_symbol["icon-translate-anchor"]),"text-opacity":new qt(Pe.paint_symbol["text-opacity"]),"text-color":new qt(Pe.paint_symbol["text-color"],{runtimeType:ar,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new qt(Pe.paint_symbol["text-halo-color"]),"text-halo-width":new qt(Pe.paint_symbol["text-halo-width"]),"text-halo-blur":new qt(Pe.paint_symbol["text-halo-blur"]),"text-translate":new Pt(Pe.paint_symbol["text-translate"]),"text-translate-anchor":new Pt(Pe.paint_symbol["text-translate-anchor"])})},get layout(){return ep=ep||new la({"symbol-placement":new Pt(Pe.layout_symbol["symbol-placement"]),"symbol-spacing":new Pt(Pe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Pt(Pe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new qt(Pe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Pt(Pe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Pt(Pe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Pt(Pe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Pt(Pe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Pt(Pe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Pt(Pe.layout_symbol["icon-rotation-alignment"]),"icon-size":new qt(Pe.layout_symbol["icon-size"]),"icon-text-fit":new Pt(Pe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Pt(Pe.layout_symbol["icon-text-fit-padding"]),"icon-image":new qt(Pe.layout_symbol["icon-image"]),"icon-rotate":new qt(Pe.layout_symbol["icon-rotate"]),"icon-padding":new qt(Pe.layout_symbol["icon-padding"]),"icon-keep-upright":new Pt(Pe.layout_symbol["icon-keep-upright"]),"icon-offset":new qt(Pe.layout_symbol["icon-offset"]),"icon-anchor":new qt(Pe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Pt(Pe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Pt(Pe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Pt(Pe.layout_symbol["text-rotation-alignment"]),"text-field":new qt(Pe.layout_symbol["text-field"]),"text-font":new qt(Pe.layout_symbol["text-font"]),"text-size":new qt(Pe.layout_symbol["text-size"]),"text-max-width":new qt(Pe.layout_symbol["text-max-width"]),"text-line-height":new Pt(Pe.layout_symbol["text-line-height"]),"text-letter-spacing":new qt(Pe.layout_symbol["text-letter-spacing"]),"text-justify":new qt(Pe.layout_symbol["text-justify"]),"text-radial-offset":new qt(Pe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Pt(Pe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new qt(Pe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new qt(Pe.layout_symbol["text-anchor"]),"text-max-angle":new Pt(Pe.layout_symbol["text-max-angle"]),"text-writing-mode":new Pt(Pe.layout_symbol["text-writing-mode"]),"text-rotate":new qt(Pe.layout_symbol["text-rotate"]),"text-padding":new Pt(Pe.layout_symbol["text-padding"]),"text-keep-upright":new Pt(Pe.layout_symbol["text-keep-upright"]),"text-transform":new qt(Pe.layout_symbol["text-transform"]),"text-offset":new qt(Pe.layout_symbol["text-offset"]),"text-allow-overlap":new Pt(Pe.layout_symbol["text-allow-overlap"]),"text-overlap":new Pt(Pe.layout_symbol["text-overlap"]),"text-ignore-placement":new Pt(Pe.layout_symbol["text-ignore-placement"]),"text-optional":new Pt(Pe.layout_symbol["text-optional"])})}};class $d{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Ri,this.defaultValue=t}evaluate(t){if(t.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(t.formattedSection))return a.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Tt("FormatSectionOverride",$d,{omit:["defaultValue"]});class Hu extends yn{constructor(t,a){super(t,ip,a)}recalculate(t,a){if(super.recalculate(t,a),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const l=this.layout.get("text-writing-mode");if(l){const d=[];for(const _ of l)d.indexOf(_)<0&&d.push(_);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,a,l,d){const _=this.layout.get(t).evaluate(a,{},l,d),v=this._unevaluatedLayout._values[t];return v.isDataDriven()||jl(v.value)||!_?_:(function(b,S){return S.replace(/{([^{}]+)}/g,((I,R)=>b&&R in b?String(b[R]):""))})(a.properties,_)}createBucket(t){return new rc(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of ip.paint.overridableProperties){if(!Hu.hasPaintOverride(this.layout,t))continue;const a=this.paint.get(t),l=new $d(a),d=new Eu(l,a.property.specification);let _=null;_=a.value.kind==="constant"||a.value.kind==="source"?new Gn("source",d):new Ns("composite",d,a.value.zoomStops),this.paint._values[t]=new Yr(a.property,_,a.parameters)}}_handleOverridablePaintPropertyUpdate(t,a,l){return!(!this.layout||a.isDataDriven()||l.isDataDriven())&&Hu.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,a){const l=t.get("text-field"),d=ip.paint.properties[a];let _=!1;const v=b=>{for(const S of b)if(d.overrides&&d.overrides.hasOverride(S))return void(_=!0)};if(l.value.kind==="constant"&&l.value.value instanceof en)v(l.value.value.sections);else if(l.value.kind==="source"||l.value.kind==="composite"){const b=I=>{_||(I instanceof Yt&&da(I.value)===ls?v(I.value.sections):I instanceof _u?v(I.sections):I.eachChild(b))},S=l.value;S._styleExpression&&b(S._styleExpression.expression)}return _}}let mm;var hg={get paint(){return mm=mm||new la({"background-color":new Pt(Pe.paint_background["background-color"]),"background-pattern":new Pu(Pe.paint_background["background-pattern"]),"background-opacity":new Pt(Pe.paint_background["background-opacity"])})}};class Jh extends yn{constructor(t,a){super(t,hg,a)}}class dg extends yn{constructor(t,a){super(t,{},a),this.onAdd=l=>{this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},this.onRemove=l=>{this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class gm{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Li={once:!0},ed=63710088e-1;class to{constructor(t,a){if(isNaN(t)||isNaN(a))throw new Error(`Invalid LngLat object: (${t}, ${a})`);if(this.lng=+t,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new to(ai(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const a=Math.PI/180,l=this.lat*a,d=t.lat*a,_=Math.sin(l)*Math.sin(d)+Math.cos(l)*Math.cos(d)*Math.cos((t.lng-this.lng)*a);return ed*Math.acos(Math.min(_,1))}static convert(t){if(t instanceof to)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new to(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new to(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Hd=2*Math.PI*ed;function ap(n){return Hd*Math.cos(n*Math.PI/180)}function Xd(n){return(180+n)/360}function Xu(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function td(n,t){return n/ap(t)}function np(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function rp(n,t){return n*ap(np(t))}class id{constructor(t,a,l=0){this.x=+t,this.y=+a,this.z=+l}static fromLngLat(t,a=0){const l=to.convert(t);return new id(Xd(l.lng),Xu(l.lat),td(a,l.lat))}toLngLat(){return new to(360*this.x-180,np(this.y))}toAltitude(){return rp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Hd*(t=np(this.y),1/Math.cos(t*Math.PI/180));var t}}function _m(n,t,a){var l=2*Math.PI*6378137/256/Math.pow(2,a);return[n*l-2*Math.PI*6378137/2,t*l-2*Math.PI*6378137/2]}class Yd{constructor(t,a,l){if(!(function(d,_,v){return!(d<0||d>25||v<0||v>=Math.pow(2,d)||_<0||_>=Math.pow(2,d))})(t,a,l))throw new Error(`x=${a}, y=${l}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=a,this.y=l,this.key=sc(0,t,t,a,l)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,a,l){const d=(v=this.y,b=this.z,S=_m(256*(_=this.x),256*(v=Math.pow(2,b)-v-1),b),I=_m(256*(_+1),256*(v+1),b),S[0]+","+S[1]+","+I[0]+","+I[1]);var _,v,b,S,I;const R=(function(O,U,V){let Z,Y="";for(let ie=O;ie>0;ie--)Z=1<<ie-1,Y+=(U&Z?1:0)+(V&Z?2:0);return Y})(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,a>1?"@2x":"").replace(/{quadkey}/g,R).replace(/{bbox-epsg-3857}/g,d)}isChildOf(t){const a=this.z-t.z;return a>0&&t.x===this.x>>a&&t.y===this.y>>a}getTilePoint(t){const a=Math.pow(2,this.z);return new B((t.x*a-this.x)*ft,(t.y*a-this.y)*ft)}toString(){return`${this.z}/${this.x}/${this.y}`}}class sp{constructor(t,a){this.wrap=t,this.canonical=a,this.key=sc(t,a.z,a.z,a.x,a.y)}}class Ai{constructor(t,a,l,d,_){if(this.terrainRttPosMatrix32f=null,t<l)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${l}`);this.overscaledZ=t,this.wrap=a,this.canonical=new Yd(l,+d,+_),this.key=sc(a,t,l,d,_)}clone(){return new Ai(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-t;return t>this.canonical.z?new Ai(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ai(t,this.wrap,t,this.canonical.x>>a,this.canonical.y>>a)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(t,a){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-t;return t>this.canonical.z?sc(this.wrap*+a,t,this.canonical.z,this.canonical.x,this.canonical.y):sc(this.wrap*+a,t,t,this.canonical.x>>l,this.canonical.y>>l)}isChildOf(t){if(t.wrap!==this.wrap||this.overscaledZ-t.overscaledZ<=0)return!1;if(t.overscaledZ===0)return this.overscaledZ>0;const a=this.canonical.z-t.canonical.z;return!(a<0)&&t.canonical.x===this.canonical.x>>a&&t.canonical.y===this.canonical.y>>a}children(t){if(this.overscaledZ>=t)return[new Ai(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,l=2*this.canonical.x,d=2*this.canonical.y;return[new Ai(a,this.wrap,a,l,d),new Ai(a,this.wrap,a,l+1,d),new Ai(a,this.wrap,a,l,d+1),new Ai(a,this.wrap,a,l+1,d+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Ai(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Ai(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new sp(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new id(t.x-this.wrap,t.y))}}function sc(n,t,a,l,d){(n*=2)<0&&(n=-1*n-1);const _=1<<a;return(_*_*n+_*d+l).toString(36)+a.toString(36)+t.toString(36)}function on(n,t){return t?n.properties[t]:n.id}Tt("CanonicalTileID",Yd),Tt("OverscaledTileID",Ai,{omit:["terrainRttPosMatrix32f"]});class nu{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(t){return this.minX=Math.min(this.minX,t.x),this.minY=Math.min(this.minY,t.y),this.maxX=Math.max(this.maxX,t.x),this.maxY=Math.max(this.maxY,t.y),this}expandBy(t){return this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(t){return this.expandBy(-t)}map(t){const a=new nu;return a.extend(t(new B(this.minX,this.minY))),a.extend(t(new B(this.maxX,this.minY))),a.extend(t(new B(this.minX,this.maxY))),a.extend(t(new B(this.maxX,this.maxY))),a}static fromPoints(t){const a=new nu;for(const l of t)a.extend(l);return a}contains(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(t){return!this.empty()&&!t.empty()&&t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY}intersects(t){return!this.empty()&&!t.empty()&&t.minX<=this.maxX&&t.maxX>=this.minX&&t.minY<=this.maxY&&t.maxY>=this.minY}}class op{constructor(t){this._stringToNumber={},this._numberToString=[];for(let a=0;a<t.length;a++){const l=t[a];this._stringToNumber[l]=a,this._numberToString[a]=l}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class ym{constructor(t,a,l,d,_){this.type="Feature",this._vectorTileFeature=t,t._z=a,t._x=l,t._y=d,this.properties=t.properties,this.id=_}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const a in this)a!=="_geometry"&&a!=="_vectorTileFeature"&&(t[a]=this[a]);return t}}class Wd{constructor(t,a){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new rl(ft,16,0),this.grid3D=new rl(ft,16,0),this.featureIndexArray=new me,this.promoteId=a}insert(t,a,l,d,_,v){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,d,_);const S=v?this.grid3D:this.grid;for(let I=0;I<a.length;I++){const R=a[I],O=[1/0,1/0,-1/0,-1/0];for(let U=0;U<R.length;U++){const V=R[U];O[0]=Math.min(O[0],V.x),O[1]=Math.min(O[1],V.y),O[2]=Math.max(O[2],V.x),O[3]=Math.max(O[3],V.y)}O[0]<ft&&O[1]<ft&&O[2]>=0&&O[3]>=0&&S.insert(b,O[0],O[1],O[2],O[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Bf(new er(this.rawTileData)).layers,this.sourceLayerCoder=new op(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,a,l,d){this.loadVTLayers();const _=t.params,v=ft/t.tileSize/t.scale,b=Xn(_.filter,_.globalState),S=t.queryGeometry,I=t.queryPadding*v,R=nu.fromPoints(S),O=this.grid.query(R.minX-I,R.minY-I,R.maxX+I,R.maxY+I),U=nu.fromPoints(t.cameraQueryGeometry).expandBy(I),V=this.grid3D.query(U.minX,U.minY,U.maxX,U.maxY,((ie,se,Ee,de)=>(function(ge,ke,Ve,rt,St){for(const bt of ge)if(ke<=bt.x&&Ve<=bt.y&&rt>=bt.x&&St>=bt.y)return!0;const pt=[new B(ke,Ve),new B(ke,St),new B(rt,St),new B(rt,Ve)];if(ge.length>2){for(const bt of pt)if($c(ge,bt))return!0}for(let bt=0;bt<ge.length-1;bt++)if(Zp(ge[bt],ge[bt+1],pt))return!0;return!1})(t.cameraQueryGeometry,ie-I,se-I,Ee+I,de+I)));for(const ie of V)O.push(ie);O.sort(Kd);const Z={};let Y;for(let ie=0;ie<O.length;ie++){const se=O[ie];if(se===Y)continue;Y=se;const Ee=this.featureIndexArray.get(se);let de=null;this.loadMatchingFeature(Z,Ee.bucketIndex,Ee.sourceLayerIndex,Ee.featureIndex,b,_.layers,_.availableImages,a,l,d,((ge,ke,Ve)=>(de||(de=Yl(ge)),ke.queryIntersectsFeature({queryGeometry:S,feature:ge,featureState:Ve,geometry:de,zoom:this.z,transform:t.transform,pixelsToTileUnits:v,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation}))))}return Z}loadMatchingFeature(t,a,l,d,_,v,b,S,I,R,O){const U=this.bucketLayerIDs[a];if(v&&!U.some((ie=>v.has(ie))))return;const V=this.sourceLayerCoder.decode(l),Z=this.vtLayers[V].feature(d);if(_.needGeometry){const ie=ts(Z,!0);if(!_.filter(new Wi(this.tileID.overscaledZ),ie,this.tileID.canonical))return}else if(!_.filter(new Wi(this.tileID.overscaledZ),Z))return;const Y=this.getId(Z,V);for(let ie=0;ie<U.length;ie++){const se=U[ie];if(v&&!v.has(se))continue;const Ee=S[se];if(!Ee)continue;let de={};Y&&R&&(de=R.getState(Ee.sourceLayer||"_geojsonTileLayer",Y));const ge=Ut({},I[se]);ge.paint=Qd(ge.paint,Ee.paint,Z,de,b),ge.layout=Qd(ge.layout,Ee.layout,Z,de,b);const ke=!O||O(Z,Ee,de);if(!ke)continue;const Ve=new ym(Z,this.z,this.x,this.y,Y);Ve.layer=ge;let rt=t[se];rt===void 0&&(rt=t[se]=[]),rt.push({featureIndex:d,feature:Ve,intersectionZ:ke})}}lookupSymbolFeatures(t,a,l,d,_,v,b,S){const I={};this.loadVTLayers();const R=Xn(_.filterSpec,_.globalState);for(const O of t)this.loadMatchingFeature(I,l,d,O,R,v,b,S,a);return I}hasLayer(t){for(const a of this.bucketLayerIDs)for(const l of a)if(t===l)return!0;return!1}getId(t,a){var l;let d=t.id;return this.promoteId&&(d=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[a]],typeof d=="boolean"&&(d=Number(d)),d===void 0&&(!((l=t.properties)===null||l===void 0)&&l.cluster)&&this.promoteId&&(d=Number(t.properties.cluster_id))),d}}function Qd(n,t,a,l,d){return Ni(n,((_,v)=>{const b=t instanceof Gc?t.get(v):null;return b&&b.evaluate?b.evaluate(a,l,d):b}))}function Kd(n,t){return t-n}function lp(n,t,a,l,d){const _=[];for(let v=0;v<n.length;v++){const b=n[v];let S;for(let I=0;I<b.length-1;I++){let R=b[I],O=b[I+1];R.x<t&&O.x<t||(R.x<t?R=new B(t,R.y+(t-R.x)/(O.x-R.x)*(O.y-R.y))._round():O.x<t&&(O=new B(t,R.y+(t-R.x)/(O.x-R.x)*(O.y-R.y))._round()),R.y<a&&O.y<a||(R.y<a?R=new B(R.x+(a-R.y)/(O.y-R.y)*(O.x-R.x),a)._round():O.y<a&&(O=new B(R.x+(a-R.y)/(O.y-R.y)*(O.x-R.x),a)._round()),R.x>=l&&O.x>=l||(R.x>=l?R=new B(l,R.y+(l-R.x)/(O.x-R.x)*(O.y-R.y))._round():O.x>=l&&(O=new B(l,R.y+(l-R.x)/(O.x-R.x)*(O.y-R.y))._round()),R.y>=d&&O.y>=d||(R.y>=d?R=new B(R.x+(d-R.y)/(O.y-R.y)*(O.x-R.x),d)._round():O.y>=d&&(O=new B(R.x+(d-R.y)/(O.y-R.y)*(O.x-R.x),d)._round()),S&&R.equals(S[S.length-1])||(S=[R],_.push(S)),S.push(O)))))}}return _}Tt("FeatureIndex",Wd,{omit:["rawTileData","sourceLayerCoder"]});class wl extends B{constructor(t,a,l,d){super(t,a),this.angle=l,d!==void 0&&(this.segment=d)}clone(){return new wl(this.x,this.y,this.angle,this.segment)}}function Jd(n,t,a,l,d){if(t.segment===void 0||a===0)return!0;let _=t,v=t.segment+1,b=0;for(;b>-a/2;){if(v--,v<0)return!1;b-=n[v].dist(_),_=n[v]}b+=n[v].dist(n[v+1]),v++;const S=[];let I=0;for(;b<a/2;){const R=n[v],O=n[v+1];if(!O)return!1;let U=n[v-1].angleTo(R)-R.angleTo(O);for(U=Math.abs((U+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:b,angleDelta:U}),I+=U;b-S[0].distance>l;)I-=S.shift().angleDelta;if(I>d)return!1;v++,b+=R.dist(O)}return!0}function ef(n){let t=0;for(let a=0;a<n.length-1;a++)t+=n[a].dist(n[a+1]);return t}function vm(n,t,a){return n?.6*t*a:0}function cp(n,t){return Math.max(n?n.right-n.left:0,t?t.right-t.left:0)}function fg(n,t,a,l,d,_){const v=vm(a,d,_),b=cp(a,l)*_;let S=0;const I=ef(n)/2;for(let R=0;R<n.length-1;R++){const O=n[R],U=n[R+1],V=O.dist(U);if(S+V>I){const Z=(I-S)/V,Y=Er.number(O.x,U.x,Z),ie=Er.number(O.y,U.y,Z),se=new wl(Y,ie,U.angleTo(O),R);return se._round(),!v||Jd(n,se,b,v,t)?se:void 0}S+=V}}function xm(n,t,a,l,d,_,v,b,S){const I=vm(l,_,v),R=cp(l,d),O=R*v,U=n[0].x===0||n[0].x===S||n[0].y===0||n[0].y===S;return t-O<t/4&&(t=O+t/4),bm(n,U?t/2*b%t:(R/2+2*_)*v*b%t,t,I,a,O,U,!1,S)}function bm(n,t,a,l,d,_,v,b,S){const I=_/2,R=ef(n);let O=0,U=t-a,V=[];for(let Z=0;Z<n.length-1;Z++){const Y=n[Z],ie=n[Z+1],se=Y.dist(ie),Ee=ie.angleTo(Y);for(;U+a<O+se;){U+=a;const de=(U-O)/se,ge=Er.number(Y.x,ie.x,de),ke=Er.number(Y.y,ie.y,de);if(ge>=0&&ge<S&&ke>=0&&ke<S&&U-I>=0&&U+I<=R){const Ve=new wl(ge,ke,Ee,Z);Ve._round(),l&&!Jd(n,Ve,_,l,d)||V.push(Ve)}}O+=se}return b||V.length||v||(V=bm(n,O/2,a,l,d,_,v,!0,S)),V}function wm(n,t,a,l){const d=[],_=n.image,v=_.pixelRatio,b=_.paddedRect.w-2,S=_.paddedRect.h-2;let I={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom};const R=_.stretchX||[[0,b]],O=_.stretchY||[[0,S]],U=(et,$t)=>et+$t[1]-$t[0],V=R.reduce(U,0),Z=O.reduce(U,0),Y=b-V,ie=S-Z;let se=0,Ee=V,de=0,ge=Z,ke=0,Ve=Y,rt=0,St=ie;if(_.content&&l){const et=_.content,$t=et[2]-et[0],Wt=et[3]-et[1];(_.textFitWidth||_.textFitHeight)&&(I=Vd(n)),se=io(R,0,et[0]),de=io(O,0,et[1]),Ee=io(R,et[0],et[2]),ge=io(O,et[1],et[3]),ke=et[0]-se,rt=et[1]-de,Ve=$t-Ee,St=Wt-ge}const pt=I.x1,bt=I.y1,Nt=I.x2-pt,yt=I.y2-bt,wt=(et,$t,Wt,Zt)=>{const Dt=ad(et.stretch-se,Ee,Nt,pt),pi=Yu(et.fixed-ke,Ve,et.stretch,V),pa=ad($t.stretch-de,ge,yt,bt),Ga=Yu($t.fixed-rt,St,$t.stretch,Z),En=ad(Wt.stretch-se,Ee,Nt,pt),br=Yu(Wt.fixed-ke,Ve,Wt.stretch,V),Wa=ad(Zt.stretch-de,ge,yt,bt),Aa=Yu(Zt.fixed-rt,St,Zt.stretch,Z),Hi=new B(Dt,pa),Na=new B(En,pa),Ua=new B(En,Wa),Pa=new B(Dt,Wa),tr=new B(pi/v,Ga/v),Or=new B(br/v,Aa/v),ja=t*Math.PI/180;if(ja){const Va=Math.sin(ja),ln=Math.cos(ja),Ka=[ln,-Va,Va,ln];Hi._matMult(Ka),Na._matMult(Ka),Pa._matMult(Ka),Ua._matMult(Ka)}const wr=et.stretch+et.fixed,Qa=$t.stretch+$t.fixed;return{tl:Hi,tr:Na,bl:Pa,br:Ua,tex:{x:_.paddedRect.x+1+wr,y:_.paddedRect.y+1+Qa,w:Wt.stretch+Wt.fixed-wr,h:Zt.stretch+Zt.fixed-Qa},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:tr,pixelOffsetBR:Or,minFontScaleX:Ve/v/Nt,minFontScaleY:St/v/yt,isSDF:a}};if(l&&(_.stretchX||_.stretchY)){const et=up(R,Y,V),$t=up(O,ie,Z);for(let Wt=0;Wt<et.length-1;Wt++){const Zt=et[Wt],Dt=et[Wt+1];for(let pi=0;pi<$t.length-1;pi++)d.push(wt(Zt,$t[pi],Dt,$t[pi+1]))}}else d.push(wt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:S+1}));return d}function io(n,t,a){let l=0;for(const d of n)l+=Math.max(t,Math.min(a,d[1]))-Math.max(t,Math.min(a,d[0]));return l}function up(n,t,a){const l=[{fixed:-1,stretch:0}];for(const[d,_]of n){const v=l[l.length-1];l.push({fixed:d-v.stretch,stretch:v.stretch}),l.push({fixed:d-v.stretch,stretch:v.stretch+(_-d)})}return l.push({fixed:t+1,stretch:a}),l}function ad(n,t,a,l){return n/t*a+l}function Yu(n,t,a,l){return n-t*a/l}Tt("Anchor",wl);class tf{constructor(t,a,l,d,_,v,b,S,I,R){var O;if(this.boxStartIndex=t.length,I){let U=v.top,V=v.bottom;const Z=v.collisionPadding;Z&&(U-=Z[1],V+=Z[3]);let Y=V-U;Y>0&&(Y=Math.max(10,Y),this.circleDiameter=Y)}else{const U=!((O=v.image)===null||O===void 0)&&O.content&&(v.image.textFitWidth||v.image.textFitHeight)?Vd(v):{x1:v.left,y1:v.top,x2:v.right,y2:v.bottom};U.y1=U.y1*b-S[0],U.y2=U.y2*b+S[2],U.x1=U.x1*b-S[3],U.x2=U.x2*b+S[1];const V=v.collisionPadding;if(V&&(U.x1-=V[0]*b,U.y1-=V[1]*b,U.x2+=V[2]*b,U.y2+=V[3]*b),R){const Z=new B(U.x1,U.y1),Y=new B(U.x2,U.y1),ie=new B(U.x1,U.y2),se=new B(U.x2,U.y2),Ee=R*Math.PI/180;Z._rotate(Ee),Y._rotate(Ee),ie._rotate(Ee),se._rotate(Ee),U.x1=Math.min(Z.x,Y.x,ie.x,se.x),U.x2=Math.max(Z.x,Y.x,ie.x,se.x),U.y1=Math.min(Z.y,Y.y,ie.y,se.y),U.y2=Math.max(Z.y,Y.y,ie.y,se.y)}t.emplaceBack(a.x,a.y,U.x1,U.y1,U.x2,U.y2,l,d,_)}this.boxEndIndex=t.length}}class pg{constructor(t=[],a=(l,d)=>l<d?-1:l>d?1:0){if(this.data=t,this.length=this.data.length,this.compare=a,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:a,compare:l}=this,d=a[t];for(;t>0;){const _=t-1>>1,v=a[_];if(l(d,v)>=0)break;a[t]=v,t=_}a[t]=d}_down(t){const{data:a,compare:l}=this,d=this.length>>1,_=a[t];for(;t<d;){let v=1+(t<<1);const b=v+1;if(b<this.length&&l(a[b],a[v])<0&&(v=b),l(a[v],_)>=0)break;a[t]=a[v],t=v}a[t]=_}}function Sm(n,t=1,a=!1){const l=nu.fromPoints(n[0]),d=Math.min(l.width(),l.height());let _=d/2;const v=new pg([],hp),{minX:b,minY:S,maxX:I,maxY:R}=l;if(d===0)return new B(b,S);for(let V=b;V<I;V+=d)for(let Z=S;Z<R;Z+=d)v.push(new oc(V+_,Z+_,_,n));let O=(function(V){let Z=0,Y=0,ie=0;const se=V[0];for(let Ee=0,de=se.length,ge=de-1;Ee<de;ge=Ee++){const ke=se[Ee],Ve=se[ge],rt=ke.x*Ve.y-Ve.x*ke.y;Y+=(ke.x+Ve.x)*rt,ie+=(ke.y+Ve.y)*rt,Z+=3*rt}return new oc(Y/Z,ie/Z,0,V)})(n),U=v.length;for(;v.length;){const V=v.pop();(V.d>O.d||!O.d)&&(O=V,a&&console.log("found best %d after %d probes",Math.round(1e4*V.d)/1e4,U)),V.max-O.d<=t||(_=V.h/2,v.push(new oc(V.p.x-_,V.p.y-_,_,n)),v.push(new oc(V.p.x+_,V.p.y-_,_,n)),v.push(new oc(V.p.x-_,V.p.y+_,_,n)),v.push(new oc(V.p.x+_,V.p.y+_,_,n)),U+=4)}return a&&(console.log(`num probes: ${U}`),console.log(`best distance: ${O.d}`)),O.p}function hp(n,t){return t.max-n.max}function oc(n,t,a,l){this.p=new B(n,t),this.h=a,this.d=(function(d,_){let v=!1,b=1/0;for(let S=0;S<_.length;S++){const I=_[S];for(let R=0,O=I.length,U=O-1;R<O;U=R++){const V=I[R],Z=I[U];V.y>d.y!=Z.y>d.y&&d.x<(Z.x-V.x)*(d.y-V.y)/(Z.y-V.y)+V.x&&(v=!v),b=Math.min(b,rn(d,V,Z))}}return(v?1:-1)*Math.sqrt(b)})(this.p,l),this.max=this.d+this.h*Math.SQRT2}var On;E.aE=void 0,(On=E.aE||(E.aE={}))[On.center=1]="center",On[On.left=2]="left",On[On.right=3]="right",On[On.top=4]="top",On[On.bottom=5]="bottom",On[On["top-left"]=6]="top-left",On[On["top-right"]=7]="top-right",On[On["bottom-left"]=8]="bottom-left",On[On["bottom-right"]=9]="bottom-right";const Lr=Number.POSITIVE_INFINITY;function af(n,t){return t[1]!==Lr?(function(a,l,d){let _=0,v=0;switch(l=Math.abs(l),d=Math.abs(d),a){case"top-right":case"top-left":case"top":v=d-7;break;case"bottom-right":case"bottom-left":case"bottom":v=7-d}switch(a){case"top-right":case"bottom-right":case"right":_=-l;break;case"top-left":case"bottom-left":case"left":_=l}return[_,v]})(n,t[0],t[1]):(function(a,l){let d=0,_=0;l<0&&(l=0);const v=l/Math.SQRT2;switch(a){case"top-right":case"top-left":_=v-7;break;case"bottom-right":case"bottom-left":_=7-v;break;case"bottom":_=7-l;break;case"top":_=l-7}switch(a){case"top-right":case"bottom-right":d=-v;break;case"top-left":case"bottom-left":d=v;break;case"left":d=l;break;case"right":d=-l}return[d,_]})(n,t[0])}function dp(n,t,a){var l;const d=n.layout,_=(l=d.get("text-variable-anchor-offset"))===null||l===void 0?void 0:l.evaluate(t,{},a);if(_){const b=_.values,S=[];for(let I=0;I<b.length;I+=2){const R=S[I]=b[I],O=b[I+1].map((U=>U*Ba));R.startsWith("top")?O[1]-=7:R.startsWith("bottom")&&(O[1]+=7),S[I+1]=O}return new Ia(S)}const v=d.get("text-variable-anchor");if(v){let b;b=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[d.get("text-radial-offset").evaluate(t,{},a)*Ba,Lr]:d.get("text-offset").evaluate(t,{},a).map((I=>I*Ba));const S=[];for(const I of v)S.push(I,af(I,b));return new Ia(S)}return null}function nf(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Mm(n,t,a,l,d,_,v,b,S,I,R,O){let U=_.textMaxSize.evaluate(t,{});U===void 0&&(U=v);const V=n.layers[0].layout,Z=V.get("icon-offset").evaluate(t,{},R),Y=ns(a.horizontal),ie=v/24,se=n.tilePixelRatio*ie,Ee=n.tilePixelRatio*U/24,de=n.tilePixelRatio*b,ge=n.tilePixelRatio*V.get("symbol-spacing"),ke=V.get("text-padding")*n.tilePixelRatio,Ve=(function(Wt,Zt,Dt,pi=1){const pa=Wt.get("icon-padding").evaluate(Zt,{},Dt),Ga=pa&&pa.values;return[Ga[0]*pi,Ga[1]*pi,Ga[2]*pi,Ga[3]*pi]})(V,t,R,n.tilePixelRatio),rt=V.get("text-max-angle")/180*Math.PI,St=V.get("text-rotation-alignment")!=="viewport"&&V.get("symbol-placement")!=="point",pt=V.get("icon-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",bt=V.get("symbol-placement"),Nt=ge/2,yt=V.get("icon-text-fit");let wt;l&&yt!=="none"&&(n.allowVerticalPlacement&&a.vertical&&(wt=Qh(l,a.vertical,yt,V.get("icon-text-fit-padding"),Z,ie)),Y&&(l=Qh(l,Y,yt,V.get("icon-text-fit-padding"),Z,ie)));const et=R?O.line.getGranularityForZoomLevel(R.z):1,$t=(Wt,Zt)=>{Zt.x<0||Zt.x>=ft||Zt.y<0||Zt.y>=ft||(function(Dt,pi,pa,Ga,En,br,Wa,Aa,Hi,Na,Ua,Pa,tr,Or,ja,wr,Qa,Va,ln,Ka,ta,Br,ru,ir,Pm){const lc=Dt.addToLineVertexArray(pi,pa);let jo,su,Qu,Sl,i=0,s=0,h=0,g=0,M=-1,z=-1;const G={};let Q=dl("");if(Dt.allowVerticalPlacement&&Ga.vertical){const Ct=Aa.layout.get("text-rotate").evaluate(ta,{},ir)+90;Qu=new tf(Hi,pi,Na,Ua,Pa,Ga.vertical,tr,Or,ja,Ct),Wa&&(Sl=new tf(Hi,pi,Na,Ua,Pa,Wa,Qa,Va,ja,Ct))}if(En){const Ct=Aa.layout.get("icon-rotate").evaluate(ta,{}),Qt=Aa.layout.get("icon-text-fit")!=="none",xi=wm(En,Ct,ru,Qt),bi=Wa?wm(Wa,Ct,ru,Qt):void 0;su=new tf(Hi,pi,Na,Ua,Pa,En,Qa,Va,!1,Ct),i=4*xi.length;const Nr=Dt.iconSizeData;let Fo=null;Nr.kind==="source"?(Fo=[Js*Aa.layout.get("icon-size").evaluate(ta,{})],Fo[0]>xr&&Xt(`${Dt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Nr.kind==="composite"&&(Fo=[Js*Br.compositeIconSizes[0].evaluate(ta,{},ir),Js*Br.compositeIconSizes[1].evaluate(ta,{},ir)],(Fo[0]>xr||Fo[1]>xr)&&Xt(`${Dt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Dt.addSymbols(Dt.icon,xi,Fo,Ka,ln,ta,E.ao.none,pi,lc.lineStartIndex,lc.lineLength,-1,ir),M=Dt.icon.placedSymbolArray.length-1,bi&&(s=4*bi.length,Dt.addSymbols(Dt.icon,bi,Fo,Ka,ln,ta,E.ao.vertical,pi,lc.lineStartIndex,lc.lineLength,-1,ir),z=Dt.icon.placedSymbolArray.length-1)}const _e=Object.keys(Ga.horizontal);for(const Ct of _e){const Qt=Ga.horizontal[Ct];if(!jo){Q=dl(Qt.text);const bi=Aa.layout.get("text-rotate").evaluate(ta,{},ir);jo=new tf(Hi,pi,Na,Ua,Pa,Qt,tr,Or,ja,bi)}const xi=Qt.positionedLines.length===1;if(h+=Wu(Dt,pi,Qt,br,Aa,ja,ta,wr,lc,Ga.vertical?E.ao.horizontal:E.ao.horizontalOnly,xi?_e:[Ct],G,M,Br,ir),xi)break}Ga.vertical&&(g+=Wu(Dt,pi,Ga.vertical,br,Aa,ja,ta,wr,lc,E.ao.vertical,["vertical"],G,z,Br,ir));const Ge=jo?jo.boxStartIndex:Dt.collisionBoxArray.length,tt=jo?jo.boxEndIndex:Dt.collisionBoxArray.length,ot=Qu?Qu.boxStartIndex:Dt.collisionBoxArray.length,qe=Qu?Qu.boxEndIndex:Dt.collisionBoxArray.length,Xe=su?su.boxStartIndex:Dt.collisionBoxArray.length,Ft=su?su.boxEndIndex:Dt.collisionBoxArray.length,ii=Sl?Sl.boxStartIndex:Dt.collisionBoxArray.length,ma=Sl?Sl.boxEndIndex:Dt.collisionBoxArray.length;let ze=-1;const Te=(Ct,Qt)=>Ct&&Ct.circleDiameter?Math.max(Ct.circleDiameter,Qt):Qt;ze=Te(jo,ze),ze=Te(Qu,ze),ze=Te(su,ze),ze=Te(Sl,ze);const Fe=ze>-1?1:0;Fe&&(ze*=Pm/Ba),Dt.glyphOffsetArray.length>=rc.MAX_GLYPHS&&Xt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ta.sortKey!==void 0&&Dt.addToSortKeyRanges(Dt.symbolInstances.length,ta.sortKey);const nt=dp(Aa,ta,ir),[Ht,Ki]=(function(Ct,Qt){const xi=Ct.length,bi=Qt?.values;if(bi?.length>0)for(let Nr=0;Nr<bi.length;Nr+=2){const Fo=bi[Nr+1];Ct.emplaceBack(E.aE[bi[Nr]],Fo[0],Fo[1])}return[xi,Ct.length]})(Dt.textAnchorOffsets,nt);Dt.symbolInstances.emplaceBack(pi.x,pi.y,G.right>=0?G.right:-1,G.center>=0?G.center:-1,G.left>=0?G.left:-1,G.vertical||-1,M,z,Q,Ge,tt,ot,qe,Xe,Ft,ii,ma,Na,h,g,i,s,Fe,0,tr,ze,Ht,Ki)})(n,Zt,Wt,a,l,d,wt,n.layers[0],n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,se,[ke,ke,ke,ke],St,S,de,Ve,pt,Z,t,_,I,R,v)};if(bt==="line")for(const Wt of lp(t.geometry,0,0,ft,ft)){const Zt=Jl(Wt,et),Dt=xm(Zt,ge,rt,a.vertical||Y,l,24,Ee,n.overscaling,ft);for(const pi of Dt)Y&&Tm(n,Y.text,Nt,pi)||$t(Zt,pi)}else if(bt==="line-center"){for(const Wt of t.geometry)if(Wt.length>1){const Zt=Jl(Wt,et),Dt=fg(Zt,rt,a.vertical||Y,l,24,Ee);Dt&&$t(Zt,Dt)}}else if(t.type==="Polygon")for(const Wt of wc(t.geometry,0)){const Zt=Sm(Wt,16);$t(Jl(Wt[0],et,!0),new wl(Zt.x,Zt.y,0))}else if(t.type==="LineString")for(const Wt of t.geometry){const Zt=Jl(Wt,et);$t(Zt,new wl(Zt[0].x,Zt[0].y,0))}else if(t.type==="Point")for(const Wt of t.geometry)for(const Zt of Wt)$t([Zt],new wl(Zt.x,Zt.y,0))}function Wu(n,t,a,l,d,_,v,b,S,I,R,O,U,V,Z){const Y=(function(Ee,de,ge,ke,Ve,rt,St,pt){const bt=ke.layout.get("text-rotate").evaluate(rt,{})*Math.PI/180,Nt=[];for(const yt of de.positionedLines)for(const wt of yt.positionedGlyphs){if(!wt.rect)continue;const et=wt.rect||{};let $t=4,Wt=!0,Zt=1,Dt=0;const pi=(Ve||pt)&&wt.vertical,pa=wt.metrics.advance*wt.scale/2;if(pt&&de.verticalizable&&(Dt=yt.lineOffset/2-(wt.imageName?-(Ba-wt.metrics.width*wt.scale)/2:(wt.scale-1)*Ba)),wt.imageName){const Va=St[wt.imageName];Wt=Va.sdf,Zt=Va.pixelRatio,$t=1/Zt}const Ga=Ve?[wt.x+pa,wt.y]:[0,0];let En=Ve?[0,0]:[wt.x+pa+ge[0],wt.y+ge[1]-Dt],br=[0,0];pi&&(br=En,En=[0,0]);const Wa=wt.metrics.isDoubleResolution?2:1,Aa=(wt.metrics.left-$t)*wt.scale-pa+En[0],Hi=(-wt.metrics.top-$t)*wt.scale+En[1],Na=Aa+et.w/Wa*wt.scale/Zt,Ua=Hi+et.h/Wa*wt.scale/Zt,Pa=new B(Aa,Hi),tr=new B(Na,Hi),Or=new B(Aa,Ua),ja=new B(Na,Ua);if(pi){const Va=new B(-pa,pa- -17),ln=-Math.PI/2,Ka=12-pa,ta=new B(22-Ka,-(wt.imageName?Ka:0)),Br=new B(...br);Pa._rotateAround(ln,Va)._add(ta)._add(Br),tr._rotateAround(ln,Va)._add(ta)._add(Br),Or._rotateAround(ln,Va)._add(ta)._add(Br),ja._rotateAround(ln,Va)._add(ta)._add(Br)}if(bt){const Va=Math.sin(bt),ln=Math.cos(bt),Ka=[ln,-Va,Va,ln];Pa._matMult(Ka),tr._matMult(Ka),Or._matMult(Ka),ja._matMult(Ka)}const wr=new B(0,0),Qa=new B(0,0);Nt.push({tl:Pa,tr,bl:Or,br:ja,tex:et,writingMode:de.writingMode,glyphOffset:Ga,sectionIndex:wt.sectionIndex,isSDF:Wt,pixelOffsetTL:wr,pixelOffsetBR:Qa,minFontScaleX:0,minFontScaleY:0})}return Nt})(0,a,b,d,_,v,l,n.allowVerticalPlacement),ie=n.textSizeData;let se=null;ie.kind==="source"?(se=[Js*d.layout.get("text-size").evaluate(v,{})],se[0]>xr&&Xt(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ie.kind==="composite"&&(se=[Js*V.compositeTextSizes[0].evaluate(v,{},Z),Js*V.compositeTextSizes[1].evaluate(v,{},Z)],(se[0]>xr||se[1]>xr)&&Xt(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,Y,se,b,_,v,I,t,S.lineStartIndex,S.lineLength,U,Z);for(const Ee of R)O[Ee]=n.text.placedSymbolArray.length-1;return 4*Y.length}function ns(n){for(const t in n)return n[t];return null}function Tm(n,t,a,l){const d=n.compareText;if(t in d){const _=d[t];for(let v=_.length-1;v>=0;v--)if(l.dist(_[v])<a)return!0}else d[t]=[];return d[t].push(l),!1}const nd=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class ao{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,l]=new Uint8Array(t,0,2);if(a!==219)throw new Error("Data does not appear to be in a KDBush format.");const d=l>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);const _=nd[15&l];if(!_)throw new Error("Unrecognized array type.");const[v]=new Uint16Array(t,2,1),[b]=new Uint32Array(t,4,1);return new ao(b,v,_,t)}constructor(t,a=64,l=Float64Array,d){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=l,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const _=nd.indexOf(this.ArrayType),v=2*t*this.ArrayType.BYTES_PER_ELEMENT,b=t*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-b%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${l}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+b+S,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+v+b+S),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+b+S,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=t)}add(t,a){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=t,this.coords[this._pos++]=a,l}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return fp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,a,l,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:v,nodeSize:b}=this,S=[0,_.length-1,0],I=[];for(;S.length;){const R=S.pop()||0,O=S.pop()||0,U=S.pop()||0;if(O-U<=b){for(let ie=U;ie<=O;ie++){const se=v[2*ie],Ee=v[2*ie+1];se>=t&&se<=l&&Ee>=a&&Ee<=d&&I.push(_[ie])}continue}const V=U+O>>1,Z=v[2*V],Y=v[2*V+1];Z>=t&&Z<=l&&Y>=a&&Y<=d&&I.push(_[V]),(R===0?t<=Z:a<=Y)&&(S.push(U),S.push(V-1),S.push(1-R)),(R===0?l>=Z:d>=Y)&&(S.push(V+1),S.push(O),S.push(1-R))}return I}within(t,a,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:_,nodeSize:v}=this,b=[0,d.length-1,0],S=[],I=l*l;for(;b.length;){const R=b.pop()||0,O=b.pop()||0,U=b.pop()||0;if(O-U<=v){for(let ie=U;ie<=O;ie++)Cm(_[2*ie],_[2*ie+1],t,a)<=I&&S.push(d[ie]);continue}const V=U+O>>1,Z=_[2*V],Y=_[2*V+1];Cm(Z,Y,t,a)<=I&&S.push(d[V]),(R===0?t-l<=Z:a-l<=Y)&&(b.push(U),b.push(V-1),b.push(1-R)),(R===0?t+l>=Z:a+l>=Y)&&(b.push(V+1),b.push(O),b.push(1-R))}return S}}function fp(n,t,a,l,d,_){if(d-l<=a)return;const v=l+d>>1;Em(n,t,v,l,d,_),fp(n,t,a,l,v-1,1-_),fp(n,t,a,v+1,d,1-_)}function Em(n,t,a,l,d,_){for(;d>l;){if(d-l>600){const I=d-l+1,R=a-l+1,O=Math.log(I),U=.5*Math.exp(2*O/3),V=.5*Math.sqrt(O*U*(I-U)/I)*(R-I/2<0?-1:1);Em(n,t,a,Math.max(l,Math.floor(a-R*U/I+V)),Math.min(d,Math.floor(a+(I-R)*U/I+V)),_)}const v=t[2*a+_];let b=l,S=d;for(No(n,t,l,a),t[2*d+_]>v&&No(n,t,l,d);b<S;){for(No(n,t,b,S),b++,S--;t[2*b+_]<v;)b++;for(;t[2*S+_]>v;)S--}t[2*l+_]===v?No(n,t,l,S):(S++,No(n,t,S,d)),S<=a&&(l=S+1),a<=S&&(d=S-1)}}function No(n,t,a,l){rf(n,a,l),rf(t,2*a,2*l),rf(t,2*a+1,2*l+1)}function rf(n,t,a){const l=n[t];n[t]=n[a],n[a]=l}function Cm(n,t,a,l){const d=n-a,_=t-l;return d*d+_*_}var pp;E.cx=void 0,(pp=E.cx||(E.cx={})).create="create",pp.load="load",pp.fullLoad="fullLoad";let sf=null,rd=[];const mp=1e3/60,gp="loadTime",_p="fullLoadTime",Am={mark(n){performance.mark(n)},frame(n){const t=n;sf!=null&&rd.push(t-sf),sf=t},clearMetrics(){sf=null,rd=[],performance.clearMeasures(gp),performance.clearMeasures(_p);for(const n in E.cx)performance.clearMarks(E.cx[n])},getPerformanceMetrics(){performance.measure(gp,E.cx.create,E.cx.load),performance.measure(_p,E.cx.create,E.cx.fullLoad);const n=performance.getEntriesByName(gp)[0].duration,t=performance.getEntriesByName(_p)[0].duration,a=rd.length,l=1/(rd.reduce(((_,v)=>_+v),0)/a/1e3),d=rd.filter((_=>_>mp)).reduce(((_,v)=>_+(v-mp)/mp),0);return{loadTime:n,fullLoadTime:t,fps:l,percentDroppedFrames:d/(a+d)*100,totalFrames:a}}};E.$=ft,E.A=Ke,E.B=function([n,t,a]){return t+=90,t*=Math.PI/180,a*=Math.PI/180,{x:n*Math.cos(t)*Math.sin(a),y:n*Math.sin(t)*Math.sin(a),z:n*Math.cos(a)}},E.C=Er,E.D=Pt,E.E=Vt,E.F=Wi,E.G=Au,E.H=Si,E.I=$f,E.J=class{constructor(n,t){this.target=n,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new gm((()=>this.process())),this.subscription=Pi(this.target,"message",(a=>this.receive(a)),!1),this.globalScope=Jt(self)?n:window}registerMessageHandler(n,t){this.messageHandlers[n]=t}sendAsync(n,t){return new Promise(((a,l)=>{const d=Math.round(1e18*Math.random()).toString(36).substring(0,10),_=t?Pi(t.signal,"abort",(()=>{_?.unsubscribe(),delete this.resolveRejects[d];const S={id:d,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(S)}),Li):null;this.resolveRejects[d]={resolve:S=>{_?.unsubscribe(),a(S)},reject:S=>{_?.unsubscribe(),l(S)}};const v=[],b=Object.assign(Object.assign({},n),{id:d,sourceMapId:this.mapId,origin:location.origin,data:So(n.data,v)});this.target.postMessage(b,{transfer:v})}))}receive(n){const t=n.data,a=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[a];const l=this.abortControllers[a];return delete this.abortControllers[a],void(l&&l.abort())}if(Jt(self)||t.mustQueue)return this.tasks[a]=t,this.taskQueue.push(a),void this.invoker.trigger();this.processTask(a,t)}}process(){if(this.taskQueue.length===0)return;const n=this.taskQueue.shift(),t=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(n,t)}processTask(n,t){return o(this,void 0,void 0,(function*(){if(t.type==="<response>"){const d=this.resolveRejects[n];return delete this.resolveRejects[n],d?void(t.error?d.reject(Mo(t.error)):d.resolve(Mo(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const a=Mo(t.data),l=new AbortController;this.abortControllers[n]=l;try{const d=yield this.messageHandlers[t.type](t.sourceMapId,a,l);this.completeTask(n,null,d)}catch(d){this.completeTask(n,d)}}))}completeTask(n,t,a){const l=[];delete this.abortControllers[n];const d={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?So(t):null,data:So(a,l)};this.target.postMessage(d,{transfer:l})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},E.K=ce,E.L=function(){var n=new Ke(16);return Ke!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},E.M=function(n,t,a){var l,d,_,v,b,S,I,R,O,U,V,Z,Y=a[0],ie=a[1],se=a[2];return t===n?(n[12]=t[0]*Y+t[4]*ie+t[8]*se+t[12],n[13]=t[1]*Y+t[5]*ie+t[9]*se+t[13],n[14]=t[2]*Y+t[6]*ie+t[10]*se+t[14],n[15]=t[3]*Y+t[7]*ie+t[11]*se+t[15]):(d=t[1],_=t[2],v=t[3],b=t[4],S=t[5],I=t[6],R=t[7],O=t[8],U=t[9],V=t[10],Z=t[11],n[0]=l=t[0],n[1]=d,n[2]=_,n[3]=v,n[4]=b,n[5]=S,n[6]=I,n[7]=R,n[8]=O,n[9]=U,n[10]=V,n[11]=Z,n[12]=l*Y+b*ie+O*se+t[12],n[13]=d*Y+S*ie+U*se+t[13],n[14]=_*Y+I*ie+V*se+t[14],n[15]=v*Y+R*ie+Z*se+t[15]),n},E.N=function(n,t,a){var l=a[0],d=a[1],_=a[2];return n[0]=t[0]*l,n[1]=t[1]*l,n[2]=t[2]*l,n[3]=t[3]*l,n[4]=t[4]*d,n[5]=t[5]*d,n[6]=t[6]*d,n[7]=t[7]*d,n[8]=t[8]*_,n[9]=t[9]*_,n[10]=t[10]*_,n[11]=t[11]*_,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},E.O=function(n,t,a){var l=t[0],d=t[1],_=t[2],v=t[3],b=t[4],S=t[5],I=t[6],R=t[7],O=t[8],U=t[9],V=t[10],Z=t[11],Y=t[12],ie=t[13],se=t[14],Ee=t[15],de=a[0],ge=a[1],ke=a[2],Ve=a[3];return n[0]=de*l+ge*b+ke*O+Ve*Y,n[1]=de*d+ge*S+ke*U+Ve*ie,n[2]=de*_+ge*I+ke*V+Ve*se,n[3]=de*v+ge*R+ke*Z+Ve*Ee,n[4]=(de=a[4])*l+(ge=a[5])*b+(ke=a[6])*O+(Ve=a[7])*Y,n[5]=de*d+ge*S+ke*U+Ve*ie,n[6]=de*_+ge*I+ke*V+Ve*se,n[7]=de*v+ge*R+ke*Z+Ve*Ee,n[8]=(de=a[8])*l+(ge=a[9])*b+(ke=a[10])*O+(Ve=a[11])*Y,n[9]=de*d+ge*S+ke*U+Ve*ie,n[10]=de*_+ge*I+ke*V+Ve*se,n[11]=de*v+ge*R+ke*Z+Ve*Ee,n[12]=(de=a[12])*l+(ge=a[13])*b+(ke=a[14])*O+(Ve=a[15])*Y,n[13]=de*d+ge*S+ke*U+Ve*ie,n[14]=de*_+ge*I+ke*V+Ve*se,n[15]=de*v+ge*R+ke*Z+Ve*Ee,n},E.P=B,E.Q=function(n,t){const a={};for(let l=0;l<t.length;l++){const d=t[l];d in n&&(a[d]=n[d])}return a},E.R=Vn,E.S=to,E.T=Lu,E.U=Xu,E.V=Xd,E.W=Ae,E.X=Ze,E.Y=qn,E.Z=Ai,E._=o,E.a=$,E.a$=Gt,E.a0=function(n,t){var a,l,d,_,v;if(!n)return t??{};if(!t)return n;let b=Object.assign({},n);if(t.removeAll&&(b={removeAll:!0}),t.remove){const S=new Set(t.remove);b.add&&(b.add=b.add.filter((R=>!S.has(R.id)))),b.update&&(b.update=b.update.filter((R=>!S.has(R.id))));const I=new Set(((a=n.add)!==null&&a!==void 0?a:[]).map((R=>R.id)));t.remove=t.remove.filter((R=>!I.has(R)))}if(t.remove){const S=new Set(b.remove?b.remove.concat(t.remove):t.remove);b.remove=Array.from(S.values())}if(t.add){const S=b.add?b.add.concat(t.add):t.add,I=new Map(S.map((R=>[R.id,R])));b.add=Array.from(I.values())}if(t.update){const S=new Map((l=b.update)===null||l===void 0?void 0:l.map((I=>[I.id,I])));for(const I of t.update){const R=(d=S.get(I.id))!==null&&d!==void 0?d:{id:I.id};I.newGeometry&&(R.newGeometry=I.newGeometry),I.addOrUpdateProperties&&(R.addOrUpdateProperties=((_=R.addOrUpdateProperties)!==null&&_!==void 0?_:[]).concat(I.addOrUpdateProperties)),I.removeProperties&&(R.removeProperties=((v=R.removeProperties)!==null&&v!==void 0?v:[]).concat(I.removeProperties)),I.removeAllProperties&&(R.removeAllProperties=!0),S.set(I.id,R)}b.update=Array.from(S.values())}return b.remove&&b.add&&(b.remove=b.remove.filter((S=>b.add.findIndex((I=>I.id===S))===-1))),b},E.a1=id,E.a2=nu,E.a3=25,E.a4=Yd,E.a5=n=>{const t=window.document.createElement("video");return t.muted=!0,new Promise((a=>{t.onloadstart=()=>{a(t)};for(const l of n){const d=window.document.createElement("source");Ce(l)||(t.crossOrigin="Anonymous"),d.src=l,t.appendChild(d)}}))},E.a6=st,E.a7=function(){return jt++},E.a8=F,E.a9=rc,E.aA=function(n){let t=1/0,a=1/0,l=-1/0,d=-1/0;for(const _ of n)t=Math.min(t,_.x),a=Math.min(a,_.y),l=Math.max(l,_.x),d=Math.max(d,_.y);return[t,a,l,d]},E.aB=Ba,E.aC=Kt,E.aD=function(n,t,a,l,d=!1){if(!a[0]&&!a[1])return[0,0];const _=d?l==="map"?-n.bearingInRadians:0:l==="viewport"?n.bearingInRadians:0;if(_){const v=Math.sin(_),b=Math.cos(_);a=[a[0]*b-a[1]*v,a[0]*v+a[1]*b]}return[d?a[0]:Kt(t,a[0],n.zoom),d?a[1]:Kt(t,a[1],n.zoom)]},E.aF=au,E.aG=nf,E.aH=Wh,E.aI=ao,E.aJ=Qi,E.aK=Yc,E.aL=ye,E.aM=vi,E.aN=Vi,E.aO=ai,E.aP=Ui,E.aQ=rp,E.aR=Ye,E.aS=Se,E.aT=function(n){var t=new Ke(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t},E.aU=function(n,t,a){return n[0]=t[0]-a[0],n[1]=t[1]-a[1],n[2]=t[2]-a[2],n},E.aV=function(n,t){var a=t[0],l=t[1],d=t[2],_=a*a+l*l+d*d;return _>0&&(_=1/Math.sqrt(_)),n[0]=t[0]*_,n[1]=t[1]*_,n[2]=t[2]*_,n},E.aW=mt,E.aX=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]},E.aY=function(n,t,a){return n[0]=t[0]*a[0],n[1]=t[1]*a[1],n[2]=t[2]*a[2],n[3]=t[3]*a[3],n},E.aZ=lt,E.a_=function(n,t,a){const l=t[0]*a[0]+t[1]*a[1]+t[2]*a[2];return l===0?null:(-(n[0]*a[0]+n[1]*a[1]+n[2]*a[2])-a[3])/l},E.aa=Xn,E.ab=ts,E.ac=ym,E.ad=function(n){const t={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((a,l,d,_)=>{const v=d||_;return t[l]=!v||v.toLowerCase(),""})),t["max-age"]){const a=parseInt(t["max-age"],10);isNaN(a)?delete t["max-age"]:t["max-age"]=a}return t},E.ae=Pn,E.af=function(n){return Math.pow(2,n)},E.ag=Et,E.ah=Ot,E.ai=85.051129,E.aj=td,E.ak=function(n){return Math.log(n)/Math.LN2},E.al=function(n){var t=n[0],a=n[1];return t*t+a*a},E.am=function(n){if(!n.length)return new Set;const t=Math.max(...n.map((S=>S.canonical.z)));let a=1/0,l=-1/0,d=1/0,_=-1/0;const v=[];for(const S of n){const{x:I,y:R,z:O}=S.canonical,U=Math.pow(2,t-O),V=I*U,Z=R*U;v.push({id:S,x:V,y:Z}),V<a&&(a=V),V>l&&(l=V),Z<d&&(d=Z),Z>_&&(_=Z)}const b=new Set;for(const S of v)S.x!==a&&S.x!==l&&S.y!==d&&S.y!==_||b.add(S.id);return b},E.an=function(n,t){let a=0,l=0;if(n.kind==="constant")l=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:d,minZoom:_,maxZoom:v}=n,b=d?Ot(nn.interpolationFactor(d,t,_,v),0,1):0;n.kind==="camera"?l=Er.number(n.minSize,n.maxSize,b):a=b}return{uSizeT:a,uSize:l}},E.ap=function(n,{uSize:t,uSizeT:a},{lowerSize:l,upperSize:d}){return n.kind==="source"?l/Js:n.kind==="composite"?Er.number(l/Js,d/Js,a):t},E.aq=function(n,t){var a=t[0],l=t[1],d=t[2],_=t[3],v=t[4],b=t[5],S=t[6],I=t[7],R=t[8],O=t[9],U=t[10],V=t[11],Z=t[12],Y=t[13],ie=t[14],se=t[15],Ee=a*b-l*v,de=a*S-d*v,ge=a*I-_*v,ke=l*S-d*b,Ve=l*I-_*b,rt=d*I-_*S,St=R*Y-O*Z,pt=R*ie-U*Z,bt=R*se-V*Z,Nt=O*ie-U*Y,yt=O*se-V*Y,wt=U*se-V*ie,et=Ee*wt-de*yt+ge*Nt+ke*bt-Ve*pt+rt*St;return et?(n[0]=(b*wt-S*yt+I*Nt)*(et=1/et),n[1]=(d*yt-l*wt-_*Nt)*et,n[2]=(Y*rt-ie*Ve+se*ke)*et,n[3]=(U*Ve-O*rt-V*ke)*et,n[4]=(S*bt-v*wt-I*pt)*et,n[5]=(a*wt-d*bt+_*pt)*et,n[6]=(ie*ge-Z*rt-se*de)*et,n[7]=(R*rt-U*ge+V*de)*et,n[8]=(v*yt-b*bt+I*St)*et,n[9]=(l*bt-a*yt-_*St)*et,n[10]=(Z*Ve-Y*ge+se*Ee)*et,n[11]=(O*ge-R*Ve-V*Ee)*et,n[12]=(b*pt-v*Nt-S*St)*et,n[13]=(a*Nt-l*pt+d*St)*et,n[14]=(Y*de-Z*ke-ie*Ee)*et,n[15]=(R*ke-O*de+U*Ee)*et,n):null},E.ar=at,E.as=function(n){var t=n[0],a=n[1];return Math.sqrt(t*t+a*a)},E.at=function(n){return n[0]=0,n[1]=0,n},E.au=function(n,t,a){return n[0]=t[0]*a,n[1]=t[1]*a,n},E.av=qd,E.aw=Oi,E.ax=function(n,t,a,l){const d=t.y-n.y,_=t.x-n.x,v=l.y-a.y,b=l.x-a.x,S=v*_-b*d;if(S===0)return null;const I=(b*(n.y-a.y)-v*(n.x-a.x))/S;return new B(n.x+I*_,n.y+I*d)},E.ay=lp,E.az=Rh,E.b=gi,E.b$=class extends Qn{constructor(n,t){super(n,t),this.current=new Array}set(n){if(n!=this.current){this.current=n;const t=new Float32Array(n);this.gl.uniform1fv(this.location,t)}}},E.b0=function(n,t,a){return n[0]=t[0]*a,n[1]=t[1]*a,n[2]=t[2]*a,n[3]=t[3]*a,n},E.b1=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]},E.b2=sp,E.b3=sc,E.b4=function(n,t,a,l,d){var _=1/Math.tan(t/2);if(n[0]=_/a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=_,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,d!=null&&d!==1/0){var v=1/(l-d);n[10]=(d+l)*v,n[14]=2*d*l*v}else n[10]=-1,n[14]=-2*l;return n},E.b5=function(n){var t=new Ke(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},E.b6=function(n,t,a){var l=Math.sin(a),d=Math.cos(a),_=t[0],v=t[1],b=t[2],S=t[3],I=t[4],R=t[5],O=t[6],U=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=_*d+I*l,n[1]=v*d+R*l,n[2]=b*d+O*l,n[3]=S*d+U*l,n[4]=I*d-_*l,n[5]=R*d-v*l,n[6]=O*d-b*l,n[7]=U*d-S*l,n},E.b7=function(n,t,a){var l=Math.sin(a),d=Math.cos(a),_=t[4],v=t[5],b=t[6],S=t[7],I=t[8],R=t[9],O=t[10],U=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=_*d+I*l,n[5]=v*d+R*l,n[6]=b*d+O*l,n[7]=S*d+U*l,n[8]=I*d-_*l,n[9]=R*d-v*l,n[10]=O*d-b*l,n[11]=U*d-S*l,n},E.b8=function(){const n=new Float32Array(16);return Et(n),n},E.b9=function(){const n=new Float64Array(16);return Et(n),n},E.bA=function(n,t){const a=pe(n,360),l=pe(t,360),d=l-a,_=l>a?d-360:d+360;return Math.abs(d)<Math.abs(_)?d:_},E.bB=function(n){return n[0]=0,n[1]=0,n[2]=0,n},E.bC=function(n,t,a,l){const d=Math.sqrt(n*n+t*t),_=Math.sqrt(a*a+l*l);n/=d,t/=d,a/=_,l/=_;const v=Math.acos(n*a+t*l);return-t*a+n*l>0?v:-v},E.bD=function(n,t){const a=pe(n,2*Math.PI),l=pe(t,2*Math.PI);return Math.min(Math.abs(a-l),Math.abs(a-l+2*Math.PI),Math.abs(a-l-2*Math.PI))},E.bE=function(){const n={},t=Pe.$version;for(const a in Pe.$root){const l=Pe.$root[a];if(l.required){let d=null;d=a==="version"?t:l.type==="array"?[]:{},d!=null&&(n[a]=d)}}return n},E.bF=ol,E.bG=be,E.bH=function n(t,a){if(Array.isArray(t)){if(!Array.isArray(a)||t.length!==a.length)return!1;for(let l=0;l<t.length;l++)if(!n(t[l],a[l]))return!1;return!0}if(typeof t=="object"&&t!==null&&a!==null){if(typeof a!="object"||Object.keys(t).length!==Object.keys(a).length)return!1;for(const l in t)if(!n(t[l],a[l]))return!1;return!0}return t===a},E.bI=function(n){n=n.slice();const t=Object.create(null);for(let a=0;a<n.length;a++)t[n[a].id]=n[a];for(let a=0;a<n.length;a++)"ref"in n[a]&&(n[a]=zi(n[a],t[n[a].ref]));return n},E.bJ=function(n,t){if(n.type==="custom")return new dg(n,t);switch(n.type){case"background":return new Jh(n,t);case"circle":return new Cf(n,t);case"color-relief":return new tg(n,t);case"fill":return new Fu(n,t);case"fill-extrusion":return new Uu(n,t);case"heatmap":return new Pf(n,t);case"hillshade":return new ml(n,t);case"line":return new Nd(n,t);case"raster":return new Po(n,t);case"symbol":return new Hu(n,t)}},E.bK=n=>n.type==="raster",E.bL=mi,E.bM=function(n,t){if(!n)return[{command:"setStyle",args:[t]}];let a=[];try{if(!kt(n.version,t.version))return[{command:"setStyle",args:[t]}];kt(n.center,t.center)||a.push({command:"setCenter",args:[t.center]}),kt(n.state,t.state)||a.push({command:"setGlobalState",args:[t.state]}),kt(n.centerAltitude,t.centerAltitude)||a.push({command:"setCenterAltitude",args:[t.centerAltitude]}),kt(n.zoom,t.zoom)||a.push({command:"setZoom",args:[t.zoom]}),kt(n.bearing,t.bearing)||a.push({command:"setBearing",args:[t.bearing]}),kt(n.pitch,t.pitch)||a.push({command:"setPitch",args:[t.pitch]}),kt(n.roll,t.roll)||a.push({command:"setRoll",args:[t.roll]}),kt(n.sprite,t.sprite)||a.push({command:"setSprite",args:[t.sprite]}),kt(n.glyphs,t.glyphs)||a.push({command:"setGlyphs",args:[t.glyphs]}),kt(n.transition,t.transition)||a.push({command:"setTransition",args:[t.transition]}),kt(n.light,t.light)||a.push({command:"setLight",args:[t.light]}),kt(n.terrain,t.terrain)||a.push({command:"setTerrain",args:[t.terrain]}),kt(n.sky,t.sky)||a.push({command:"setSky",args:[t.sky]}),kt(n.projection,t.projection)||a.push({command:"setProjection",args:[t.projection]});const l={},d=[];(function(v,b,S,I){let R;for(R in b=b||{},v=v||{})Object.prototype.hasOwnProperty.call(v,R)&&(Object.prototype.hasOwnProperty.call(b,R)||za(R,S,I));for(R in b)Object.prototype.hasOwnProperty.call(b,R)&&(Object.prototype.hasOwnProperty.call(v,R)?kt(v[R],b[R])||(v[R].type==="geojson"&&b[R].type==="geojson"&&hn(v,b,R)?Ei(S,{command:"setGeoJSONSourceData",args:[R,b[R].data]}):qa(R,b,S,I)):Fa(R,b,S))})(n.sources,t.sources,d,l);const _=[];n.layers&&n.layers.forEach((v=>{"source"in v&&l[v.source]?a.push({command:"removeLayer",args:[v.id]}):_.push(v)})),a=a.concat(d),(function(v,b,S){b=b||[];const I=(v=v||[]).map(Za),R=b.map(Za),O=v.reduce(ji,{}),U=b.reduce(ji,{}),V=I.slice(),Z=Object.create(null);let Y,ie,se,Ee,de;for(let ge=0,ke=0;ge<I.length;ge++)Y=I[ge],Object.prototype.hasOwnProperty.call(U,Y)?ke++:(Ei(S,{command:"removeLayer",args:[Y]}),V.splice(V.indexOf(Y,ke),1));for(let ge=0,ke=0;ge<R.length;ge++)Y=R[R.length-1-ge],V[V.length-1-ge]!==Y&&(Object.prototype.hasOwnProperty.call(O,Y)?(Ei(S,{command:"removeLayer",args:[Y]}),V.splice(V.lastIndexOf(Y,V.length-ke),1)):ke++,Ee=V[V.length-ge],Ei(S,{command:"addLayer",args:[U[Y],Ee]}),V.splice(V.length-ge,0,Y),Z[Y]=!0);for(let ge=0;ge<R.length;ge++)if(Y=R[ge],ie=O[Y],se=U[Y],!Z[Y]&&!kt(ie,se))if(kt(ie.source,se.source)&&kt(ie["source-layer"],se["source-layer"])&&kt(ie.type,se.type)){for(de in Ji(ie.layout,se.layout,S,Y,null,"setLayoutProperty"),Ji(ie.paint,se.paint,S,Y,null,"setPaintProperty"),kt(ie.filter,se.filter)||Ei(S,{command:"setFilter",args:[Y,se.filter]}),kt(ie.minzoom,se.minzoom)&&kt(ie.maxzoom,se.maxzoom)||Ei(S,{command:"setLayerZoomRange",args:[Y,se.minzoom,se.maxzoom]}),ie)Object.prototype.hasOwnProperty.call(ie,de)&&de!=="layout"&&de!=="paint"&&de!=="filter"&&de!=="metadata"&&de!=="minzoom"&&de!=="maxzoom"&&(de.indexOf("paint.")===0?Ji(ie[de],se[de],S,Y,de.slice(6),"setPaintProperty"):kt(ie[de],se[de])||Ei(S,{command:"setLayerProperty",args:[Y,de,se[de]]}));for(de in se)Object.prototype.hasOwnProperty.call(se,de)&&!Object.prototype.hasOwnProperty.call(ie,de)&&de!=="layout"&&de!=="paint"&&de!=="filter"&&de!=="metadata"&&de!=="minzoom"&&de!=="maxzoom"&&(de.indexOf("paint.")===0?Ji(ie[de],se[de],S,Y,de.slice(6),"setPaintProperty"):kt(ie[de],se[de])||Ei(S,{command:"setLayerProperty",args:[Y,de,se[de]]}))}else Ei(S,{command:"removeLayer",args:[Y]}),Ee=V[V.lastIndexOf(Y)+1],Ei(S,{command:"addLayer",args:[se,Ee]})})(_,t.layers,a)}catch(l){console.warn("Unable to compute style diff:",l),a=[{command:"setStyle",args:[t]}]}return a},E.bN=function(n){const t=[],a=n.id;return a===void 0&&t.push({message:`layers.${a}: missing required property "id"`}),n.render===void 0&&t.push({message:`layers.${a}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&t.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),t},E.bO=Ni,E.bP=ri,E.bQ=class extends Qn{constructor(n,t){super(n,t),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},E.bR=Kn,E.bS=class extends Qn{constructor(n,t){super(n,t),this.current=xn}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let t=1;t<16;t++)if(n[t]!==this.current[t]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},E.bT=Xa,E.bU=class extends Qn{constructor(n,t){super(n,t),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},E.bV=class extends Qn{constructor(n,t){super(n,t),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},E.bW=vt,E.bX=function(n,t){var a=Math.sin(t),l=Math.cos(t);return n[0]=l,n[1]=a,n[2]=0,n[3]=-a,n[4]=l,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},E.bY=function(n,t,a){var l=t[0],d=t[1],_=t[2];return n[0]=l*a[0]+d*a[3]+_*a[6],n[1]=l*a[1]+d*a[4]+_*a[7],n[2]=l*a[2]+d*a[5]+_*a[8],n},E.bZ=function(n,t,a,l,d,_,v){var b=1/(t-a),S=1/(l-d),I=1/(_-v);return n[0]=-2*b,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*S,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*I,n[11]=0,n[12]=(t+a)*b,n[13]=(d+l)*S,n[14]=(v+_)*I,n[15]=1,n},E.b_=class extends Qn{constructor(n,t){super(n,t),this.current=new Array}set(n){if(n!=this.current){this.current=n;const t=new Float32Array(4*n.length);for(let a=0;a<n.length;a++)t[4*a]=n[a].r,t[4*a+1]=n[a].g,t[4*a+2]=n[a].b,t[4*a+3]=n[a].a;this.gl.uniform4fv(this.location,t)}}},E.ba=function(){return new Float64Array(16)},E.bb=function(n,t,a){const l=new Float64Array(4);return He(l,n,t-90,a),l},E.bc=function(n,t,a,l){var d,_,v,b,S,I=t[0],R=t[1],O=t[2],U=t[3],V=a[0],Z=a[1],Y=a[2],ie=a[3];return(_=I*V+R*Z+O*Y+U*ie)<0&&(_=-_,V=-V,Z=-Z,Y=-Y,ie=-ie),1-_>Be?(d=Math.acos(_),v=Math.sin(d),b=Math.sin((1-l)*d)/v,S=Math.sin(l*d)/v):(b=1-l,S=l),n[0]=b*I+S*V,n[1]=b*R+S*Z,n[2]=b*O+S*Y,n[3]=b*U+S*ie,n},E.bd=function(n){const t=new Float64Array(9);var a,l,d,_,v,b,S,I,R,O,U,V,Z,Y,ie,se,Ee,de;O=(d=(l=n)[0])*(S=d+d),U=(_=l[1])*S,Z=(v=l[2])*S,Y=v*(I=_+_),se=(b=l[3])*S,Ee=b*I,de=b*(R=v+v),(a=t)[0]=1-(V=_*I)-(ie=v*R),a[3]=U-de,a[6]=Z+Ee,a[1]=U+de,a[4]=1-O-ie,a[7]=Y-se,a[2]=Z-Ee,a[5]=Y+se,a[8]=1-O-V;const ge=Ui(-Math.asin(Ot(t[2],-1,1)));let ke,Ve;return Math.hypot(t[5],t[8])<.001?(ke=0,Ve=-Ui(Math.atan2(t[3],t[4]))):(ke=Ui(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),Ve=Ui(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:ke,pitch:ge+90,bearing:Ve}},E.be=function(n,t){return n.roll==t.roll&&n.pitch==t.pitch&&n.bearing==t.bearing},E.bf=hi,E.bg=Ea,E.bh=Mn,E.bi=_r,E.bj=ju,E.bk=Ue,E.bl=We,E.bm=fn,E.bn=function(n,t,a,l,d){return Ue(l,d,Ot((n-t)/(a-t),0,1))},E.bo=pe,E.bp=function(){return new Float64Array(3)},E.bq=function(n,t,a,l){return n[0]=t[0]+a[0]*l,n[1]=t[1]+a[1]*l,n[2]=t[2]+a[2]*l,n},E.br=He,E.bs=function(n,t,a){var l=a[0],d=a[1],_=a[2],v=a[3],b=t[0],S=t[1],I=t[2],R=d*I-_*S,O=_*b-l*I,U=l*S-d*b;return n[0]=b+v*(R+=R)+d*(U+=U)-_*(O+=O),n[1]=S+v*O+_*R-l*U,n[2]=I+v*U+l*O-d*R,n},E.bt=function(n,t,a){const l=(d=[n[0],n[1],n[2],t[0],t[1],t[2],a[0],a[1],a[2]])[0]*((R=d[8])*(v=d[4])-(b=d[5])*(I=d[7]))+d[1]*(-R*(_=d[3])+b*(S=d[6]))+d[2]*(I*_-v*S);var d,_,v,b,S,I,R;if(l===0)return null;const O=mt([],[t[0],t[1],t[2]],[a[0],a[1],a[2]]),U=mt([],[a[0],a[1],a[2]],[n[0],n[1],n[2]]),V=mt([],[n[0],n[1],n[2]],[t[0],t[1],t[2]]),Z=Ye([],O,-n[3]);return Se(Z,Z,Ye([],U,-t[3])),Se(Z,Z,Ye([],V,-a[3])),Ye(Z,Z,1/l),Z},E.bu=ed,E.bv=function(){return new Float64Array(4)},E.bw=function(n,t,a,l){var d=[],_=[];return d[0]=t[0]-a[0],d[1]=t[1]-a[1],d[2]=t[2]-a[2],_[0]=d[0]*Math.cos(l)-d[1]*Math.sin(l),_[1]=d[0]*Math.sin(l)+d[1]*Math.cos(l),_[2]=d[2],n[0]=_[0]+a[0],n[1]=_[1]+a[1],n[2]=_[2]+a[2],n},E.bx=function(n,t,a,l){var d=[],_=[];return d[0]=t[0]-a[0],d[1]=t[1]-a[1],d[2]=t[2]-a[2],_[0]=d[0],_[1]=d[1]*Math.cos(l)-d[2]*Math.sin(l),_[2]=d[1]*Math.sin(l)+d[2]*Math.cos(l),n[0]=_[0]+a[0],n[1]=_[1]+a[1],n[2]=_[2]+a[2],n},E.by=function(n,t,a,l){var d=[],_=[];return d[0]=t[0]-a[0],d[1]=t[1]-a[1],d[2]=t[2]-a[2],_[0]=d[2]*Math.sin(l)+d[0]*Math.cos(l),_[1]=d[1],_[2]=d[2]*Math.cos(l)-d[0]*Math.sin(l),n[0]=_[0]+a[0],n[1]=_[1]+a[1],n[2]=_[2]+a[2],n},E.bz=function(n,t,a){var l=Math.sin(a),d=Math.cos(a),_=t[0],v=t[1],b=t[2],S=t[3],I=t[8],R=t[9],O=t[10],U=t[11];return t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=_*d-I*l,n[1]=v*d-R*l,n[2]=b*d-O*l,n[3]=S*d-U*l,n[8]=_*l+I*d,n[9]=v*l+R*d,n[10]=b*l+O*d,n[11]=S*l+U*d,n},E.c=H,E.c0=class extends Iu{},E.c1=Ff,E.c2=class extends e{},E.c3=Ks,E.c4=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},E.c5=Af,E.c6=function(n,t,a){var l=t[0],d=t[1],_=t[2],v=a[3]*l+a[7]*d+a[11]*_+a[15];return n[0]=(a[0]*l+a[4]*d+a[8]*_+a[12])/(v=v||1),n[1]=(a[1]*l+a[5]*d+a[9]*_+a[13])/v,n[2]=(a[2]*l+a[6]*d+a[10]*_+a[14])/v,n},E.c7=class extends hl{},E.c8=class extends A{},E.c9=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]&&n[9]===t[9]&&n[10]===t[10]&&n[11]===t[11]&&n[12]===t[12]&&n[13]===t[13]&&n[14]===t[14]&&n[15]===t[15]},E.cA=function(n,t){$.REGISTERED_PROTOCOLS[n]=t},E.cB=function(n){delete $.REGISTERED_PROTOCOLS[n]},E.cC=function(n,t){const a={};for(let d=0;d<n.length;d++){const _=t&&t[n[d].id]||$r(n[d]);t&&(t[n[d].id]=_);let v=a[_];v||(v=a[_]=[]),v.push(n[d])}const l=[];for(const d in a)l.push(a[d]);return l},E.cD=Tt,E.cE=op,E.cF=Wd,E.cG=Hf,E.cH=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=ft/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const t=n.bucket.layers[0],a=t.layout,l=t._unevaluatedLayout._values,d={layoutIconSize:l["icon-size"].possiblyEvaluate(new Wi(n.bucket.zoom+1),n.canonical),layoutTextSize:l["text-size"].possiblyEvaluate(new Wi(n.bucket.zoom+1),n.canonical),textMaxSize:l["text-size"].possiblyEvaluate(new Wi(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:I,maxZoom:R}=n.bucket.textSizeData;d.compositeTextSizes=[l["text-size"].possiblyEvaluate(new Wi(I),n.canonical),l["text-size"].possiblyEvaluate(new Wi(R),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:I,maxZoom:R}=n.bucket.iconSizeData;d.compositeIconSizes=[l["icon-size"].possiblyEvaluate(new Wi(I),n.canonical),l["icon-size"].possiblyEvaluate(new Wi(R),n.canonical)]}const _=a.get("text-line-height")*Ba,v=a.get("text-rotation-alignment")!=="viewport"&&a.get("symbol-placement")!=="point",b=a.get("text-keep-upright"),S=a.get("text-size");for(const I of n.bucket.features){const R=a.get("text-font").evaluate(I,{},n.canonical).join(","),O=S.evaluate(I,{},n.canonical),U=d.layoutTextSize.evaluate(I,{},n.canonical),V=d.layoutIconSize.evaluate(I,{},n.canonical),Z={horizontal:{},vertical:void 0},Y=I.text;let ie,se=[0,0];if(Y){const ge=Y.toString(),ke=a.get("text-letter-spacing").evaluate(I,{},n.canonical)*Ba,Ve=Ah(ge)?ke:0,rt=a.get("text-anchor").evaluate(I,{},n.canonical),St=dp(t,I,n.canonical);if(!St){const yt=a.get("text-radial-offset").evaluate(I,{},n.canonical);se=yt?af(rt,[yt*Ba,Lr]):a.get("text-offset").evaluate(I,{},n.canonical).map((wt=>wt*Ba))}let pt=v?"center":a.get("text-justify").evaluate(I,{},n.canonical);const bt=a.get("symbol-placement")==="point"?a.get("text-max-width").evaluate(I,{},n.canonical)*Ba:1/0,Nt=()=>{n.bucket.allowVerticalPlacement&&xs(ge)&&(Z.vertical=Xh(Y,n.glyphMap,n.glyphPositions,n.imagePositions,R,bt,_,rt,"left",Ve,se,E.ao.vertical,!0,U,O))};if(!v&&St){const yt=new Set;if(pt==="auto")for(let et=0;et<St.values.length;et+=2)yt.add(nf(St.values[et]));else yt.add(pt);let wt=!1;for(const et of yt)if(!Z.horizontal[et])if(wt)Z.horizontal[et]=Z.horizontal[0];else{const $t=Xh(Y,n.glyphMap,n.glyphPositions,n.imagePositions,R,bt,_,"center",et,Ve,se,E.ao.horizontal,!1,U,O);$t&&(Z.horizontal[et]=$t,wt=$t.positionedLines.length===1)}Nt()}else{pt==="auto"&&(pt=nf(rt));const yt=Xh(Y,n.glyphMap,n.glyphPositions,n.imagePositions,R,bt,_,rt,pt,Ve,se,E.ao.horizontal,!1,U,O);yt&&(Z.horizontal[pt]=yt),Nt(),xs(ge)&&v&&b&&(Z.vertical=Xh(Y,n.glyphMap,n.glyphPositions,n.imagePositions,R,bt,_,rt,pt,Ve,se,E.ao.vertical,!1,U,O))}}let Ee=!1;if(I.icon&&I.icon.name){const ge=n.imageMap[I.icon.name];ge&&(ie=$u(n.imagePositions[I.icon.name],a.get("icon-offset").evaluate(I,{},n.canonical),a.get("icon-anchor").evaluate(I,{},n.canonical)),Ee=!!ge.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=Ee:n.bucket.sdfIcons!==Ee&&Xt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ge.pixelRatio!==n.bucket.pixelRatio||a.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const de=ns(Z.horizontal)||Z.vertical;n.bucket.iconsInText=!!de&&de.iconsInText,(de||ie)&&Mm(n.bucket,I,Z,ie,n.imageMap,d,U,V,se,Ee,n.canonical,n.subdivisionGranularity)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},E.cI=Uh,E.cJ=ha,E.cK=eu,E.cL=Bf,E.cM=er,E.cN=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},E.cO=function(n,t,a,l,d){return o(this,void 0,void 0,(function*(){if(Ze())try{return yield qn(n,t,a,l,d)}catch{}return(function(_,v,b,S,I){const R=_.width,O=_.height;Ja&&An||(Ja=new OffscreenCanvas(R,O),An=Ja.getContext("2d",{willReadFrequently:!0})),Ja.width=R,Ja.height=O,An.drawImage(_,0,0,R,O);const U=An.getImageData(v,b,S,I);return An.clearRect(0,0,R,O),U.data})(n,t,a,l,d)}))},E.cP=Ou,E.cQ=j,E.cR=Of,E.cS=Wc,E.cT=zc,E.cU=function(n,t){const a=new Map;if(n!=null)if(n.type==="Feature")a.set(on(n,t),n);else for(const l of n.features)a.set(on(l,t),l);return a},E.cV=function(n,t){if(n==null)return!0;if(n.type==="Feature")return on(n,t)!=null;if(n.type==="FeatureCollection"){const a=new Set;for(const l of n.features){const d=on(l,t);if(d==null||a.has(d))return!1;a.add(d)}return!0}return!1},E.cW=function(n,t,a){var l,d,_,v;if(t.removeAll&&n.clear(),t.remove)for(const b of t.remove)n.delete(b);if(t.add)for(const b of t.add){const S=on(b,a);S!=null&&n.set(S,b)}if(t.update)for(const b of t.update){let S=n.get(b.id);if(S==null)continue;const I=!b.removeAllProperties&&(((l=b.removeProperties)===null||l===void 0?void 0:l.length)>0||((d=b.addOrUpdateProperties)===null||d===void 0?void 0:d.length)>0);if((b.newGeometry||b.removeAllProperties||I)&&(S=Object.assign({},S),n.set(b.id,S),I&&(S.properties=Object.assign({},S.properties))),b.newGeometry&&(S.geometry=b.newGeometry),b.removeAllProperties)S.properties={};else if(((_=b.removeProperties)===null||_===void 0?void 0:_.length)>0)for(const R of b.removeProperties)Object.prototype.hasOwnProperty.call(S.properties,R)&&delete S.properties[R];if(((v=b.addOrUpdateProperties)===null||v===void 0?void 0:v.length)>0)for(const{key:R,value:O}of b.addOrUpdateProperties)S.properties[R]=O}},E.cX=bs,E.ca=function(n,t){var a=n[0],l=n[1],d=n[2],_=n[3],v=n[4],b=n[5],S=n[6],I=n[7],R=n[8],O=n[9],U=n[10],V=n[11],Z=n[12],Y=n[13],ie=n[14],se=n[15],Ee=t[0],de=t[1],ge=t[2],ke=t[3],Ve=t[4],rt=t[5],St=t[6],pt=t[7],bt=t[8],Nt=t[9],yt=t[10],wt=t[11],et=t[12],$t=t[13],Wt=t[14],Zt=t[15];return Math.abs(a-Ee)<=Be*Math.max(1,Math.abs(a),Math.abs(Ee))&&Math.abs(l-de)<=Be*Math.max(1,Math.abs(l),Math.abs(de))&&Math.abs(d-ge)<=Be*Math.max(1,Math.abs(d),Math.abs(ge))&&Math.abs(_-ke)<=Be*Math.max(1,Math.abs(_),Math.abs(ke))&&Math.abs(v-Ve)<=Be*Math.max(1,Math.abs(v),Math.abs(Ve))&&Math.abs(b-rt)<=Be*Math.max(1,Math.abs(b),Math.abs(rt))&&Math.abs(S-St)<=Be*Math.max(1,Math.abs(S),Math.abs(St))&&Math.abs(I-pt)<=Be*Math.max(1,Math.abs(I),Math.abs(pt))&&Math.abs(R-bt)<=Be*Math.max(1,Math.abs(R),Math.abs(bt))&&Math.abs(O-Nt)<=Be*Math.max(1,Math.abs(O),Math.abs(Nt))&&Math.abs(U-yt)<=Be*Math.max(1,Math.abs(U),Math.abs(yt))&&Math.abs(V-wt)<=Be*Math.max(1,Math.abs(V),Math.abs(wt))&&Math.abs(Z-et)<=Be*Math.max(1,Math.abs(Z),Math.abs(et))&&Math.abs(Y-$t)<=Be*Math.max(1,Math.abs(Y),Math.abs($t))&&Math.abs(ie-Wt)<=Be*Math.max(1,Math.abs(ie),Math.abs(Wt))&&Math.abs(se-Zt)<=Be*Math.max(1,Math.abs(se),Math.abs(Zt))},E.cb=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},E.cc=n=>n.type==="symbol",E.cd=n=>n.type==="circle",E.ce=n=>n.type==="heatmap",E.cf=n=>n.type==="line",E.cg=n=>n.type==="fill",E.ch=n=>n.type==="fill-extrusion",E.ci=n=>n.type==="hillshade",E.cj=n=>n.type==="color-relief",E.ck=n=>n.type==="background",E.cl=n=>n.type==="custom",E.cm=Mt,E.cn=function(n,t,a){const l=At(t.x-a.x,t.y-a.y),d=At(n.x-a.x,n.y-a.y);var _,v;return Ui(Math.atan2(l[0]*d[1]-l[1]*d[0],(_=l)[0]*(v=d)[0]+_[1]*v[1]))},E.co=Lt,E.cp=function(n,t){return ya[t]&&(n instanceof MouseEvent||n instanceof WheelEvent)},E.cq=function(n,t){return Sa[t]&&"touches"in n},E.cr=function(n){return Sa[n]||ya[n]},E.cs=function(n,t,a){var l=t[0],d=t[1];return n[0]=a[0]*l+a[4]*d+a[12],n[1]=a[1]*l+a[5]*d+a[13],n},E.ct=function(n,t){const{x:a,y:l}=id.fromLngLat(t);return!(n<0||n>25||l<0||l>=1||a<0||a>=1)},E.cu=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},E.cv=class extends va{},E.cw=Am,E.cy=function(n){return n.message===ve},E.cz=fe,E.d=Ce,E.e=Ut,E.f=n=>o(void 0,void 0,void 0,(function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(t)}catch(a){throw new Error(`Could not load image because of ${a.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),E.g=te,E.h=n=>new Promise(((t,a)=>{const l=new Image;l.onload=()=>{t(l),URL.revokeObjectURL(l.src),l.onload=null,window.requestAnimationFrame((()=>{l.src=ia}))},l.onerror=()=>a(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const d=new Blob([new Uint8Array(n)],{type:"image/png"});l.src=n.byteLength?URL.createObjectURL(d):ia})),E.i=Jt,E.j=(n,t)=>Ie(Ut(n,{type:"json"}),t),E.k=zt,E.l=Je,E.m=Ie,E.n=(n,t)=>Ie(Ut(n,{type:"arrayBuffer"}),t),E.o=function(n){return new er(n).readFields(Fd,[])},E.p=hm,E.q=ku,E.r=la,E.s=Pi,E.t=Fc,E.u=oi,E.v=Pe,E.w=Xt,E.x=bf,E.y=bo,E.z=dr})),P("worker",["./shared"],(function(E){class o{constructor(H,$){this.keyCache={},H&&this.replace(H,$)}replace(H,$){this._layerConfigs={},this._layers={},this.update(H,[],$)}update(H,$,te){for(const fe of H){this._layerConfigs[fe.id]=fe;const be=this._layers[fe.id]=E.bJ(fe,te);be._featureFilter=E.aa(be.filter,te),this.keyCache[fe.id]&&delete this.keyCache[fe.id]}for(const fe of $)delete this.keyCache[fe],delete this._layerConfigs[fe],delete this._layers[fe];this.familiesBySource={};const ce=E.cC(Object.values(this._layerConfigs),this.keyCache);for(const fe of ce){const be=fe.map((zt=>this._layers[zt.id])),Ie=be[0];if(Ie.visibility==="none")continue;const Ce=Ie.source||"";let $e=this.familiesBySource[Ce];$e||($e=this.familiesBySource[Ce]={});const ct=Ie.sourceLayer||"_geojsonTileLayer";let Je=$e[ct];Je||(Je=$e[ct]=[]),Je.push(be)}}}class B{constructor(H){const $={},te=[];for(const Ie in H){const Ce=H[Ie],$e=$[Ie]={};for(const ct in Ce){const Je=Ce[+ct];if(!Je||Je.bitmap.width===0||Je.bitmap.height===0)continue;const zt={x:0,y:0,w:Je.bitmap.width+2,h:Je.bitmap.height+2};te.push(zt),$e[ct]={rect:zt,metrics:Je.metrics}}}const{w:ce,h:fe}=E.p(te),be=new E.q({width:ce||1,height:fe||1});for(const Ie in H){const Ce=H[Ie];for(const $e in Ce){const ct=Ce[+$e];if(!ct||ct.bitmap.width===0||ct.bitmap.height===0)continue;const Je=$[Ie][$e].rect;E.q.copy(ct.bitmap,be,{x:0,y:0},{x:Je.x+1,y:Je.y+1},ct.bitmap)}}this.image=be,this.positions=$}}E.cD("GlyphAtlas",B);class j{constructor(H){this.tileID=new E.Z(H.tileID.overscaledZ,H.tileID.wrap,H.tileID.canonical.z,H.tileID.canonical.x,H.tileID.canonical.y),this.uid=H.uid,this.zoom=H.zoom,this.pixelRatio=H.pixelRatio,this.tileSize=H.tileSize,this.source=H.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=H.showCollisionBoxes,this.collectResourceTiming=!!H.collectResourceTiming,this.returnDependencies=!!H.returnDependencies,this.promoteId=H.promoteId,this.inFlightDependencies=[]}parse(H,$,te,ce,fe){return E._(this,void 0,void 0,(function*(){this.status="parsing",this.data=H,this.collisionBoxArray=new E.a8;const be=new E.cE(Object.keys(H.layers).sort()),Ie=new E.cF(this.tileID,this.promoteId);Ie.bucketLayerIDs=[];const Ce={},$e={featureIndex:Ie,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:te,subdivisionGranularity:fe},ct=$.familiesBySource[this.source];for(const ji in ct){const st=H.layers[ji];if(!st)continue;st.version===1&&E.w(`Vector tile source "${this.source}" layer "${ji}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Gr=be.encode(ji),Zn=[];for(let $a=0;$a<st.length;$a++){const Ri=st.feature($a),ut=Ie.getId(Ri,ji);Zn.push({feature:Ri,id:ut,index:$a,sourceLayerIndex:Gr})}for(const $a of ct[ji]){const Ri=$a[0];Ri.source!==this.source&&E.w(`layer.source = ${Ri.source} does not equal this.source = ${this.source}`),Ri.minzoom&&this.zoom<Math.floor(Ri.minzoom)||Ri.maxzoom&&this.zoom>=Ri.maxzoom||Ri.visibility!=="none"&&(J($a,this.zoom,te),(Ce[Ri.id]=Ri.createBucket({index:Ie.bucketLayerIDs.length,layers:$a,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Gr,sourceID:this.source})).populate(Zn,$e,this.tileID.canonical),Ie.bucketLayerIDs.push($a.map((ut=>ut.id))))}}const Je=E.bO($e.glyphDependencies,(ji=>Object.keys(ji).map(Number)));this.inFlightDependencies.forEach((ji=>ji?.abort())),this.inFlightDependencies=[];let zt=Promise.resolve({});if(Object.keys(Je).length){const ji=new AbortController;this.inFlightDependencies.push(ji),zt=ce.sendAsync({type:"GG",data:{stacks:Je,source:this.source,tileID:this.tileID,type:"glyphs"}},ji)}const Vt=Object.keys($e.iconDependencies);let Pe=Promise.resolve({});if(Vt.length){const ji=new AbortController;this.inFlightDependencies.push(ji),Pe=ce.sendAsync({type:"GI",data:{icons:Vt,source:this.source,tileID:this.tileID,type:"icons"}},ji)}const _i=Object.keys($e.patternDependencies);let zi=Promise.resolve({});if(_i.length){const ji=new AbortController;this.inFlightDependencies.push(ji),zi=ce.sendAsync({type:"GI",data:{icons:_i,source:this.source,tileID:this.tileID,type:"patterns"}},ji)}const kt=$e.dashDependencies;let Ei=Promise.resolve({});if(Object.keys(kt).length){const ji=new AbortController;this.inFlightDependencies.push(ji),Ei=ce.sendAsync({type:"GDA",data:{dashes:kt}},ji)}const[Fa,za,qa,hn]=yield Promise.all([zt,Pe,zi,Ei]),Ji=new B(Fa),Za=new E.cG(za,qa);for(const ji in Ce){const st=Ce[ji];st instanceof E.a9?(J(st.layers,this.zoom,te),E.cH({bucket:st,glyphMap:Fa,glyphPositions:Ji.positions,imageMap:za,imagePositions:Za.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:$e.subdivisionGranularity})):st.hasDependencies&&(st instanceof E.cI||st instanceof E.cJ||st instanceof E.cK)&&(J(st.layers,this.zoom,te),st.addFeatures($e,this.tileID.canonical,Za.patternPositions,hn))}return this.status="done",{buckets:Object.values(Ce).filter((ji=>!ji.isEmpty())),featureIndex:Ie,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ji.image,imageAtlas:Za,dashPositions:hn,glyphMap:this.returnDependencies?Fa:null,iconMap:this.returnDependencies?za:null,glyphPositions:this.returnDependencies?Ji.positions:null}}))}}function J(ve,H,$){const te=new E.F(H);for(const ce of ve)ce.recalculate(te,$)}class K{constructor(H,$,te){this.actor=H,this.layerIndex=$,this.availableImages=te,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(H,$){return E._(this,void 0,void 0,(function*(){const te=yield E.n(H.request,$);try{return{vectorTile:new E.cL(new E.cM(te.data)),rawData:te.data,cacheControl:te.cacheControl,expires:te.expires}}catch(ce){const fe=new Uint8Array(te.data);let be=`Unable to parse the tile at ${H.request.url}, `;throw be+=fe[0]===31&&fe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ce.message}`,new Error(be)}}))}loadTile(H){return E._(this,void 0,void 0,(function*(){const $=H.uid,te=!!(H&&H.request&&H.request.collectResourceTiming)&&new E.cN(H.request),ce=new j(H);this.loading[$]=ce;const fe=new AbortController;ce.abort=fe;try{const be=yield this.loadVectorTile(H,fe);if(delete this.loading[$],!be)return null;const Ie=be.rawData,Ce={};be.expires&&(Ce.expires=be.expires),be.cacheControl&&(Ce.cacheControl=be.cacheControl);const $e={};if(te){const Je=te.finish();Je&&($e.resourceTiming=JSON.parse(JSON.stringify(Je)))}ce.vectorTile=be.vectorTile;const ct=ce.parse(be.vectorTile,this.layerIndex,this.availableImages,this.actor,H.subdivisionGranularity);this.loaded[$]=ce,this.fetching[$]={rawTileData:Ie,cacheControl:Ce,resourceTiming:$e};try{const Je=yield ct;return E.e({rawTileData:Ie.slice(0)},Je,Ce,$e)}finally{delete this.fetching[$]}}catch(be){throw delete this.loading[$],ce.status="done",this.loaded[$]=ce,be}}))}reloadTile(H){return E._(this,void 0,void 0,(function*(){const $=H.uid;if(!this.loaded||!this.loaded[$])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const te=this.loaded[$];if(te.showCollisionBoxes=H.showCollisionBoxes,te.status==="parsing"){const ce=yield te.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor,H.subdivisionGranularity);let fe;if(this.fetching[$]){const{rawTileData:be,cacheControl:Ie,resourceTiming:Ce}=this.fetching[$];delete this.fetching[$],fe=E.e({rawTileData:be.slice(0)},ce,Ie,Ce)}else fe=ce;return fe}if(te.status==="done"&&te.vectorTile)return te.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor,H.subdivisionGranularity)}))}abortTile(H){return E._(this,void 0,void 0,(function*(){const $=this.loading,te=H.uid;$&&$[te]&&$[te].abort&&($[te].abort.abort(),delete $[te])}))}removeTile(H){return E._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[H.uid]&&delete this.loaded[H.uid]}))}}class W{constructor(){this.loaded={}}loadTile(H){return E._(this,void 0,void 0,(function*(){const{uid:$,encoding:te,rawImageData:ce,redFactor:fe,greenFactor:be,blueFactor:Ie,baseShift:Ce}=H,$e=ce.width+2,ct=ce.height+2,Je=E.b(ce)?new E.R({width:$e,height:ct},yield E.cO(ce,-1,-1,$e,ct)):ce,zt=new E.cP($,Je,te,fe,be,Ie,Ce);return this.loaded=this.loaded||{},this.loaded[$]=zt,zt}))}removeTile(H){const $=this.loaded,te=H.uid;$&&$[te]&&delete $[te]}}var ee,we,Oe=(function(){if(we)return ee;function ve($,te){if($.length!==0){H($[0],te);for(var ce=1;ce<$.length;ce++)H($[ce],!te)}}function H($,te){for(var ce=0,fe=0,be=0,Ie=$.length,Ce=Ie-1;be<Ie;Ce=be++){var $e=($[be][0]-$[Ce][0])*($[Ce][1]+$[be][1]),ct=ce+$e;fe+=Math.abs(ce)>=Math.abs($e)?ce-ct+$e:$e-ct+ce,ce=ct}ce+fe>=0!=!!te&&$.reverse()}return we=1,ee=function $(te,ce){var fe,be=te&&te.type;if(be==="FeatureCollection")for(fe=0;fe<te.features.length;fe++)$(te.features[fe],ce);else if(be==="GeometryCollection")for(fe=0;fe<te.geometries.length;fe++)$(te.geometries[fe],ce);else if(be==="Feature")$(te.geometry,ce);else if(be==="Polygon")ve(te.coordinates,ce);else if(be==="MultiPolygon")for(fe=0;fe<te.coordinates.length;fe++)ve(te.coordinates[fe],ce);return te}})(),Ae=E.cQ(Oe);class Ze extends E.cS{constructor(H,$){super(new E.cM,0,$,[],[]),this.feature=H,this.type=H.type,this.properties=H.tags?H.tags:{},"id"in H&&(typeof H.id=="string"?this.id=parseInt(H.id,10):typeof H.id!="number"||isNaN(H.id)||(this.id=H.id))}loadGeometry(){const H=[],$=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const te of $){const ce=[];for(const fe of te)ce.push(new E.P(fe[0],fe[1]));H.push(ce)}return H}}class Be extends E.cR{constructor(H,$){super(new E.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=$?$.version:1,this.extent=$?$.extent:4096,this.length=H.length,this.features=H}feature(H){return new Ze(this.features[H],this.extent)}}function Ke(ve,H){H.writeVarintField(15,ve.version||1),H.writeStringField(1,ve.name||""),H.writeVarintField(5,ve.extent||4096);const $={keys:[],values:[],keycache:{},valuecache:{}};for(let fe=0;fe<ve.length;fe++)$.feature=ve.feature(fe),H.writeMessage(2,vt,$);const te=$.keys;for(const fe of te)H.writeStringField(3,fe);const ce=$.values;for(const fe of ce)H.writeMessage(4,Se,fe)}function vt(ve,H){if(!ve.feature)return;const $=ve.feature;$.id!==void 0&&H.writeVarintField(1,$.id),H.writeMessage(2,Et,ve),H.writeVarintField(3,$.type),H.writeMessage(4,xe,$)}function Et(ve,H){for(const $ in ve.feature?.properties){let te=ve.feature.properties[$],ce=ve.keycache[$];if(te===null)continue;ce===void 0&&(ve.keys.push($),ce=ve.keys.length-1,ve.keycache[$]=ce),H.writeVarint(ce),typeof te!="string"&&typeof te!="boolean"&&typeof te!="number"&&(te=JSON.stringify(te));const fe=typeof te+":"+te;let be=ve.valuecache[fe];be===void 0&&(ve.values.push(te),be=ve.values.length-1,ve.valuecache[fe]=be),H.writeVarint(be)}}function xt(ve,H){return(H<<3)+(7&ve)}function lt(ve){return ve<<1^ve>>31}function xe(ve,H){const $=ve.loadGeometry(),te=ve.type;let ce=0,fe=0;for(const be of $){let Ie=1;te===1&&(Ie=be.length),H.writeVarint(xt(1,Ie));const Ce=te===3?be.length-1:be.length;for(let $e=0;$e<Ce;$e++){$e===1&&te!==1&&H.writeVarint(xt(2,Ce-1));const ct=be[$e].x-ce,Je=be[$e].y-fe;H.writeVarint(lt(ct)),H.writeVarint(lt(Je)),ce+=ct,fe+=Je}ve.type===3&&H.writeVarint(xt(7,1))}}function Se(ve,H){const $=typeof ve;$==="string"?H.writeStringField(1,ve):$==="boolean"?H.writeBooleanField(7,ve):$==="number"&&(ve%1!=0?H.writeDoubleField(3,ve):ve<0?H.writeSVarintField(6,ve):H.writeVarintField(5,ve))}const Ye={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ve=>ve},mt=Math.fround||(gt=new Float32Array(1),ve=>(gt[0]=+ve,gt[0]));var gt;class Gt{constructor(H){this.options=Object.assign(Object.create(Ye),H),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(H){const{log:$,minZoom:te,maxZoom:ce}=this.options;$&&console.time("total time");const fe=`prepare ${H.length} points`;$&&console.time(fe),this.points=H;const be=[];for(let Ce=0;Ce<H.length;Ce++){const $e=H[Ce];if(!$e.geometry)continue;const[ct,Je]=$e.geometry.coordinates,zt=mt(He(ct)),Vt=mt(at(Je));be.push(zt,Vt,1/0,Ce,-1,1),this.options.reduce&&be.push(0)}let Ie=this.trees[ce+1]=this._createTree(be);$&&console.timeEnd(fe);for(let Ce=ce;Ce>=te;Ce--){const $e=+Date.now();Ie=this.trees[Ce]=this._createTree(this._cluster(Ie,Ce)),$&&console.log("z%d: %d clusters in %dms",Ce,Ie.numItems,+Date.now()-$e)}return $&&console.timeEnd("total time"),this}getClusters(H,$){let te=((H[0]+180)%360+360)%360-180;const ce=Math.max(-90,Math.min(90,H[1]));let fe=H[2]===180?180:((H[2]+180)%360+360)%360-180;const be=Math.max(-90,Math.min(90,H[3]));if(H[2]-H[0]>=360)te=-180,fe=180;else if(te>fe){const Je=this.getClusters([te,ce,180,be],$),zt=this.getClusters([-180,ce,fe,be],$);return Je.concat(zt)}const Ie=this.trees[this._limitZoom($)],Ce=Ie.range(He(te),at(be),He(fe),at(ce)),$e=Ie.data,ct=[];for(const Je of Ce){const zt=this.stride*Je;ct.push($e[zt+5]>1?Oi($e,zt,this.clusterProps):this.points[$e[zt+3]])}return ct}getChildren(H){const $=this._getOriginId(H),te=this._getOriginZoom(H),ce="No cluster with the specified id.",fe=this.trees[te];if(!fe)throw new Error(ce);const be=fe.data;if($*this.stride>=be.length)throw new Error(ce);const Ie=this.options.radius/(this.options.extent*Math.pow(2,te-1)),Ce=fe.within(be[$*this.stride],be[$*this.stride+1],Ie),$e=[];for(const ct of Ce){const Je=ct*this.stride;be[Je+4]===H&&$e.push(be[Je+5]>1?Oi(be,Je,this.clusterProps):this.points[be[Je+3]])}if($e.length===0)throw new Error(ce);return $e}getLeaves(H,$,te){const ce=[];return this._appendLeaves(ce,H,$=$||10,te=te||0,0),ce}getTile(H,$,te){const ce=this.trees[this._limitZoom(H)],fe=Math.pow(2,H),{extent:be,radius:Ie}=this.options,Ce=Ie/be,$e=(te-Ce)/fe,ct=(te+1+Ce)/fe,Je={features:[]};return this._addTileFeatures(ce.range(($-Ce)/fe,$e,($+1+Ce)/fe,ct),ce.data,$,te,fe,Je),$===0&&this._addTileFeatures(ce.range(1-Ce/fe,$e,1,ct),ce.data,fe,te,fe,Je),$===fe-1&&this._addTileFeatures(ce.range(0,$e,Ce/fe,ct),ce.data,-1,te,fe,Je),Je.features.length?Je:null}getClusterExpansionZoom(H){let $=this._getOriginZoom(H)-1;for(;$<=this.options.maxZoom;){const te=this.getChildren(H);if($++,te.length!==1)break;H=te[0].properties.cluster_id}return $}_appendLeaves(H,$,te,ce,fe){const be=this.getChildren($);for(const Ie of be){const Ce=Ie.properties;if(Ce&&Ce.cluster?fe+Ce.point_count<=ce?fe+=Ce.point_count:fe=this._appendLeaves(H,Ce.cluster_id,te,ce,fe):fe<ce?fe++:H.push(Ie),H.length===te)break}return fe}_createTree(H){const $=new E.aI(H.length/this.stride|0,this.options.nodeSize,Float32Array);for(let te=0;te<H.length;te+=this.stride)$.add(H[te],H[te+1]);return $.finish(),$.data=H,$}_addTileFeatures(H,$,te,ce,fe,be){for(const Ie of H){const Ce=Ie*this.stride,$e=$[Ce+5]>1;let ct,Je,zt;if($e)ct=Xi($,Ce,this.clusterProps),Je=$[Ce],zt=$[Ce+1];else{const _i=this.points[$[Ce+3]];ct=_i.properties;const[zi,kt]=_i.geometry.coordinates;Je=He(zi),zt=at(kt)}const Vt={type:1,geometry:[[Math.round(this.options.extent*(Je*fe-te)),Math.round(this.options.extent*(zt*fe-ce))]],tags:ct};let Pe;Pe=$e||this.options.generateId?$[Ce+3]:this.points[$[Ce+3]].id,Pe!==void 0&&(Vt.id=Pe),be.features.push(Vt)}}_limitZoom(H){return Math.max(this.options.minZoom,Math.min(Math.floor(+H),this.options.maxZoom+1))}_cluster(H,$){const{radius:te,extent:ce,reduce:fe,minPoints:be}=this.options,Ie=te/(ce*Math.pow(2,$)),Ce=H.data,$e=[],ct=this.stride;for(let Je=0;Je<Ce.length;Je+=ct){if(Ce[Je+2]<=$)continue;Ce[Je+2]=$;const zt=Ce[Je],Vt=Ce[Je+1],Pe=H.within(Ce[Je],Ce[Je+1],Ie),_i=Ce[Je+5];let zi=_i;for(const kt of Pe){const Ei=kt*ct;Ce[Ei+2]>$&&(zi+=Ce[Ei+5])}if(zi>_i&&zi>=be){let kt,Ei=zt*_i,Fa=Vt*_i,za=-1;const qa=(Je/ct<<5)+($+1)+this.points.length;for(const hn of Pe){const Ji=hn*ct;if(Ce[Ji+2]<=$)continue;Ce[Ji+2]=$;const Za=Ce[Ji+5];Ei+=Ce[Ji]*Za,Fa+=Ce[Ji+1]*Za,Ce[Ji+4]=qa,fe&&(kt||(kt=this._map(Ce,Je,!0),za=this.clusterProps.length,this.clusterProps.push(kt)),fe(kt,this._map(Ce,Ji)))}Ce[Je+4]=qa,$e.push(Ei/zi,Fa/zi,1/0,qa,-1,zi),fe&&$e.push(za)}else{for(let kt=0;kt<ct;kt++)$e.push(Ce[Je+kt]);if(zi>1)for(const kt of Pe){const Ei=kt*ct;if(!(Ce[Ei+2]<=$)){Ce[Ei+2]=$;for(let Fa=0;Fa<ct;Fa++)$e.push(Ce[Ei+Fa])}}}}return $e}_getOriginId(H){return H-this.points.length>>5}_getOriginZoom(H){return(H-this.points.length)%32}_map(H,$,te){if(H[$+5]>1){const be=this.clusterProps[H[$+6]];return te?Object.assign({},be):be}const ce=this.points[H[$+3]].properties,fe=this.options.map(ce);return te&&fe===ce?Object.assign({},fe):fe}}function Oi(ve,H,$){return{type:"Feature",id:ve[H+3],properties:Xi(ve,H,$),geometry:{type:"Point",coordinates:[(te=ve[H],360*(te-.5)),At(ve[H+1])]}};var te}function Xi(ve,H,$){const te=ve[H+5],ce=te>=1e4?`${Math.round(te/1e3)}k`:te>=1e3?Math.round(te/100)/10+"k":te,fe=ve[H+6],be=fe===-1?{}:Object.assign({},$[fe]);return Object.assign(be,{cluster:!0,cluster_id:ve[H+3],point_count:te,point_count_abbreviated:ce})}function He(ve){return ve/360+.5}function at(ve){const H=Math.sin(ve*Math.PI/180),$=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return $<0?0:$>1?1:$}function At(ve){const H=(180-360*ve)*Math.PI/180;return 360*Math.atan(Math.exp(H))/Math.PI-90}function ft(ve,H,$,te){let ce=te;const fe=H+($-H>>1);let be,Ie=$-H;const Ce=ve[H],$e=ve[H+1],ct=ve[$],Je=ve[$+1];for(let zt=H+3;zt<$;zt+=3){const Vt=Kt(ve[zt],ve[zt+1],Ce,$e,ct,Je);if(Vt>ce)be=zt,ce=Vt;else if(Vt===ce){const Pe=Math.abs(zt-fe);Pe<Ie&&(be=zt,Ie=Pe)}}ce>te&&(be-H>3&&ft(ve,H,be,te),ve[be+2]=ce,$-be>3&&ft(ve,be,$,te))}function Kt(ve,H,$,te,ce,fe){let be=ce-$,Ie=fe-te;if(be!==0||Ie!==0){const Ce=((ve-$)*be+(H-te)*Ie)/(be*be+Ie*Ie);Ce>1?($=ce,te=fe):Ce>0&&($+=be*Ce,te+=Ie*Ce)}return be=ve-$,Ie=H-te,be*be+Ie*Ie}function pe(ve,H,$,te){const ce={id:ve??null,type:H,geometry:$,tags:te,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(H==="Point"||H==="MultiPoint"||H==="LineString")Ue(ce,$);else if(H==="Polygon")Ue(ce,$[0]);else if(H==="MultiLineString")for(const fe of $)Ue(ce,fe);else if(H==="MultiPolygon")for(const fe of $)Ue(ce,fe[0]);return ce}function Ue(ve,H){for(let $=0;$<H.length;$+=3)ve.minX=Math.min(ve.minX,H[$]),ve.minY=Math.min(ve.minY,H[$+1]),ve.maxX=Math.max(ve.maxX,H[$]),ve.maxY=Math.max(ve.maxY,H[$+1])}function We(ve,H,$,te){if(!H.geometry)return;const ce=H.geometry.coordinates;if(ce&&ce.length===0)return;const fe=H.geometry.type,be=Math.pow($.tolerance/((1<<$.maxZoom)*$.extent),2);let Ie=[],Ce=H.id;if($.promoteId?Ce=H.properties[$.promoteId]:$.generateId&&(Ce=te||0),fe==="Point")Mt(ce,Ie);else if(fe==="MultiPoint")for(const $e of ce)Mt($e,Ie);else if(fe==="LineString")Lt(ce,Ie,be,!1);else if(fe==="MultiLineString"){if($.lineMetrics){for(const $e of ce)Ie=[],Lt($e,Ie,be,!1),ve.push(pe(Ce,"LineString",Ie,H.properties));return}Ot(ce,Ie,be,!1)}else if(fe==="Polygon")Ot(ce,Ie,be,!0);else{if(fe!=="MultiPolygon"){if(fe==="GeometryCollection"){for(const $e of H.geometry.geometries)We(ve,{id:Ce,geometry:$e,properties:H.properties},$,te);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const $e of ce){const ct=[];Ot($e,ct,be,!0),Ie.push(ct)}}ve.push(pe(Ce,fe,Ie,H.properties))}function Mt(ve,H){H.push(ai(ve[0]),Ut(ve[1]),0)}function Lt(ve,H,$,te){let ce,fe,be=0;for(let Ce=0;Ce<ve.length;Ce++){const $e=ai(ve[Ce][0]),ct=Ut(ve[Ce][1]);H.push($e,ct,0),Ce>0&&(be+=te?(ce*ct-$e*fe)/2:Math.sqrt(Math.pow($e-ce,2)+Math.pow(ct-fe,2))),ce=$e,fe=ct}const Ie=H.length-3;H[2]=1,ft(H,0,Ie,$),H[Ie+2]=1,H.size=Math.abs(be),H.start=0,H.end=H.size}function Ot(ve,H,$,te){for(let ce=0;ce<ve.length;ce++){const fe=[];Lt(ve[ce],fe,$,te),H.push(fe)}}function ai(ve){return ve/360+.5}function Ut(ve){const H=Math.sin(ve*Math.PI/180),$=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return $<0?0:$>1?1:$}function jt(ve,H,$,te,ce,fe,be,Ie){if(te/=H,fe>=($/=H)&&be<te)return ve;if(be<$||fe>=te)return null;const Ce=[];for(const $e of ve){const ct=$e.geometry;let Je=$e.type;const zt=ce===0?$e.minX:$e.minY,Vt=ce===0?$e.maxX:$e.maxY;if(zt>=$&&Vt<te){Ce.push($e);continue}if(Vt<$||zt>=te)continue;let Pe=[];if(Je==="Point"||Je==="MultiPoint")Ni(ct,Pe,$,te,ce);else if(Je==="LineString")ri(ct,Pe,$,te,ce,!1,Ie.lineMetrics);else if(Je==="MultiLineString")di(ct,Pe,$,te,ce,!1);else if(Je==="Polygon")di(ct,Pe,$,te,ce,!0);else if(Je==="MultiPolygon")for(const _i of ct){const zi=[];di(_i,zi,$,te,ce,!0),zi.length&&Pe.push(zi)}if(Pe.length){if(Ie.lineMetrics&&Je==="LineString"){for(const _i of Pe)Ce.push(pe($e.id,Je,_i,$e.tags));continue}Je!=="LineString"&&Je!=="MultiLineString"||(Pe.length===1?(Je="LineString",Pe=Pe[0]):Je="MultiLineString"),Je!=="Point"&&Je!=="MultiPoint"||(Je=Pe.length===3?"Point":"MultiPoint"),Ce.push(pe($e.id,Je,Pe,$e.tags))}}return Ce.length?Ce:null}function Ni(ve,H,$,te,ce){for(let fe=0;fe<ve.length;fe+=3){const be=ve[fe+ce];be>=$&&be<=te&&Xt(H,ve[fe],ve[fe+1],ve[fe+2])}}function ri(ve,H,$,te,ce,fe,be){let Ie=mi(ve);const Ce=ce===0?fi:Jt;let $e,ct,Je=ve.start;for(let zi=0;zi<ve.length-3;zi+=3){const kt=ve[zi],Ei=ve[zi+1],Fa=ve[zi+2],za=ve[zi+3],qa=ve[zi+4],hn=ce===0?kt:Ei,Ji=ce===0?za:qa;let Za=!1;be&&($e=Math.sqrt(Math.pow(kt-za,2)+Math.pow(Ei-qa,2))),hn<$?Ji>$&&(ct=Ce(Ie,kt,Ei,za,qa,$),be&&(Ie.start=Je+$e*ct)):hn>te?Ji<te&&(ct=Ce(Ie,kt,Ei,za,qa,te),be&&(Ie.start=Je+$e*ct)):Xt(Ie,kt,Ei,Fa),Ji<$&&hn>=$&&(ct=Ce(Ie,kt,Ei,za,qa,$),Za=!0),Ji>te&&hn<=te&&(ct=Ce(Ie,kt,Ei,za,qa,te),Za=!0),!fe&&Za&&(be&&(Ie.end=Je+$e*ct),H.push(Ie),Ie=mi(ve)),be&&(Je+=$e)}let zt=ve.length-3;const Vt=ve[zt],Pe=ve[zt+1],_i=ce===0?Vt:Pe;_i>=$&&_i<=te&&Xt(Ie,Vt,Pe,ve[zt+2]),zt=Ie.length-3,fe&&zt>=3&&(Ie[zt]!==Ie[0]||Ie[zt+1]!==Ie[1])&&Xt(Ie,Ie[0],Ie[1],Ie[2]),Ie.length&&H.push(Ie)}function mi(ve){const H=[];return H.size=ve.size,H.start=ve.start,H.end=ve.end,H}function di(ve,H,$,te,ce,fe){for(const be of ve)ri(be,H,$,te,ce,fe,!1)}function Xt(ve,H,$,te){ve.push(H,$,te)}function fi(ve,H,$,te,ce,fe){const be=(fe-H)/(te-H);return Xt(ve,fe,$+(ce-$)*be,1),be}function Jt(ve,H,$,te,ce,fe){const be=(fe-$)/(ce-$);return Xt(ve,H+(te-H)*be,fe,1),be}function wa(ve,H){const $=[];for(let te=0;te<ve.length;te++){const ce=ve[te],fe=ce.type;let be;if(fe==="Point"||fe==="MultiPoint"||fe==="LineString")be=Si(ce.geometry,H);else if(fe==="MultiLineString"||fe==="Polygon"){be=[];for(const Ie of ce.geometry)be.push(Si(Ie,H))}else if(fe==="MultiPolygon"){be=[];for(const Ie of ce.geometry){const Ce=[];for(const $e of Ie)Ce.push(Si($e,H));be.push(Ce)}}$.push(pe(ce.id,fe,be,ce.tags))}return $}function Si(ve,H){const $=[];$.size=ve.size,ve.start!==void 0&&($.start=ve.start,$.end=ve.end);for(let te=0;te<ve.length;te+=3)$.push(ve[te]+H,ve[te+1],ve[te+2]);return $}function gi(ve,H){if(ve.transformed)return ve;const $=1<<ve.z,te=ve.x,ce=ve.y;for(const fe of ve.features){const be=fe.geometry,Ie=fe.type;if(fe.geometry=[],Ie===1)for(let Ce=0;Ce<be.length;Ce+=2)fe.geometry.push(ia(be[Ce],be[Ce+1],H,$,te,ce));else for(let Ce=0;Ce<be.length;Ce++){const $e=[];for(let ct=0;ct<be[Ce].length;ct+=2)$e.push(ia(be[Ce][ct],be[Ce][ct+1],H,$,te,ce));fe.geometry.push($e)}}return ve.transformed=!0,ve}function ia(ve,H,$,te,ce,fe){return[Math.round($*(ve*te-ce)),Math.round($*(H*te-fe))]}function qn(ve,H,$,te,ce){const fe=H===ce.maxZoom?0:ce.tolerance/((1<<H)*ce.extent),be={features:[],numPoints:0,numSimplified:0,numFeatures:ve.length,source:null,x:$,y:te,z:H,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ie of ve)Ja(be,Ie,fe,ce);return be}function Ja(ve,H,$,te){const ce=H.geometry,fe=H.type,be=[];if(ve.minX=Math.min(ve.minX,H.minX),ve.minY=Math.min(ve.minY,H.minY),ve.maxX=Math.max(ve.maxX,H.maxX),ve.maxY=Math.max(ve.maxY,H.maxY),fe==="Point"||fe==="MultiPoint")for(let Ie=0;Ie<ce.length;Ie+=3)be.push(ce[Ie],ce[Ie+1]),ve.numPoints++,ve.numSimplified++;else if(fe==="LineString")An(be,ce,ve,$,!1,!1);else if(fe==="MultiLineString"||fe==="Polygon")for(let Ie=0;Ie<ce.length;Ie++)An(be,ce[Ie],ve,$,fe==="Polygon",Ie===0);else if(fe==="MultiPolygon")for(let Ie=0;Ie<ce.length;Ie++){const Ce=ce[Ie];for(let $e=0;$e<Ce.length;$e++)An(be,Ce[$e],ve,$,!0,$e===0)}if(be.length){let Ie=H.tags||null;if(fe==="LineString"&&te.lineMetrics){Ie={};for(const $e in H.tags)Ie[$e]=H.tags[$e];Ie.mapbox_clip_start=ce.start/ce.size,Ie.mapbox_clip_end=ce.end/ce.size}const Ce={geometry:be,type:fe==="Polygon"||fe==="MultiPolygon"?3:fe==="LineString"||fe==="MultiLineString"?2:1,tags:Ie};H.id!==null&&(Ce.id=H.id),ve.features.push(Ce)}}function An(ve,H,$,te,ce,fe){const be=te*te;if(te>0&&H.size<(ce?be:te))return void($.numPoints+=H.length/3);const Ie=[];for(let Ce=0;Ce<H.length;Ce+=3)(te===0||H[Ce+2]>be)&&($.numSimplified++,Ie.push(H[Ce],H[Ce+1])),$.numPoints++;ce&&(function(Ce,$e){let ct=0;for(let Je=0,zt=Ce.length,Vt=zt-2;Je<zt;Vt=Je,Je+=2)ct+=(Ce[Je]-Ce[Vt])*(Ce[Je+1]+Ce[Vt+1]);if(ct>0===$e)for(let Je=0,zt=Ce.length;Je<zt/2;Je+=2){const Vt=Ce[Je],Pe=Ce[Je+1];Ce[Je]=Ce[zt-2-Je],Ce[Je+1]=Ce[zt-1-Je],Ce[zt-2-Je]=Vt,Ce[zt-1-Je]=Pe}})(Ie,fe),ve.push(Ie)}const Pi={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Pn{constructor(H,$){const te=($=this.options=(function(fe,be){for(const Ie in be)fe[Ie]=be[Ie];return fe})(Object.create(Pi),$)).debug;if(te&&console.time("preprocess data"),$.maxZoom<0||$.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if($.promoteId&&$.generateId)throw new Error("promoteId and generateId cannot be used together.");let ce=(function(fe,be){const Ie=[];if(fe.type==="FeatureCollection")for(let Ce=0;Ce<fe.features.length;Ce++)We(Ie,fe.features[Ce],be,Ce);else We(Ie,fe.type==="Feature"?fe:{geometry:fe},be);return Ie})(H,$);this.tiles={},this.tileCoords=[],te&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",$.indexMaxZoom,$.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ce=(function(fe,be){const Ie=be.buffer/be.extent;let Ce=fe;const $e=jt(fe,1,-1-Ie,Ie,0,-1,2,be),ct=jt(fe,1,1-Ie,2+Ie,0,-1,2,be);return($e||ct)&&(Ce=jt(fe,1,-Ie,1+Ie,0,-1,2,be)||[],$e&&(Ce=wa($e,1).concat(Ce)),ct&&(Ce=Ce.concat(wa(ct,-1)))),Ce})(ce,$),ce.length&&this.splitTile(ce,0,0,0),te&&(ce.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(H,$,te,ce,fe,be,Ie){const Ce=[H,$,te,ce],$e=this.options,ct=$e.debug;for(;Ce.length;){ce=Ce.pop(),te=Ce.pop(),$=Ce.pop(),H=Ce.pop();const Je=1<<$,zt=Ui($,te,ce);let Vt=this.tiles[zt];if(!Vt&&(ct>1&&console.time("creation"),Vt=this.tiles[zt]=qn(H,$,te,ce,$e),this.tileCoords.push({z:$,x:te,y:ce}),ct)){ct>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",$,te,ce,Vt.numFeatures,Vt.numPoints,Vt.numSimplified),console.timeEnd("creation"));const Za=`z${$}`;this.stats[Za]=(this.stats[Za]||0)+1,this.total++}if(Vt.source=H,fe==null){if($===$e.indexMaxZoom||Vt.numPoints<=$e.indexMaxPoints)continue}else{if($===$e.maxZoom||$===fe)continue;if(fe!=null){const Za=fe-$;if(te!==be>>Za||ce!==Ie>>Za)continue}}if(Vt.source=null,H.length===0)continue;ct>1&&console.time("clipping");const Pe=.5*$e.buffer/$e.extent,_i=.5-Pe,zi=.5+Pe,kt=1+Pe;let Ei=null,Fa=null,za=null,qa=null,hn=jt(H,Je,te-Pe,te+zi,0,Vt.minX,Vt.maxX,$e),Ji=jt(H,Je,te+_i,te+kt,0,Vt.minX,Vt.maxX,$e);H=null,hn&&(Ei=jt(hn,Je,ce-Pe,ce+zi,1,Vt.minY,Vt.maxY,$e),Fa=jt(hn,Je,ce+_i,ce+kt,1,Vt.minY,Vt.maxY,$e),hn=null),Ji&&(za=jt(Ji,Je,ce-Pe,ce+zi,1,Vt.minY,Vt.maxY,$e),qa=jt(Ji,Je,ce+_i,ce+kt,1,Vt.minY,Vt.maxY,$e),Ji=null),ct>1&&console.timeEnd("clipping"),Ce.push(Ei||[],$+1,2*te,2*ce),Ce.push(Fa||[],$+1,2*te,2*ce+1),Ce.push(za||[],$+1,2*te+1,2*ce),Ce.push(qa||[],$+1,2*te+1,2*ce+1)}}getTile(H,$,te){H=+H,$=+$,te=+te;const ce=this.options,{extent:fe,debug:be}=ce;if(H<0||H>24)return null;const Ie=1<<H,Ce=Ui(H,$=$+Ie&Ie-1,te);if(this.tiles[Ce])return gi(this.tiles[Ce],fe);be>1&&console.log("drilling down to z%d-%d-%d",H,$,te);let $e,ct=H,Je=$,zt=te;for(;!$e&&ct>0;)ct--,Je>>=1,zt>>=1,$e=this.tiles[Ui(ct,Je,zt)];return $e&&$e.source?(be>1&&(console.log("found parent tile z%d-%d-%d",ct,Je,zt),console.time("drilling down")),this.splitTile($e.source,ct,Je,zt,H,$,te),be>1&&console.timeEnd("drilling down"),this.tiles[Ce]?gi(this.tiles[Ce],fe):null):null}}function Ui(ve,H,$){return 32*((1<<ve)*$+H)+ve}class Sa extends K{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(H,$){return E._(this,void 0,void 0,(function*(){const te=H.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ce=this._geoJSONIndex.getTile(te.z,te.x,te.y);if(!ce)return null;const fe=new Be(ce.features,{version:2,extent:E.$});let be=(function(Ie){const Ce=new E.cM;return(function($e,ct){for(const Je in $e.layers)ct.writeMessage(3,Ke,$e.layers[Je])})(Ie,Ce),Ce.finish()})(fe);return be.byteOffset===0&&be.byteLength===be.buffer.byteLength||(be=new Uint8Array(be)),{vectorTile:fe,rawData:be.buffer}}))}loadData(H){return E._(this,void 0,void 0,(function*(){var $;($=this._pendingRequest)===null||$===void 0||$.abort();const te=!!(H&&H.request&&H.request.collectResourceTiming)&&new E.cN(H.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(H,this._pendingRequest);const ce=yield this._pendingData;this._geoJSONIndex=H.cluster?new Gt((function({superclusterOptions:be,clusterProperties:Ie}){if(!Ie||!be)return be;const Ce={},$e={},ct={accumulated:null,zoom:0},Je={properties:null},zt=Object.keys(Ie);for(const Vt of zt){const[Pe,_i]=Ie[Vt],zi=E.cT(_i),kt=E.cT(typeof Pe=="string"?[Pe,["accumulated"],["get",Vt]]:Pe);Ce[Vt]=zi.value,$e[Vt]=kt.value}return be.map=Vt=>{Je.properties=Vt;const Pe={};for(const _i of zt)Pe[_i]=Ce[_i].evaluate(ct,Je);return Pe},be.reduce=(Vt,Pe)=>{Je.properties=Pe;for(const _i of zt)ct.accumulated=Vt[_i],Vt[_i]=$e[_i].evaluate(ct,Je)},be})(H)).load(ce.features):(function(be,Ie){return new Pn(be,Ie)})(ce,H.geojsonVtOptions),this.loaded={};const fe={data:ce};if(te){const be=te.finish();be&&(fe.resourceTiming={},fe.resourceTiming[H.source]=JSON.parse(JSON.stringify(be)))}return fe}catch(ce){if(delete this._pendingRequest,E.cy(ce))return{abandoned:!0};throw ce}}))}getData(){return E._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(H){const $=this.loaded;return $&&$[H.uid]?super.reloadTile(H):this.loadTile(H)}loadAndProcessGeoJSON(H,$){return E._(this,void 0,void 0,(function*(){let te=yield this.loadGeoJSON(H,$);if(delete this._pendingRequest,typeof te!="object")throw new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`);if(Ae(te,!0),H.filter){const ce=E.cT(H.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ce.result==="error")throw new Error(ce.value.map((be=>`${be.key}: ${be.message}`)).join(", "));te={type:"FeatureCollection",features:te.features.filter((be=>ce.value.evaluate({zoom:0},be)))}}return te}))}loadGeoJSON(H,$){return E._(this,void 0,void 0,(function*(){const{promoteId:te}=H;if(H.request){const ce=yield E.j(H.request,$);return this._dataUpdateable=E.cV(ce.data,te)?E.cU(ce.data,te):void 0,ce.data}if(typeof H.data=="string")try{const ce=JSON.parse(H.data);return this._dataUpdateable=E.cV(ce,te)?E.cU(ce,te):void 0,ce}catch{throw new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`)}if(!H.dataDiff)throw new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${H.source}`);return E.cW(this._dataUpdateable,H.dataDiff,te),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(H){return E._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(H){return this._geoJSONIndex.getClusterExpansionZoom(H.clusterId)}getClusterChildren(H){return this._geoJSONIndex.getChildren(H.clusterId)}getClusterLeaves(H){return this._geoJSONIndex.getLeaves(H.clusterId,H.limit,H.offset)}}class ya{constructor(H){this.self=H,this.actor=new E.J(H),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=($,te)=>{if(this.externalWorkerSourceTypes[$])throw new Error(`Worker source with name "${$}" already registered.`);this.externalWorkerSourceTypes[$]=te},this.self.addProtocol=E.cA,this.self.removeProtocol=E.cB,this.self.registerRTLTextPlugin=$=>{E.cX.setMethods($)},this.actor.registerMessageHandler("LDT",(($,te)=>this._getDEMWorkerSource($,te.source).loadTile(te))),this.actor.registerMessageHandler("RDT",(($,te)=>E._(this,void 0,void 0,(function*(){this._getDEMWorkerSource($,te.source).removeTile(te)})))),this.actor.registerMessageHandler("GCEZ",(($,te)=>E._(this,void 0,void 0,(function*(){return this._getWorkerSource($,te.type,te.source).getClusterExpansionZoom(te)})))),this.actor.registerMessageHandler("GCC",(($,te)=>E._(this,void 0,void 0,(function*(){return this._getWorkerSource($,te.type,te.source).getClusterChildren(te)})))),this.actor.registerMessageHandler("GCL",(($,te)=>E._(this,void 0,void 0,(function*(){return this._getWorkerSource($,te.type,te.source).getClusterLeaves(te)})))),this.actor.registerMessageHandler("LD",(($,te)=>this._getWorkerSource($,te.type,te.source).loadData(te))),this.actor.registerMessageHandler("GD",(($,te)=>this._getWorkerSource($,te.type,te.source).getData())),this.actor.registerMessageHandler("LT",(($,te)=>this._getWorkerSource($,te.type,te.source).loadTile(te))),this.actor.registerMessageHandler("RT",(($,te)=>this._getWorkerSource($,te.type,te.source).reloadTile(te))),this.actor.registerMessageHandler("AT",(($,te)=>this._getWorkerSource($,te.type,te.source).abortTile(te))),this.actor.registerMessageHandler("RMT",(($,te)=>this._getWorkerSource($,te.type,te.source).removeTile(te))),this.actor.registerMessageHandler("RS",(($,te)=>E._(this,void 0,void 0,(function*(){if(!this.workerSources[$]||!this.workerSources[$][te.type]||!this.workerSources[$][te.type][te.source])return;const ce=this.workerSources[$][te.type][te.source];delete this.workerSources[$][te.type][te.source],ce.removeSource!==void 0&&ce.removeSource(te)})))),this.actor.registerMessageHandler("RM",($=>E._(this,void 0,void 0,(function*(){delete this.layerIndexes[$],delete this.availableImages[$],delete this.workerSources[$],delete this.demWorkerSources[$],this.globalStates.delete($)})))),this.actor.registerMessageHandler("SR",(($,te)=>E._(this,void 0,void 0,(function*(){this.referrer=te})))),this.actor.registerMessageHandler("SRPS",(($,te)=>this._syncRTLPluginState($,te))),this.actor.registerMessageHandler("IS",(($,te)=>E._(this,void 0,void 0,(function*(){this.self.importScripts(te)})))),this.actor.registerMessageHandler("SI",(($,te)=>this._setImages($,te))),this.actor.registerMessageHandler("UL",(($,te)=>E._(this,void 0,void 0,(function*(){this._getLayerIndex($).update(te.layers,te.removedIds,this._getGlobalState($))})))),this.actor.registerMessageHandler("UGS",(($,te)=>E._(this,void 0,void 0,(function*(){const ce=this._getGlobalState($);for(const fe in te)ce[fe]=te[fe]})))),this.actor.registerMessageHandler("SL",(($,te)=>E._(this,void 0,void 0,(function*(){this._getLayerIndex($).replace(te,this._getGlobalState($))}))))}_getGlobalState(H){let $=this.globalStates.get(H);return $||($={},this.globalStates.set(H,$)),$}_setImages(H,$){return E._(this,void 0,void 0,(function*(){this.availableImages[H]=$;for(const te in this.workerSources[H]){const ce=this.workerSources[H][te];for(const fe in ce)ce[fe].availableImages=$}}))}_syncRTLPluginState(H,$){return E._(this,void 0,void 0,(function*(){return yield E.cX.syncState($,this.self.importScripts)}))}_getAvailableImages(H){let $=this.availableImages[H];return $||($=[]),$}_getLayerIndex(H){let $=this.layerIndexes[H];return $||($=this.layerIndexes[H]=new o),$}_getWorkerSource(H,$,te){if(this.workerSources[H]||(this.workerSources[H]={}),this.workerSources[H][$]||(this.workerSources[H][$]={}),!this.workerSources[H][$][te]){const ce={sendAsync:(fe,be)=>(fe.targetMapId=H,this.actor.sendAsync(fe,be))};switch($){case"vector":this.workerSources[H][$][te]=new K(ce,this._getLayerIndex(H),this._getAvailableImages(H));break;case"geojson":this.workerSources[H][$][te]=new Sa(ce,this._getLayerIndex(H),this._getAvailableImages(H));break;default:this.workerSources[H][$][te]=new this.externalWorkerSourceTypes[$](ce,this._getLayerIndex(H),this._getAvailableImages(H))}}return this.workerSources[H][$][te]}_getDEMWorkerSource(H,$){return this.demWorkerSources[H]||(this.demWorkerSources[H]={}),this.demWorkerSources[H][$]||(this.demWorkerSources[H][$]=new W),this.demWorkerSources[H][$]}}return E.i(self)&&(self.worker=new ya(self)),ya})),P("index",["exports","./shared"],(function(E,o){var B="5.9.0";function j(){var p=new o.A(4);return o.A!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p}let J,K;const W={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(p,e,r){const c=requestAnimationFrame((m=>{f(),e(m)})),{unsubscribe:f}=o.s(p.signal,"abort",(()=>{f(),cancelAnimationFrame(c),r(o.c())}),!1)},frameAsync(p){return new Promise(((e,r)=>{this.frame(p,e,r)}))},getImageData(p,e=0){return this.getImageCanvasContext(p).getImageData(-e,-e,p.width+2*e,p.height+2*e)},getImageCanvasContext(p){const e=window.document.createElement("canvas"),r=e.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return e.width=p.width,e.height=p.height,r.drawImage(p,0,0,p.width,p.height),r},resolveURL:p=>(J||(J=document.createElement("a")),J.href=p,J.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(K==null&&(K=matchMedia("(prefers-reduced-motion: reduce)")),K.matches)}};class ee{static testProp(e){if(!ee.docStyle)return e[0];for(let r=0;r<e.length;r++)if(e[r]in ee.docStyle)return e[r];return e[0]}static create(e,r,c){const f=window.document.createElement(e);return r!==void 0&&(f.className=r),c&&c.appendChild(f),f}static createNS(e,r){return window.document.createElementNS(e,r)}static disableDrag(){ee.docStyle&&ee.selectProp&&(ee.userSelect=ee.docStyle[ee.selectProp],ee.docStyle[ee.selectProp]="none")}static enableDrag(){ee.docStyle&&ee.selectProp&&(ee.docStyle[ee.selectProp]=ee.userSelect)}static setTransform(e,r){e.style[ee.transformProp]=r}static addEventListener(e,r,c,f={}){e.addEventListener(r,c,"passive"in f?f:f.capture)}static removeEventListener(e,r,c,f={}){e.removeEventListener(r,c,"passive"in f?f:f.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",ee.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",ee.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",ee.suppressClickInternal,!0)}),0)}static getScale(e){const r=e.getBoundingClientRect();return{x:r.width/e.offsetWidth||1,y:r.height/e.offsetHeight||1,boundingClientRect:r}}static getPoint(e,r,c){const f=r.boundingClientRect;return new o.P((c.clientX-f.left)/r.x-e.clientLeft,(c.clientY-f.top)/r.y-e.clientTop)}static mousePos(e,r){const c=ee.getScale(e);return ee.getPoint(e,c,r)}static touchPos(e,r){const c=[],f=ee.getScale(e);for(let m=0;m<r.length;m++)c.push(ee.getPoint(e,f,r[m]));return c}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const r=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),c=r.querySelectorAll("script");for(const f of c)f.remove();return ee.clean(r),r.innerHTML}static isPossiblyDangerous(e,r){const c=r.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!c.includes("javascript:")&&!c.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const r=e.children;for(const c of r)ee.removeAttributes(c),ee.clean(c)}static removeAttributes(e){for(const{name:r,value:c}of e.attributes)ee.isPossiblyDangerous(r,c)&&e.removeAttribute(r)}}ee.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,ee.selectProp=ee.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),ee.transformProp=ee.testProp(["transform","WebkitTransform"]);const we={supported:!1,testSupport:function(p){!Ze&&Ae&&(Be?Ke(p):Oe=p)}};let Oe,Ae,Ze=!1,Be=!1;function Ke(p){const e=p.createTexture();p.bindTexture(p.TEXTURE_2D,e);try{if(p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,Ae),p.isContextLost())return;we.supported=!0}catch{}p.deleteTexture(e),Ze=!0}var vt;typeof document<"u"&&(Ae=document.createElement("img"),Ae.onload=()=>{Oe&&Ke(Oe),Oe=null,Be=!0},Ae.onerror=()=>{Ze=!0,Oe=null},Ae.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(p){let e,r,c,f;p.resetRequestQueue=()=>{e=[],r=0,c=0,f={}},p.addThrottleControl=A=>{const k=c++;return f[k]=A,k},p.removeThrottleControl=A=>{delete f[A],x()},p.getImage=(A,k,L=!0)=>new Promise(((F,N)=>{we.supported&&(A.headers||(A.headers={}),A.headers.accept="image/webp,*/*"),o.e(A,{type:"image"}),e.push({abortController:k,requestParameters:A,supportImageRefresh:L,state:"queued",onError:q=>{N(q)},onSuccess:q=>{F(q)}}),x()}));const m=A=>o._(this,void 0,void 0,(function*(){A.state="running";const{requestParameters:k,supportImageRefresh:L,onError:F,onSuccess:N,abortController:q}=A,X=L===!1&&!o.i(self)&&!o.g(k.url)&&(!k.headers||Object.keys(k.headers).reduce(((re,oe)=>re&&oe==="accept"),!0));r++;const ae=X?T(k,q):o.m(k,q);try{const re=yield ae;delete A.abortController,A.state="completed",re.data instanceof HTMLImageElement||o.b(re.data)?N(re):re.data&&N({data:yield(ne=re.data,typeof createImageBitmap=="function"?o.f(ne):o.h(ne)),cacheControl:re.cacheControl,expires:re.expires})}catch(re){delete A.abortController,F(re)}finally{r--,x()}var ne})),x=()=>{const A=(()=>{for(const k of Object.keys(f))if(f[k]())return!0;return!1})()?o.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let k=r;k<A&&e.length>0;k++){const L=e.shift();L.abortController.signal.aborted?k--:m(L)}},T=(A,k)=>new Promise(((L,F)=>{const N=new Image,q=A.url,X=A.credentials;X&&X==="include"?N.crossOrigin="use-credentials":(X&&X==="same-origin"||!o.d(q))&&(N.crossOrigin="anonymous"),k.signal.addEventListener("abort",(()=>{N.src="",F(o.c())})),N.fetchPriority="high",N.onload=()=>{N.onerror=N.onload=null,L({data:N})},N.onerror=()=>{N.onerror=N.onload=null,k.signal.aborted||F(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},N.src=q}))})(vt||(vt={})),vt.resetRequestQueue();class Et{constructor(e){this._transformRequestFn=e??null}transformRequest(e,r){return this._transformRequestFn&&this._transformRequestFn(e,r)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function xt(p){const e=[];if(typeof p=="string")e.push({id:"default",url:p});else if(p&&p.length>0){const r=[];for(const{id:c,url:f}of p){const m=`${c}${f}`;r.indexOf(m)===-1&&(r.push(m),e.push({id:c,url:f}))}}return e}function lt(p,e,r){try{const c=new URL(p);return c.pathname+=`${e}${r}`,c.toString()}catch{throw new Error(`Invalid sprite URL "${p}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function xe(p){const{userImage:e}=p;return!!(e&&e.render&&e.render())&&(p.data.replace(new Uint8Array(e.data.buffer)),!0)}class Se extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:r,promiseResolve:c}of this.requestors)c(this._getImagesForIds(r));this.requestors=[]}}getImage(e){const r=this.images[e];if(r&&!r.data&&r.spriteData){const c=r.spriteData;r.data=new o.R({width:c.width,height:c.height},c.context.getImageData(c.x,c.y,c.width,c.height).data),r.spriteData=null}return r}addImage(e,r){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,r)&&(this.images[e]=r)}_validate(e,r){let c=!0;const f=r.data||r.spriteData;return this._validateStretch(r.stretchX,f&&f.width)||(this.fire(new o.k(new Error(`Image "${e}" has invalid "stretchX" value`))),c=!1),this._validateStretch(r.stretchY,f&&f.height)||(this.fire(new o.k(new Error(`Image "${e}" has invalid "stretchY" value`))),c=!1),this._validateContent(r.content,r)||(this.fire(new o.k(new Error(`Image "${e}" has invalid "content" value`))),c=!1),c}_validateStretch(e,r){if(!e)return!0;let c=0;for(const f of e){if(f[0]<c||f[1]<f[0]||r<f[1])return!1;c=f[1]}return!0}_validateContent(e,r){if(!e)return!0;if(e.length!==4)return!1;const c=r.spriteData,f=c&&c.width||r.data.width,m=c&&c.height||r.data.height;return!(e[0]<0||f<e[0]||e[1]<0||m<e[1]||e[2]<0||f<e[2]||e[3]<0||m<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,r,c=!0){const f=this.getImage(e);if(c&&(f.data.width!==r.data.width||f.data.height!==r.data.height))throw new Error(`size mismatch between old image (${f.data.width}x${f.data.height}) and new image (${r.data.width}x${r.data.height}).`);r.version=f.version+1,this.images[e]=r,this.updatedImages[e]=!0}removeImage(e){const r=this.images[e];delete this.images[e],delete this.patterns[e],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise(((r,c)=>{let f=!0;if(!this.isLoaded())for(const m of e)this.images[m]||(f=!1);this.isLoaded()||f?r(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:r})}))}_getImagesForIds(e){const r={};for(const c of e){let f=this.getImage(c);f||(this.fire(new o.l("styleimagemissing",{id:c})),f=this.getImage(c)),f?r[c]={data:f.data.clone(),pixelRatio:f.pixelRatio,sdf:f.sdf,version:f.version,stretchX:f.stretchX,stretchY:f.stretchY,content:f.content,textFitWidth:f.textFitWidth,textFitHeight:f.textFitHeight,hasRenderCallback:!!(f.userImage&&f.userImage.render)}:o.w(`Image "${c}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return r}getPixelSize(){const{width:e,height:r}=this.atlasImage;return{width:e,height:r}}getPattern(e){const r=this.patterns[e],c=this.getImage(e);if(!c)return null;if(r&&r.position.version===c.version)return r.position;if(r)r.position.version=c.version;else{const f={w:c.data.width+2,h:c.data.height+2,x:0,y:0},m=new o.I(f,c);this.patterns[e]={bin:f,position:m}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const r=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.T(e,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const m in this.patterns)e.push(this.patterns[m].bin);const{w:r,h:c}=o.p(e),f=this.atlasImage;f.resize({width:r||1,height:c||1});for(const m in this.patterns){const{bin:x}=this.patterns[m],T=x.x+1,A=x.y+1,k=this.getImage(m).data,L=k.width,F=k.height;o.R.copy(k,f,{x:0,y:0},{x:T,y:A},{width:L,height:F}),o.R.copy(k,f,{x:0,y:F-1},{x:T,y:A-1},{width:L,height:1}),o.R.copy(k,f,{x:0,y:0},{x:T,y:A+F},{width:L,height:1}),o.R.copy(k,f,{x:L-1,y:0},{x:T-1,y:A},{width:1,height:F}),o.R.copy(k,f,{x:0,y:0},{x:T+L,y:A},{width:1,height:F})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const r of e){if(this.callbackDispatchedThisFrame[r])continue;this.callbackDispatchedThisFrame[r]=!0;const c=this.getImage(r);c||o.w(`Image with ID: "${r}" was not found`),xe(c)&&this.updateImage(r,c)}}}const Ye=1e20;function mt(p,e,r,c,f,m,x,T,A){for(let k=e;k<e+c;k++)gt(p,r*m+k,m,f,x,T,A);for(let k=r;k<r+f;k++)gt(p,k*m+e,1,c,x,T,A)}function gt(p,e,r,c,f,m,x){m[0]=0,x[0]=-Ye,x[1]=Ye,f[0]=p[e];for(let T=1,A=0,k=0;T<c;T++){f[T]=p[e+T*r];const L=T*T;do{const F=m[A];k=(f[T]-f[F]+L-F*F)/(T-F)/2}while(k<=x[A]&&--A>-1);A++,m[A]=T,x[A]=k,x[A+1]=Ye}for(let T=0,A=0;T<c;T++){for(;x[A+1]<T;)A++;const k=m[A],L=T-k;p[e+T*r]=f[k]+L*L}}class Gt{constructor(e,r,c){this.requestManager=e,this.localIdeographFontFamily=r,this.entries={},this.lang=c}setURL(e){this.url=e}getGlyphs(e){return o._(this,void 0,void 0,(function*(){const r=[];for(const m in e)for(const x of e[m])r.push(this._getAndCacheGlyphsPromise(m,x));const c=yield Promise.all(r),f={};for(const{stack:m,id:x,glyph:T}of c)f[m]||(f[m]={}),f[m][x]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics};return f}))}_getAndCacheGlyphsPromise(e,r){return o._(this,void 0,void 0,(function*(){let c=this.entries[e];c||(c=this.entries[e]={glyphs:{},requests:{},ranges:{}});let f=c.glyphs[r];if(f!==void 0)return{stack:e,id:r,glyph:f};if(f=this._tinySDF(c,e,r),f)return c.glyphs[r]=f,{stack:e,id:r,glyph:f};const m=Math.floor(r/256);if(256*m>65535)throw new Error("glyphs > 65535 not supported");if(c.ranges[m])return{stack:e,id:r,glyph:f};if(!this.url)throw new Error("glyphsUrl is not set");if(!c.requests[m]){const T=Gt.loadGlyphRange(e,m,this.url,this.requestManager);c.requests[m]=T}const x=yield c.requests[m];for(const T in x)this._doesCharSupportLocalGlyph(+T)||(c.glyphs[+T]=x[+T]);return c.ranges[m]=!0,{stack:e,id:r,glyph:x[r]||null}}))}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))||o.u["CJK Unified Ideographs"](e)||o.u["Hangul Syllables"](e)||o.u.Hiragana(e)||o.u.Katakana(e)||o.u["CJK Symbols and Punctuation"](e)||o.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,r,c){const f=this.localIdeographFontFamily;if(!f||!this._doesCharSupportLocalGlyph(c))return;let m=e.tinySDF;if(!m){let T="400";/bold/i.test(r)?T="900":/medium/i.test(r)?T="500":/light/i.test(r)&&(T="200"),m=e.tinySDF=new Gt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,lang:this.lang,fontFamily:f,fontWeight:T})}const x=m.draw(String.fromCharCode(c));return{id:c,bitmap:new o.q({width:x.width||60,height:x.height||60},x.data),metrics:{width:x.glyphWidth/2||24,height:x.glyphHeight/2||24,left:x.glyphLeft/2+.5||0,top:x.glyphTop/2-27.5||-8,advance:x.glyphAdvance/2||24,isDoubleResolution:!0}}}}Gt.loadGlyphRange=function(p,e,r,c){return o._(this,void 0,void 0,(function*(){const f=256*e,m=f+255,x=c.transformRequest(r.replace("{fontstack}",p).replace("{range}",`${f}-${m}`),"Glyphs"),T=yield o.n(x,new AbortController);if(!T||!T.data)throw new Error(`Could not load glyph range. range: ${e}, ${f}-${m}`);const A={};for(const k of o.o(T.data))A[k.id]=k;return A}))},Gt.TinySDF=class{constructor({fontSize:p=24,buffer:e=3,radius:r=8,cutoff:c=.25,fontFamily:f="sans-serif",fontWeight:m="normal",fontStyle:x="normal",lang:T=null}={}){this.buffer=e,this.cutoff=c,this.radius=r,this.lang=T;const A=this.size=p+4*e,k=this._createCanvas(A),L=this.ctx=k.getContext("2d",{willReadFrequently:!0});L.font=`${x} ${m} ${p}px ${f}`,L.textBaseline="alphabetic",L.textAlign="left",L.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Uint16Array(A)}_createCanvas(p){const e=document.createElement("canvas");return e.width=e.height=p,e}draw(p){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:c,actualBoundingBoxLeft:f,actualBoundingBoxRight:m}=this.ctx.measureText(p),x=Math.ceil(r),T=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-f))),A=Math.min(this.size-this.buffer,x+Math.ceil(c)),k=T+2*this.buffer,L=A+2*this.buffer,F=Math.max(k*L,0),N=new Uint8ClampedArray(F),q={data:N,width:k,height:L,glyphWidth:T,glyphHeight:A,glyphTop:x,glyphLeft:0,glyphAdvance:e};if(T===0||A===0)return q;const{ctx:X,buffer:ae,gridInner:ne,gridOuter:re}=this;this.lang&&(X.lang=this.lang),X.clearRect(ae,ae,T,A),X.fillText(p,ae,ae+x);const oe=X.getImageData(ae,ae,T,A);re.fill(Ye,0,F),ne.fill(0,0,F);for(let ue=0;ue<A;ue++)for(let le=0;le<T;le++){const me=oe.data[4*(ue*T+le)+3]/255;if(me===0)continue;const ye=(ue+ae)*k+le+ae;if(me===1)re[ye]=0,ne[ye]=Ye;else{const he=.5-me;re[ye]=he>0?he*he:0,ne[ye]=he<0?he*he:0}}mt(re,0,0,k,L,k,this.f,this.v,this.z),mt(ne,ae,ae,T,A,k,this.f,this.v,this.z);for(let ue=0;ue<F;ue++){const le=Math.sqrt(re[ue])-Math.sqrt(ne[ue]);N[ue]=Math.round(255-255*(le/this.radius+this.cutoff))}return q}};class Oi{constructor(){this.specification=o.v.light.position}possiblyEvaluate(e,r){return o.B(e.expression.evaluate(r))}interpolate(e,r,c){return{x:o.C.number(e.x,r.x,c),y:o.C.number(e.y,r.y,c),z:o.C.number(e.z,r.z,c)}}}let Xi;class He extends o.E{constructor(e){super(),Xi=Xi||new o.r({anchor:new o.D(o.v.light.anchor),position:new Oi,color:new o.D(o.v.light.color),intensity:new o.D(o.v.light.intensity)}),this._transitionable=new o.t(Xi,void 0),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,r={}){if(!this._validate(o.x,e,r))for(const c in e){const f=e[c];c.endsWith("-transition")?this._transitionable.setTransition(c.slice(0,-11),f):this._transitionable.setValue(c,f)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,r,c){return(!c||c.validate!==!1)&&o.y(this,e.call(o.z,{value:r,style:{glyphs:!0,sprite:!0},styleSpec:o.v}))}}const at=new o.r({"sky-color":new o.D(o.v.sky["sky-color"]),"horizon-color":new o.D(o.v.sky["horizon-color"]),"fog-color":new o.D(o.v.sky["fog-color"]),"fog-ground-blend":new o.D(o.v.sky["fog-ground-blend"]),"horizon-fog-blend":new o.D(o.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new o.D(o.v.sky["sky-horizon-blend"]),"atmosphere-blend":new o.D(o.v.sky["atmosphere-blend"])});class At extends o.E{constructor(e){super(),this._transitionable=new o.t(at,void 0),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.F(0))}setSky(e,r={}){if(!this._validate(o.G,e,r)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const c in e){const f=e[c];c.endsWith("-transition")?this._transitionable.setTransition(c.slice(0,-11),f):this._transitionable.setValue(c,f)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,r,c={}){return c?.validate!==!1&&o.y(this,e.call(o.z,o.e({value:r,style:{glyphs:!0,sprite:!0},styleSpec:o.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class ft{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,r){const c=e.join(",")+String(r);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(e,r)),this.dashEntry[c]}getDashRanges(e,r,c){const f=[];let m=e.length%2==1?-e[e.length-1]*c:0,x=e[0]*c,T=!0;f.push({left:m,right:x,isDash:T,zeroLength:e[0]===0});let A=e[0];for(let k=1;k<e.length;k++){T=!T;const L=e[k];m=A*c,A+=L,x=A*c,f.push({left:m,right:x,isDash:T,zeroLength:L===0})}return f}addRoundDash(e,r,c){const f=r/2;for(let m=-c;m<=c;m++){const x=this.width*(this.nextRow+c+m);let T=0,A=e[T];for(let k=0;k<this.width;k++){k/A.right>1&&(A=e[++T]);const L=Math.abs(k-A.left),F=Math.abs(k-A.right),N=Math.min(L,F);let q;const X=m/c*(f+1);if(A.isDash){const ae=f-Math.abs(X);q=Math.sqrt(N*N+ae*ae)}else q=f-Math.sqrt(N*N+X*X);this.data[x+k]=Math.max(0,Math.min(255,q+128))}}}addRegularDash(e){for(let T=e.length-1;T>=0;--T){const A=e[T],k=e[T+1];A.zeroLength?e.splice(T,1):k&&k.isDash===A.isDash&&(k.left=A.left,e.splice(T,1))}const r=e[0],c=e[e.length-1];r.isDash===c.isDash&&(r.left=c.left-this.width,c.right=r.right+this.width);const f=this.width*this.nextRow;let m=0,x=e[m];for(let T=0;T<this.width;T++){T/x.right>1&&(x=e[++m]);const A=Math.abs(T-x.left),k=Math.abs(T-x.right),L=Math.min(A,k);this.data[f+T]=Math.max(0,Math.min(255,(x.isDash?L:-L)+128))}}addDash(e,r){const c=r?7:0,f=2*c+1;if(this.nextRow+f>this.height)return o.w("LineAtlas out of space"),null;let m=0;for(let T=0;T<e.length;T++)m+=e[T];if(m!==0){const T=this.width/m,A=this.getDashRanges(e,this.width,T);r?this.addRoundDash(A,T,c):this.addRegularDash(A)}const x={y:this.nextRow+c,height:2*c,width:m};return this.nextRow+=f,this.dirty=!0,x}bind(e){const r=e.gl;this.texture?(r.bindTexture(r.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,r.texSubImage2D(r.TEXTURE_2D,0,0,0,this.width,this.height,r.ALPHA,r.UNSIGNED_BYTE,this.data))):(this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.width,this.height,0,r.ALPHA,r.UNSIGNED_BYTE,this.data))}}const Kt="maplibre_preloaded_worker_pool";class pe{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<pe.workerCount;)this.workers.push(new Worker(o.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach((r=>{r.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Kt]}numActive(){return Object.keys(this.active).length}}const Ue=Math.floor(W.hardwareConcurrency/2);let We,Mt;function Lt(){return We||(We=new pe),We}pe.workerCount=o.H(globalThis)?Math.max(Math.min(Ue,3),1):1;class Ot{constructor(e,r){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=r;const c=this.workerPool.acquire(r);for(let f=0;f<c.length;f++){const m=new o.J(c[f],r);m.name=`Worker ${f}`,this.actors.push(m)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,r){const c=[];for(const f of this.actors)c.push(f.sendAsync({type:e,data:r}));return Promise.all(c)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach((r=>{r.remove()})),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,r){for(const c of this.actors)c.registerMessageHandler(e,r)}}function ai(){return Mt||(Mt=new Ot(Lt(),o.K),Mt.registerMessageHandler("GR",((p,e,r)=>o.m(e,r)))),Mt}function Ut(p,e){const r=o.L();return o.M(r,r,[1,1,0]),o.N(r,r,[.5*p.width,.5*p.height,1]),p.calculatePosMatrix?o.O(r,r,p.calculatePosMatrix(e.toUnwrapped())):r}function jt(p,e,r,c,f,m,x){var T;const A=(function(N,q,X){if(N)for(const ae of N){const ne=q[ae];if(ne&&ne.source===X&&ne.type==="fill-extrusion")return!0}else for(const ae in q){const ne=q[ae];if(ne.source===X&&ne.type==="fill-extrusion")return!0}return!1})((T=f?.layers)!==null&&T!==void 0?T:null,e,p.id),k=m.maxPitchScaleFactor(),L=p.tilesIn(c,k,A);L.sort(Ni);const F=[];for(const N of L)F.push({wrappedTileID:N.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(e,r,p._state,N.queryGeometry,N.cameraQueryGeometry,N.scale,f,m,k,Ut(p.transform,N.tileID),x?(q,X)=>x(N.tileID,q,X):void 0)});return(function(N,q){for(const X in N)for(const ae of N[X])ri(ae,q);return N})((function(N){const q={},X={};for(const ae of N){const ne=ae.queryResults,re=ae.wrappedTileID,oe=X[re]=X[re]||{};for(const ue in ne){const le=ne[ue],me=oe[ue]=oe[ue]||{},ye=q[ue]=q[ue]||[];for(const he of le)me[he.featureIndex]||(me[he.featureIndex]=!0,ye.push(he))}}return q})(F),p)}function Ni(p,e){const r=p.tileID,c=e.tileID;return r.overscaledZ-c.overscaledZ||r.canonical.y-c.canonical.y||r.wrap-c.wrap||r.canonical.x-c.canonical.x}function ri(p,e){const r=p.feature,c=e.getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=c}function mi(p,e,r){return o._(this,void 0,void 0,(function*(){let c=p;if(p.url?c=(yield o.j(e.transformRequest(p.url,"Source"),r)).data:yield W.frameAsync(r),!c)return null;const f=o.Q(o.e(c,p),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in c&&c.vector_layers&&(f.vectorLayerIds=c.vector_layers.map((m=>m.id))),f}))}class di{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof o.S?new o.S(e.lng,e.lat):o.S.convert(e),this}setSouthWest(e){return this._sw=e instanceof o.S?new o.S(e.lng,e.lat):o.S.convert(e),this}extend(e){const r=this._sw,c=this._ne;let f,m;if(e instanceof o.S)f=e,m=e;else{if(!(e instanceof di))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(di.convert(e)):this.extend(o.S.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(o.S.convert(e)):this;if(f=e._sw,m=e._ne,!f||!m)return this}return r||c?(r.lng=Math.min(f.lng,r.lng),r.lat=Math.min(f.lat,r.lat),c.lng=Math.max(m.lng,c.lng),c.lat=Math.max(m.lat,c.lat)):(this._sw=new o.S(f.lng,f.lat),this._ne=new o.S(m.lng,m.lat)),this}getCenter(){return new o.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.S(this.getWest(),this.getNorth())}getSouthEast(){return new o.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:c}=o.S.convert(e);let f=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&f}static convert(e){return e instanceof di?e:e&&new di(e)}static fromLngLat(e,r=0){const c=360*r/40075017,f=c/Math.cos(Math.PI/180*e.lat);return new di(new o.S(e.lng-f,e.lat-c),new o.S(e.lng+f,e.lat+c))}adjustAntiMeridian(){const e=new o.S(this._sw.lng,this._sw.lat),r=new o.S(this._ne.lng,this._ne.lat);return new di(e,e.lng>r.lng?new o.S(r.lng+360,r.lat):r)}}class Xt{constructor(e,r,c){this.bounds=di.convert(this.validateBounds(e)),this.minzoom=r||0,this.maxzoom=c||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const r=Math.pow(2,e.z),c=Math.floor(o.V(this.bounds.getWest())*r),f=Math.floor(o.U(this.bounds.getNorth())*r),m=Math.ceil(o.V(this.bounds.getEast())*r),x=Math.ceil(o.U(this.bounds.getSouth())*r);return e.x>=c&&e.x<m&&e.y>=f&&e.y<x}}class fi extends o.E{constructor(e,r,c,f){if(super(),this.id=e,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.Q(r,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f)}load(){return o._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield mi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(o.e(this,e),e.bounds&&(this.tileBounds=new Xt(e.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this._loaded=!0,this.fire(new o.k(e))}}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return o.e({},this._options)}loadTile(e){return o._(this,void 0,void 0,(function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c={request:this.map._requestManager.transformRequest(r,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};c.request.collectResourceTiming=this._collectResourceTiming;let f="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise(((m,x)=>{e.reloadPromise={resolve:m,reject:x}}))}else e.actor=this.dispatcher.getActor(),f="LT";e.abortController=new AbortController;try{const m=yield e.actor.sendAsync({type:f,data:c},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,m)}catch(m){if(delete e.abortController,e.aborted)return;if(m&&m.status!==404)throw m;this._afterTileLoadWorkerResponse(e,null)}}))}_afterTileLoadWorkerResponse(e,r){if(r&&r.resourceTiming&&(e.resourceTiming=r.resourceTiming),r&&this.map._refreshExpiredTiles&&e.setExpiryData(r),e.loadVectorData(r,this.map.painter),e.reloadPromise){const c=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(c.resolve).catch(c.reject)}}abortTile(e){return o._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}unloadTile(e){return o._(this,void 0,void 0,(function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class Jt extends o.E{constructor(e,r,c,f){super(),this.id=e,this.dispatcher=c,this.setEventedParent(f),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},r),o.e(this,o.Q(r,["url","scheme","tileSize"]))}load(){return o._(this,arguments,void 0,(function*(e=!1){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const r=yield mi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,r&&(o.e(this,r),r.bounds&&(this.tileBounds=new Xt(r.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(r){this._tileJSONRequest=null,this._loaded=!0,this.fire(new o.k(r))}}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}serialize(){return o.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return o._(this,void 0,void 0,(function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const c=yield vt.getImage(this.map._requestManager.transformRequest(r,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(c&&c.data){this.map._refreshExpiredTiles&&(c.cacheControl||c.expires)&&e.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const f=this.map.painter.context,m=f.gl,x=c.data;e.texture=this.map.painter.getTileTexture(x.width),e.texture?e.texture.update(x,{useMipmap:!0}):(e.texture=new o.T(f,x,m.RGBA,{useMipmap:!0}),e.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE,m.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(c){if(delete e.abortController,e.aborted)e.state="unloaded";else if(c)throw e.state="errored",c}}))}abortTile(e){return o._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)}))}unloadTile(e){return o._(this,void 0,void 0,(function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)}))}hasTransition(){return!1}}class wa extends Jt{constructor(e,r,c,f){super(e,r,c,f),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox",this.redFactor=r.redFactor,this.greenFactor=r.greenFactor,this.blueFactor=r.blueFactor,this.baseShift=r.baseShift}loadTile(e){return o._(this,void 0,void 0,(function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c=this.map._requestManager.transformRequest(r,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const f=yield vt.getImage(c,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(f&&f.data){const m=f.data;this.map._refreshExpiredTiles&&(f.cacheControl||f.expires)&&e.setExpiryData({cacheControl:f.cacheControl,expires:f.expires});const x=o.b(m)&&o.W()?m:yield this.readImageNow(m),T={type:this.type,uid:e.uid,source:this.id,rawImageData:x,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const A=yield e.actor.sendAsync({type:"LDT",data:T});e.dem=A,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(f){if(delete e.abortController,e.aborted)e.state="unloaded";else if(f)throw e.state="errored",f}}))}readImageNow(e){return o._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&o.X()){const r=e.width+2,c=e.height+2;try{return new o.R({width:r,height:c},yield o.Y(e,-1,-1,r,c))}catch{}}return W.getImageData(e,1)}))}_getNeighboringTiles(e){const r=e.canonical,c=Math.pow(2,r.z),f=(r.x-1+c)%c,m=r.x===0?e.wrap-1:e.wrap,x=(r.x+1+c)%c,T=r.x+1===c?e.wrap+1:e.wrap,A={};return A[new o.Z(e.overscaledZ,m,r.z,f,r.y).key]={backfilled:!1},A[new o.Z(e.overscaledZ,T,r.z,x,r.y).key]={backfilled:!1},r.y>0&&(A[new o.Z(e.overscaledZ,m,r.z,f,r.y-1).key]={backfilled:!1},A[new o.Z(e.overscaledZ,e.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},A[new o.Z(e.overscaledZ,T,r.z,x,r.y-1).key]={backfilled:!1}),r.y+1<c&&(A[new o.Z(e.overscaledZ,m,r.z,f,r.y+1).key]={backfilled:!1},A[new o.Z(e.overscaledZ,e.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},A[new o.Z(e.overscaledZ,T,r.z,x,r.y+1).key]={backfilled:!1}),A}unloadTile(e){return o._(this,void 0,void 0,(function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))}))}}class Si extends o.E{constructor(e,r,c,f){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:r.data},this.actor=c.getActor(),this.setEventedParent(f),this._data=r.data,this._options=o.e({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId,r.clusterMaxZoom!==void 0&&this.maxzoom<=r.clusterMaxZoom&&o.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${r.clusterMaxZoom}".`),this.workerOptions=o.e({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(r.buffer!==void 0?r.buffer:128),tolerance:this._pixelsToTileUnits(r.tolerance!==void 0?r.tolerance:.375),extent:o.$,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(r.clusterMaxZoom),minPoints:Math.max(2,r.clusterMinPoints||2),extent:o.$,radius:this._pixelsToTileUnits(r.clusterRadius||50),log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(o.$/this.tileSize)}_getClusterMaxZoom(e){const r=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||e===void 0||o.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${r}"`),r}load(){return o._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._pendingWorkerUpdate={data:e},this._updateWorkerData(),this}updateData(e){return this._pendingWorkerUpdate.diff=o.a0(this._pendingWorkerUpdate.diff,e),this._updateWorkerData(),this}getData(){return o._(this,void 0,void 0,(function*(){const e=o.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})}))}getCoordinatesFromGeometry(e){return e.type==="GeometryCollection"?e.geometries.map((r=>r.coordinates)).flat(1/0):e.coordinates.flat(1/0)}getBounds(){return o._(this,void 0,void 0,(function*(){const e=new di,r=yield this.getData();let c;switch(r.type){case"FeatureCollection":c=r.features.map((f=>this.getCoordinatesFromGeometry(f.geometry))).flat(1/0);break;case"Feature":c=this.getCoordinatesFromGeometry(r.geometry);break;default:c=this.getCoordinatesFromGeometry(r)}if(c.length==0)return e;for(let f=0;f<c.length-1;f+=2)e.extend([c[f],c[f+1]]);return e}))}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,r,c){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:r,offset:c}})}_updateWorkerData(){return o._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;const{data:e,diff:r}=this._pendingWorkerUpdate;if(!e&&!r)return void o.w(`No data or diff provided to GeoJSONSource ${this.id}.`);const c=o.e({type:this.type},this.workerOptions);e?(typeof e=="string"?(c.request=this.map._requestManager.transformRequest(W.resolveURL(e),"Source"),c.request.collectResourceTiming=this._collectResourceTiming):c.data=JSON.stringify(e),this._pendingWorkerUpdate.data=void 0):r&&(c.dataDiff=r,this._pendingWorkerUpdate.diff=void 0),this._isUpdatingWorker=!0,this.fire(new o.l("dataloading",{dataType:"source"}));try{const f=yield this.actor.sendAsync({type:"LD",data:c});if(this._isUpdatingWorker=!1,this._removed||f.abandoned)return void this.fire(new o.l("dataabort",{dataType:"source"}));this._data=f.data;let m=null;f.resourceTiming&&f.resourceTiming[this.id]&&(m=f.resourceTiming[this.id].slice(0));const x={dataType:"source"};this._collectResourceTiming&&m&&m.length>0&&o.e(x,{resourceTiming:m}),this.fire(new o.l("data",Object.assign(Object.assign({},x),{sourceDataType:"metadata"}))),this.fire(new o.l("data",Object.assign(Object.assign({},x),{sourceDataType:"content"})))}catch(f){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new o.l("dataabort",{dataType:"source"}));this.fire(new o.k(f))}finally{(this._pendingWorkerUpdate.data||this._pendingWorkerUpdate.diff)&&this._updateWorkerData()}}))}loaded(){return!this._isUpdatingWorker&&this._pendingWorkerUpdate.data===void 0&&this._pendingWorkerUpdate.diff===void 0}loadTile(e){return o._(this,void 0,void 0,(function*(){const r=e.actor?"RT":"LT";e.actor=this.actor;const c={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};e.abortController=new AbortController;const f=yield this.actor.sendAsync({type:r,data:c},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(f,this.map.painter,r==="RT")}))}abortTile(e){return o._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0}))}unloadTile(e){return o._(this,void 0,void 0,(function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return o.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class gi extends o.E{constructor(e,r,c,f){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=c,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(f),this.options=r}load(e){return o._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const r=yield vt.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,r&&r.data&&(this.image=r.data,e&&(this.coordinates=e),this._finishLoading())}catch(r){this._request=null,this._loaded=!0,this.fire(new o.k(r))}}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const r=e.map(o.a1.fromLngLat);var c;return this.tileID=(function(f){const m=o.a2.fromPoints(f),x=m.width(),T=m.height(),A=Math.max(x,T),k=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),L=Math.pow(2,k);return new o.a4(k,Math.floor((m.minX+m.maxX)/2*L),Math.floor((m.minY+m.maxY)/2*L))})(r),this.terrainTileRanges=this._getOverlappingTileRanges(r),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=r.map((f=>this.tileID.getTilePoint(f)._round())),this.flippedWindingOrder=((c=this.tileCoords)[1].x-c[0].x)*(c[2].y-c[0].y)-(c[1].y-c[0].y)*(c[2].x-c[0].x)<0,this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,r=e.gl;this.texture||(this.texture=new o.T(e,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let c=!1;for(const f in this.tiles){const m=this.tiles[f];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,c=!0)}c&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return o._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){const{minX:r,minY:c,maxX:f,maxY:m}=o.a2.fromPoints(e),x={};for(let T=0;T<=o.a3;T++){const A=Math.pow(2,T),k=Math.floor(r*A),L=Math.floor(c*A),F=Math.floor(f*A),N=Math.floor(m*A);x[T]={minTileX:k,minTileY:L,maxTileX:F,maxTileY:N}}return x}}class ia extends gi{constructor(e,r,c,f){super(e,r,c,f),this.roundZoom=!0,this.type="video",this.options=r}load(){return o._(this,void 0,void 0,(function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const r of e.urls)this.urls.push(this.map._requestManager.transformRequest(r,"Source").url);try{const r=yield o.a5(this.urls);if(this._loaded=!0,!r)return;this.video=r,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(r){this.fire(new o.k(r))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const r=this.video.seekable;e<r.start(0)||e>r.end(0)?this.fire(new o.k(new o.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,r=e.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(e,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let c=!1;for(const f in this.tiles){const m=this.tiles[f];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,c=!0)}c&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class qn extends gi{constructor(e,r,c,f){super(e,r,c,f),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some((m=>!Array.isArray(m)||m.length!==2||m.some((x=>typeof x!="number"))))||this.fire(new o.k(new o.a6(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.k(new o.a6(`sources.${e}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new o.k(new o.a6(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new o.k(new o.a6(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.k(new o.a6(`sources.${e}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){return o._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context,c=r.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(r,this.canvas,c.RGBA,{premultiply:!0});let f=!1;for(const m in this.tiles){const x=this.tiles[m];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,f=!0)}f&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Ja={},An=p=>{switch(p){case"geojson":return Si;case"image":return gi;case"raster":return Jt;case"raster-dem":return wa;case"vector":return fi;case"video":return ia;case"canvas":return qn}return Ja[p]},Pi="RTLPluginLoaded";class Pn extends o.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=ai()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch((r=>{throw this.status="error",r}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return o._(this,arguments,void 0,(function*(r,c=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=W.resolveURL(r),!this.url)throw new Error(`requested url ${r} is invalid`);if(this.status==="unavailable"){if(!c)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return o._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new o.l(Pi))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Ui=null;function Sa(){return Ui||(Ui=new Pn),Ui}var ya,ve;(function(p){p[p.Base=0]="Base",p[p.Parent=1]="Parent"})(ya||(ya={})),(function(p){p[p.Departing=0]="Departing",p[p.Incoming=1]="Incoming"})(ve||(ve={}));class H{constructor(e,r){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=e,this.uid=o.a7(),this.uses=0,this.tileSize=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(e){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(e||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:e,fadingDirection:r,fadingParentID:c,fadeEndTime:f}){this.resetFadeLogic(),this.fadingRole=e,this.fadingDirection=r,this.fadingParentID=c,this.fadeEndTime=f}setSelfFadeLogic(e){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=e}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=W.now(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,r,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=(function(f,m){const x={};if(!m)return x;for(const T of f){const A=T.layerIds.map((k=>m.getLayer(k))).filter(Boolean);if(A.length!==0){T.layers=A,T.stateDependentLayerIds&&(T.stateDependentLayers=T.stateDependentLayerIds.map((k=>A.filter((L=>L.id===k))[0])));for(const k of A)x[k.id]=T}}return x})(e.buckets,r?.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const m=this.buckets[f];if(m instanceof o.a9){if(this.hasSymbolBuckets=!0,!c)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const m=this.buckets[f];if(m instanceof o.a9&&m.hasRTLText){this.hasRTLText=!0,Sa().lazyLoad();break}}this.queryPadding=0;for(const f in this.buckets){const m=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(f).queryRadius(m))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),this.dashPositions=e.dashPositions}else this.collisionBoxArray=new o.a8}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const c in this.buckets){const f=this.buckets[c];f.uploadPending()&&f.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new o.T(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,c,f,m,x,T,A,k,L,F){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:f,cameraQueryGeometry:m,scale:x,tileSize:this.tileSize,pixelPosMatrix:L,transform:A,params:T,queryPadding:this.queryPadding*k,getElevation:F},e,r,c):{}}querySourceFeatures(e,r){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const f=c.loadVTLayers(),m=r&&r.sourceLayer?r.sourceLayer:"",x=f._geojsonTileLayer||f[m];if(!x)return;const T=o.aa(r?.filter,r?.globalState),{z:A,x:k,y:L}=this.tileID.canonical,F={z:A,x:k,y:L};for(let N=0;N<x.length;N++){const q=x.feature(N);if(T.needGeometry){const ne=o.ab(q,!0);if(!T.filter(new o.F(this.tileID.overscaledZ),ne,this.tileID.canonical))continue}else if(!T.filter(new o.F(this.tileID.overscaledZ),q))continue;const X=c.getId(q,m),ae=new o.ac(q,A,k,L,X);ae.tile=F,e.push(ae)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const c=o.ad(e.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const c=Date.now();let f=!1;if(this.expirationTime>c)f=!1;else if(r)if(this.expirationTime<r)f=!0;else{const m=this.expirationTime-r;m?this.expirationTime=c+Math.max(m,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const c=this.latestFeatureIndex.loadVTLayers();for(const f in this.buckets){if(!r.style.hasLayer(f))continue;const m=this.buckets[f],x=m.layers[0].sourceLayer||"_geojsonTileLayer",T=c[x],A=e[x];if(!T||!A||Object.keys(A).length===0)continue;m.update(A,T,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const k=r&&r.style&&r.style.getLayer(f);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(m)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<W.now()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(e){this.symbolFadeHoldUntil=W.now()+e}setDependencies(e,r){const c={};for(const f of r)c[f]=!0;this.dependencies[e]=c}hasDependency(e,r){for(const c of e){const f=this.dependencies[c];if(f){for(const m of r)if(f[m])return!0}}return!1}}class ${constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,c){const f=e.wrapped().key;this.data[f]===void 0&&(this.data[f]=[]);const m={value:r,timeout:void 0};if(c!==void 0&&(m.timeout=setTimeout((()=>{this.remove(e,m)}),c)),this.data[f].push(m),this.order.push(f),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const c=e.wrapped().key,f=r===void 0?0:this.data[c].indexOf(r),m=this.data[c][f];return this.data[c].splice(f,1),m.timeout&&clearTimeout(m.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(m.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const c in this.data)for(const f of this.data[c])e(f.value)||r.push(f);for(const c of r)this.remove(c.value.tileID,c)}}class te{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,c){const f=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][f]=this.stateChanges[e][f]||{},o.e(this.stateChanges[e][f],c),this.deletedStates[e]===null){this.deletedStates[e]={};for(const m in this.state[e])m!==f&&(this.deletedStates[e][m]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][f]===null){this.deletedStates[e][f]={};for(const m in this.state[e][f])c[m]||(this.deletedStates[e][f][m]=null)}else for(const m in c)this.deletedStates[e]&&this.deletedStates[e][f]&&this.deletedStates[e][f][m]===null&&delete this.deletedStates[e][f][m]}removeFeatureState(e,r,c){if(this.deletedStates[e]===null)return;const f=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},c&&r!==void 0)this.deletedStates[e][f]!==null&&(this.deletedStates[e][f]=this.deletedStates[e][f]||{},this.deletedStates[e][f][c]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][f])for(c in this.deletedStates[e][f]={},this.stateChanges[e][f])this.deletedStates[e][f][c]=null;else this.deletedStates[e][f]=null;else this.deletedStates[e]=null}getState(e,r){const c=String(r),f=o.e({},(this.state[e]||{})[c],(this.stateChanges[e]||{})[c]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const m=this.deletedStates[e][r];if(m===null)return{};for(const x in m)delete f[x]}return f}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const c={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const m={};for(const x in this.stateChanges[f])this.state[f][x]||(this.state[f][x]={}),o.e(this.state[f][x],this.stateChanges[f][x]),m[x]=this.state[f][x];c[f]=m}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const m={};if(this.deletedStates[f]===null)for(const x in this.state[f])m[x]={},this.state[f][x]={};else for(const x in this.deletedStates[f]){if(this.deletedStates[f][x]===null)this.state[f][x]={};else for(const T of Object.keys(this.deletedStates[f][x]))delete this.state[f][x][T];m[x]=this.state[f][x]}c[f]=c[f]||{},o.e(c[f],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const f in e)e[f].setFeatureState(c,r)}}const ce=89.25;function fe(p,e){const r=o.ah(e.lat,-o.ai,o.ai);return new o.P(o.V(e.lng)*p,o.U(r)*p)}function be(p,e){return new o.a1(e.x/p,e.y/p).toLngLat()}function Ie(p){return p.cameraToCenterDistance*Math.min(.85*Math.tan(o.ae(90-p.pitch)),Math.tan(o.ae(ce-p.pitch)))}function Ce(p,e){const r=p.canonical,c=e/o.af(r.z),f=r.x+Math.pow(2,r.z)*p.wrap,m=o.ag(new Float64Array(16));return o.M(m,m,[f*c,r.y*c,0]),o.N(m,m,[c/o.$,c/o.$,1]),m}function $e(p,e,r,c,f){const m=o.a1.fromLngLat(p,e),x=f*o.aj(1,p.lat),T=x*Math.cos(o.ae(r)),A=Math.sqrt(x*x-T*T),k=A*Math.sin(o.ae(-c)),L=A*Math.cos(o.ae(-c));return new o.a1(m.x+k,m.y+L,m.z+T)}function ct(p,e,r){const c=e.intersectsFrustum(p);if(!r||c===0)return c;const f=e.intersectsPlane(r);return f===0?0:c===2&&f===2?2:1}function Je(p,e,r){let c=0;const f=(r-e)/10;for(let m=0;m<10;m++)c+=f*Math.pow(Math.cos(e+(m+.5)/10*(r-e)),p);return c}function zt(p,e){return function(r,c,f,m,x){const T=2*((p-1)/o.ak(Math.cos(o.ae(ce-x))/Math.cos(o.ae(ce)))-1),A=Math.acos(f/m),k=2*Je(T-1,0,o.ae(x/2)),L=Math.min(o.ae(ce),A+o.ae(x/2)),F=Je(T-1,Math.min(L,A-o.ae(x/2)),L),N=Math.atan(c/f),q=Math.hypot(c,f);let X=r;return X+=o.ak(m/q/Math.max(.5,Math.cos(o.ae(x/2)))),X+=T*o.ak(Math.cos(N))/2,X-=o.ak(Math.max(1,F/k/e))/2,X}}const Vt=zt(9.314,3);function Pe(p,e){const r=(e.roundZoom?Math.round:Math.floor)(p.zoom+o.ak(p.tileSize/e.tileSize));return Math.max(0,r)}function _i(p,e){const r=p.getCameraFrustum(),c=p.getClippingPlane(),f=p.screenPointToMercatorCoordinate(p.getCameraPoint()),m=o.a1.fromLngLat(p.center,p.elevation);f.z=m.z+Math.cos(p.pitchInRadians)*p.cameraToCenterDistance/p.worldSize;const x=p.getCoveringTilesDetailsProvider(),T=x.allowVariableZoom(p,e),A=Pe(p,e),k=e.minzoom||0,L=e.maxzoom!==void 0?e.maxzoom:p.maxZoom,F=Math.min(Math.max(0,A),L),N=Math.pow(2,F),q=[N*f.x,N*f.y,0],X=[N*m.x,N*m.y,0],ae=Math.hypot(m.x-f.x,m.y-f.y),ne=Math.abs(m.z-f.z),re=Math.hypot(ae,ne),oe=me=>({zoom:0,x:0,y:0,wrap:me,fullyVisible:!1}),ue=[],le=[];if(p.renderWorldCopies&&x.allowWorldCopies())for(let me=1;me<=3;me++)ue.push(oe(-me)),ue.push(oe(me));for(ue.push(oe(0));ue.length>0;){const me=ue.pop(),ye=me.x,he=me.y;let Me=me.fullyVisible;const je={x:ye,y:he,z:me.zoom},De=x.getTileBoundingVolume(je,me.wrap,p.elevation,e);if(!Me){const dt=ct(r,De,c);if(dt===0)continue;Me=dt===2}const Le=x.distanceToTile2d(f.x,f.y,je,De);let Ne=A;T&&(Ne=(e.calculateTileZoom||Vt)(p.zoom+o.ak(p.tileSize/e.tileSize),Le,ne,re,p.fov)),Ne=(e.roundZoom?Math.round:Math.floor)(Ne),Ne=Math.max(0,Ne);const ht=Math.min(Ne,L);if(me.wrap=x.getWrap(m,je,me.wrap),me.zoom>=ht){if(me.zoom<k)continue;const dt=F-me.zoom,it=q[0]-.5-(ye<<dt),Rt=q[1]-.5-(he<<dt),ei=e.reparseOverscaled?Math.max(me.zoom,Ne):me.zoom;le.push({tileID:new o.Z(me.zoom===L?ei:me.zoom,me.wrap,me.zoom,ye,he),distanceSq:o.al([X[0]-.5-ye,X[1]-.5-he]),tileDistanceToCamera:Math.sqrt(it*it+Rt*Rt)})}else for(let dt=0;dt<4;dt++)ue.push({zoom:me.zoom+1,x:(ye<<1)+dt%2,y:(he<<1)+(dt>>1),wrap:me.wrap,fullyVisible:Me})}return le.sort(((me,ye)=>me.distanceSq-ye.distanceSq)).map((me=>me.tileID))}const zi=o.a2.fromPoints([new o.P(0,0),new o.P(o.$,o.$)]);class kt extends o.E{constructor(e,r,c){super(),this.id=e,this.dispatcher=c,this.on("data",(f=>this._dataHandler(f))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((f,m,x,T)=>{const A=new(An(m.type))(f,m,x,T);if(A.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${A.id}`);return A})(e,r,c,this),this._tiles={},this._cache=new $(0,(f=>this._unloadTile(f))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new te,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,r,c){return o._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,r,c)}catch(f){e.state="errored",f.status!==404?this._source.fire(new o.k(f,{tile:e})):this.update(this.transform,this.terrain)}}))}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new o.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const c=this._tiles[r];c.upload(e),c.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((e=>e.tileID)).sort(Ei).map((e=>e.key))}getRenderableIds(e){const r=[];for(const c in this._tiles)this._isIdRenderable(c,e)&&r.push(this._tiles[c]);return e?r.sort(((c,f)=>{const m=c.tileID,x=f.tileID,T=new o.P(m.canonical.x,m.canonical.y)._rotate(-this.transform.bearingInRadians),A=new o.P(x.canonical.x,x.canonical.y)._rotate(-this.transform.bearingInRadians);return m.overscaledZ-x.overscaledZ||A.y-T.y||A.x-T.x})).map((c=>c.tileID.key)):r.map((c=>c.tileID)).sort(Ei).map((c=>c.key))}hasRenderableParent(e){const r=e.overscaledZ-1;if(r>=this._source.minzoom){const c=this._getLoadedTile(e.scaledTo(r));if(c)return this._isIdRenderable(c.tileID.key)}return!1}_isIdRenderable(e,r=!1){var c;return(c=this._tiles[e])===null||c===void 0?void 0:c.isRenderable(r)}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)e?this._reloadTile(r,"expired"):this._tiles[r].state!=="errored"&&this._reloadTile(r,"reloading")}}_reloadTile(e,r){return o._(this,void 0,void 0,(function*(){const c=this._tiles[e];c&&(c.state!=="loading"&&(c.state=r),yield this._loadTile(c,e,r))}))}_tileLoaded(e,r,c){e.timeAdded=W.now(),c==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new o.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const r=this.getRenderableIds();for(let f=0;f<r.length;f++){const m=r[f];if(e.neighboringTiles&&e.neighboringTiles[m]){const x=this.getTileByID(m);c(e,x),c(x,e)}}function c(f,m){f.needsHillshadePrepare=!0,f.needsTerrainPrepare=!0;let x=m.tileID.canonical.x-f.tileID.canonical.x;const T=m.tileID.canonical.y-f.tileID.canonical.y,A=Math.pow(2,f.tileID.canonical.z),k=m.tileID.key;x===0&&T===0||Math.abs(T)>1||(Math.abs(x)>1&&(Math.abs(x+A)===1?x+=A:Math.abs(x-A)===1&&(x-=A)),m.dem&&f.dem&&(f.dem.backfillBorder(m.dem,x,T),f.neighboringTiles&&f.neighboringTiles[k]&&(f.neighboringTiles[k].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r){const c=Object.values(e),f=this._getLoadedDescendents(c),m={};for(const x of c){const T=f[x.key];if(!T?.length){m[x.key]=x;continue}const A=x.overscaledZ+kt.maxUnderzooming,k=T.filter((N=>N.tileID.overscaledZ<=A));if(!k.length){m[x.key]=x;continue}const L=Math.min(...k.map((N=>N.tileID.overscaledZ))),F=k.filter((N=>N.tileID.overscaledZ===L)).map((N=>N.tileID));for(const N of F)r[N.key]=N;this._areDescendentsComplete(F,L,x.overscaledZ)||(m[x.key]=x)}return m}_getLoadedDescendents(e){var r;const c={};for(const f in this._tiles){const m=this._tiles[f];if(m.hasData())for(const x of e)m.tileID.isChildOf(x)&&(c[r=x.key]||(c[r]=[])).push(m)}return c}_areDescendentsComplete(e,r,c){return e.length===1&&e[0].isOverscaled()?e[0].overscaledZ===r:Math.pow(4,r-c)===e.length}_getLoadedTile(e){const r=this._tiles[e.key];return r?.hasData()?r:null}updateCacheSize(e){const r=Math.ceil(e.width/this._source.tileSize)+1,c=Math.ceil(e.height/this._source.tileSize)+1,f=Math.floor(r*c*(this._maxTileCacheZoomLevels===null?o.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),m=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,f):f;this._cache.setMaxSize(m)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const c={};for(const f in this._tiles){const m=this._tiles[f];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+r),c[m.tileID.key]=m}this._tiles=c;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(f,this._tiles[f])}}update(e,r){if(!this._sourceLoaded||this._paused)return;let c;this.transform=e,this.terrain=r,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?c=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((A=>new o.Z(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y))):(c=_i(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:r,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(c=c.filter((A=>this._source.hasTile(A))))):c=[],this.usedForTerrain&&(c=this._addTerrainIdealTiles(c));const f=c.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,f&&this.fire(new o.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const m=Pe(e,this._source),x=this._updateRetainedTiles(c,m),T=Fa(this._source.type);T&&this._rasterFadeDuration>0&&!r&&this._updateFadingTiles(c,x),T?this._cleanUpRasterTiles(x):this._cleanUpVectorTiles(x)}_cleanUpRasterTiles(e){for(const r in this._tiles)e[r]||this._removeTile(r)}_cleanUpVectorTiles(e){for(const r in this._tiles){const c=this._tiles[r];e[r]?c.clearSymbolFadeHold():c.hasSymbolBuckets?c.holdingForSymbolFade()?c.symbolFadeFinished()&&this._removeTile(r):c.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(r)}}_addTerrainIdealTiles(e){const r=[];for(const c of e)if(c.canonical.z>this._source.minzoom){const f=c.scaledTo(c.canonical.z-1);r.push(f);const m=c.scaledTo(Math.max(this._source.minzoom,Math.min(c.canonical.z,5)));r.push(m)}return e.concat(r)}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForSymbolFade()&&this._removeTile(e)}_updateRetainedTiles(e,r){var c;const f={},m={},x=Math.max(r-kt.maxOverzooming,this._source.minzoom);let T={};for(const A of e){const k=this._addTile(A);f[A.key]=A,k.hasData()||(T[A.key]=A)}T=this._retainLoadedChildren(T,f);for(const A in T){const k=T[A];let L=this._tiles[A],F=L?.wasRequested();for(let N=k.overscaledZ-1;N>=x;--N){const q=k.scaledTo(N);if(m[q.key])break;if(m[q.key]=!0,L=this.getTile(q),!L&&F&&(L=this._addTile(q)),L){const X=L.hasData();if((X||!(!((c=this.map)===null||c===void 0)&&c.cancelPendingTileRequestsWhileZooming)||F)&&(f[q.key]=q),F=L.wasRequested(),X)break}}}return f}_updateFadingTiles(e,r){const c=W.now(),f=o.am(e);for(const m of e){const x=this._tiles[m.key];x.fadingDirection!==ve.Departing&&x.fadeOpacity!==0||x.resetFadeLogic(),this._updateFadingAncestor(x,r,c)||this._updateFadingDescendents(x,r,c)||this._updateFadingEdge(x,f,c)||x.resetFadeLogic()}}_updateFadingAncestor(e,r,c){if(!e.hasData())return!1;const{tileID:f,fadingRole:m,fadingDirection:x,fadingParentID:T}=e;if(m===ya.Base&&x===ve.Incoming&&T)return r[T.key]=T,!0;const A=Math.max(f.overscaledZ-this._maxFadingAncestorLevels,this._source.minzoom);for(let k=f.overscaledZ-1;k>=A;k--){const L=f.scaledTo(k),F=this._getLoadedTile(L);if(F)return e.setCrossFadeLogic({fadingRole:ya.Base,fadingDirection:ve.Incoming,fadingParentID:F.tileID,fadeEndTime:c+this._rasterFadeDuration}),F.setCrossFadeLogic({fadingRole:ya.Parent,fadingDirection:ve.Departing,fadeEndTime:c+this._rasterFadeDuration}),r[L.key]=L,!0}return!1}_updateFadingDescendents(e,r,c){if(!e.hasData())return!1;const f=e.tileID.children(this._source.maxzoom);let m=this._updateFadingChildren(e,f,r,c);if(m)return!0;for(const x of f){const T=x.children(this._source.maxzoom);this._updateFadingChildren(e,T,r,c)&&(m=!0)}return m}_updateFadingChildren(e,r,c,f){if(r[0].overscaledZ>=this._source.maxzoom)return!1;let m=!1;for(const x of r){const T=this._getLoadedTile(x);if(!T)continue;const{fadingRole:A,fadingDirection:k,fadingParentID:L}=T;A===ya.Base&&k===ve.Departing&&L||(T.setCrossFadeLogic({fadingRole:ya.Base,fadingDirection:ve.Departing,fadingParentID:e.tileID,fadeEndTime:f+this._rasterFadeDuration}),e.setCrossFadeLogic({fadingRole:ya.Parent,fadingDirection:ve.Incoming,fadeEndTime:f+this._rasterFadeDuration})),c[x.key]=x,m=!0}return m}_updateFadingEdge(e,r,c){const f=e.tileID;return!!e.selfFading||!e.hasData()&&!!r.has(f)&&(e.setSelfFadeLogic(c+this._rasterFadeDuration),!0)}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(r.resetFadeLogic(),this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const c=r;return r||(r=new H(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(r,e.key,r.state)),r.uses++,this._tiles[e.key]=r,c||this._source.fire(new o.l("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const c=r.getExpiryTimeout();c&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),c))}refreshTiles(e){for(const r in this._tiles)(this._isIdRenderable(r)||this._tiles[r].state=="errored")&&e.some((c=>c.equals(this._tiles[r].tileID.canonical)))&&this._reloadTile(r,"expired")}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}_dataHandler(e){e.dataType==="source"&&(e.sourceDataType!=="metadata"?e.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,r,c){const f=[],m=this.transform;if(!m)return f;const x=m.getCoveringTilesDetailsProvider().allowWorldCopies(),T=c?m.getCameraQueryGeometry(e):e,A=q=>m.screenPointToMercatorCoordinate(q,this.terrain),k=this.transformBbox(e,A,!x),L=this.transformBbox(T,A,!x),F=this.getIds(),N=o.a2.fromPoints(L);for(let q=0;q<F.length;q++){const X=this._tiles[F[q]];if(X.holdingForSymbolFade())continue;const ae=x?[X.tileID]:[X.tileID.unwrapTo(-1),X.tileID.unwrapTo(0)],ne=Math.pow(2,m.zoom-X.tileID.overscaledZ),re=r*X.queryPadding*o.$/X.tileSize/ne;for(const oe of ae){const ue=N.map((le=>oe.getTilePoint(new o.a1(le.x,le.y))));if(ue.expandBy(re),ue.intersects(zi)){const le=k.map((ye=>oe.getTilePoint(ye))),me=L.map((ye=>oe.getTilePoint(ye)));f.push({tile:X,tileID:x?oe:oe.unwrapTo(0),queryGeometry:le,cameraQueryGeometry:me,scale:ne})}}}return f}transformBbox(e,r,c){let f=e.map(r);if(c){const m=o.a2.fromPoints(e);m.shrinkBy(.001*Math.min(m.width(),m.height()));const x=m.map(r);o.a2.fromPoints(f).covers(x)||(f=f.map((T=>T.x>.5?new o.a1(T.x-1,T.y,T.z):T)))}return f}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map((c=>this._tiles[c].tileID));return this.transform&&this.transform.populateCache(r),r}hasTransition(){if(this._source.hasTransition())return!0;if(Fa(this._source.type)&&this._rasterFadeDuration>0){const e=W.now();for(const r in this._tiles)if(this._tiles[r].fadeEndTime>=e)return!0}return!1}setRasterFadeDuration(e){this._rasterFadeDuration=e}setFeatureState(e,r,c){this._state.updateState(e=e||"_geojsonTileLayer",r,c)}removeFeatureState(e,r,c){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,c)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,c){const f=this._tiles[e];f&&f.setDependencies(r,c)}reloadTilesForDependencies(e,r){for(const c in this._tiles)this._tiles[c].hasDependency(e,r)&&this._reloadTile(c,"reloading");this._cache.filter((c=>!c.hasDependency(e,r)))}}function Ei(p,e){const r=Math.abs(2*p.wrap)-+(p.wrap<0),c=Math.abs(2*e.wrap)-+(e.wrap<0);return p.overscaledZ-e.overscaledZ||c-r||e.canonical.y-p.canonical.y||e.canonical.x-p.canonical.x}function Fa(p){return p==="raster"||p==="image"||p==="video"}kt.maxOverzooming=10,kt.maxUnderzooming=3;class za{constructor(e,r){this.reset(e,r)}reset(e,r){this.points=e||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=o.ah(e,0,1);let r=1,c=this._distances[r];const f=e*this.paddedLength+this.padding;for(;c<f&&r<this._distances.length;)c=this._distances[++r];const m=r-1,x=this._distances[m],T=c-x,A=T>0?(f-x)/T:0;return this.points[m].mult(1-A).add(this.points[r].mult(A))}}function qa(p,e){let r=!0;return p==="always"||p!=="never"&&e!=="never"||(r=!1),r}class hn{constructor(e,r,c){const f=this.boxCells=[],m=this.circleCells=[];this.xCellCount=Math.ceil(e/c),this.yCellCount=Math.ceil(r/c);for(let x=0;x<this.xCellCount*this.yCellCount;x++)f.push([]),m.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=r,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,r,c,f,m){this._forEachCell(r,c,f,m,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(r),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(m)}insertCircle(e,r,c,f){this._forEachCell(r-f,c-f,r+f,c+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(r),this.circles.push(c),this.circles.push(f)}_insertBoxCell(e,r,c,f,m,x){this.boxCells[m].push(x)}_insertCircleCell(e,r,c,f,m,x){this.circleCells[m].push(x)}_query(e,r,c,f,m,x,T){if(c<0||e>this.width||f<0||r>this.height)return[];const A=[];if(e<=0&&r<=0&&this.width<=c&&this.height<=f){if(m)return[{key:null,x1:e,y1:r,x2:c,y2:f}];for(let k=0;k<this.boxKeys.length;k++)A.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const L=this.circles[3*k],F=this.circles[3*k+1],N=this.circles[3*k+2];A.push({key:this.circleKeys[k],x1:L-N,y1:F-N,x2:L+N,y2:F+N})}}else this._forEachCell(e,r,c,f,this._queryCell,A,{hitTest:m,overlapMode:x,seenUids:{box:{},circle:{}}},T);return A}query(e,r,c,f){return this._query(e,r,c,f,!1,null)}hitTest(e,r,c,f,m,x){return this._query(e,r,c,f,!0,m,x).length>0}hitTestCircle(e,r,c,f,m){const x=e-c,T=e+c,A=r-c,k=r+c;if(T<0||x>this.width||k<0||A>this.height)return!1;const L=[];return this._forEachCell(x,A,T,k,this._queryCellCircle,L,{hitTest:!0,overlapMode:f,circle:{x:e,y:r,radius:c},seenUids:{box:{},circle:{}}},m),L.length>0}_queryCell(e,r,c,f,m,x,T,A){const{seenUids:k,hitTest:L,overlapMode:F}=T,N=this.boxCells[m];if(N!==null){const X=this.bboxes;for(const ae of N)if(!k.box[ae]){k.box[ae]=!0;const ne=4*ae,re=this.boxKeys[ae];if(e<=X[ne+2]&&r<=X[ne+3]&&c>=X[ne+0]&&f>=X[ne+1]&&(!A||A(re))&&(!L||!qa(F,re.overlapMode))&&(x.push({key:re,x1:X[ne],y1:X[ne+1],x2:X[ne+2],y2:X[ne+3]}),L))return!0}}const q=this.circleCells[m];if(q!==null){const X=this.circles;for(const ae of q)if(!k.circle[ae]){k.circle[ae]=!0;const ne=3*ae,re=this.circleKeys[ae];if(this._circleAndRectCollide(X[ne],X[ne+1],X[ne+2],e,r,c,f)&&(!A||A(re))&&(!L||!qa(F,re.overlapMode))){const oe=X[ne],ue=X[ne+1],le=X[ne+2];if(x.push({key:re,x1:oe-le,y1:ue-le,x2:oe+le,y2:ue+le}),L)return!0}}}return!1}_queryCellCircle(e,r,c,f,m,x,T,A){const{circle:k,seenUids:L,overlapMode:F}=T,N=this.boxCells[m];if(N!==null){const X=this.bboxes;for(const ae of N)if(!L.box[ae]){L.box[ae]=!0;const ne=4*ae,re=this.boxKeys[ae];if(this._circleAndRectCollide(k.x,k.y,k.radius,X[ne+0],X[ne+1],X[ne+2],X[ne+3])&&(!A||A(re))&&!qa(F,re.overlapMode))return x.push(!0),!0}}const q=this.circleCells[m];if(q!==null){const X=this.circles;for(const ae of q)if(!L.circle[ae]){L.circle[ae]=!0;const ne=3*ae,re=this.circleKeys[ae];if(this._circlesCollide(X[ne],X[ne+1],X[ne+2],k.x,k.y,k.radius)&&(!A||A(re))&&!qa(F,re.overlapMode))return x.push(!0),!0}}}_forEachCell(e,r,c,f,m,x,T,A){const k=this._convertToXCellCoord(e),L=this._convertToYCellCoord(r),F=this._convertToXCellCoord(c),N=this._convertToYCellCoord(f);for(let q=k;q<=F;q++)for(let X=L;X<=N;X++)if(m.call(this,e,r,c,f,this.xCellCount*X+q,x,T,A))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,r,c,f,m,x){const T=f-e,A=m-r,k=c+x;return k*k>T*T+A*A}_circleAndRectCollide(e,r,c,f,m,x,T){const A=(x-f)/2,k=Math.abs(e-(f+A));if(k>A+c)return!1;const L=(T-m)/2,F=Math.abs(r-(m+L));if(F>L+c)return!1;if(k<=A||F<=L)return!0;const N=k-A,q=F-L;return N*N+q*q<=c*c}}function Ji(p,e,r){const c=o.L();if(!p){const{vecSouth:F,vecEast:N}=ji(e),q=j();q[0]=N[0],q[1]=N[1],q[2]=F[0],q[3]=F[1],f=q,(L=(x=(m=q)[0])*(k=m[3])-(A=m[2])*(T=m[1]))&&(f[0]=k*(L=1/L),f[1]=-T*L,f[2]=-A*L,f[3]=x*L),c[0]=q[0],c[1]=q[1],c[4]=q[2],c[5]=q[3]}var f,m,x,T,A,k,L;return o.N(c,c,[1/r,1/r,1]),c}function Za(p,e,r,c){if(p){const f=o.L();if(!e){const{vecSouth:m,vecEast:x}=ji(r);f[0]=x[0],f[1]=x[1],f[4]=m[0],f[5]=m[1]}return o.N(f,f,[c,c,1]),f}return r.pixelsToClipSpaceMatrix}function ji(p){const e=Math.cos(p.rollInRadians),r=Math.sin(p.rollInRadians),c=Math.cos(p.pitchInRadians),f=Math.cos(p.bearingInRadians),m=Math.sin(p.bearingInRadians),x=o.ar();x[0]=-f*c*r-m*e,x[1]=-m*c*r+f*e;const T=o.as(x);T<1e-9?o.at(x):o.au(x,x,1/T);const A=o.ar();A[0]=f*c*e-m*r,A[1]=m*c*e+f*r;const k=o.as(A);return k<1e-9?o.at(A):o.au(A,A,1/k),{vecEast:A,vecSouth:x}}function st(p,e,r,c){let f;c?(f=[p,e,c(p,e),1],o.aw(f,f,r)):(f=[p,e,0,1],Ma(f,f,r));const m=f[3];return{point:new o.P(f[0]/m,f[1]/m),signedDistanceFromCamera:m,isOccluded:!1}}function Gr(p,e){return .5+p/e*.5}function Zn(p,e){return p.x>=-e[0]&&p.x<=e[0]&&p.y>=-e[1]&&p.y<=e[1]}function $a(p,e,r,c,f,m,x,T,A,k,L,F,N){const q=r?p.textSizeData:p.iconSizeData,X=o.an(q,e.transform.zoom),ae=[256/e.width*2+1,256/e.height*2+1],ne=r?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;ne.clear();const re=p.lineVertexArray,oe=r?p.text.placedSymbolArray:p.icon.placedSymbolArray,ue=e.transform.width/e.transform.height;let le=!1;for(let me=0;me<oe.length;me++){const ye=oe.get(me);if(ye.hidden||ye.writingMode===o.ao.vertical&&!le){$n(ye.numGlyphs,ne);continue}le=!1;const he=new o.P(ye.anchorX,ye.anchorY),Me={getElevation:N,pitchedLabelPlaneMatrix:c,lineVertexArray:re,pitchWithMap:m,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:he,unwrappedTileID:A,width:k,height:L,translation:F},je=ni(ye.anchorX,ye.anchorY,Me);if(!Zn(je.point,ae)){$n(ye.numGlyphs,ne);continue}const De=Gr(e.transform.cameraToCenterDistance,je.signedDistanceFromCamera),Le=o.ap(q,X,ye),Ne=m?Le*e.transform.getPitchedTextCorrection(ye.anchorX,ye.anchorY,A)/De:Le*De,ht=si({projectionContext:Me,pitchedLabelPlaneMatrixInverse:f,symbol:ye,fontSize:Ne,flip:!1,keepUpright:x,glyphOffsetArray:p.glyphOffsetArray,dynamicLayoutVertexArray:ne,aspectRatio:ue,rotateToLine:T});le=ht.useVertical,(ht.notEnoughRoom||le||ht.needsFlipping&&si({projectionContext:Me,pitchedLabelPlaneMatrixInverse:f,symbol:ye,fontSize:Ne,flip:!0,keepUpright:x,glyphOffsetArray:p.glyphOffsetArray,dynamicLayoutVertexArray:ne,aspectRatio:ue,rotateToLine:T}).notEnoughRoom)&&$n(ye.numGlyphs,ne)}r?p.text.dynamicLayoutVertexBuffer.updateData(ne):p.icon.dynamicLayoutVertexBuffer.updateData(ne)}function Ri(p,e,r,c,f,m,x,T){const A=m.glyphStartIndex+m.numGlyphs,k=m.lineStartIndex,L=m.lineStartIndex+m.lineLength,F=e.getoffsetX(m.glyphStartIndex),N=e.getoffsetX(A-1),q=Mr(p*F,r,c,f,m.segment,k,L,T,x);if(!q)return null;const X=Mr(p*N,r,c,f,m.segment,k,L,T,x);return X?T.projectionCache.anyProjectionOccluded?null:{first:q,last:X}:null}function ut(p,e,r,c){return p===o.ao.horizontal&&Math.abs(r.y-e.y)>Math.abs(r.x-e.x)*c?{useVertical:!0}:(p===o.ao.vertical?e.y<r.y:e.x>r.x)?{needsFlipping:!0}:null}function si(p){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:r,symbol:c,fontSize:f,flip:m,keepUpright:x,glyphOffsetArray:T,dynamicLayoutVertexArray:A,aspectRatio:k,rotateToLine:L}=p,F=f/24,N=c.lineOffsetX*F,q=c.lineOffsetY*F;let X;if(c.numGlyphs>1){const ae=c.glyphStartIndex+c.numGlyphs,ne=c.lineStartIndex,re=c.lineStartIndex+c.lineLength,oe=Ri(F,T,N,q,m,c,L,e);if(!oe)return{notEnoughRoom:!0};const ue=Ur(oe.first.point.x,oe.first.point.y,e,r),le=Ur(oe.last.point.x,oe.last.point.y,e,r);if(x&&!m){const me=ut(c.writingMode,ue,le,k);if(me)return me}X=[oe.first];for(let me=c.glyphStartIndex+1;me<ae-1;me++){const ye=Mr(F*T.getoffsetX(me),N,q,m,c.segment,ne,re,e,L);if(!ye)return{notEnoughRoom:!0};X.push(ye)}X.push(oe.last)}else{if(x&&!m){const ne=os(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,re=c.lineStartIndex+c.segment+1,oe=new o.P(e.lineVertexArray.getx(re),e.lineVertexArray.gety(re)),ue=os(oe.x,oe.y,e),le=ue.signedDistanceFromCamera>0?ue.point:li(e.tileAnchorPoint,oe,ne,1,e),me=Ur(ne.x,ne.y,e,r),ye=Ur(le.x,le.y,e,r),he=ut(c.writingMode,me,ye,k);if(he)return he}const ae=Mr(F*T.getoffsetX(c.glyphStartIndex),N,q,m,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,e,L);if(!ae||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};X=[ae]}for(const ae of X)o.av(A,ae.point,ae.angle);return{}}function li(p,e,r,c,f){const m=p.add(p.sub(e)._unit()),x=os(m.x,m.y,f).point,T=r.sub(x);return r.add(T._mult(c/T.mag()))}function ar(p,e,r){const c=e.projectionCache;if(c.projections[p])return c.projections[p];const f=new o.P(e.lineVertexArray.getx(p),e.lineVertexArray.gety(p)),m=os(f.x,f.y,e);if(m.signedDistanceFromCamera>0)return c.projections[p]=m.point,c.anyProjectionOccluded=c.anyProjectionOccluded||m.isOccluded,m.point;const x=p-r.direction;return li(r.distanceFromAnchor===0?e.tileAnchorPoint:new o.P(e.lineVertexArray.getx(x),e.lineVertexArray.gety(x)),f,r.previousVertex,r.absOffsetX-r.distanceFromAnchor+1,e)}function os(p,e,r){const c=p+r.translation[0],f=e+r.translation[1];let m;return r.pitchWithMap?(m=st(c,f,r.pitchedLabelPlaneMatrix,r.getElevation),m.isOccluded=!1):(m=r.transform.projectTileCoordinates(c,f,r.unwrappedTileID,r.getElevation),m.point.x=(.5*m.point.x+.5)*r.width,m.point.y=(.5*-m.point.y+.5)*r.height),m}function Ur(p,e,r,c){if(r.pitchWithMap){const f=[p,e,0,1];return o.aw(f,f,c),r.transform.projectTileCoordinates(f[0]/f[3],f[1]/f[3],r.unwrappedTileID,r.getElevation).point}return{x:p/r.width*2-1,y:1-e/r.height*2}}function ni(p,e,r){return r.transform.projectTileCoordinates(p,e,r.unwrappedTileID,r.getElevation)}function no(p,e,r){return p._unit()._perp()._mult(e*r)}function ls(p,e,r,c,f,m,x,T,A){if(T.projectionCache.offsets[p])return T.projectionCache.offsets[p];const k=r.add(e);if(p+A.direction<c||p+A.direction>=f)return T.projectionCache.offsets[p]=k,k;const L=ar(p+A.direction,T,A),F=no(L.sub(r),x,A.direction),N=r.add(F),q=L.add(F);return T.projectionCache.offsets[p]=o.ax(m,k,N,q)||k,T.projectionCache.offsets[p]}function Mr(p,e,r,c,f,m,x,T,A){const k=c?p-e:p+e;let L=k>0?1:-1,F=0;c&&(L*=-1,F=Math.PI),L<0&&(F+=Math.PI);let N,q=L>0?m+f:m+f+1;T.projectionCache.cachedAnchorPoint?N=T.projectionCache.cachedAnchorPoint:(N=os(T.tileAnchorPoint.x,T.tileAnchorPoint.y,T).point,T.projectionCache.cachedAnchorPoint=N);let X,ae,ne=N,re=N,oe=0,ue=0;const le=Math.abs(k),me=[];let ye;for(;oe+ue<=le;){if(q+=L,q<m||q>=x)return null;oe+=ue,re=ne,ae=X;const je={absOffsetX:le,direction:L,distanceFromAnchor:oe,previousVertex:re};if(ne=ar(q,T,je),r===0)me.push(re),ye=ne.sub(re);else{let De;const Le=ne.sub(re);De=Le.mag()===0?no(ar(q+L,T,je).sub(ne),r,L):no(Le,r,L),ae||(ae=re.add(De)),X=ls(q,De,ne,m,x,ae,r,T,je),me.push(ae),ye=X.sub(ae)}ue=ye.mag()}const he=ye._mult((le-oe)/ue)._add(ae||re),Me=F+Math.atan2(ne.y-re.y,ne.x-re.x);return me.push(he),{point:he,angle:A?Me:0,path:me}}const Ps=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function $n(p,e){for(let r=0;r<p;r++){const c=e.length;e.resize(c+4),e.float32.set(Ps,3*c)}}function Ma(p,e,r){const c=e[0],f=e[1];return p[0]=r[0]*c+r[4]*f+r[12],p[1]=r[1]*c+r[5]*f+r[13],p[3]=r[3]*c+r[7]*f+r[15],p}const Ra=100;class Hn{constructor(e,r=new hn(e.width+200,e.height+200,25),c=new hn(e.width+200,e.height+200,25)){this.transform=e,this.grid=r,this.ignoredGrid=c,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Ra,this.screenBottomBoundary=e.height+Ra,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,r,c,f,m,x,T,A,k,L,F,N){const q=this.projectAndGetPerspectiveRatio(e.anchorPointX+A[0],e.anchorPointY+A[1],m,L,N),X=c*q.perspectiveRatio;let ae;if(x||T)ae=this._projectCollisionBox(e,X,f,m,x,T,A,q,L,F,N);else{const ye=q.x+(F?F.x*X:0),he=q.y+(F?F.y*X:0);ae={allPointsOccluded:!1,box:[ye+e.x1*X,he+e.y1*X,ye+e.x2*X,he+e.y2*X]}}const[ne,re,oe,ue]=ae.box,le=x?ae.allPointsOccluded:q.isOccluded;let me=le;return me||(me=q.perspectiveRatio<this.perspectiveRatioCutoff),me||(me=!this.isInsideGrid(ne,re,oe,ue)),me||r!=="always"&&this.grid.hitTest(ne,re,oe,ue,r,k)?{box:[ne,re,oe,ue],placeable:!1,offscreen:!1,occluded:le}:{box:[ne,re,oe,ue],placeable:!0,offscreen:this.isOffscreen(ne,re,oe,ue),occluded:le}}placeCollisionCircles(e,r,c,f,m,x,T,A,k,L,F,N,q,X){const ae=[],ne=new o.P(r.anchorX,r.anchorY),re=this.getPerspectiveRatio(ne.x,ne.y,x,X),oe=(k?m*this.transform.getPitchedTextCorrection(r.anchorX,r.anchorY,x)/re:m*re)/o.aB,ue={getElevation:X,pitchedLabelPlaneMatrix:T,lineVertexArray:c,pitchWithMap:k,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:ne,unwrappedTileID:x,width:this.transform.width,height:this.transform.height,translation:q},le=Ri(oe,f,r.lineOffsetX*oe,r.lineOffsetY*oe,!1,r,!1,ue);let me=!1,ye=!1,he=!0;if(le){const Me=.5*F*re+N,je=new o.P(-100,-100),De=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Le=new za,Ne=le.first,ht=le.last;let dt=[];for(let ei=Ne.path.length-1;ei>=1;ei--)dt.push(Ne.path[ei]);for(let ei=1;ei<ht.path.length;ei++)dt.push(ht.path[ei]);const it=2.5*Me;if(k){const ei=this.projectPathToScreenSpace(dt,ue);dt=ei.some((Ii=>Ii.signedDistanceFromCamera<=0))?[]:ei.map((Ii=>Ii.point))}let Rt=[];if(dt.length>0){const ei=dt[0].clone(),Ii=dt[0].clone();for(let Vi=1;Vi<dt.length;Vi++)ei.x=Math.min(ei.x,dt[Vi].x),ei.y=Math.min(ei.y,dt[Vi].y),Ii.x=Math.max(Ii.x,dt[Vi].x),Ii.y=Math.max(Ii.y,dt[Vi].y);Rt=ei.x>=je.x&&Ii.x<=De.x&&ei.y>=je.y&&Ii.y<=De.y?[dt]:Ii.x<je.x||ei.x>De.x||Ii.y<je.y||ei.y>De.y?[]:o.ay([dt],je.x,je.y,De.x,De.y)}for(const ei of Rt){Le.reset(ei,.25*Me);let Ii=0;Ii=Le.length<=.5*Me?1:Math.ceil(Le.paddedLength/it)+1;for(let Vi=0;Vi<Ii;Vi++){const qi=Vi/Math.max(Ii-1,1),ua=Le.lerp(qi),na=ua.x+Ra,vi=ua.y+Ra;ae.push(na,vi,Me,0);const xa=na-Me,vn=vi-Me,La=na+Me,Oa=vi+Me;if(he=he&&this.isOffscreen(xa,vn,La,Oa),ye=ye||this.isInsideGrid(xa,vn,La,Oa),e!=="always"&&this.grid.hitTestCircle(na,vi,Me,e,L)&&(me=!0,!A))return{circles:[],offscreen:!1,collisionDetected:me}}}}return{circles:!A&&me||!ye||re<this.perspectiveRatioCutoff?[]:ae,offscreen:he,collisionDetected:me}}projectPathToScreenSpace(e,r){const c=(function(f,m){const x=o.L();return o.aq(x,m.pitchedLabelPlaneMatrix),f.map((T=>{const A=st(T.x,T.y,x,m.getElevation),k=m.transform.projectTileCoordinates(A.point.x,A.point.y,m.unwrappedTileID,m.getElevation);return k.point.x=(.5*k.point.x+.5)*m.width,k.point.y=(.5*-k.point.y+.5)*m.height,k}))})(e,r);return(function(f){let m=0,x=0,T=0,A=0;for(let k=0;k<f.length;k++)f[k].isOccluded?(T=k+1,A=0):(A++,A>x&&(x=A,m=T));return f.slice(m,m+x)})(c)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[],c=new o.a2;for(const F of e){const N=new o.P(F.x+Ra,F.y+Ra);c.extend(N),r.push(N)}const{minX:f,minY:m,maxX:x,maxY:T}=c,A=this.grid.query(f,m,x,T).concat(this.ignoredGrid.query(f,m,x,T)),k={},L={};for(const F of A){const N=F.key;if(k[N.bucketInstanceId]===void 0&&(k[N.bucketInstanceId]={}),k[N.bucketInstanceId][N.featureIndex])continue;const q=[new o.P(F.x1,F.y1),new o.P(F.x2,F.y1),new o.P(F.x2,F.y2),new o.P(F.x1,F.y2)];o.az(r,q)&&(k[N.bucketInstanceId][N.featureIndex]=!0,L[N.bucketInstanceId]===void 0&&(L[N.bucketInstanceId]=[]),L[N.bucketInstanceId].push(N.featureIndex))}return L}insertCollisionBox(e,r,c,f,m,x){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:m,collisionGroupID:x,overlapMode:r},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,r,c,f,m,x){const T=c?this.ignoredGrid:this.grid,A={bucketInstanceId:f,featureIndex:m,collisionGroupID:x,overlapMode:r};for(let k=0;k<e.length;k+=4)T.insertCircle(A,e[k],e[k+1],e[k+2])}projectAndGetPerspectiveRatio(e,r,c,f,m){if(m){let x;f?(x=[e,r,f(e,r),1],o.aw(x,x,m)):(x=[e,r,0,1],Ma(x,x,m));const T=x[3];return{x:(x[0]/T+1)/2*this.transform.width+Ra,y:(-x[1]/T+1)/2*this.transform.height+Ra,perspectiveRatio:.5+this.transform.cameraToCenterDistance/T*.5,isOccluded:!1,signedDistanceFromCamera:T}}{const x=this.transform.projectTileCoordinates(e,r,c,f);return{x:(x.point.x+1)/2*this.transform.width+Ra,y:(1-x.point.y)/2*this.transform.height+Ra,perspectiveRatio:.5+this.transform.cameraToCenterDistance/x.signedDistanceFromCamera*.5,isOccluded:x.isOccluded,signedDistanceFromCamera:x.signedDistanceFromCamera}}}getPerspectiveRatio(e,r,c,f){const m=this.transform.projectTileCoordinates(e,r,c,f);return .5+this.transform.cameraToCenterDistance/m.signedDistanceFromCamera*.5}isOffscreen(e,r,c,f){return c<Ra||e>=this.screenRightBoundary||f<Ra||r>this.screenBottomBoundary}isInsideGrid(e,r,c,f){return c>=0&&e<this.gridRightBoundary&&f>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const e=o.ag([]);return o.M(e,e,[-100,-100,0]),e}_projectCollisionBox(e,r,c,f,m,x,T,A,k,L,F){let N=1,q=0,X=0,ae=1;const ne=e.anchorPointX+T[0],re=e.anchorPointY+T[1];if(x&&!m){const dt=this.projectAndGetPerspectiveRatio(ne+1,re,f,k,F),it=dt.x-A.x,Rt=Math.atan((dt.y-A.y)/it)+(it<0?Math.PI:0),ei=Math.sin(Rt),Ii=Math.cos(Rt);N=Ii,q=ei,X=-ei,ae=Ii}else if(!x&&m){const dt=ji(this.transform);N=dt.vecEast[0],q=dt.vecEast[1],X=dt.vecSouth[0],ae=dt.vecSouth[1]}let oe=A.x,ue=A.y,le=r;m&&(oe=ne,ue=re,le=Math.pow(2,-(this.transform.zoom-c.overscaledZ)),le*=this.transform.getPitchedTextCorrection(ne,re,f),L||(le*=o.ah(.5+A.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),L&&(oe+=N*L.x*le+X*L.y*le,ue+=q*L.x*le+ae*L.y*le);const me=e.x1*le,ye=e.x2*le,he=(me+ye)/2,Me=e.y1*le,je=e.y2*le,De=(Me+je)/2,Le=[{offsetX:me,offsetY:Me},{offsetX:he,offsetY:Me},{offsetX:ye,offsetY:Me},{offsetX:ye,offsetY:De},{offsetX:ye,offsetY:je},{offsetX:he,offsetY:je},{offsetX:me,offsetY:je},{offsetX:me,offsetY:De}];let Ne=[];for(const{offsetX:dt,offsetY:it}of Le)Ne.push(new o.P(oe+N*dt+X*it,ue+q*dt+ae*it));let ht=!1;if(m){const dt=Ne.map((it=>this.projectAndGetPerspectiveRatio(it.x,it.y,f,k,F)));ht=dt.some((it=>!it.isOccluded)),Ne=dt.map((it=>new o.P(it.x,it.y)))}else ht=!0;return{box:o.aA(Ne),allPointsOccluded:!ht}}}class Zi{constructor(e,r,c,f){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?r:-r))):f&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class cs{constructor(e,r,c,f,m){this.text=new Zi(e?e.text:null,r,c,m),this.icon=new Zi(e?e.icon:null,r,f,m)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Cl{constructor(e,r,c){this.text=e,this.icon=r,this.skipFade=c}}class hu{constructor(e,r,c,f,m){this.bucketInstanceId=e,this.featureIndex=r,this.sourceLayerIndex=c,this.bucketIndex=f,this.tileID=m}}class ro{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const r=++this.maxGroupID;this.collisionGroups[e]={ID:r,predicate:c=>c.collisionGroupID===r}}return this.collisionGroups[e]}}function zs(p,e,r,c,f){const{horizontalAlign:m,verticalAlign:x}=o.aH(p);return new o.P(-(m-.5)*e+c[0]*f,-(x-.5)*r+c[1]*f)}class fc{constructor(e,r,c,f,m){this.transform=e.clone(),this.terrain=r,this.collisionIndex=new Hn(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new ro(f),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const r=this.terrain;return r?(c,f)=>r.getElevation(e,c,f):null}getBucketParts(e,r,c,f){const m=c.getBucket(r),x=c.latestFeatureIndex;if(!m||!x||r.id!==m.layerIds[0])return;const T=c.collisionBoxArray,A=m.layers[0].layout,k=m.layers[0].paint,L=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),F=c.tileSize/o.$,N=c.tileID.toUnwrapped(),q=A.get("text-rotation-alignment")==="map",X=o.aC(c,1,this.transform.zoom),ae=o.aD(this.collisionIndex.transform,c,k.get("text-translate"),k.get("text-translate-anchor")),ne=o.aD(this.collisionIndex.transform,c,k.get("icon-translate"),k.get("icon-translate-anchor")),re=Ji(q,this.transform,X);this.retainedQueryData[m.bucketInstanceId]=new hu(m.bucketInstanceId,x,m.sourceLayerIndex,m.index,c.tileID);const oe={bucket:m,layout:A,translationText:ae,translationIcon:ne,unwrappedTileID:N,pitchedLabelPlaneMatrix:re,scale:L,textPixelRatio:F,holdingForFade:c.holdingForSymbolFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:o.an(m.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(m.sourceID)};if(f)for(const ue of m.sortKeyRanges){const{sortKey:le,symbolInstanceStart:me,symbolInstanceEnd:ye}=ue;e.push({sortKey:le,symbolInstanceStart:me,symbolInstanceEnd:ye,parameters:oe})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:m.symbolInstances.length,parameters:oe})}attemptAnchorPlacement(e,r,c,f,m,x,T,A,k,L,F,N,q,X,ae,ne,re,oe,ue,le){const me=o.aE[e.textAnchor],ye=[e.textOffset0,e.textOffset1],he=zs(me,c,f,ye,m),Me=this.collisionIndex.placeCollisionBox(r,N,A,k,L,T,x,ne,F.predicate,ue,he,le);if((!oe||this.collisionIndex.placeCollisionBox(oe,N,A,k,L,T,x,re,F.predicate,ue,he,le).placeable)&&Me.placeable){let je;if(this.prevPlacement&&this.prevPlacement.variableOffsets[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID].text&&(je=this.prevPlacement.variableOffsets[q.crossTileID].anchor),q.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[q.crossTileID]={textOffset:ye,width:c,height:f,anchor:me,textBoxScale:m,prevAnchor:je},this.markUsedJustification(X,me,q,ae),X.allowVerticalPlacement&&(this.markUsedOrientation(X,ae,q),this.placedOrientations[q.crossTileID]=ae),{shift:he,placedGlyphBoxes:Me}}}placeLayerBucketPart(e,r,c){const{bucket:f,layout:m,translationText:x,translationIcon:T,unwrappedTileID:A,pitchedLabelPlaneMatrix:k,textPixelRatio:L,holdingForFade:F,collisionBoxArray:N,partiallyEvaluatedTextSize:q,collisionGroup:X}=e.parameters,ae=m.get("text-optional"),ne=m.get("icon-optional"),re=o.aF(m,"text-overlap","text-allow-overlap"),oe=re==="always",ue=o.aF(m,"icon-overlap","icon-allow-overlap"),le=ue==="always",me=m.get("text-rotation-alignment")==="map",ye=m.get("text-pitch-alignment")==="map",he=m.get("icon-text-fit")!=="none",Me=m.get("symbol-z-order")==="viewport-y",je=oe&&(le||!f.hasIconData()||ne),De=le&&(oe||!f.hasTextData()||ae);!f.collisionArrays&&N&&f.deserializeCollisionBoxes(N);const Le=this.retainedQueryData[f.bucketInstanceId].tileID,Ne=this._getTerrainElevationFunc(Le),ht=this.transform.getFastPathSimpleProjectionMatrix(Le),dt=(it,Rt,ei)=>{var Ii,Vi;if(r[it.crossTileID])return;if(F)return void(this.placements[it.crossTileID]=new Cl(!1,!1,!1));let qi=!1,ua=!1,na=!0,vi=null,xa={box:null,placeable:!1,offscreen:null,occluded:!1},vn={placeable:!1},La=null,Oa=null,Dn=null,Xs=0,mr=0,Ys=0;Rt.textFeatureIndex?Xs=Rt.textFeatureIndex:it.useRuntimeCollisionCircles&&(Xs=it.featureIndex),Rt.verticalTextFeatureIndex&&(mr=Rt.verticalTextFeatureIndex);const Io=Rt.textBox;if(Io){const gr=Ea=>{let Xa=o.ao.horizontal;if(f.allowVerticalPlacement&&!Ea&&this.prevPlacement){const Kn=this.prevPlacement.placedOrientations[it.crossTileID];Kn&&(this.placedOrientations[it.crossTileID]=Kn,Xa=Kn,this.markUsedOrientation(f,Xa,it))}return Xa},Rr=(Ea,Xa)=>{if(f.allowVerticalPlacement&&it.numVerticalGlyphVertices>0&&Rt.verticalTextBox){for(const Kn of f.writingModes)if(Kn===o.ao.vertical?(xa=Xa(),vn=xa):xa=Ea(),xa&&xa.placeable)break}else xa=Ea()},Kr=it.textAnchorOffsetStartIndex,Qn=it.textAnchorOffsetEndIndex;if(Qn===Kr){const Ea=(Xa,Kn)=>{const xn=this.collisionIndex.placeCollisionBox(Xa,re,L,Le,A,ye,me,x,X.predicate,Ne,void 0,ht);return xn&&xn.placeable&&(this.markUsedOrientation(f,Kn,it),this.placedOrientations[it.crossTileID]=Kn),xn};Rr((()=>Ea(Io,o.ao.horizontal)),(()=>{const Xa=Rt.verticalTextBox;return f.allowVerticalPlacement&&it.numVerticalGlyphVertices>0&&Xa?Ea(Xa,o.ao.vertical):{box:null,offscreen:null}})),gr(xa&&xa.placeable)}else{let Ea=o.aE[(Vi=(Ii=this.prevPlacement)===null||Ii===void 0?void 0:Ii.variableOffsets[it.crossTileID])===null||Vi===void 0?void 0:Vi.anchor];const Xa=(xn,Ih,Xl)=>{const Jr=xn.x2-xn.x1,es=xn.y2-xn.y1,Jn=it.textBoxScale,Ws=he&&ue==="never"?Ih:null;let Qs=null,fl=re==="never"?1:2,Ru="never";Ea&&fl++;for(let Ms=0;Ms<fl;Ms++){for(let Du=Kr;Du<Qn;Du++){const Zc=f.textAnchorOffsets.get(Du);if(Ea&&Zc.textAnchor!==Ea)continue;const pl=this.attemptAnchorPlacement(Zc,xn,Jr,es,Jn,me,ye,L,Le,A,X,Ru,it,f,Xl,x,T,Ws,Ne);if(pl&&(Qs=pl.placedGlyphBoxes,Qs&&Qs.placeable))return qi=!0,vi=pl.shift,Qs}Ea?Ea=null:Ru=re}return c&&!Qs&&(Qs={box:this.collisionIndex.placeCollisionBox(Io,"always",L,Le,A,ye,me,x,X.predicate,Ne,void 0,ht).box,offscreen:!1,placeable:!1,occluded:!1}),Qs};Rr((()=>Xa(Io,Rt.iconBox,o.ao.horizontal)),(()=>{const xn=Rt.verticalTextBox;return f.allowVerticalPlacement&&(!xa||!xa.placeable)&&it.numVerticalGlyphVertices>0&&xn?Xa(xn,Rt.verticalIconBox,o.ao.vertical):{box:null,occluded:!0,offscreen:null}})),xa&&(qi=xa.placeable,na=xa.offscreen);const Kn=gr(xa&&xa.placeable);if(!qi&&this.prevPlacement){const xn=this.prevPlacement.variableOffsets[it.crossTileID];xn&&(this.variableOffsets[it.crossTileID]=xn,this.markUsedJustification(f,xn.anchor,it,Kn))}}}if(La=xa,qi=La&&La.placeable,na=La&&La.offscreen,it.useRuntimeCollisionCircles&&it.centerJustifiedTextSymbolIndex>=0){const gr=f.text.placedSymbolArray.get(it.centerJustifiedTextSymbolIndex),Rr=o.ap(f.textSizeData,q,gr),Kr=m.get("text-padding");Oa=this.collisionIndex.placeCollisionCircles(re,gr,f.lineVertexArray,f.glyphOffsetArray,Rr,A,k,c,ye,X.predicate,it.collisionCircleDiameter,Kr,x,Ne),Oa.circles.length&&Oa.collisionDetected&&!c&&o.w("Collisions detected, but collision boxes are not shown"),qi=oe||Oa.circles.length>0&&!Oa.collisionDetected,na=na&&Oa.offscreen}if(Rt.iconFeatureIndex&&(Ys=Rt.iconFeatureIndex),Rt.iconBox){const gr=Rr=>this.collisionIndex.placeCollisionBox(Rr,ue,L,Le,A,ye,me,T,X.predicate,Ne,he&&vi?vi:void 0,ht);vn&&vn.placeable&&Rt.verticalIconBox?(Dn=gr(Rt.verticalIconBox),ua=Dn.placeable):(Dn=gr(Rt.iconBox),ua=Dn.placeable),na=na&&Dn.offscreen}const Hl=ae||it.numHorizontalGlyphVertices===0&&it.numVerticalGlyphVertices===0,dl=ne||it.numIconVertices===0;Hl||dl?dl?Hl||(ua=ua&&qi):qi=ua&&qi:ua=qi=ua&&qi;const Ss=ua&&Dn.placeable;if(qi&&La.placeable&&this.collisionIndex.insertCollisionBox(La.box,re,m.get("text-ignore-placement"),f.bucketInstanceId,vn&&vn.placeable&&mr?mr:Xs,X.ID),Ss&&this.collisionIndex.insertCollisionBox(Dn.box,ue,m.get("icon-ignore-placement"),f.bucketInstanceId,Ys,X.ID),Oa&&qi&&this.collisionIndex.insertCollisionCircles(Oa.circles,re,m.get("text-ignore-placement"),f.bucketInstanceId,Xs,X.ID),c&&this.storeCollisionData(f.bucketInstanceId,ei,Rt,La,Dn,Oa),it.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(f.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[it.crossTileID]=new Cl((qi||je)&&!La?.occluded,(ua||De)&&!Dn?.occluded,na||f.justReloaded),r[it.crossTileID]=!0};if(Me){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const it=f.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Rt=it.length-1;Rt>=0;--Rt){const ei=it[Rt];dt(f.symbolInstances.get(ei),f.collisionArrays[ei],ei)}}else for(let it=e.symbolInstanceStart;it<e.symbolInstanceEnd;it++)dt(f.symbolInstances.get(it),f.collisionArrays[it],it);f.justReloaded=!1}storeCollisionData(e,r,c,f,m,x){if(c.textBox||c.iconBox){let T,A;this.collisionBoxArrays.has(e)?T=this.collisionBoxArrays.get(e):(T=new Map,this.collisionBoxArrays.set(e,T)),T.has(r)?A=T.get(r):(A={text:null,icon:null},T.set(r,A)),c.textBox&&(A.text=f.box),c.iconBox&&(A.icon=m.box)}if(x){let T=this.collisionCircleArrays[e];T===void 0&&(T=this.collisionCircleArrays[e]=[]);for(let A=0;A<x.circles.length;A+=4)T.push(x.circles[A+0]-Ra),T.push(x.circles[A+1]-Ra),T.push(x.circles[A+2]),T.push(x.collisionDetected?1:0)}}markUsedJustification(e,r,c,f){let m;m=f===o.ao.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[o.aG(r)];const x=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];for(const T of x)T>=0&&(e.text.placedSymbolArray.get(T).crossTileID=m>=0&&T!==m?0:c.crossTileID)}markUsedOrientation(e,r,c){const f=r===o.ao.horizontal||r===o.ao.horizontalOnly?r:0,m=r===o.ao.vertical?r:0,x=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];for(const T of x)e.text.placedSymbolArray.get(T).placedOrientation=f;c.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=m)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let c=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const f=r?r.symbolFadeChange(e):1,m=r?r.opacities:{},x=r?r.variableOffsets:{},T=r?r.placedOrientations:{};for(const A in this.placements){const k=this.placements[A],L=m[A];L?(this.opacities[A]=new cs(L,f,k.text,k.icon),c=c||k.text!==L.text.placed||k.icon!==L.icon.placed):(this.opacities[A]=new cs(null,f,k.text,k.icon,k.skipFade),c=c||k.text||k.icon)}for(const A in m){const k=m[A];if(!this.opacities[A]){const L=new cs(k,f,!1,!1);L.isHidden()||(this.opacities[A]=L,c=c||k.text.placed||k.icon.placed)}}for(const A in x)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=x[A]);for(const A in T)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=T[A]);if(r&&r.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");c?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:e)}updateLayerOpacities(e,r){const c={};for(const f of r){const m=f.getBucket(e);m&&f.latestFeatureIndex&&e.id===m.layerIds[0]&&this.updateBucketOpacities(m,f.tileID,c,f.collisionBoxArray)}}updateBucketOpacities(e,r,c,f){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const m=e.layers[0],x=m.layout,T=new cs(null,0,!1,!1,!0),A=x.get("text-allow-overlap"),k=x.get("icon-allow-overlap"),L=m._unevaluatedLayout.hasValue("text-variable-anchor")||m._unevaluatedLayout.hasValue("text-variable-anchor-offset"),F=x.get("text-rotation-alignment")==="map",N=x.get("text-pitch-alignment")==="map",q=x.get("icon-text-fit")!=="none",X=new cs(null,0,A&&(k||!e.hasIconData()||x.get("icon-optional")),k&&(A||!e.hasTextData()||x.get("text-optional")),!0);!e.collisionArrays&&f&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(f);const ae=(re,oe,ue)=>{for(let le=0;le<oe/4;le++)re.opacityVertexArray.emplaceBack(ue);re.hasVisibleVertices=re.hasVisibleVertices||ue!==dn},ne=this.collisionBoxArrays.get(e.bucketInstanceId);for(let re=0;re<e.symbolInstances.length;re++){const oe=e.symbolInstances.get(re),{numHorizontalGlyphVertices:ue,numVerticalGlyphVertices:le,crossTileID:me}=oe;let ye=this.opacities[me];c[me]?ye=T:ye||(ye=X,this.opacities[me]=ye),c[me]=!0;const he=oe.numIconVertices>0,Me=this.placedOrientations[oe.crossTileID],je=Me===o.ao.vertical,De=Me===o.ao.horizontal||Me===o.ao.horizontalOnly;if(ue>0||le>0){const Ne=rh(ye.text);ae(e.text,ue,je?dn:Ne),ae(e.text,le,De?dn:Ne);const ht=ye.text.isHidden();[oe.rightJustifiedTextSymbolIndex,oe.centerJustifiedTextSymbolIndex,oe.leftJustifiedTextSymbolIndex].forEach((Rt=>{Rt>=0&&(e.text.placedSymbolArray.get(Rt).hidden=ht||je?1:0)})),oe.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(oe.verticalPlacedTextSymbolIndex).hidden=ht||De?1:0);const dt=this.variableOffsets[oe.crossTileID];dt&&this.markUsedJustification(e,dt.anchor,oe,Me);const it=this.placedOrientations[oe.crossTileID];it&&(this.markUsedJustification(e,"left",oe,it),this.markUsedOrientation(e,it,oe))}if(he){const Ne=rh(ye.icon),ht=!(q&&oe.verticalPlacedIconSymbolIndex&&je);oe.placedIconSymbolIndex>=0&&(ae(e.icon,oe.numIconVertices,ht?Ne:dn),e.icon.placedSymbolArray.get(oe.placedIconSymbolIndex).hidden=ye.icon.isHidden()),oe.verticalPlacedIconSymbolIndex>=0&&(ae(e.icon,oe.numVerticalIconVertices,ht?dn:Ne),e.icon.placedSymbolArray.get(oe.verticalPlacedIconSymbolIndex).hidden=ye.icon.isHidden())}const Le=ne&&ne.has(re)?ne.get(re):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Ne=e.collisionArrays[re];if(Ne){let ht=new o.P(0,0);if(Ne.textBox||Ne.verticalTextBox){let dt=!0;if(L){const it=this.variableOffsets[me];it?(ht=zs(it.anchor,it.width,it.height,it.textOffset,it.textBoxScale),F&&ht._rotate(N?-this.transform.bearingInRadians:this.transform.bearingInRadians)):dt=!1}if(Ne.textBox||Ne.verticalTextBox){let it;Ne.textBox&&(it=je),Ne.verticalTextBox&&(it=De),Al(e.textCollisionBox.collisionVertexArray,ye.text.placed,!dt||it,Le.text,ht.x,ht.y)}}if(Ne.iconBox||Ne.verticalIconBox){const dt=!!(!De&&Ne.verticalIconBox);let it;Ne.iconBox&&(it=dt),Ne.verticalIconBox&&(it=!dt),Al(e.iconCollisionBox.collisionVertexArray,ye.icon.placed,it,Le.icon,q?ht.x:0,q?ht.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,r){const c=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*c>e}setStale(){this.stale=!0}}function Al(p,e,r,c,f,m){c&&c.length!==0||(c=[0,0,0,0]);const x=c[0]-Ra,T=c[1]-Ra,A=c[2]-Ra,k=c[3]-Ra;p.emplaceBack(e?1:0,r?1:0,f||0,m||0,x,T),p.emplaceBack(e?1:0,r?1:0,f||0,m||0,A,T),p.emplaceBack(e?1:0,r?1:0,f||0,m||0,A,k),p.emplaceBack(e?1:0,r?1:0,f||0,m||0,x,k)}const us=Math.pow(2,25),bn=Math.pow(2,24),ah=Math.pow(2,17),yf=Math.pow(2,16),nh=Math.pow(2,9),ud=Math.pow(2,8),pc=Math.pow(2,1);function rh(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const e=p.placed?1:0,r=Math.floor(127*p.opacity);return r*us+e*bn+r*ah+e*yf+r*nh+e*ud+r*pc+e}const dn=0;class mc{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,r,c,f,m){const x=this._bucketParts;for(;this._currentTileIndex<e.length;)if(r.getBucketParts(x,f,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,m())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort(((T,A)=>T.sortKey-A.sortKey)));this._currentPartIndex<x.length;)if(r.placeLayerBucketPart(x[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,m())return!0;return!1}}class sh{constructor(e,r,c,f,m,x,T,A){this.placement=new fc(e,r,x,T,A),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(e,r,c){const f=W.now(),m=()=>!this._forceFullPlacement&&W.now()-f>2;for(;this._currentPlacementIndex>=0;){const x=r[e[this._currentPlacementIndex]],T=this.placement.collisionIndex.transform.zoom;if(x.type==="symbol"&&(!x.minzoom||x.minzoom<=T)&&(!x.maxzoom||x.maxzoom>T)){if(this._inProgressLayer||(this._inProgressLayer=new mc(x)),this._inProgressLayer.continuePlacement(c[x.source],this.placement,this._showCollisionBoxes,x,m))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Is=512/o.$/2;class so{constructor(e,r,c){this.tileID=e,this.bucketInstanceId=c,this._symbolsByKey={};const f=new Map;for(let m=0;m<r.length;m++){const x=r.get(m),T=x.key,A=f.get(T);A?A.push(x):f.set(T,[x])}for(const[m,x]of f){const T={positions:x.map((A=>({x:Math.floor(A.anchorX*Is),y:Math.floor(A.anchorY*Is)}))),crossTileIDs:x.map((A=>A.crossTileID))};if(T.positions.length>128){const A=new o.aI(T.positions.length,16,Uint16Array);for(const{x:k,y:L}of T.positions)A.add(k,L);A.finish(),delete T.positions,T.index=A}this._symbolsByKey[m]=T}}getScaledCoordinates(e,r){const{x:c,y:f,z:m}=this.tileID.canonical,{x,y:T,z:A}=r.canonical,k=Is/Math.pow(2,A-m),L=(T*o.$+e.anchorY)*k,F=f*o.$*Is;return{x:Math.floor((x*o.$+e.anchorX)*k-c*o.$*Is),y:Math.floor(L-F)}}findMatches(e,r,c){const f=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z);for(let m=0;m<e.length;m++){const x=e.get(m);if(x.crossTileID)continue;const T=this._symbolsByKey[x.key];if(!T)continue;const A=this.getScaledCoordinates(x,r);if(T.index){const k=T.index.range(A.x-f,A.y-f,A.x+f,A.y+f).sort();for(const L of k){const F=T.crossTileIDs[L];if(!c[F]){c[F]=!0,x.crossTileID=F;break}}}else if(T.positions)for(let k=0;k<T.positions.length;k++){const L=T.positions[k],F=T.crossTileIDs[k];if(Math.abs(L.x-A.x)<=f&&Math.abs(L.y-A.y)<=f&&!c[F]){c[F]=!0,x.crossTileID=F;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:e})=>e))}}class hd{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Pl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const r=Math.round((e-this.lng)/360);if(r!==0)for(const c in this.indexes){const f=this.indexes[c],m={};for(const x in f){const T=f[x];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+r),m[T.tileID.key]=T}this.indexes[c]=m}this.lng=e}addBucket(e,r,c){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let m=0;m<r.symbolInstances.length;m++)r.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const f=this.usedCrossTileIDs[e.overscaledZ];for(const m in this.indexes){const x=this.indexes[m];if(Number(m)>e.overscaledZ)for(const T in x){const A=x[T];A.tileID.isChildOf(e)&&A.findMatches(r.symbolInstances,e,f)}else{const T=x[e.scaledTo(Number(m)).key];T&&T.findMatches(r.symbolInstances,e,f)}}for(let m=0;m<r.symbolInstances.length;m++){const x=r.symbolInstances.get(m);x.crossTileID||(x.crossTileID=c.generate(),f[x.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new so(e,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(e,r){for(const c of r.getCrossTileIDsLists())for(const f of c)delete this.usedCrossTileIDs[e][f]}removeStaleBuckets(e){let r=!1;for(const c in this.indexes){const f=this.indexes[c];for(const m in f)e[f[m].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,f[m]),delete f[m],r=!0)}return r}}class hs{constructor(){this.layerIndexes={},this.crossTileIDs=new hd,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,r,c){let f=this.layerIndexes[e.id];f===void 0&&(f=this.layerIndexes[e.id]=new Pl);let m=!1;const x={};f.handleWrapJump(c);for(const T of r){const A=T.getBucket(e);A&&e.id===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),f.addBucket(T.tileID,A,this.crossTileIDs)&&(m=!0),x[A.bucketInstanceId]=!0)}return f.removeStaleBuckets(x)&&(m=!0),m}pruneUnusedLayers(e){const r={};e.forEach((c=>{r[c]=!0}));for(const c in this.layerIndexes)r[c]||delete this.layerIndexes[c]}}var oh="void main() {fragColor=vec4(1.0);}";const zn={prelude:Mi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Mi("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Mi("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Mi(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Mi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Mi(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Mi(oh,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Mi(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Mi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Mi("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Mi("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Mi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Mi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Mi(oh,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Mi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Mi(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Mi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Mi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Mi(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Mi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Mi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Mi(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Mi(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Mi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Mi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Mi(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:Mi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:Mi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Mi(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Mi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Mi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Mi("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Mi("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Mi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Mi("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Mi(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Mi("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Mi(p,e){const r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,c=e.match(/in ([\w]+) ([\w]+)/g),f=p.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),m=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=m?m.concat(f):f,T={};return{fragmentSource:p=p.replace(r,((A,k,L,F,N)=>(T[N]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_${N}
in ${L} ${F} ${N};
#else
uniform ${L} ${F} u_${N};
#endif
`:`
#ifdef HAS_UNIFORM_u_${N}
    ${L} ${F} ${N} = u_${N};
#endif
`))),vertexSource:e=e.replace(r,((A,k,L,F,N)=>{const q=F==="float"?"vec2":"vec4",X=N.match(/color/)?"color":q;return T[N]?k==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
in ${L} ${q} a_${N};
out ${L} ${F} ${N};
#else
uniform ${L} ${F} u_${N};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = a_${N};
#else
    ${L} ${F} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = unpack_mix_${X}(a_${N}, u_${N}_t);
#else
    ${L} ${F} ${N} = u_${N};
#endif
`:k==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
in ${L} ${q} a_${N};
#else
uniform ${L} ${F} u_${N};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${L} ${F} ${N} = a_${N};
#else
    ${L} ${F} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${L} ${F} ${N} = unpack_mix_${X}(a_${N}, u_${N}_t);
#else
    ${L} ${F} ${N} = u_${N};
#endif
`})),staticAttributes:c,staticUniforms:x}}class oo{constructor(e,r,c){this.vertexBuffer=e,this.indexBuffer=r,this.segments=c}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Bn=o.aJ([{name:"a_pos",type:"Int16",components:2}]);const Uo="#define PROJECTION_MERCATOR",hi="mercator";class nr{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return hi}get shaderDefine(){return Uo}get shaderPreludeCode(){return zn.projectionMercator}get vertexShaderPreludeCode(){return zn.projectionMercator.vertexSource}get subdivisionGranularity(){return o.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,r,c,f,m){if(this._cachedMesh)return this._cachedMesh;const x=new o.aL;x.emplaceBack(0,0),x.emplaceBack(o.$,0),x.emplaceBack(0,o.$),x.emplaceBack(o.$,o.$);const T=e.createVertexBuffer(x,Bn.members),A=o.aM.simpleSegment(0,0,4,2),k=new o.aN;k.emplaceBack(1,0,2),k.emplaceBack(1,2,3);const L=e.createIndexBuffer(k);return this._cachedMesh=new oo(T,L,A),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class Vo{constructor(e=0,r=0,c=0,f=0){if(isNaN(e)||e<0||isNaN(r)||r<0||isNaN(c)||c<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=r,this.left=c,this.right=f}interpolate(e,r,c){return r.top!=null&&e.top!=null&&(this.top=o.C.number(e.top,r.top,c)),r.bottom!=null&&e.bottom!=null&&(this.bottom=o.C.number(e.bottom,r.bottom,c)),r.left!=null&&e.left!=null&&(this.left=o.C.number(e.left,r.left,c)),r.right!=null&&e.right!=null&&(this.right=o.C.number(e.right,r.right,c)),this}getCenter(e,r){const c=o.ah((this.left+e-this.right)/2,0,e),f=o.ah((this.top+r-this.bottom)/2,0,r);return new o.P(c,f)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Vo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function lo(p,e){if(!p.renderWorldCopies||p.lngRange)return;const r=e.lng-p.center.lng;e.lng+=r>180?-360:r<-180?360:0}function en(p){return Math.max(0,Math.floor(p))}class Da{constructor(e,r,c,f,m,x){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=x===void 0||!!x,this._minZoom=r||0,this._maxZoom=c||22,this._minPitch=f??0,this._maxPitch=m??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new o.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=en(this._zoom),this._scale=o.af(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Vo,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,r,c){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=en(this._zoom),this._scale=o.af(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new Vo(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!c&&e.autoCalculateNearFarZ,r&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const r=o.aO(e,-180,180)*Math.PI/180;var c,f,m,x,T,A,k,L,F;this._bearingInRadians!==r&&(this._unmodified=!1,this._bearingInRadians=r,this._calcMatrices(),this._rotationMatrix=j(),c=this._rotationMatrix,m=-this._bearingInRadians,x=(f=this._rotationMatrix)[0],T=f[1],A=f[2],k=f[3],L=Math.sin(m),F=Math.cos(m),c[0]=x*F+A*L,c[1]=T*F+k*L,c[2]=x*-L+A*F,c[3]=T*-L+k*F)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const r=o.ah(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==r&&(this._unmodified=!1,this._pitchInRadians=r,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const r=e/180*Math.PI;this._rollInRadians!==r&&(this._unmodified=!1,this._rollInRadians=r,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return o.aP(this._fovInRadians)}setFov(e){e=o.ah(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=o.ae(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const r=this.getConstrained(this._center,e).zoom;this._zoom!==r&&(this._unmodified=!1,this._zoom=r,this._tileZoom=Math.max(0,Math.floor(r)),this._scale=o.af(r),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,r){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=r,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,r,c){this._unmodified=!1,this._edgeInsets.interpolate(e,r,c),this._constrain(),this._calcMatrices()}resize(e,r,c=!0){this._width=e,this._height=r,c&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new di([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-o.ai,o.ai])}getConstrained(e,r){return this._callbacks.getConstrained(e,r)}getCameraQueryGeometry(e,r){if(r.length===1)return[r[0],e];{const{minX:c,minY:f,maxX:m,maxY:x}=o.a2.fromPoints(r).extend(e);return[new o.P(c,f),new o.P(m,f),new o.P(m,x),new o.P(c,x),new o.P(c,f)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:r,zoom:c}=this.getConstrained(this.center,this.zoom);this.setCenter(r),this.setZoom(c),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=o.ag(new Float64Array(16));o.N(e,e,[this._width/2,-this._height/2,1]),o.M(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=o.ag(new Float64Array(16)),o.N(e,e,[1,-1,1]),o.M(e,e,[-1,-1,0]),o.N(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,r,c,f){const m=c!==void 0?c:this.bearing,x=f=f!==void 0?f:this.pitch,T=o.a1.fromLngLat(e,r),A=-Math.cos(o.ae(x)),k=Math.sin(o.ae(x)),L=k*Math.sin(o.ae(m)),F=-k*Math.cos(o.ae(m));let N=this.elevation;const q=r-N;let X;A*q>=0||Math.abs(A)<.1?(X=1e4,N=r+X*A):X=-q/A;let ae,ne,re=o.aQ(1,T.y),oe=0;do{if(oe+=1,oe>10)break;ne=X/re,ae=new o.a1(T.x+L*ne,T.y+F*ne),re=1/ae.meterInMercatorCoordinateUnits()}while(Math.abs(X-ne*re)>1e-12);return{center:ae.toLngLat(),elevation:N,zoom:o.ak(this.height/2/Math.tan(this.fovInRadians/2)/ne/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const r=o.aj(1,this.center.lat)*this.worldSize,c=this.cameraToCenterDistance/r,f=o.a1.fromLngLat(this.center,this.elevation),m=$e(this.center,this.elevation,this.pitch,this.bearing,c);this._elevation=e;const x=this.calculateCenterFromCameraLngLatAlt(m.toLngLat(),o.aQ(m.z,f.y),this.bearing,this.pitch);this._elevation=x.elevation,this._center=x.center,this.setZoom(x.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=o.aj(1,this.center.lat)*this.worldSize;return $e(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const r=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/r,e.canonical.y/r,1/r/o.$,1/r/o.$]}}class tn{constructor(e,r){this.min=e,this.max=r,this.center=o.aR([],o.aS([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],c=o.aT(this.min),f=o.aT(this.max);for(let m=0;m<r.length;m++)c[m]=r[m]?this.min[m]:this.center[m],f[m]=r[m]?this.center[m]:this.max[m];return f[2]=this.max[2],new tn(c,f)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let r=!0;for(let c=0;c<e.planes.length;c++){const f=this.intersectsPlane(e.planes[c]);if(f===0)return 0;f===1&&(r=!1)}return r?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let r=e[3],c=e[3];for(let f=0;f<3;f++)e[f]>0?(r+=e[f]*this.min[f],c+=e[f]*this.max[f]):(c+=e[f]*this.min[f],r+=e[f]*this.max[f]);return r>=0?2:c<0?0:1}}class an{distanceToTile2d(e,r,c,f){const m=f.distanceX([e,r]),x=f.distanceY([e,r]);return Math.hypot(m,x)}getWrap(e,r,c){return c}getTileBoundingVolume(e,r,c,f){var m,x;let T=0,A=0;if(f?.terrain){const L=new o.Z(e.z,r,e.z,e.x,e.y),F=f.terrain.getMinMaxElevation(L);T=(m=F.minElevation)!==null&&m!==void 0?m:Math.min(0,c),A=(x=F.maxElevation)!==null&&x!==void 0?x:Math.max(0,c)}const k=1<<e.z;return new tn([r+e.x/k,e.y/k,T],[r+(e.x+1)/k,(e.y+1)/k,A])}allowVariableZoom(e,r){const c=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,f=o.ah(78.5-c/2,0,60);return!!r.terrain||e.pitch>f}allowWorldCopies(){return!0}prepareNextFrame(){}}class sa{constructor(e,r,c){this.points=e,this.planes=r,this.aabb=c}static fromInvProjectionMatrix(e,r=1,c=0,f,m){const x=m?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],T=Math.pow(2,c),A=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((N=>(function(q,X,ae,ne){const re=o.aw([],q,X),oe=1/re[3]/ae*ne;return o.aY(re,re,[oe,oe,1/re[3],oe])})(N,e,r,T)));f&&(function(N,q,X,ae){const ne=ae?4:0,re=ae?0:4;let oe=0;const ue=[],le=[];for(let he=0;he<4;he++){const Me=o.aU([],N[he+re],N[he+ne]),je=o.aZ(Me);o.aR(Me,Me,1/je),ue.push(je),le.push(Me)}for(let he=0;he<4;he++){const Me=o.a_(N[he+ne],le[he],X);oe=Me!==null&&Me>=0?Math.max(oe,Me):Math.max(oe,ue[he])}const me=(function(he,Me){const je=o.aU([],he[Me[0]],he[Me[1]]),De=o.aU([],he[Me[2]],he[Me[1]]),Le=[0,0,0,0];return o.aV(Le,o.aW([],je,De)),Le[3]=-o.aX(Le,he[Me[0]]),Le})(N,q),ye=(function(he,Me){const je=o.a$(he),De=o.b0([],he,1/je),Le=o.aU([],Me,o.aR([],De,o.aX(Me,De))),Ne=o.a$(Le);if(Ne>0){const ht=Math.sqrt(1-De[3]*De[3]),dt=o.aR([],De,-De[3]),it=o.aS([],dt,o.aR([],Le,ht/Ne));return o.b1(Me,it)}return null})(X,me);if(ye!==null){const he=ye/o.aX(le[0],me);oe=Math.min(oe,he)}for(let he=0;he<4;he++){const Me=Math.min(oe,ue[he]);N[he+re]=[N[he+ne][0]+le[he][0]*Me,N[he+ne][1]+le[he][1]*Me,N[he+ne][2]+le[he][2]*Me,1]}})(A,x[0],f,m);const k=x.map((N=>{const q=o.aU([],A[N[0]],A[N[1]]),X=o.aU([],A[N[2]],A[N[1]]),ae=o.aV([],o.aW([],q,X)),ne=-o.aX(ae,A[N[1]]);return ae.concat(ne)})),L=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],F=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const N of A)for(let q=0;q<3;q++)L[q]=Math.min(L[q],N[q]),F[q]=Math.max(F[q],N[q]);return new sa(A,k,new tn(L,F))}}class ds{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,c){return this._helper.interpolatePadding(e,r,c)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r,c=!0){this._helper.resize(e,r,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,r){}constructor(e,r,c,f,m){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Da({calcMatrices:()=>{this._calcMatrices()},getConstrained:(x,T)=>this.getConstrained(x,T)},e,r,c,f,m),this._coveringTilesDetailsProvider=new an}clone(){const e=new ds;return e.apply(this),e}apply(e,r,c){this._helper.apply(e,r,c)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const r=[new o.b2(0,e)];if(this._helper._renderWorldCopies){const c=this.screenPointToMercatorCoordinate(new o.P(0,0)),f=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,0)),m=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,this._helper._height)),x=this.screenPointToMercatorCoordinate(new o.P(0,this._helper._height)),T=Math.floor(Math.min(c.x,f.x,m.x,x.x)),A=Math.floor(Math.max(c.x,f.x,m.x,x.x)),k=1;for(let L=T-k;L<=A+k;L++)L!==0&&r.push(new o.b2(L,e))}return r}getCameraFrustum(){return sa.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const r=this.screenPointToLocation(this.centerPoint,e),c=e?e.getElevationForLngLatZoom(r,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(c)}setLocationAtPoint(e,r){const c=o.aj(this.elevation,this.center.lat),f=this.screenPointToMercatorCoordinateAtZ(r,c),m=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,c),x=o.a1.fromLngLat(e),T=new o.a1(x.x-(f.x-m.x),x.y-(f.y-m.y));this.setCenter(T?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,r){return r?this.coordinatePoint(o.a1.fromLngLat(e),r.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(o.a1.fromLngLat(e))}screenPointToLocation(e,r){var c;return(c=this.screenPointToMercatorCoordinate(e,r))===null||c===void 0?void 0:c.toLngLat()}screenPointToMercatorCoordinate(e,r){if(r){const c=r.pointCoordinate(e);if(c!=null)return c}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,r){const c=r||0,f=[e.x,e.y,0,1],m=[e.x,e.y,1,1];o.aw(f,f,this._pixelMatrixInverse),o.aw(m,m,this._pixelMatrixInverse);const x=f[3],T=m[3],A=f[1]/x,k=m[1]/T,L=f[2]/x,F=m[2]/T,N=L===F?0:(c-L)/(F-L);return new o.a1(o.C.number(f[0]/x,m[0]/T,N)/this.worldSize,o.C.number(A,k,N)/this.worldSize,c)}coordinatePoint(e,r=0,c=this._pixelMatrix){const f=[e.x*this.worldSize,e.y*this.worldSize,r,1];return o.aw(f,f,c),new o.P(f[0]/f[3],f[1]/f[3])}getBounds(){const e=Math.max(0,this._helper._height/2-Ie(this));return new di().extend(this.screenPointToLocation(new o.P(0,e))).extend(this.screenPointToLocation(new o.P(this._helper._width,e))).extend(this.screenPointToLocation(new o.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new o.P(0,this._helper._height)))}isPointOnMapSurface(e,r){return r?r.pointCoordinate(e)!=null:e.y>this.height/2-Ie(this)}calculatePosMatrix(e,r=!1,c){var f;const m=(f=e.key)!==null&&f!==void 0?f:o.b3(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),x=r?this._alignedPosMatrixCache:this._posMatrixCache;if(x.has(m)){const k=x.get(m);return c?k.f32:k.f64}const T=Ce(e,this.worldSize);o.O(T,r?this._alignedProjMatrix:this._viewProjMatrix,T);const A={f64:T,f32:new Float32Array(T)};return x.set(m,A),c?A.f32:A.f64}calculateFogMatrix(e){const r=e.key,c=this._fogMatrixCacheF32;if(c.has(r))return c.get(r);const f=Ce(e,this.worldSize);return o.O(f,this._fogMatrix,f),c.set(r,new Float32Array(f)),c.get(r)}getConstrained(e,r){r=o.ah(+r,this.minZoom,this.maxZoom);const c={center:new o.S(e.lng,e.lat),zoom:r};let f=this._helper._lngRange;if(!this._helper._renderWorldCopies&&f===null){const ue=179.9999999999;f=[-ue,ue]}const m=this.tileSize*o.af(c.zoom);let x=0,T=m,A=0,k=m,L=0,F=0;const{x:N,y:q}=this.size;if(this._helper._latRange){const ue=this._helper._latRange;x=o.U(ue[1])*m,T=o.U(ue[0])*m,T-x<q&&(L=q/(T-x))}f&&(A=o.aO(o.V(f[0])*m,0,m),k=o.aO(o.V(f[1])*m,0,m),k<A&&(k+=m),k-A<N&&(F=N/(k-A)));const{x:X,y:ae}=fe(m,e);let ne,re;const oe=Math.max(F||0,L||0);if(oe){const ue=new o.P(F?(k+A)/2:X,L?(T+x)/2:ae);return c.center=be(m,ue).wrap(),c.zoom+=o.ak(oe),c}if(this._helper._latRange){const ue=q/2;ae-ue<x&&(re=x+ue),ae+ue>T&&(re=T-ue)}if(f){const ue=(A+k)/2;let le=X;this._helper._renderWorldCopies&&(le=o.aO(X,ue-m/2,ue+m/2));const me=N/2;le-me<A&&(ne=A+me),le+me>k&&(ne=k-me)}if(ne!==void 0||re!==void 0){const ue=new o.P(ne??X,re??ae);c.center=be(m,ue).wrap()}return c}calculateCenterFromCameraLngLatAlt(e,r,c,f){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,c,f)}_calculateNearFarZIfNeeded(e,r,c){if(!this._helper.autoCalculateNearFarZ)return;const f=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),m=e-f*this._helper._pixelPerMeter/Math.cos(r),x=f<0?m:e,T=Math.PI/2+this.pitchInRadians,A=o.ae(this.fov)*(Math.abs(Math.cos(o.ae(this.roll)))*this.height+Math.abs(Math.sin(o.ae(this.roll)))*this.width)/this.height*(.5+c.y/this.height),k=Math.sin(A)*x/Math.sin(o.ah(Math.PI-T-A,.01,Math.PI-.01)),L=Ie(this),F=Math.atan(L/this._helper.cameraToCenterDistance),N=o.ae(.75),q=F>N?2*F*(.5+c.y/(2*L)):N,X=Math.sin(q)*x/Math.sin(o.ah(Math.PI-T-q,.01,Math.PI-.01)),ae=Math.min(k,X);this._helper._farZ=1.01*(Math.cos(Math.PI/2-r)*ae+x),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,r=fe(this.worldSize,this.center),c=r.x,f=r.y;this._helper._pixelPerMeter=o.aj(1,this.center.lat)*this.worldSize;const m=o.ae(Math.min(this.pitch,ce)),x=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(m));let T;this._calculateNearFarZIfNeeded(x,m,e),T=new Float64Array(16),o.b4(T,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),o.aq(this._invProjMatrix,T),T[8]=2*-e.x/this._helper._width,T[9]=2*e.y/this._helper._height,this._projectionMatrix=o.b5(T),o.N(T,T,[1,-1,1]),o.M(T,T,[0,0,-this._helper.cameraToCenterDistance]),o.b6(T,T,-this.rollInRadians),o.b7(T,T,this.pitchInRadians),o.b6(T,T,-this.bearingInRadians),o.M(T,T,[-c,-f,0]),this._mercatorMatrix=o.N([],T,[this.worldSize,this.worldSize,this.worldSize]),o.N(T,T,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=o.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,T),o.M(T,T,[0,0,-this.elevation]),this._viewProjMatrix=T,this._invViewProjMatrix=o.aq([],T);const A=[0,0,-1,1];o.aw(A,A,this._invViewProjMatrix),this._cameraPosition=[A[0]/A[3],A[1]/A[3],A[2]/A[3]],this._fogMatrix=new Float64Array(16),o.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,x,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,o.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),o.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),o.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),o.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),o.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),o.M(this._fogMatrix,this._fogMatrix,[-c,-f,0]),o.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),o.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=o.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,T);const k=this._helper._width%2/2,L=this._helper._height%2/2,F=Math.cos(this.bearingInRadians),N=Math.sin(-this.bearingInRadians),q=c-Math.round(c)+F*k+N*L,X=f-Math.round(f)+F*L+N*k,ae=new Float64Array(T);if(o.M(ae,ae,[q>.5?q-1:q,X>.5?X-1:X,0]),this._alignedProjMatrix=ae,T=o.aq(new Float64Array(16),this._pixelMatrix),!T)throw new Error("failed to invert matrix");this._pixelMatrixInverse=T,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new o.P(0,0)),r=[e.x*this.worldSize,e.y*this.worldSize,0,1];return o.aw(r,r,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=o.aj(1,this.center.lat)*this.worldSize;return $e(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,r){const c=o.a1.fromLngLat(e),f=[c.x*this.worldSize,c.y*this.worldSize,r,1];return o.aw(f,f,this._viewProjMatrix),f[2]/f[3]}getProjectionData(e){const{overscaledTileID:r,aligned:c,applyTerrainMatrix:f}=e,m=this._helper.getMercatorTileCoordinates(r),x=r?this.calculatePosMatrix(r,c,!0):null;let T;return T=r&&r.terrainRttPosMatrix32f&&f?r.terrainRttPosMatrix32f:x||o.b8(),{mainMatrix:T,tileMercatorCoords:m,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:T}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,r,c){return 1}transformLightDirection(e){return o.aT(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,r,c,f){const m=this.calculatePosMatrix(c);let x;f?(x=[e,r,f(e,r),1],o.aw(x,x,m)):(x=[e,r,0,1],Ma(x,x,m));const T=x[3];return{point:new o.P(x[0]/T,x[1]/T),signedDistanceFromCamera:T,isOccluded:!1}}populateCache(e){for(const r of e)this.calculatePosMatrix(r)}getMatrixForModel(e,r){const c=o.a1.fromLngLat(e,r),f=c.meterInMercatorCoordinateUnits(),m=o.b9();return o.M(m,m,[c.x,c.y,c.z]),o.b6(m,m,Math.PI),o.b7(m,m,Math.PI/2),o.N(m,m,[-f,f,f]),m}getProjectionDataForCustomLayer(e=!0){const r=new o.Z(0,0,0,0,0),c=this.getProjectionData({overscaledTileID:r,applyGlobeMatrix:e}),f=Ce(r,this.worldSize);o.O(f,this._viewProjMatrix,f),c.tileMercatorCoords=[0,0,1,1];const m=[o.$,o.$,this.worldSize/this._helper.pixelsPerMeter],x=o.ba();return o.N(x,f,m),c.fallbackMatrix=x,c.mainMatrix=x,c}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function Ia(){o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Nn(p){if(p.useSlerp)if(p.k<1){const e=o.bb(p.startEulerAngles.roll,p.startEulerAngles.pitch,p.startEulerAngles.bearing),r=o.bb(p.endEulerAngles.roll,p.endEulerAngles.pitch,p.endEulerAngles.bearing),c=new Float64Array(4);o.bc(c,e,r,p.k);const f=o.bd(c);p.tr.setRoll(f.roll),p.tr.setPitch(f.pitch),p.tr.setBearing(f.bearing)}else p.tr.setRoll(p.endEulerAngles.roll),p.tr.setPitch(p.endEulerAngles.pitch),p.tr.setBearing(p.endEulerAngles.bearing);else p.tr.setRoll(o.C.number(p.startEulerAngles.roll,p.endEulerAngles.roll,p.k)),p.tr.setPitch(o.C.number(p.startEulerAngles.pitch,p.endEulerAngles.pitch,p.k)),p.tr.setBearing(o.C.number(p.startEulerAngles.bearing,p.endEulerAngles.bearing,p.k))}function fn(p,e,r,c,f){const m=f.padding,x=fe(f.worldSize,r.getNorthWest()),T=fe(f.worldSize,r.getNorthEast()),A=fe(f.worldSize,r.getSouthEast()),k=fe(f.worldSize,r.getSouthWest()),L=o.ae(-c),F=x.rotate(L),N=T.rotate(L),q=A.rotate(L),X=k.rotate(L),ae=new o.P(Math.max(F.x,N.x,X.x,q.x),Math.max(F.y,N.y,X.y,q.y)),ne=new o.P(Math.min(F.x,N.x,X.x,q.x),Math.min(F.y,N.y,X.y,q.y)),re=ae.sub(ne),oe=(f.width-(m.left+m.right+e.left+e.right))/re.x,ue=(f.height-(m.top+m.bottom+e.top+e.bottom))/re.y;if(ue<0||oe<0)return void Ia();const le=Math.min(o.ak(f.scale*Math.min(oe,ue)),p.maxZoom),me=o.P.convert(p.offset),ye=new o.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(o.ae(c)),he=me.add(ye).mult(f.scale/o.af(le));return{center:be(f.worldSize,x.add(A).div(2).sub(he)),zoom:le,bearing:c}}class Tr{get useGlobeControls(){return!1}handlePanInertia(e,r){const c=e.mag(),f=Math.abs(Ie(r));return{easingOffset:e.mult(Math.min(.75*f/c,1)),easingCenter:r.center}}handleMapControlsRollPitchBearingZoom(e,r){e.bearingDelta&&r.setBearing(r.bearing+e.bearingDelta),e.pitchDelta&&r.setPitch(r.pitch+e.pitchDelta),e.rollDelta&&r.setRoll(r.roll+e.rollDelta),e.zoomDelta&&r.setZoom(r.zoom+e.zoomDelta)}handleMapControlsPan(e,r,c){e.around.distSqr(r.centerPoint)<.01||r.setLocationAtPoint(c,e.around)}cameraForBoxAndBearing(e,r,c,f,m){return fn(e,r,c,f,m)}handleJumpToCenterZoom(e,r){e.zoom!==(r.zoom!==void 0?+r.zoom:e.zoom)&&e.setZoom(+r.zoom),r.center!==void 0&&e.setCenter(o.S.convert(r.center))}handleEaseTo(e,r){const c=e.zoom,f=e.padding,m={roll:e.roll,pitch:e.pitch,bearing:e.bearing},x={roll:r.roll===void 0?e.roll:r.roll,pitch:r.pitch===void 0?e.pitch:r.pitch,bearing:r.bearing===void 0?e.bearing:r.bearing},T=r.zoom!==void 0,A=!e.isPaddingEqual(r.padding);let k=!1;const L=T?+r.zoom:e.zoom;let F=e.centerPoint.add(r.offsetAsPoint);const N=e.screenPointToLocation(F),{center:q,zoom:X}=e.getConstrained(o.S.convert(r.center||N),L??c);lo(e,q);const ae=fe(e.worldSize,N),ne=fe(e.worldSize,q).sub(ae),re=o.af(X-c);return k=X!==c,{easeFunc:oe=>{if(k&&e.setZoom(o.C.number(c,X,oe)),o.be(m,x)||Nn({startEulerAngles:m,endEulerAngles:x,tr:e,k:oe,useSlerp:m.roll!=x.roll}),A&&(e.interpolatePadding(f,r.padding,oe),F=e.centerPoint.add(r.offsetAsPoint)),r.around)e.setLocationAtPoint(r.around,r.aroundPoint);else{const ue=o.af(e.zoom-c),le=X>c?Math.min(2,re):Math.max(.5,re),me=Math.pow(le,1-oe),ye=be(e.worldSize,ae.add(ne.mult(oe*me)).mult(ue));e.setLocationAtPoint(e.renderWorldCopies?ye.wrap():ye,F)}},isZooming:k,elevationCenter:q}}handleFlyTo(e,r){const c=r.zoom!==void 0,f=e.zoom,m=e.getConstrained(o.S.convert(r.center||r.locationAtOffset),c?+r.zoom:f),x=m.center,T=m.zoom;lo(e,x);const A=fe(e.worldSize,r.locationAtOffset),k=fe(e.worldSize,x).sub(A),L=k.mag(),F=o.af(T-f);let N;if(r.minZoom!==void 0){const q=Math.min(+r.minZoom,f,T),X=e.getConstrained(x,q).zoom;N=o.af(X-f)}return{easeFunc:(q,X,ae,ne)=>{e.setZoom(q===1?T:f+o.ak(X));const re=q===1?x:be(e.worldSize,A.add(k.mult(ae)).mult(X));e.setLocationAtPoint(e.renderWorldCopies?re.wrap():re,ne)},scaleOfZoom:F,targetCenter:x,scaleOfMinZoom:N,pixelPathLength:L}}}class $i{constructor(e,r,c){this.blendFunction=e,this.blendColor=r,this.mask=c}}$i.Replace=[1,0],$i.disabled=new $i($i.Replace,o.bf.transparent,[!1,!1,!1,!1]),$i.unblended=new $i($i.Replace,o.bf.transparent,[!0,!0,!0,!0]),$i.alphaBlended=new $i([1,771],o.bf.transparent,[!0,!0,!0,!0]);const da=2305;class yi{constructor(e,r,c){this.enable=e,this.mode=r,this.frontFace=c}}yi.disabled=new yi(!1,1029,da),yi.backCCW=new yi(!0,1029,da),yi.frontCCW=new yi(!0,1028,da);class Yt{constructor(e,r,c){this.func=e,this.mask=r,this.range=c}}Yt.ReadOnly=!1,Yt.ReadWrite=!0,Yt.disabled=new Yt(519,Yt.ReadOnly,[0,1]);const Rs=7680;class ci{constructor(e,r,c,f,m,x){this.test=e,this.ref=r,this.mask=c,this.fail=f,this.depthFail=m,this.pass=x}}ci.disabled=new ci({func:519,mask:0},0,0,Rs,Rs,Rs);const wn=new WeakMap;function ka(p){var e;if(wn.has(p))return wn.get(p);{const r=(e=p.getParameter(p.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return wn.set(p,r),r}}class zl{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const r=e.context,c=r.gl;this._texFormat=c.RGBA,this._texType=c.UNSIGNED_BYTE;const f=new o.aL;f.emplaceBack(-1,-1),f.emplaceBack(2,-1),f.emplaceBack(-1,2);const m=new o.aN;m.emplaceBack(0,1,2),this._fullscreenTriangle=new oo(r.createVertexBuffer(f,Bn.members),r.createIndexBuffer(m),o.aM.simpleSegment(0,0,f.length,m.length)),this._resultBuffer=new Uint8Array(4),r.activeTexture.set(c.TEXTURE1);const x=c.createTexture();c.bindTexture(c.TEXTURE_2D,x),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texImage2D(c.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=r.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(x),ka(c)&&(this._pbo=c.createBuffer(),c.bindBuffer(c.PIXEL_PACK_BUFFER,this._pbo),c.bufferData(c.PIXEL_PACK_BUFFER,4,c.STREAM_READ),c.bindBuffer(c.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,r){const c=this._updateCount;return this._readbackQueue?c>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():c>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,r),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,r=e.gl;e.activeTexture.set(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,r){const c=this._cachedRenderContext.context,f=c.gl;if(this._bindFramebuffer(),c.viewport.set([0,0,this._texWidth,this._texHeight]),c.clear({color:o.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(c,f.TRIANGLES,Yt.disabled,ci.disabled,$i.unblended,yi.disabled,((m,x)=>({u_input:m,u_output_expected:x}))(e,r),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&ka(f)){f.bindBuffer(f.PIXEL_PACK_BUFFER,this._pbo),f.readBuffer(f.COLOR_ATTACHMENT0),f.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),f.bindBuffer(f.PIXEL_PACK_BUFFER,null);const m=f.fenceSync(f.SYNC_GPU_COMMANDS_COMPLETE,0);f.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:m}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&ka(e)){const r=e.clientWaitSync(this._readbackQueue.sync,0,0);if(r===e.WAIT_FAILED)return o.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(r===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=zl._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let r=0;return r+=e[0]/256,r+=e[1]/65536,r+=e[2]/16777216,e[3]<127&&(r=-r),r/128}}const Ds=o.$/128;function gc(p,e){const r=p.granularity!==void 0?Math.max(p.granularity,1):1,c=r+(p.generateBorders?2:0),f=r+(p.extendToNorthPole||p.generateBorders?1:0)+(p.extendToSouthPole||p.generateBorders?1:0),m=c+1,x=f+1,T=p.generateBorders?-1:0,A=p.generateBorders||p.extendToNorthPole?-1:0,k=r+(p.generateBorders?1:0),L=r+(p.generateBorders||p.extendToSouthPole?1:0),F=m*x,N=c*f*6,q=m*x>65536;if(q&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const X=q||e==="32bit",ae=new Int16Array(2*F);let ne=0;for(let ue=A;ue<=L;ue++)for(let le=T;le<=k;le++){let me=le/r*o.$;le===-1&&(me=-Ds),le===r+1&&(me=o.$+Ds);let ye=ue/r*o.$;ue===-1&&(ye=p.extendToNorthPole?o.bh:-Ds),ue===r+1&&(ye=p.extendToSouthPole?o.bi:o.$+Ds),ae[ne++]=me,ae[ne++]=ye}const re=X?new Uint32Array(N):new Uint16Array(N);let oe=0;for(let ue=0;ue<f;ue++)for(let le=0;le<c;le++){const me=le+1+ue*m,ye=le+(ue+1)*m,he=le+1+(ue+1)*m;re[oe++]=le+ue*m,re[oe++]=ye,re[oe++]=me,re[oe++]=me,re[oe++]=ye,re[oe++]=he}return{vertices:ae.buffer.slice(0),indices:re.buffer.slice(0),uses32bitIndices:X}}const co=new o.aK({fill:new o.bj(128,2),line:new o.bj(512,0),tile:new o.bj(128,32),stencil:new o.bj(128,1),circle:3});class qo{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return zn.projectionGlobe}get vertexShaderPreludeCode(){return zn.projectionMercator.vertexSource}get subdivisionGranularity(){return co}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new zl(e));const r=o.U(this._errorQueryLatitudeDegrees),c=2*Math.atan(Math.exp(Math.PI-r*Math.PI*2))-.5*Math.PI,f=this._errorMeasurement.updateErrorLoop(r,c),m=W.now();f!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=f,this._errorMeasurementLastChangeTime=m);const x=Math.min(Math.max((m-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=o.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,o.bl(x))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,r,c,f,m){const x=(m==="stencil"?co.stencil:co.tile).getGranularityForZoomLevel(r.z);return this._getMesh(e,{granularity:x,generateBorders:c,extendToNorthPole:r.y===0&&f,extendToSouthPole:r.y===(1<<r.z)-1&&f})}_getMesh(e,r){const c=this._getMeshKey(r);if(c in this._tileMeshCache)return this._tileMeshCache[c];const f=(function(m,x){const T=gc(x,"16bit"),A=o.aL.deserialize({arrayBuffer:T.vertices,length:T.vertices.byteLength/2/2}),k=o.aN.deserialize({arrayBuffer:T.indices,length:T.indices.byteLength/2/3});return new oo(m.createVertexBuffer(A,Bn.members),m.createIndexBuffer(k),o.aM.simpleSegment(0,0,A.length,k.length))})(e,r);return this._tileMeshCache[c]=f,f}recalculate(e){}hasTransition(){const e=W.now();let r=!1;return r=r||(e-this._errorMeasurementLastChangeTime)/1e3<.7,r=r||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,r}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const Zo=new o.r({type:new o.D(o.v.projection.type)});class $o extends o.E{constructor(e){super(),this._transitionable=new o.t(Zo,void 0),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.F(0)),this._mercatorProjection=new nr,this._verticalPerspectiveProjection=new qo}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof o.bm){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,r,c,f,m){return this.currentProjection.getMeshFromTileID(e,r,c,f,m)}setProjection(e){this._transitionable.setValue("type",e?.type||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function Il(p){const e=Ho(p.worldSize,p.center.lat);return 2*Math.PI*e}function fs(p,e,r,c,f){const m=1/(1<<f),x=e/o.$*m+c*m,T=o.bo((p/o.$*m+r*m)*Math.PI*2+Math.PI,2*Math.PI),A=2*Math.atan(Math.exp(Math.PI-x*Math.PI*2))-.5*Math.PI,k=Math.cos(A),L=new Float64Array(3);return L[0]=Math.sin(T)*k,L[1]=Math.sin(A),L[2]=Math.cos(T)*k,L}function pn(p){return(function(e,r){const c=Math.cos(r),f=new Float64Array(3);return f[0]=Math.sin(e)*c,f[1]=Math.sin(r),f[2]=Math.cos(e)*c,f})(p.lng*Math.PI/180,p.lat*Math.PI/180)}function Ho(p,e){return p/(2*Math.PI)/Math.cos(e*Math.PI/180)}function Xo(p){const e=Math.asin(p[1])/Math.PI*180,r=Math.sqrt(p[0]*p[0]+p[2]*p[2]);if(r>1e-6){const c=p[0]/r,f=Math.acos(p[2]/r),m=(c>0?f:-f)/Math.PI*180;return new o.S(o.aO(m,-180,180),e)}return new o.S(0,e)}function uo(p){return Math.cos(p*Math.PI/180)}function mn(p,e){const r=uo(p),c=uo(e);return o.ak(c/r)}function du(p,e){const r=p.rotate(e.bearingInRadians),c=e.zoom+mn(e.center.lat,0),f=o.bk(1/uo(e.center.lat),1/uo(Math.min(Math.abs(e.center.lat),60)),o.bn(c,7,3,0,1)),m=360/Il({worldSize:e.worldSize,center:{lat:e.center.lat}});return new o.S(e.center.lng-r.x*m*f,o.ah(e.center.lat+r.y*m,-o.ai,o.ai))}function fu(p){const e=.5*p,r=Math.sin(e),c=Math.cos(e);return Math.log(r+c)-Math.log(c-r)}function dd(p,e,r,c){const f=p.lat+r*c;if(Math.abs(r)>1){const m=(Math.sign(p.lat+r)!==Math.sign(p.lat)?-Math.abs(p.lat):Math.abs(p.lat))*Math.PI/180,x=Math.abs(p.lat+r)*Math.PI/180,T=fu(m+c*(x-m)),A=fu(m),k=fu(x);return new o.S(p.lng+e*((T-A)/(k-A)),f)}return new o.S(p.lng+e*c,f)}class fd{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,r,c,f){const m=`${e.z}_${e.x}_${e.y}_${f?.terrain?"t":""}`,x=this._cache.get(m);if(x)return x;const T=this._cachePrevious.get(m);if(T)return this._cache.set(m,T),T;const A=this._boundingVolumeFactory(e,r,c,f);return this._cache.set(m,A),this._hadAnyChanges=!0,A}}class nn{constructor(e,r,c,f){this.min=c,this.max=f,this.points=e,this.planes=r}static fromAabb(e,r){const c=[];for(let f=0;f<8;f++)c.push([1&~f?e[0]:r[0],(f>>1&1)==1?r[1]:e[1],(f>>2&1)==1?r[2]:e[2]]);return new nn(c,[[-1,0,0,r[0]],[1,0,0,-e[0]],[0,-1,0,r[1]],[0,1,0,-e[1]],[0,0,-1,r[2]],[0,0,1,-e[2]]],e,r)}static fromCenterSizeAngles(e,r,c){const f=o.br([],c[0],c[1],c[2]),m=o.bs([],[r[0],0,0],f),x=o.bs([],[0,r[1],0],f),T=o.bs([],[0,0,r[2]],f),A=[...e],k=[...e];for(let F=0;F<8;F++)for(let N=0;N<3;N++){const q=e[N]+m[N]*(1&~F?-1:1)+x[N]*((F>>1&1)==1?1:-1)+T[N]*((F>>2&1)==1?1:-1);A[N]=Math.min(A[N],q),k[N]=Math.max(k[N],q)}const L=[];for(let F=0;F<8;F++){const N=[...e];o.aS(N,N,o.aR([],m,1&~F?-1:1)),o.aS(N,N,o.aR([],x,(F>>1&1)==1?1:-1)),o.aS(N,N,o.aR([],T,(F>>2&1)==1?1:-1)),L.push(N)}return new nn(L,[[...m,-o.aX(m,L[0])],[...x,-o.aX(x,L[0])],[...T,-o.aX(T,L[0])],[-m[0],-m[1],-m[2],-o.aX(m,L[7])],[-x[0],-x[1],-x[2],-o.aX(x,L[7])],[-T[0],-T[1],-T[2],-o.aX(T,L[7])]],A,k)}intersectsFrustum(e){let r=!0;const c=this.points.length,f=this.planes.length,m=e.planes.length,x=e.points.length;for(let T=0;T<m;T++){const A=e.planes[T];let k=0;for(let L=0;L<c;L++){const F=this.points[L];A[0]*F[0]+A[1]*F[1]+A[2]*F[2]+A[3]>=0&&k++}if(k===0)return 0;k<c&&(r=!1)}if(r)return 2;for(let T=0;T<f;T++){const A=this.planes[T];let k=0;for(let L=0;L<x;L++){const F=e.points[L];A[0]*F[0]+A[1]*F[1]+A[2]*F[2]+A[3]>=0&&k++}if(k===0)return 0}return 1}intersectsPlane(e){const r=this.points.length;let c=0;for(let f=0;f<r;f++){const m=this.points[f];e[0]*m[0]+e[1]*m[1]+e[2]*m[2]+e[3]>=0&&c++}return c===r?2:c===0?0:1}}function Rl(p,e,r){const c=p-e;return c<0?-c:Math.max(0,c-r)}function Er(p,e,r,c,f){const m=p-r;let x;return x=m<0?Math.min(-m,1+m-f):m>1?Math.min(Math.max(m-f,0),1-m):0,Math.max(x,Rl(e,c,f))}class pu{constructor(){this._boundingVolumeCache=new fd(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,r,c,f){const m=1<<c.z,x=1/m,T=c.x/m,A=c.y/m;let k=2;return k=Math.min(k,Er(e,r,T,A,x)),k=Math.min(k,Er(e,r,T+.5,-A-x,x)),k=Math.min(k,Er(e,r,T+.5,2-A-x,x)),k}getWrap(e,r,c){const f=1<<r.z,m=1/f,x=r.x/f,T=Rl(e.x,x,m),A=Rl(e.x,x-1,m),k=Rl(e.x,x+1,m),L=Math.min(T,A,k);return L===k?1:L===A?-1:0}allowVariableZoom(e,r){return Pe(e,r)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,r,c,f){return this._boundingVolumeCache.getTileBoundingVolume(e,r,c,f)}_computeTileBoundingVolume(e,r,c,f){var m,x;let T=0,A=0;if(f?.terrain){const k=new o.Z(e.z,r,e.z,e.x,e.y),L=f.terrain.getMinMaxElevation(k);T=(m=L.minElevation)!==null&&m!==void 0?m:Math.min(0,c),A=(x=L.maxElevation)!==null&&x!==void 0?x:Math.max(0,c)}if(T/=o.bu,A/=o.bu,T+=1,A+=1,e.z<=0)return nn.fromAabb([-A,-A,-A],[A,A,A]);if(e.z===1)return nn.fromAabb([e.x===0?-A:0,e.y===0?0:-A,-A],[e.x===0?0:A,e.y===0?A:0,A]);{const k=[fs(0,0,e.x,e.y,e.z),fs(o.$,0,e.x,e.y,e.z),fs(o.$,o.$,e.x,e.y,e.z),fs(0,o.$,e.x,e.y,e.z)],L=[];for(const Le of k)L.push(o.aR([],Le,A));if(A!==T)for(const Le of k)L.push(o.aR([],Le,T));e.y===0&&L.push([0,1,0]),e.y===(1<<e.z)-1&&L.push([0,-1,0]);const F=[1,1,1],N=[-1,-1,-1];for(const Le of L)for(let Ne=0;Ne<3;Ne++)F[Ne]=Math.min(F[Ne],Le[Ne]),N[Ne]=Math.max(N[Ne],Le[Ne]);const q=fs(o.$/2,o.$/2,e.x,e.y,e.z),X=o.aW([],[0,1,0],q);o.aV(X,X);const ae=o.aW([],q,X);o.aV(ae,ae);const ne=o.aW([],k[2],k[1]);o.aV(ne,ne);const re=o.aW([],k[0],k[3]);o.aV(re,re),L.push(o.aR([],q,A)),e.y>=(1<<e.z)/2&&L.push(o.aR([],fs(o.$/2,0,e.x,e.y,e.z),A)),e.y<(1<<e.z)/2&&L.push(o.aR([],fs(o.$/2,o.$,e.x,e.y,e.z),A));const oe=_c(q,L),ue=_c(ae,L),le=[-q[0],-q[1],-q[2],oe.max],me=[q[0],q[1],q[2],-oe.min],ye=[-ae[0],-ae[1],-ae[2],ue.max],he=[ae[0],ae[1],ae[2],-ue.min],Me=[...ne,0],je=[...re,0],De=[];return e.y===0?De.push(o.bt(je,Me,le),o.bt(je,Me,me)):De.push(o.bt(ye,Me,le),o.bt(ye,Me,me),o.bt(ye,je,le),o.bt(ye,je,me)),e.y===(1<<e.z)-1?De.push(o.bt(je,Me,le),o.bt(je,Me,me)):De.push(o.bt(he,Me,le),o.bt(he,Me,me),o.bt(he,je,le),o.bt(he,je,me)),new nn(De,[le,me,ye,he,Me,je],F,N)}}}function _c(p,e){let r=1/0,c=-1/0;for(const f of e){const m=o.aX(p,f);r=Math.min(r,m),c=Math.max(c,m)}return{min:r,max:c}}class yc{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,c){return this._helper.interpolatePadding(e,r,c)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r){this._helper.resize(e,r)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=o.bv(),this._projectionMatrix=o.b9(),this._globeViewProjMatrix32f=o.b8(),this._globeViewProjMatrixNoCorrection=o.b9(),this._globeViewProjMatrixNoCorrectionInverted=o.b9(),this._globeProjMatrixInverted=o.b9(),this._cameraPosition=o.bp(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Da({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,r)=>this.getConstrained(e,r)}),this._coveringTilesDetailsProvider=new pu}clone(){const e=new yc;return e.apply(this),e}apply(e,r){this._globeLatitudeErrorCorrectionRadians=r||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=o.bp();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:r,applyGlobeMatrix:c}=e,f=this._helper.getMercatorTileCoordinates(r);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:f,clippingPlane:this._cachedClippingPlane,projectionTransition:c?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const r=this.pitchInRadians,c=this.cameraToCenterDistance/e,f=Math.sin(r)*c,m=Math.cos(r)*c+1,x=1/Math.sqrt(f*f+m*m)*1;let T=-f,A=m;const k=Math.sqrt(T*T+A*A);T/=k,A/=k;const L=[0,T,A];o.bw(L,L,[0,0,0],-this.bearingInRadians),o.bx(L,L,[0,0,0],-1*this.center.lat*Math.PI/180),o.by(L,L,[0,0,0],this.center.lng*Math.PI/180);const F=1/o.aZ(L);return o.aR(L,L,F),[...L,-x*F]}isLocationOccluded(e){return!this.isSurfacePointVisible(pn(e))}transformLightDirection(e){const r=this._helper._center.lng*Math.PI/180,c=this._helper._center.lat*Math.PI/180,f=Math.cos(c),m=[Math.sin(r)*f,Math.sin(c),Math.cos(r)*f],x=[m[2],0,-m[0]],T=[0,0,0];o.aW(T,x,m),o.aV(x,x),o.aV(T,T);const A=[0,0,0];return o.aV(A,[x[0]*e[0]+T[0]*e[1]+m[0]*e[2],x[1]*e[0]+T[1]*e[1]+m[1]*e[2],x[2]*e[0]+T[2]*e[1]+m[2]*e[2]]),A}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,r,c){const f=(function(T,A,k){const L=1/(1<<k.z);return new o.a1(T/o.$*L+k.x*L,A/o.$*L+k.y*L)})(e,r,c.canonical),m=(x=f.y,[o.bo(f.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-x*Math.PI*2))-.5*Math.PI]);var x;return this.getCircleRadiusCorrection()/Math.cos(m[1])}projectTileCoordinates(e,r,c,f){const m=c.canonical,x=fs(e,r,m.x,m.y,m.z),T=1+(f?f(e,r):0)/o.bu,A=[x[0]*T,x[1]*T,x[2]*T,1];o.aw(A,A,this._globeViewProjMatrixNoCorrection);const k=this._cachedClippingPlane,L=k[0]*x[0]+k[1]*x[1]+k[2]*x[2]+k[3]<0;return{point:new o.P(A[0]/A[3],A[1]/A[3]),signedDistanceFromCamera:A[3],isOccluded:L}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=Ho(this.worldSize,this.center.lat),r=o.ba(),c=o.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),o.b4(r,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const f=this.centerOffset;r[8]=2*-f.x/this._helper._width,r[9]=2*f.y/this._helper._height,this._projectionMatrix=o.b5(r),this._globeProjMatrixInverted=o.ba(),o.aq(this._globeProjMatrixInverted,r),o.M(r,r,[0,0,-this.cameraToCenterDistance]),o.b6(r,r,this.rollInRadians),o.b7(r,r,-this.pitchInRadians),o.b6(r,r,this.bearingInRadians),o.M(r,r,[0,0,-e]);const m=o.bp();m[0]=e,m[1]=e,m[2]=e,o.b7(c,r,this.center.lat*Math.PI/180),o.bz(c,c,-this.center.lng*Math.PI/180),o.N(c,c,m),this._globeViewProjMatrixNoCorrection=c,o.b7(r,r,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),o.bz(r,r,-this.center.lng*Math.PI/180),o.N(r,r,m),this._globeViewProjMatrix32f=new Float32Array(r),this._globeViewProjMatrixNoCorrectionInverted=o.ba(),o.aq(this._globeViewProjMatrixNoCorrectionInverted,c);const x=o.bp();this._cameraPosition=o.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/e,o.bw(this._cameraPosition,this._cameraPosition,x,-this.rollInRadians),o.bx(this._cameraPosition,this._cameraPosition,x,this.pitchInRadians),o.bw(this._cameraPosition,this._cameraPosition,x,-this.bearingInRadians),o.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),o.bx(this._cameraPosition,this._cameraPosition,x,-this.center.lat*Math.PI/180),o.by(this._cameraPosition,this._cameraPosition,x,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const T=o.b5(this._globeViewProjMatrixNoCorrectionInverted);o.N(T,T,[1,1,-1]),this._cachedFrustum=sa.fromInvProjectionMatrix(T,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){o.w("calculateFogMatrix is not supported on globe projection.");const r=o.ba();return o.ag(r),r}getVisibleUnwrappedCoordinates(e){return[new o.b2(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&o.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,r){if(!this._globeViewProjMatrixNoCorrection)return 1;const c=pn(e);o.aR(c,c,1+r/o.bu);const f=o.bv();return o.aw(f,[c[0],c[1],c[2],1],this._globeViewProjMatrixNoCorrection),f[2]/f[3]}populateCache(e){}getBounds(){const e=.5*this.width,r=.5*this.height,c=[new o.P(0,0),new o.P(e,0),new o.P(this.width,0),new o.P(this.width,r),new o.P(this.width,this.height),new o.P(e,this.height),new o.P(0,this.height),new o.P(0,r)],f=[];for(const F of c)f.push(this.unprojectScreenPoint(F));let m=0,x=0,T=0,A=0;const k=this.center;for(const F of f){const N=o.bA(k.lng,F.lng),q=o.bA(k.lat,F.lat);N<x&&(x=N),N>m&&(m=N),q<A&&(A=q),q>T&&(T=q)}const L=[k.lng+x,k.lat+A,k.lng+m,k.lat+T];return this.isSurfacePointOnScreen([0,1,0])&&(L[3]=90,L[0]=-180,L[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(L[1]=-90,L[0]=-180,L[2]=180),new di(L)}getConstrained(e,r){const c=o.ah(e.lat,-o.ai,o.ai),f=o.ah(+r,this.minZoom+mn(0,c),this.maxZoom);return{center:new o.S(e.lng,c),zoom:f}}calculateCenterFromCameraLngLatAlt(e,r,c,f){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,c,f)}setLocationAtPoint(e,r){const c=pn(this.unprojectScreenPoint(r)),f=pn(e),m=o.bp();o.bB(m);const x=o.bp();o.by(x,c,m,-this.center.lng*Math.PI/180),o.bx(x,x,m,this.center.lat*Math.PI/180);const T=f[0]*f[0]+f[2]*f[2],A=x[0]*x[0];if(T<A)return;const k=Math.sqrt(T-A),L=-k,F=o.bC(f[0],f[2],x[0],k),N=o.bC(f[0],f[2],x[0],L),q=o.bp();o.by(q,f,m,-F);const X=o.bC(q[1],q[2],x[1],x[2]),ae=o.bp();o.by(ae,f,m,-N);const ne=o.bC(ae[1],ae[2],x[1],x[2]),re=.5*Math.PI,oe=X>=-re&&X<=re,ue=ne>=-re&&ne<=re;let le,me;if(oe&&ue){const je=this.center.lng*Math.PI/180,De=this.center.lat*Math.PI/180;o.bD(F,je)+o.bD(X,De)<o.bD(N,je)+o.bD(ne,De)?(le=F,me=X):(le=N,me=ne)}else if(oe)le=F,me=X;else{if(!ue)return;le=N,me=ne}const ye=le/Math.PI*180,he=me/Math.PI*180,Me=this.center.lat;this.setCenter(new o.S(ye,o.ah(he,-90,90))),this.setZoom(this.zoom+mn(Me,this.center.lat))}locationToScreenPoint(e,r){const c=pn(e);if(r){const f=r.getElevationForLngLatZoom(e,this._helper._tileZoom);o.aR(c,c,1+f/o.bu)}return this._projectSurfacePointToScreen(c)}_projectSurfacePointToScreen(e){const r=o.bv();return o.aw(r,[...e,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],new o.P((.5*r[0]+.5)*this.width,(.5*-r[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,r){if(r){const c=r.pointCoordinate(e);if(c)return c}return o.a1.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,r){var c;return(c=this.screenPointToMercatorCoordinate(e,r))===null||c===void 0?void 0:c.toLngLat()}isPointOnMapSurface(e,r){const c=this._cameraPosition,f=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(c,f)}getRayDirectionFromPixel(e){const r=o.bv();r[0]=e.x/this.width*2-1,r[1]=-1*(e.y/this.height*2-1),r[2]=1,r[3]=1,o.aw(r,r,this._globeViewProjMatrixNoCorrectionInverted),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3];const c=o.bp();c[0]=r[0]-this._cameraPosition[0],c[1]=r[1]-this._cameraPosition[1],c[2]=r[2]-this._cameraPosition[2];const f=o.bp();return o.aV(f,c),f}isSurfacePointVisible(e){const r=this._cachedClippingPlane;return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const r=o.bv();return o.aw(r,[...e,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3],r[0]>-1&&r[0]<1&&r[1]>-1&&r[1]<1&&r[2]>-1&&r[2]<1}rayPlanetIntersection(e,r){const c=o.aX(e,r),f=o.bp(),m=o.bp();o.aR(m,r,c),o.aU(f,e,m);const x=1-o.aX(f,f);if(x<0)return null;const T=o.aX(e,e)-1,A=-c+(c<0?1:-1)*Math.sqrt(x),k=T/A,L=A;return{tMin:Math.min(k,L),tMax:Math.max(k,L)}}unprojectScreenPoint(e){const r=this._cameraPosition,c=this.getRayDirectionFromPixel(e),f=this.rayPlanetIntersection(r,c);if(f){const L=o.bp();o.aS(L,r,[c[0]*f.tMin,c[1]*f.tMin,c[2]*f.tMin]);const F=o.bp();return o.aV(F,L),Xo(F)}const m=this._cachedClippingPlane,x=m[0]*c[0]+m[1]*c[1]+m[2]*c[2],T=-o.b1(m,r)/x,A=o.bp();if(T>0)o.aS(A,r,[c[0]*T,c[1]*T,c[2]*T]);else{const L=o.bp();o.aS(L,r,[2*c[0],2*c[1],2*c[2]]);const F=o.b1(this._cachedClippingPlane,L);o.aU(A,L,[this._cachedClippingPlane[0]*F,this._cachedClippingPlane[1]*F,this._cachedClippingPlane[2]*F])}const k=(function(L){const F=o.bp();return F[0]=L[0]*-L[3],F[1]=L[1]*-L[3],F[2]=L[2]*-L[3],{center:F,radius:Math.sqrt(1-L[3]*L[3])}})(m);return Xo((function(L,F,N){const q=o.bp();o.aU(q,N,L);const X=o.bp();return o.bq(X,L,q,F/o.a$(q)),X})(k.center,k.radius,A))}getMatrixForModel(e,r){const c=o.S.convert(e),f=1/o.bu,m=o.b9();return o.bz(m,m,c.lng/180*Math.PI),o.b7(m,m,-c.lat/180*Math.PI),o.M(m,m,[0,0,1+r/o.bu]),o.b7(m,m,.5*Math.PI),o.N(m,m,[f,f,f]),m}getProjectionDataForCustomLayer(e=!0){const r=this.getProjectionData({overscaledTileID:new o.Z(0,0,0,0,0),applyGlobeMatrix:e});return r.tileMercatorCoords=[0,0,1,1],r}getFastPathSimpleProjectionMatrix(e){}}class ks{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,c){return this._helper.interpolatePadding(e,r,c)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r,c=!0){this._helper.resize(e,r,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,r){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=r,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Da({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,r)=>this.getConstrained(e,r)}),this._globeness=1,this._mercatorTransform=new ds,this._verticalPerspectiveTransform=new yc}clone(){const e=new ks;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const r=this._mercatorTransform.getProjectionData(e),c=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?c.mainMatrix:r.mainMatrix,clippingPlane:c.clippingPlane,tileMercatorCoords:c.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:r.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return o.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return o.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,r,c){const f=this._mercatorTransform.getPitchedTextCorrection(e,r,c),m=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,r,c);return o.bk(f,m,this._globeness)}projectTileCoordinates(e,r,c,f){return this.currentTransform.projectTileCoordinates(e,r,c,f)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,r){return this.currentTransform.lngLatToCameraDepth(e,r)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,r){return this.currentTransform.getConstrained(e,r)}calculateCenterFromCameraLngLatAlt(e,r,c,f){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,c,f)}setLocationAtPoint(e,r){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,r),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,r),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,r){return this.currentTransform.locationToScreenPoint(e,r)}screenPointToMercatorCoordinate(e,r){return this.currentTransform.screenPointToMercatorCoordinate(e,r)}screenPointToLocation(e,r){return this.currentTransform.screenPointToLocation(e,r)}isPointOnMapSurface(e,r){return this.currentTransform.isPointOnMapSurface(e,r)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,r){return this.currentTransform.getMatrixForModel(e,r)}getProjectionDataForCustomLayer(e=!0){const r=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return r;const c=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return c.fallbackMatrix=r.mainMatrix,c}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class Vr{get useGlobeControls(){return!0}handlePanInertia(e,r){const c=du(e,r);return Math.abs(c.lng-r.center.lng)>180&&(c.lng=r.center.lng+179.5*Math.sign(c.lng-r.center.lng)),{easingCenter:c,easingOffset:new o.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,r){const c=e.around,f=r.screenPointToLocation(c);e.bearingDelta&&r.setBearing(r.bearing+e.bearingDelta),e.pitchDelta&&r.setPitch(r.pitch+e.pitchDelta),e.rollDelta&&r.setRoll(r.roll+e.rollDelta);const m=r.zoom;e.zoomDelta&&r.setZoom(r.zoom+e.zoomDelta);const x=r.zoom-m;if(x===0)return;const T=o.bA(r.center.lng,f.lng),A=T/(Math.abs(T/180)+1),k=o.bA(r.center.lat,f.lat),L=r.getRayDirectionFromPixel(c),F=r.cameraPosition,N=-1*o.aX(F,L),q=o.bp();o.aS(q,F,[L[0]*N,L[1]*N,L[2]*N]);const X=o.aZ(q)-1,ae=Math.exp(.5*-Math.max(X-.3,0)),ne=Ho(r.worldSize,r.center.lat)/Math.min(r.width,r.height),re=o.bn(ne,.9,.5,1,.25),oe=(1-o.af(-x))*Math.min(ae,re),ue=r.center.lat,le=r.zoom,me=new o.S(r.center.lng+A*oe,o.ah(r.center.lat+k*oe,-o.ai,o.ai));r.setLocationAtPoint(f,c);const ye=r.center,he=o.bn(Math.abs(T),45,85,0,1),Me=o.bn(ne,.75,.35,0,1),je=Math.pow(Math.max(he,Me),.25),De=o.bA(ye.lng,me.lng),Le=o.bA(ye.lat,me.lat);r.setCenter(new o.S(ye.lng+De*je,ye.lat+Le*je).wrap()),r.setZoom(le+mn(ue,r.center.lat))}handleMapControlsPan(e,r,c){if(!e.panDelta)return;const f=r.center.lat,m=r.zoom;r.setCenter(du(e.panDelta,r).wrap()),r.setZoom(m+mn(f,r.center.lat))}cameraForBoxAndBearing(e,r,c,f,m){const x=fn(e,r,c,f,m),T=r.left/m.width*2-1,A=(m.width-r.right)/m.width*2-1,k=r.top/m.height*-2+1,L=(m.height-r.bottom)/m.height*-2+1,F=o.bA(c.getWest(),c.getEast())<0,N=F?c.getEast():c.getWest(),q=F?c.getWest():c.getEast(),X=Math.max(c.getNorth(),c.getSouth()),ae=Math.min(c.getNorth(),c.getSouth()),ne=N+.5*o.bA(N,q),re=X+.5*o.bA(X,ae),oe=m.clone();oe.setCenter(x.center),oe.setBearing(x.bearing),oe.setPitch(0),oe.setRoll(0),oe.setZoom(x.zoom);const ue=oe.modelViewProjectionMatrix,le=[pn(c.getNorthWest()),pn(c.getNorthEast()),pn(c.getSouthWest()),pn(c.getSouthEast()),pn(new o.S(q,re)),pn(new o.S(N,re)),pn(new o.S(ne,X)),pn(new o.S(ne,ae))],me=pn(x.center);let ye=Number.POSITIVE_INFINITY;for(const he of le)T<0&&(ye=Vr.getLesserNonNegativeNonNull(ye,Vr.solveVectorScale(he,me,ue,"x",T))),A>0&&(ye=Vr.getLesserNonNegativeNonNull(ye,Vr.solveVectorScale(he,me,ue,"x",A))),k>0&&(ye=Vr.getLesserNonNegativeNonNull(ye,Vr.solveVectorScale(he,me,ue,"y",k))),L<0&&(ye=Vr.getLesserNonNegativeNonNull(ye,Vr.solveVectorScale(he,me,ue,"y",L)));if(Number.isFinite(ye)&&ye!==0)return x.zoom=oe.zoom+o.ak(ye),x;Ia()}handleJumpToCenterZoom(e,r){const c=e.center.lat,f=e.getConstrained(r.center?o.S.convert(r.center):e.center,e.zoom).center;e.setCenter(f.wrap());const m=r.zoom!==void 0?+r.zoom:e.zoom+mn(c,f.lat);e.zoom!==m&&e.setZoom(m)}handleEaseTo(e,r){const c=e.zoom,f=e.center,m=e.padding,x={roll:e.roll,pitch:e.pitch,bearing:e.bearing},T={roll:r.roll===void 0?e.roll:r.roll,pitch:r.pitch===void 0?e.pitch:r.pitch,bearing:r.bearing===void 0?e.bearing:r.bearing},A=r.zoom!==void 0,k=!e.isPaddingEqual(r.padding);let L=!1;const F=r.center?o.S.convert(r.center):f,N=e.getConstrained(F,c).center;lo(e,N);const q=e.clone();q.setCenter(N),q.setZoom(A?+r.zoom:c+mn(f.lat,F.lat)),q.setBearing(r.bearing);const X=new o.P(o.ah(e.centerPoint.x+r.offsetAsPoint.x,0,e.width),o.ah(e.centerPoint.y+r.offsetAsPoint.y,0,e.height));q.setLocationAtPoint(N,X);const ae=(r.offset&&r.offsetAsPoint.mag())>0?q.center:N,ne=A?+r.zoom:c+mn(f.lat,ae.lat),re=c+mn(f.lat,0),oe=ne+mn(ae.lat,0),ue=o.bA(f.lng,ae.lng),le=o.bA(f.lat,ae.lat),me=o.af(oe-re);return L=ne!==c,{easeFunc:ye=>{if(o.be(x,T)||Nn({startEulerAngles:x,endEulerAngles:T,tr:e,k:ye,useSlerp:x.roll!=T.roll}),k&&e.interpolatePadding(m,r.padding,ye),r.around)o.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(r.around,r.aroundPoint);else{const he=oe>re?Math.min(2,me):Math.max(.5,me),Me=Math.pow(he,1-ye),je=dd(f,ue,le,ye*Me);e.setCenter(je.wrap())}if(L){const he=o.C.number(re,oe,ye)+mn(0,e.center.lat);e.setZoom(he)}},isZooming:L,elevationCenter:ae}}handleFlyTo(e,r){const c=r.zoom!==void 0,f=e.center,m=e.zoom,x=e.padding,T=!e.isPaddingEqual(r.padding),A=e.getConstrained(o.S.convert(r.center||r.locationAtOffset),m).center,k=c?+r.zoom:e.zoom+mn(e.center.lat,A.lat),L=e.clone();L.setCenter(A),L.setZoom(k),L.setBearing(r.bearing);const F=new o.P(o.ah(e.centerPoint.x+r.offsetAsPoint.x,0,e.width),o.ah(e.centerPoint.y+r.offsetAsPoint.y,0,e.height));L.setLocationAtPoint(A,F);const N=L.center;lo(e,N);const q=(function(le,me,ye){const he=pn(me),Me=pn(ye),je=o.aX(he,Me),De=Math.acos(je),Le=Il(le);return De/(2*Math.PI)*Le})(e,f,N),X=m+mn(f.lat,0),ae=k+mn(N.lat,0),ne=o.af(ae-X);let re;if(typeof r.minZoom=="number"){const le=+r.minZoom+mn(N.lat,0),me=Math.min(le,X,ae)+mn(0,N.lat),ye=e.getConstrained(N,me).zoom+mn(N.lat,0);re=o.af(ye-X)}const oe=o.bA(f.lng,N.lng),ue=o.bA(f.lat,N.lat);return{easeFunc:(le,me,ye,he)=>{const Me=dd(f,oe,ue,ye);T&&e.interpolatePadding(x,r.padding,le);const je=le===1?N:Me;e.setCenter(je.wrap());const De=X+o.ak(me);e.setZoom(le===1?k:De+mn(0,je.lat))},scaleOfZoom:ne,targetCenter:N,scaleOfMinZoom:re,pixelPathLength:q}}static solveVectorScale(e,r,c,f,m){const x=f==="x"?[c[0],c[4],c[8],c[12]]:[c[1],c[5],c[9],c[13]],T=[c[3],c[7],c[11],c[15]],A=e[0]*x[0]+e[1]*x[1]+e[2]*x[2],k=e[0]*T[0]+e[1]*T[1]+e[2]*T[2],L=r[0]*x[0]+r[1]*x[1]+r[2]*x[2],F=r[0]*T[0]+r[1]*T[1]+r[2]*T[2];return L+m*k===A+m*F||T[3]*(A-L)+x[3]*(F-k)+A*F==L*k?null:(L+x[3]-m*F-m*T[3])/(L-A-m*F+m*k)}static getLesserNonNegativeNonNull(e,r){return r!==null&&r>=0&&r<e?r:e}}class lh{constructor(e){this._globe=e,this._mercatorCameraHelper=new Tr,this._verticalPerspectiveCameraHelper=new Vr}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,r){return this.currentHelper.handlePanInertia(e,r)}handleMapControlsRollPitchBearingZoom(e,r){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,r)}handleMapControlsPan(e,r,c){this.currentHelper.handleMapControlsPan(e,r,c)}cameraForBoxAndBearing(e,r,c,f,m){return this.currentHelper.cameraForBoxAndBearing(e,r,c,f,m)}handleJumpToCenterZoom(e,r){this.currentHelper.handleJumpToCenterZoom(e,r)}handleEaseTo(e,r){return this.currentHelper.handleEaseTo(e,r)}handleFlyTo(e,r){return this.currentHelper.handleFlyTo(e,r)}}const mu=(p,e)=>o.y(p,e&&e.filter((r=>r.identifier!=="source.canvas"))),vf=o.bE();class ch extends o.E{constructor(e,r={}){var c,f;super(),this._rtlPluginLoaded=()=>{for(const x in this.sourceCaches){const T=this.sourceCaches[x].getSource().type;T!=="vector"&&T!=="geojson"||this.sourceCaches[x].reload()}},this.map=e,this.dispatcher=new Ot(Lt(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",((x,T)=>this.getGlyphs(x,T))),this.dispatcher.registerMessageHandler("GI",((x,T)=>this.getImages(x,T))),this.dispatcher.registerMessageHandler("GDA",((x,T)=>this.getDashes(x,T))),this.imageManager=new Se,this.imageManager.setEventedParent(this);const m=((c=e._container)===null||c===void 0?void 0:c.lang)||typeof document<"u"&&((f=document.documentElement)===null||f===void 0?void 0:f.lang)||void 0;this.glyphManager=new Gt(e._requestManager,r.localIdeographFontFamily,m),this.lineAtlas=new ft(256,512),this.crossTileSymbolIndex=new hs,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",o.bG()),Sa().on(Pi,this._rtlPluginLoaded),this.on("data",(x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const T=this.sourceCaches[x.sourceId];if(!T)return;const A=T.getSource();if(A&&A.vectorLayerIds)for(const k in this._layers){const L=this._layers[k];L.source===A.id&&this._validateLayer(L)}}))}setGlobalStateProperty(e,r){var c,f,m;this._checkLoaded();const x=r===null?(m=(f=(c=this.stylesheet.state)===null||c===void 0?void 0:c[e])===null||f===void 0?void 0:f.default)!==null&&m!==void 0?m:null:r;if(o.bH(x,this._globalState[e]))return this;this._globalState[e]=x,this._applyGlobalStateChanges([e])}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();const r=[];for(const c in e)!o.bH(this._globalState[c],e[c].default)&&(r.push(c),this._globalState[c]=e[c].default);this._applyGlobalStateChanges(r)}_applyGlobalStateChanges(e){if(e.length===0)return;const r=new Set,c={};for(const f of e){c[f]=this._globalState[f];for(const m in this._layers){const x=this._layers[m],T=x.getLayoutAffectingGlobalStateRefs(),A=x.getPaintAffectingGlobalStateRefs();if(T.has(f)&&r.add(x.source),A.has(f))for(const{name:k,value:L}of A.get(f))this._updatePaintProperty(x,k,L)}}this.dispatcher.broadcast("UGS",c);for(const f in this.sourceCaches)r.has(f)&&(this._reloadSource(f),this._changed=!0)}loadURL(e,r={},c){this.fire(new o.l("dataloading",{dataType:"style"})),r.validate=typeof r.validate!="boolean"||r.validate;const f=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const m=this._loadStyleRequest;o.j(f,this._loadStyleRequest).then((x=>{this._loadStyleRequest=null,this._load(x.data,r,c)})).catch((x=>{this._loadStyleRequest=null,x&&!m.signal.aborted&&this.fire(new o.k(x))}))}loadJSON(e,r={},c){this.fire(new o.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,W.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,r.validate=r.validate!==!1,this._load(e,r,c)})).catch((()=>{}))}loadEmpty(){this.fire(new o.l("dataloading",{dataType:"style"})),this._load(vf,{validate:!1})}_load(e,r,c){var f,m;let x=r.transformStyle?r.transformStyle(c,e):e;if(!r.validate||!mu(this,o.z(x))){x=Object.assign({},x),this._loaded=!0,this.stylesheet=x;for(const T in x.sources)this.addSource(T,x.sources[T],{validate:!1});x.sprite?this._loadSprite(x.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(x.glyphs),this._createLayers(),this.light=new He(this.stylesheet.light),this._setProjectionInternal(((f=this.stylesheet.projection)===null||f===void 0?void 0:f.type)||"mercator"),this.sky=new At(this.stylesheet.sky),this.map.setTerrain((m=this.stylesheet.terrain)!==null&&m!==void 0?m:null),this.fire(new o.l("data",{dataType:"style"})),this.fire(new o.l("style.load"))}}_createLayers(){var e,r,c;const f=o.bI(this.stylesheet.layers);this.setGlobalState((e=this.stylesheet.state)!==null&&e!==void 0?e:null),this.dispatcher.broadcast("SL",f),this._order=f.map((m=>m.id)),this._layers={},this._serializedLayers=null;for(const m of f){const x=o.bJ(m,this._globalState);if(x.setEventedParent(this,{layer:{id:m.id}}),this._layers[m.id]=x,o.bK(x)&&this.sourceCaches[x.source]){const T=(c=(r=m.paint)===null||r===void 0?void 0:r["raster-fade-duration"])!==null&&c!==void 0?c:x.paint.get("raster-fade-duration");this.sourceCaches[x.source].setRasterFadeDuration(T)}}}_loadSprite(e,r=!1,c=void 0){let f;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(m,x,T,A){return o._(this,void 0,void 0,(function*(){const k=xt(m),L=T>1?"@2x":"",F={},N={};for(const{id:q,url:X}of k){const ae=x.transformRequest(lt(X,L,".json"),"SpriteJSON");F[q]=o.j(ae,A);const ne=x.transformRequest(lt(X,L,".png"),"SpriteImage");N[q]=vt.getImage(ne,A)}return yield Promise.all([...Object.values(F),...Object.values(N)]),(function(q,X){return o._(this,void 0,void 0,(function*(){const ae={};for(const ne in q){ae[ne]={};const re=W.getImageCanvasContext((yield X[ne]).data),oe=(yield q[ne]).data;for(const ue in oe){const{width:le,height:me,x:ye,y:he,sdf:Me,pixelRatio:je,stretchX:De,stretchY:Le,content:Ne,textFitWidth:ht,textFitHeight:dt}=oe[ue];ae[ne][ue]={data:null,pixelRatio:je,sdf:Me,stretchX:De,stretchY:Le,content:Ne,textFitWidth:ht,textFitHeight:dt,spriteData:{width:le,height:me,x:ye,y:he,context:re}}}}return ae}))})(F,N)}))})(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((m=>{if(this._spriteRequest=null,m)for(const x in m){this._spritesImagesIds[x]=[];const T=this._spritesImagesIds[x]?this._spritesImagesIds[x].filter((A=>!(A in m))):[];for(const A of T)this.imageManager.removeImage(A),this._changedImages[A]=!0;for(const A in m[x]){const k=x==="default"?A:`${x}:${A}`;this._spritesImagesIds[x].push(k),k in this.imageManager.images?this.imageManager.updateImage(k,m[x][A],!1):this.imageManager.addImage(k,m[x][A]),r&&(this._changedImages[k]=!0)}}})).catch((m=>{this._spriteRequest=null,f=m,this.fire(new o.k(f))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),r&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"})),c&&c(f)}))}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}_validateLayer(e){const r=this.sourceCaches[e.source];if(!r)return;const c=e.sourceLayer;if(!c)return;const f=r.getSource();(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(c)===-1)&&this.fire(new o.k(new Error(`Source layer "${c}" does not exist on source "${f.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,r=!1){const c=this._serializedAllLayers();if(!e||e.length===0)return Object.values(r?o.bL(c):c);const f=[];for(const m of e)if(c[m]){const x=r?o.bL(c[m]):c[m];f.push(x)}return f}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const r=Object.keys(this._layers);for(const c of r){const f=this._layers[c];f.type!=="custom"&&(e[c]=f.serialize())}return e}hasTransitions(){var e,r,c;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((r=this.sky)===null||r===void 0)&&r.hasTransition()||!((c=this.projection)===null||c===void 0)&&c.hasTransition())return!0;for(const f in this.sourceCaches)if(this.sourceCaches[f].hasTransition())return!0;for(const f in this._layers)if(this._layers[f].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const r=this._changed;if(r){const f=Object.keys(this._updatedLayers),m=Object.keys(this._removedLayers);(f.length||m.length)&&this._updateWorkerLayers(f,m);for(const x in this._updatedSources){const T=this._updatedSources[x];if(T==="reload")this._reloadSource(x);else{if(T!=="clear")throw new Error(`Invalid action ${T}`);this._clearSource(x)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const x in this._updatedPaintProps)this._layers[x].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const c={};for(const f in this.sourceCaches){const m=this.sourceCaches[f];c[f]=m.used,m.used=!1}for(const f of this._order){const m=this._layers[f];m.recalculate(e,this._availableImages),!m.isHidden(e.zoom)&&m.source&&(this.sourceCaches[m.source].used=!0)}for(const f in c){const m=this.sourceCaches[f];!!c[f]!=!!m.used&&m.fire(new o.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:f}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,r&&this.fire(new o.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,r){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:r})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,r={}){var c;this._checkLoaded();const f=this.serialize();if(e=r.transformStyle?r.transformStyle(f,e):e,((c=r.validate)===null||c===void 0||c)&&mu(this,o.z(e)))return!1;(e=o.bL(e)).layers=o.bI(e.layers);const m=o.bM(f,e),x=this._getOperationsToPerform(m);if(x.unimplemented.length>0)throw new Error(`Unimplemented: ${x.unimplemented.join(", ")}.`);if(x.operations.length===0)return!1;for(const T of x.operations)T();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const r=[],c=[];for(const f of e)switch(f.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":r.push((()=>this.addLayer.apply(this,f.args)));break;case"removeLayer":r.push((()=>this.removeLayer.apply(this,f.args)));break;case"setPaintProperty":r.push((()=>this.setPaintProperty.apply(this,f.args)));break;case"setLayoutProperty":r.push((()=>this.setLayoutProperty.apply(this,f.args)));break;case"setFilter":r.push((()=>this.setFilter.apply(this,f.args)));break;case"addSource":r.push((()=>this.addSource.apply(this,f.args)));break;case"removeSource":r.push((()=>this.removeSource.apply(this,f.args)));break;case"setLayerZoomRange":r.push((()=>this.setLayerZoomRange.apply(this,f.args)));break;case"setLight":r.push((()=>this.setLight.apply(this,f.args)));break;case"setGeoJSONSourceData":r.push((()=>this.setGeoJSONSourceData.apply(this,f.args)));break;case"setGlyphs":r.push((()=>this.setGlyphs.apply(this,f.args)));break;case"setSprite":r.push((()=>this.setSprite.apply(this,f.args)));break;case"setTerrain":r.push((()=>this.map.setTerrain.apply(this,f.args)));break;case"setSky":r.push((()=>this.setSky.apply(this,f.args)));break;case"setProjection":this.setProjection.apply(this,f.args);break;case"setGlobalState":r.push((()=>this.setGlobalState.apply(this,f.args)));break;case"setTransition":r.push((()=>{}));break;default:c.push(f.command)}return{operations:r,unimplemented:c}}addImage(e,r){if(this.getImage(e))return this.fire(new o.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,r),this._afterImageUpdated(e)}updateImage(e,r){this.imageManager.updateImage(e,r)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new o.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,r,c={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(o.z.source,`sources.${e}`,r,null,c))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const f=this.sourceCaches[e]=new kt(e,r,this.dispatcher);f.style=this,f.setEventedParent(this,(()=>({isSourceLoaded:f.loaded(),source:f.serialize(),sourceId:e}))),f.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const c in this._layers)if(this._layers[c].source===e)return this.fire(new o.k(new Error(`Source "${e}" cannot be removed while layer "${c}" is using it.`)));const r=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],r.fire(new o.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),r.setEventedParent(null),r.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,r){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const c=this.sourceCaches[e].getSource();if(c.type!=="geojson")throw new Error(`geojsonSource.type is ${c.type}, which is !== 'geojson`);c.setData(r),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,r,c={}){this._checkLoaded();const f=e.id;if(this.getLayer(f))return void this.fire(new o.k(new Error(`Layer "${f}" already exists on this map.`)));let m;if(e.type==="custom"){if(mu(this,o.bN(e)))return;m=o.bJ(e,this._globalState)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(f,e.source),e=o.bL(e),e=o.e(e,{source:f})),this._validate(o.z.layer,`layers.${f}`,e,{arrayIndex:-1},c))return;m=o.bJ(e,this._globalState),this._validateLayer(m),m.setEventedParent(this,{layer:{id:f}})}const x=r?this._order.indexOf(r):this._order.length;if(r&&x===-1)this.fire(new o.k(new Error(`Cannot add layer "${f}" before non-existing layer "${r}".`)));else{if(this._order.splice(x,0,f),this._layerOrderChanged=!0,this._layers[f]=m,this._removedLayers[f]&&m.source&&m.type!=="custom"){const T=this._removedLayers[f];delete this._removedLayers[f],T.type!==m.type?this._updatedSources[m.source]="clear":(this._updatedSources[m.source]="reload",this.sourceCaches[m.source].pause())}this._updateLayer(m),m.onAdd&&m.onAdd(this.map)}}moveLayer(e,r){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new o.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===r)return;const c=this._order.indexOf(e);this._order.splice(c,1);const f=r?this._order.indexOf(r):this._order.length;r&&f===-1?this.fire(new o.k(new Error(`Cannot move layer "${e}" before non-existing layer "${r}".`))):(this._order.splice(f,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const r=this._layers[e];if(!r)return void this.fire(new o.k(new Error(`Cannot remove non-existing layer "${e}".`)));r.setEventedParent(null);const c=this._order.indexOf(e);this._order.splice(c,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=r,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],r.onRemove&&r.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,r,c){this._checkLoaded();const f=this.getLayer(e);f?f.minzoom===r&&f.maxzoom===c||(r!=null&&(f.minzoom=r),c!=null&&(f.maxzoom=c),this._updateLayer(f)):this.fire(new o.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,r,c={}){this._checkLoaded();const f=this.getLayer(e);if(f){if(!o.bH(f.filter,r))return r==null?(f.setFilter(void 0),void this._updateLayer(f)):void(this._validate(o.z.filter,`layers.${f.id}.filter`,r,null,c)||(f.setFilter(o.bL(r)),this._updateLayer(f)))}else this.fire(new o.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return o.bL(this.getLayer(e).filter)}setLayoutProperty(e,r,c,f={}){this._checkLoaded();const m=this.getLayer(e);m?o.bH(m.getLayoutProperty(r),c)||(m.setLayoutProperty(r,c,f),this._updateLayer(m)):this.fire(new o.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,r){const c=this.getLayer(e);if(c)return c.getLayoutProperty(r);this.fire(new o.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,r,c,f={}){this._checkLoaded();const m=this.getLayer(e);m?o.bH(m.getPaintProperty(r),c)||this._updatePaintProperty(m,r,c,f):this.fire(new o.k(new Error(`Cannot style non-existing layer "${e}".`)))}_updatePaintProperty(e,r,c,f={}){e.setPaintProperty(r,c,f)&&this._updateLayer(e),o.bK(e)&&r==="raster-fade-duration"&&this.sourceCaches[e.source].setRasterFadeDuration(c),this._changed=!0,this._updatedPaintProps[e.id]=!0,this._serializedLayers=null}getPaintProperty(e,r){return this.getLayer(e).getPaintProperty(r)}setFeatureState(e,r){this._checkLoaded();const c=e.source,f=e.sourceLayer,m=this.sourceCaches[c];if(m===void 0)return void this.fire(new o.k(new Error(`The source '${c}' does not exist in the map's style.`)));const x=m.getSource().type;x==="geojson"&&f?this.fire(new o.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):x!=="vector"||f?(e.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),m.setFeatureState(f,e.id,r)):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,r){this._checkLoaded();const c=e.source,f=this.sourceCaches[c];if(f===void 0)return void this.fire(new o.k(new Error(`The source '${c}' does not exist in the map's style.`)));const m=f.getSource().type,x=m==="vector"?e.sourceLayer:void 0;m!=="vector"||x?r&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new o.k(new Error("A feature id is required to remove its specific state property."))):f.removeFeatureState(x,e.id,r):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const r=e.source,c=e.sourceLayer,f=this.sourceCaches[r];if(f!==void 0)return f.getSource().type!=="vector"||c?(e.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),f.getFeatureState(c,e.id)):void this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.k(new Error(`The source '${r}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=o.bO(this.sourceCaches,(m=>m.serialize())),r=this._serializeByIds(this._order,!0),c=this.map.getTerrain()||void 0,f=this.stylesheet;return o.bP({version:f.version,name:f.name,metadata:f.metadata,light:f.light,sky:f.sky,center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch,sprite:f.sprite,glyphs:f.glyphs,transition:f.transition,projection:f.projection,sources:e,layers:r,terrain:c},(m=>m!==void 0))}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const r=x=>this._layers[x].type==="fill-extrusion",c={},f=[];for(let x=this._order.length-1;x>=0;x--){const T=this._order[x];if(r(T)){c[T]=x;for(const A of e){const k=A[T];if(k)for(const L of k)f.push(L)}}}f.sort(((x,T)=>T.intersectionZ-x.intersectionZ));const m=[];for(let x=this._order.length-1;x>=0;x--){const T=this._order[x];if(r(T))for(let A=f.length-1;A>=0;A--){const k=f[A].feature;if(c[k.layer.id]<x)break;m.push(k),f.pop()}else for(const A of e){const k=A[T];if(k)for(const L of k)m.push(L.feature)}}return m}queryRenderedFeatures(e,r,c){r&&r.filter&&this._validate(o.z.filter,"queryRenderedFeatures.filter",r.filter,null,r);const f={};if(r&&r.layers){if(!(Array.isArray(r.layers)||r.layers instanceof Set))return this.fire(new o.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const k of r.layers){const L=this._layers[k];if(!L)return this.fire(new o.k(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];f[L.source]=!0}}const m=[];r.availableImages=this._availableImages;const x=this._serializedAllLayers(),T=r.layers instanceof Set?r.layers:Array.isArray(r.layers)?new Set(r.layers):null,A=Object.assign(Object.assign({},r),{layers:T,globalState:this._globalState});for(const k in this.sourceCaches)r.layers&&!f[k]||m.push(jt(this.sourceCaches[k],this._layers,x,e,A,c,this.map.terrain?(L,F,N)=>this.map.terrain.getElevation(L,F,N):void 0));return this.placement&&m.push((function(k,L,F,N,q,X,ae){const ne={},re=X.queryRenderedSymbols(N),oe=[];for(const ue of Object.keys(re).map(Number))oe.push(ae[ue]);oe.sort(Ni);for(const ue of oe){const le=ue.featureIndex.lookupSymbolFeatures(re[ue.bucketInstanceId],L,ue.bucketIndex,ue.sourceLayerIndex,{filterSpec:q.filter,globalState:q.globalState},q.layers,q.availableImages,k);for(const me in le){const ye=ne[me]=ne[me]||[],he=le[me];he.sort(((Me,je)=>{const De=ue.featureSortOrder;if(De){const Le=De.indexOf(Me.featureIndex);return De.indexOf(je.featureIndex)-Le}return je.featureIndex-Me.featureIndex}));for(const Me of he)ye.push(Me)}}return(function(ue,le,me){for(const ye in ue)for(const he of ue[ye])ri(he,me[le[ye].source]);return ue})(ne,k,F)})(this._layers,x,this.sourceCaches,e,A,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(m)}querySourceFeatures(e,r){r?.filter&&this._validate(o.z.filter,"querySourceFeatures.filter",r.filter,null,r);const c=this.sourceCaches[e];return c?(function(f,m){const x=f.getRenderableIds().map((k=>f.getTileByID(k))),T=[],A={};for(let k=0;k<x.length;k++){const L=x[k],F=L.tileID.canonical.key;A[F]||(A[F]=!0,L.querySourceFeatures(T,m))}return T})(c,r?Object.assign(Object.assign({},r),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(e,r={}){this._checkLoaded();const c=this.light.getLight();let f=!1;for(const x in e)if(!o.bH(e[x],c[x])){f=!0;break}if(!f)return;const m={now:W.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,r),this.light.updateTransitions(m)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,r={}){this._checkLoaded();const c=this.getSky();let f=!1;if(!e&&!c)return;if(e&&!c)f=!0;else if(!e&&c)f=!0;else for(const x in e)if(!o.bH(e[x],c[x])){f=!0;break}if(!f)return;const m={now:W.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,r),this.sky.updateTransitions(m)}_setProjectionInternal(e){const r=(function(c){if(Array.isArray(c)){const f=new $o({type:c});return{projection:f,transform:new ks,cameraHelper:new lh(f)}}switch(c){case"mercator":return{projection:new nr,transform:new ds,cameraHelper:new Tr};case"globe":{const f=new $o({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:f,transform:new ks,cameraHelper:new lh(f)}}case"vertical-perspective":return{projection:new qo,transform:new yc,cameraHelper:new Vr};default:return o.w(`Unknown projection name: ${c}. Falling back to mercator projection.`),{projection:new nr,transform:new ds,cameraHelper:new Tr}}})(e);this.projection=r.projection,this.map.migrateProjection(r.transform,r.cameraHelper);for(const c in this.sourceCaches)this.sourceCaches[c].reload()}_validate(e,r,c,f,m={}){return(!m||m.validate!==!1)&&mu(this,e.call(o.z,o.e({key:r,style:this.serialize(),value:c,styleSpec:o.v},f)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Sa().off(Pi,this._rtlPluginLoaded);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this.sourceCaches){const c=this.sourceCaches[r];c.setEventedParent(null),c.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const r in this.sourceCaches)this.sourceCaches[r].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,r,c,f,m=!1){let x=!1,T=!1;const A={};for(const k of this._order){const L=this._layers[k];if(L.type!=="symbol")continue;if(!A[L.source]){const N=this.sourceCaches[L.source];A[L.source]=N.getRenderableIds(!0).map((q=>N.getTileByID(q))).sort(((q,X)=>X.tileID.overscaledZ-q.tileID.overscaledZ||(q.tileID.isLessThan(X.tileID)?-1:1)))}const F=this.crossTileSymbolIndex.addLayer(L,A[L.source],e.center.lng);x=x||F}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((m=m||this._layerOrderChanged||c===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(W.now(),e.zoom))&&(this.pauseablePlacement=new sh(e,this.map.terrain,this._order,m,r,c,f,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(W.now()),T=!0),x&&this.pauseablePlacement.placement.setStale()),T||x)for(const k of this._order){const L=this._layers[k];L.type==="symbol"&&this.placement.updateLayerOpacities(L,A[L.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(W.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,r){return o._(this,void 0,void 0,(function*(){const c=yield this.imageManager.getImages(r.icons);this._updateTilesForChangedImages();const f=this.sourceCaches[r.source];return f&&f.setDependencies(r.tileID.key,r.type,r.icons),c}))}getGlyphs(e,r){return o._(this,void 0,void 0,(function*(){const c=yield this.glyphManager.getGlyphs(r.stacks),f=this.sourceCaches[r.source];return f&&f.setDependencies(r.tileID.key,r.type,[""]),c}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,r={}){this._checkLoaded(),e&&this._validate(o.z.glyphs,"glyphs",e,null,r)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}getDashes(e,r){return o._(this,void 0,void 0,(function*(){const c={};for(const[f,m]of Object.entries(r.dashes))c[f]=this.lineAtlas.getDash(m.dasharray,m.round);return c}))}addSprite(e,r,c={},f){this._checkLoaded();const m=[{id:e,url:r}],x=[...xt(this.stylesheet.sprite),...m];this._validate(o.z.sprite,"sprite",x,null,c)||(this.stylesheet.sprite=x,this._loadSprite(m,!0,f))}removeSprite(e){this._checkLoaded();const r=xt(this.stylesheet.sprite);if(r.find((c=>c.id===e))){if(this._spritesImagesIds[e])for(const c of this._spritesImagesIds[e])this.imageManager.removeImage(c),this._changedImages[c]=!0;r.splice(r.findIndex((c=>c.id===e)),1),this.stylesheet.sprite=r.length>0?r:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}else this.fire(new o.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return xt(this.stylesheet.sprite)}setSprite(e,r={},c){this._checkLoaded(),e&&this._validate(o.z.sprite,"sprite",e,null,r)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,c):(this._unloadSprite(),c&&c(null)))}}var xf=o.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class gu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,r,c,f,m,x,T,A,k){this.context=e;let L=this.boundPaintVertexBuffers.length!==f.length;for(let F=0;!L&&F<f.length;F++)this.boundPaintVertexBuffers[F]!==f[F]&&(L=!0);!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==c||L||this.boundIndexBuffer!==m||this.boundVertexOffset!==x||this.boundDynamicVertexBuffer!==T||this.boundDynamicVertexBuffer2!==A||this.boundDynamicVertexBuffer3!==k?this.freshBind(r,c,f,m,x,T,A,k):(e.bindVertexArray.set(this.vao),T&&T.bind(),m&&m.dynamicDraw&&m.bind(),A&&A.bind(),k&&k.bind())}freshBind(e,r,c,f,m,x,T,A){const k=e.numAttributes,L=this.context,F=L.gl;this.vao&&this.destroy(),this.vao=L.createVertexArray(),L.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=f,this.boundVertexOffset=m,this.boundDynamicVertexBuffer=x,this.boundDynamicVertexBuffer2=T,this.boundDynamicVertexBuffer3=A,r.enableAttributes(F,e);for(const N of c)N.enableAttributes(F,e);x&&x.enableAttributes(F,e),T&&T.enableAttributes(F,e),A&&A.enableAttributes(F,e),r.bind(),r.setVertexAttribPointers(F,e,m);for(const N of c)N.bind(),N.setVertexAttribPointers(F,e,m);x&&(x.bind(),x.setVertexAttribPointers(F,e,m)),f&&f.bind(),T&&(T.bind(),T.setVertexAttribPointers(F,e,m)),A&&(A.bind(),A.setVertexAttribPointers(F,e,m)),L.currentNumAttributes=k}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const uh=(p,e,r,c,f)=>({u_texture:0,u_ele_delta:p,u_fog_matrix:e,u_fog_color:r?r.properties.get("fog-color"):o.bf.white,u_fog_ground_blend:r?r.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:f?0:r?r.calculateFogBlendOpacity(c):0,u_horizon_color:r?r.properties.get("horizon-color"):o.bf.white,u_horizon_fog_blend:r?r.properties.get("horizon-fog-blend"):1,u_is_globe_mode:f?1:0}),_u={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Dl(p){const e=[];for(let r=0;r<p.length;r++){if(p[r]===null)continue;const c=p[r].split(" ");e.push(c.pop())}return e}class hh{constructor(e,r,c,f,m,x,T,A,k=[]){const L=e.gl;this.program=L.createProgram();const F=Dl(r.staticAttributes),N=c?c.getBinderAttributes():[],q=F.concat(N),X=zn.prelude.staticUniforms?Dl(zn.prelude.staticUniforms):[],ae=T.staticUniforms?Dl(T.staticUniforms):[],ne=r.staticUniforms?Dl(r.staticUniforms):[],re=c?c.getBinderUniforms():[],oe=X.concat(ae).concat(ne).concat(re),ue=[];for(const De of oe)ue.indexOf(De)<0&&ue.push(De);const le=c?c.defines():[];ka(L)&&le.unshift("#version 300 es"),m&&le.push("#define OVERDRAW_INSPECTOR;"),x&&le.push("#define TERRAIN3D;"),A&&le.push(A),k&&le.push(...k);let me=le.concat(zn.prelude.fragmentSource,T.fragmentSource,r.fragmentSource).join(`
`),ye=le.concat(zn.prelude.vertexSource,T.vertexSource,r.vertexSource).join(`
`);ka(L)||(me=(function(De){return De.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(me),ye=(function(De){return De.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(ye));const he=L.createShader(L.FRAGMENT_SHADER);if(L.isContextLost())return void(this.failedToCreate=!0);if(L.shaderSource(he,me),L.compileShader(he),!L.getShaderParameter(he,L.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${L.getShaderInfoLog(he)}`);L.attachShader(this.program,he);const Me=L.createShader(L.VERTEX_SHADER);if(L.isContextLost())return void(this.failedToCreate=!0);if(L.shaderSource(Me,ye),L.compileShader(Me),!L.getShaderParameter(Me,L.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${L.getShaderInfoLog(Me)}`);L.attachShader(this.program,Me),this.attributes={};const je={};this.numAttributes=q.length;for(let De=0;De<this.numAttributes;De++)q[De]&&(L.bindAttribLocation(this.program,De,q[De]),this.attributes[q[De]]=De);if(L.linkProgram(this.program),!L.getProgramParameter(this.program,L.LINK_STATUS))throw new Error(`Program failed to link: ${L.getProgramInfoLog(this.program)}`);L.deleteShader(Me),L.deleteShader(he);for(let De=0;De<ue.length;De++){const Le=ue[De];if(Le&&!je[Le]){const Ne=L.getUniformLocation(this.program,Le);Ne&&(je[Le]=Ne)}}this.fixedUniforms=f(e,je),this.terrainUniforms=((De,Le)=>({u_depth:new o.bQ(De,Le.u_depth),u_terrain:new o.bQ(De,Le.u_terrain),u_terrain_dim:new o.bg(De,Le.u_terrain_dim),u_terrain_matrix:new o.bS(De,Le.u_terrain_matrix),u_terrain_unpack:new o.bT(De,Le.u_terrain_unpack),u_terrain_exaggeration:new o.bg(De,Le.u_terrain_exaggeration)}))(e,je),this.projectionUniforms=((De,Le)=>({u_projection_matrix:new o.bS(De,Le.u_projection_matrix),u_projection_tile_mercator_coords:new o.bT(De,Le.u_projection_tile_mercator_coords),u_projection_clipping_plane:new o.bT(De,Le.u_projection_clipping_plane),u_projection_transition:new o.bg(De,Le.u_projection_transition),u_projection_fallback_matrix:new o.bS(De,Le.u_projection_fallback_matrix)}))(e,je),this.binderUniforms=c?c.getUniforms(e,je):[]}draw(e,r,c,f,m,x,T,A,k,L,F,N,q,X,ae,ne,re,oe,ue){const le=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(c),e.setStencilMode(f),e.setColorMode(m),e.setCullFace(x),A){e.activeTexture.set(le.TEXTURE2),le.bindTexture(le.TEXTURE_2D,A.depthTexture),e.activeTexture.set(le.TEXTURE3),le.bindTexture(le.TEXTURE_2D,A.texture);for(const ye in this.terrainUniforms)this.terrainUniforms[ye].set(A[ye])}if(k)for(const ye in k)this.projectionUniforms[_u[ye]].set(k[ye]);if(T)for(const ye in this.fixedUniforms)this.fixedUniforms[ye].set(T[ye]);ne&&ne.setUniforms(e,this.binderUniforms,X,{zoom:ae});let me=0;switch(r){case le.LINES:me=2;break;case le.TRIANGLES:me=3;break;case le.LINE_STRIP:me=1}for(const ye of q.get()){const he=ye.vaos||(ye.vaos={});(he[L]||(he[L]=new gu)).bind(e,this,F,ne?ne.getPaintVertexBuffers():[],N,ye.vertexOffset,re,oe,ue),le.drawElements(r,ye.primitiveLength*me,le.UNSIGNED_SHORT,ye.primitiveOffset*me*2)}}}function rr(p,e,r){const c=1/o.aC(r,1,e.transform.tileZoom),f=Math.pow(2,r.tileID.overscaledZ),m=r.tileSize*Math.pow(2,e.transform.tileZoom)/f,x=m*(r.tileID.canonical.x+r.tileID.wrap*f),T=m*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[c,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[x>>16,T>>16],u_pixel_coord_lower:[65535&x,65535&T]}}const kl=(p,e,r,c)=>{const f=p.style.light,m=f.properties.get("position"),x=[m.x,m.y,m.z],T=o.bW();f.properties.get("anchor")==="viewport"&&o.bX(T,p.transform.bearingInRadians),o.bY(x,x,T);const A=p.transform.transformLightDirection(x),k=f.properties.get("color");return{u_lightpos:x,u_lightpos_globe:A,u_lightintensity:f.properties.get("intensity"),u_lightcolor:[k.r,k.g,k.b],u_vertical_gradient:+e,u_opacity:r,u_fill_translate:c}},dh=(p,e,r,c,f,m,x)=>o.e(kl(p,e,r,c),rr(m,p,x),{u_height_factor:-Math.pow(2,f.overscaledZ)/x.tileSize/8}),Yo=(p,e,r,c)=>o.e(rr(e,p,r),{u_fill_translate:c}),Ll=(p,e)=>({u_world:p,u_fill_translate:e}),pd=(p,e,r,c,f)=>o.e(Yo(p,e,r,f),{u_world:c}),vc=(p,e,r,c,f)=>{const m=p.transform;let x,T,A=0;if(r.paint.get("circle-pitch-alignment")==="map"){const k=o.aC(e,1,m.zoom);x=!0,T=[k,k],A=k/(o.$*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*f}else x=!1,T=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(r.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+x,u_device_pixel_ratio:p.pixelRatio,u_extrude_scale:T,u_globe_extrude_scale:A,u_translate:c}},md=p=>({u_pixel_extrude_scale:[1/p.width,1/p.height]}),qr=p=>({u_viewport_size:[p.width,p.height]}),gd=(p,e=1)=>({u_color:p,u_overlay:0,u_overlay_scale:e}),fh=(p,e,r,c)=>{const f=o.aC(p,1,e)/(o.$*Math.pow(2,p.tileID.overscaledZ))*2*Math.PI*c;return{u_extrude_scale:o.aC(p,1,e),u_intensity:r,u_globe_extrude_scale:f}},_d=(p,e,r,c)=>{const f=o.L();o.bZ(f,0,p.width,p.height,0,0,1);const m=p.context.gl;return{u_matrix:f,u_world:[m.drawingBufferWidth,m.drawingBufferHeight],u_image:r,u_color_ramp:c,u_opacity:e.paint.get("heatmap-opacity")}},ph=(p,e,r)=>{const c=r.paint.get("hillshade-accent-color");let f;switch(r.paint.get("hillshade-method")){case"basic":f=4;break;case"combined":f=1;break;case"igor":f=2;break;case"multidirectional":f=3;break;default:f=0}const m=r.getIlluminationProperties();for(let x=0;x<m.directionRadians.length;x++)r.paint.get("hillshade-illumination-anchor")==="viewport"&&(m.directionRadians[x]+=p.transform.bearingInRadians);return{u_image:0,u_latrange:Ol(0,e.tileID),u_exaggeration:r.paint.get("hillshade-exaggeration"),u_altitudes:m.altitudeRadians,u_azimuths:m.directionRadians,u_accent:c,u_method:f,u_highlights:m.highlightColor,u_shadows:m.shadowColor}},yu=(p,e)=>{const r=e.stride,c=o.L();return o.bZ(c,0,o.$,-o.$,0,0,1),o.M(c,c,[0,-o.$,0]),{u_matrix:c,u_image:1,u_dimension:[r,r],u_zoom:p.overscaledZ,u_unpack:e.getUnpackVector()}};function Ol(p,e){const r=Math.pow(2,e.canonical.z),c=e.canonical.y;return[new o.a1(0,c/r).toLngLat().lat,new o.a1(0,(c+1)/r).toLngLat().lat]}const Bl=(p,e,r=0)=>({u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:r,u_opacity:p.paint.get("color-relief-opacity")}),xc=(p,e,r,c)=>{const f=p.transform;return{u_translation:gh(p,e,r),u_ratio:c/o.aC(e,1,f.zoom),u_device_pixel_ratio:p.pixelRatio,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},bc=(p,e,r,c,f)=>o.e(xc(p,e,r,c),{u_image:0,u_image_height:f}),ho=(p,e,r,c,f)=>{const m=p.transform,x=Ls(e,m);return{u_translation:gh(p,e,r),u_texsize:e.imageAtlasTexture.size,u_ratio:c/o.aC(e,1,m.zoom),u_device_pixel_ratio:p.pixelRatio,u_image:0,u_scale:[x,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},mh=(p,e,r,c,f)=>{const m=Ls(e,p.transform);return o.e(xc(p,e,r,c),{u_tileratio:m,u_crossfade_from:f.fromScale,u_crossfade_to:f.toScale,u_image:0,u_mix:f.t,u_lineatlas_width:p.lineAtlas.width,u_lineatlas_height:p.lineAtlas.height})},vu=(p,e,r,c,f,m)=>{const x=Ls(e,p.transform);return o.e(xc(p,e,r,c),{u_image:0,u_image_height:m,u_tileratio:x,u_crossfade_from:f.fromScale,u_crossfade_to:f.toScale,u_image_dash:1,u_mix:f.t,u_lineatlas_width:p.lineAtlas.width,u_lineatlas_height:p.lineAtlas.height})};function Ls(p,e){return 1/o.aC(p,1,e.tileZoom)}function gh(p,e,r){return o.aD(p.transform,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const wc=(p,e,r,c,f)=>{return{u_tl_parent:p,u_scale_parent:e,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(x=c.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(m=c.paint.get("raster-contrast"),m>0?1/(1-m):1+m),u_spin_weights:yd(c.paint.get("raster-hue-rotate")),u_coords_top:[f[0].x,f[0].y,f[1].x,f[1].y],u_coords_bottom:[f[3].x,f[3].y,f[2].x,f[2].y]};var m,x};function yd(p){p*=Math.PI/180;const e=Math.sin(p),r=Math.cos(p);return[(2*r+1)/3,(-Math.sqrt(3)*e-r+1)/3,(Math.sqrt(3)*e-r+1)/3]}const vd=(p,e,r,c,f,m,x,T,A,k,L,F,N)=>{const q=x.transform;return{u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:q.cameraToCenterDistance,u_pitch:q.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:q.width/q.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_label_plane_matrix:T,u_coord_matrix:A,u_is_text:+L,u_pitch_with_map:+c,u_is_along_line:f,u_is_variable_anchor:m,u_texsize:F,u_texture:0,u_translation:k,u_pitched_scale:N}},_h=(p,e,r,c,f,m,x,T,A,k,L,F,N,q)=>{const X=x.transform;return o.e(vd(p,e,r,c,f,m,x,T,A,k,L,F,q),{u_gamma_scale:c?Math.cos(X.pitch*Math.PI/180)*X.cameraToCenterDistance:1,u_device_pixel_ratio:x.pixelRatio,u_is_halo:1})},xd=(p,e,r,c,f,m,x,T,A,k,L,F,N)=>o.e(_h(p,e,r,c,f,m,x,T,A,k,!0,L,0,N),{u_texsize_icon:F,u_texture_icon:1}),bd=(p,e)=>({u_opacity:p,u_color:e}),yh=(p,e,r,c,f)=>o.e((function(m,x,T,A){const k=T.imageManager.getPattern(m.from.toString()),L=T.imageManager.getPattern(m.to.toString()),{width:F,height:N}=T.imageManager.getPixelSize(),q=Math.pow(2,A.tileID.overscaledZ),X=A.tileSize*Math.pow(2,T.transform.tileZoom)/q,ae=X*(A.tileID.canonical.x+A.tileID.wrap*q),ne=X*A.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:k.tl,u_pattern_br_a:k.br,u_pattern_tl_b:L.tl,u_pattern_br_b:L.br,u_texsize:[F,N],u_mix:x.t,u_pattern_size_a:k.displaySize,u_pattern_size_b:L.displaySize,u_scale_a:x.fromScale,u_scale_b:x.toScale,u_tile_units_to_pixels:1/o.aC(A,1,T.transform.tileZoom),u_pixel_coord_upper:[ae>>16,ne>>16],u_pixel_coord_lower:[65535&ae,65535&ne]}})(r,f,e,c),{u_opacity:p}),jn=(p,e)=>{},fo={fillExtrusion:(p,e)=>({u_lightpos:new o.bU(p,e.u_lightpos),u_lightpos_globe:new o.bU(p,e.u_lightpos_globe),u_lightintensity:new o.bg(p,e.u_lightintensity),u_lightcolor:new o.bU(p,e.u_lightcolor),u_vertical_gradient:new o.bg(p,e.u_vertical_gradient),u_opacity:new o.bg(p,e.u_opacity),u_fill_translate:new o.bV(p,e.u_fill_translate)}),fillExtrusionPattern:(p,e)=>({u_lightpos:new o.bU(p,e.u_lightpos),u_lightpos_globe:new o.bU(p,e.u_lightpos_globe),u_lightintensity:new o.bg(p,e.u_lightintensity),u_lightcolor:new o.bU(p,e.u_lightcolor),u_vertical_gradient:new o.bg(p,e.u_vertical_gradient),u_height_factor:new o.bg(p,e.u_height_factor),u_opacity:new o.bg(p,e.u_opacity),u_fill_translate:new o.bV(p,e.u_fill_translate),u_image:new o.bQ(p,e.u_image),u_texsize:new o.bV(p,e.u_texsize),u_pixel_coord_upper:new o.bV(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.bV(p,e.u_pixel_coord_lower),u_scale:new o.bU(p,e.u_scale),u_fade:new o.bg(p,e.u_fade)}),fill:(p,e)=>({u_fill_translate:new o.bV(p,e.u_fill_translate)}),fillPattern:(p,e)=>({u_image:new o.bQ(p,e.u_image),u_texsize:new o.bV(p,e.u_texsize),u_pixel_coord_upper:new o.bV(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.bV(p,e.u_pixel_coord_lower),u_scale:new o.bU(p,e.u_scale),u_fade:new o.bg(p,e.u_fade),u_fill_translate:new o.bV(p,e.u_fill_translate)}),fillOutline:(p,e)=>({u_world:new o.bV(p,e.u_world),u_fill_translate:new o.bV(p,e.u_fill_translate)}),fillOutlinePattern:(p,e)=>({u_world:new o.bV(p,e.u_world),u_image:new o.bQ(p,e.u_image),u_texsize:new o.bV(p,e.u_texsize),u_pixel_coord_upper:new o.bV(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.bV(p,e.u_pixel_coord_lower),u_scale:new o.bU(p,e.u_scale),u_fade:new o.bg(p,e.u_fade),u_fill_translate:new o.bV(p,e.u_fill_translate)}),circle:(p,e)=>({u_camera_to_center_distance:new o.bg(p,e.u_camera_to_center_distance),u_scale_with_map:new o.bQ(p,e.u_scale_with_map),u_pitch_with_map:new o.bQ(p,e.u_pitch_with_map),u_extrude_scale:new o.bV(p,e.u_extrude_scale),u_device_pixel_ratio:new o.bg(p,e.u_device_pixel_ratio),u_globe_extrude_scale:new o.bg(p,e.u_globe_extrude_scale),u_translate:new o.bV(p,e.u_translate)}),collisionBox:(p,e)=>({u_pixel_extrude_scale:new o.bV(p,e.u_pixel_extrude_scale)}),collisionCircle:(p,e)=>({u_viewport_size:new o.bV(p,e.u_viewport_size)}),debug:(p,e)=>({u_color:new o.bR(p,e.u_color),u_overlay:new o.bQ(p,e.u_overlay),u_overlay_scale:new o.bg(p,e.u_overlay_scale)}),depth:jn,clippingMask:jn,heatmap:(p,e)=>({u_extrude_scale:new o.bg(p,e.u_extrude_scale),u_intensity:new o.bg(p,e.u_intensity),u_globe_extrude_scale:new o.bg(p,e.u_globe_extrude_scale)}),heatmapTexture:(p,e)=>({u_matrix:new o.bS(p,e.u_matrix),u_world:new o.bV(p,e.u_world),u_image:new o.bQ(p,e.u_image),u_color_ramp:new o.bQ(p,e.u_color_ramp),u_opacity:new o.bg(p,e.u_opacity)}),hillshade:(p,e)=>({u_image:new o.bQ(p,e.u_image),u_latrange:new o.bV(p,e.u_latrange),u_exaggeration:new o.bg(p,e.u_exaggeration),u_altitudes:new o.b$(p,e.u_altitudes),u_azimuths:new o.b$(p,e.u_azimuths),u_accent:new o.bR(p,e.u_accent),u_method:new o.bQ(p,e.u_method),u_shadows:new o.b_(p,e.u_shadows),u_highlights:new o.b_(p,e.u_highlights)}),hillshadePrepare:(p,e)=>({u_matrix:new o.bS(p,e.u_matrix),u_image:new o.bQ(p,e.u_image),u_dimension:new o.bV(p,e.u_dimension),u_zoom:new o.bg(p,e.u_zoom),u_unpack:new o.bT(p,e.u_unpack)}),colorRelief:(p,e)=>({u_image:new o.bQ(p,e.u_image),u_unpack:new o.bT(p,e.u_unpack),u_dimension:new o.bV(p,e.u_dimension),u_elevation_stops:new o.bQ(p,e.u_elevation_stops),u_color_stops:new o.bQ(p,e.u_color_stops),u_color_ramp_size:new o.bQ(p,e.u_color_ramp_size),u_opacity:new o.bg(p,e.u_opacity)}),line:(p,e)=>({u_translation:new o.bV(p,e.u_translation),u_ratio:new o.bg(p,e.u_ratio),u_device_pixel_ratio:new o.bg(p,e.u_device_pixel_ratio),u_units_to_pixels:new o.bV(p,e.u_units_to_pixels)}),lineGradient:(p,e)=>({u_translation:new o.bV(p,e.u_translation),u_ratio:new o.bg(p,e.u_ratio),u_device_pixel_ratio:new o.bg(p,e.u_device_pixel_ratio),u_units_to_pixels:new o.bV(p,e.u_units_to_pixels),u_image:new o.bQ(p,e.u_image),u_image_height:new o.bg(p,e.u_image_height)}),linePattern:(p,e)=>({u_translation:new o.bV(p,e.u_translation),u_texsize:new o.bV(p,e.u_texsize),u_ratio:new o.bg(p,e.u_ratio),u_device_pixel_ratio:new o.bg(p,e.u_device_pixel_ratio),u_image:new o.bQ(p,e.u_image),u_units_to_pixels:new o.bV(p,e.u_units_to_pixels),u_scale:new o.bU(p,e.u_scale),u_fade:new o.bg(p,e.u_fade)}),lineSDF:(p,e)=>({u_translation:new o.bV(p,e.u_translation),u_ratio:new o.bg(p,e.u_ratio),u_device_pixel_ratio:new o.bg(p,e.u_device_pixel_ratio),u_units_to_pixels:new o.bV(p,e.u_units_to_pixels),u_image:new o.bQ(p,e.u_image),u_mix:new o.bg(p,e.u_mix),u_tileratio:new o.bg(p,e.u_tileratio),u_crossfade_from:new o.bg(p,e.u_crossfade_from),u_crossfade_to:new o.bg(p,e.u_crossfade_to),u_lineatlas_width:new o.bg(p,e.u_lineatlas_width),u_lineatlas_height:new o.bg(p,e.u_lineatlas_height)}),lineGradientSDF:(p,e)=>({u_translation:new o.bV(p,e.u_translation),u_ratio:new o.bg(p,e.u_ratio),u_device_pixel_ratio:new o.bg(p,e.u_device_pixel_ratio),u_units_to_pixels:new o.bV(p,e.u_units_to_pixels),u_image:new o.bQ(p,e.u_image),u_image_height:new o.bg(p,e.u_image_height),u_tileratio:new o.bg(p,e.u_tileratio),u_crossfade_from:new o.bg(p,e.u_crossfade_from),u_crossfade_to:new o.bg(p,e.u_crossfade_to),u_image_dash:new o.bQ(p,e.u_image_dash),u_mix:new o.bg(p,e.u_mix),u_lineatlas_width:new o.bg(p,e.u_lineatlas_width),u_lineatlas_height:new o.bg(p,e.u_lineatlas_height)}),raster:(p,e)=>({u_tl_parent:new o.bV(p,e.u_tl_parent),u_scale_parent:new o.bg(p,e.u_scale_parent),u_buffer_scale:new o.bg(p,e.u_buffer_scale),u_fade_t:new o.bg(p,e.u_fade_t),u_opacity:new o.bg(p,e.u_opacity),u_image0:new o.bQ(p,e.u_image0),u_image1:new o.bQ(p,e.u_image1),u_brightness_low:new o.bg(p,e.u_brightness_low),u_brightness_high:new o.bg(p,e.u_brightness_high),u_saturation_factor:new o.bg(p,e.u_saturation_factor),u_contrast_factor:new o.bg(p,e.u_contrast_factor),u_spin_weights:new o.bU(p,e.u_spin_weights),u_coords_top:new o.bT(p,e.u_coords_top),u_coords_bottom:new o.bT(p,e.u_coords_bottom)}),symbolIcon:(p,e)=>({u_is_size_zoom_constant:new o.bQ(p,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bQ(p,e.u_is_size_feature_constant),u_size_t:new o.bg(p,e.u_size_t),u_size:new o.bg(p,e.u_size),u_camera_to_center_distance:new o.bg(p,e.u_camera_to_center_distance),u_pitch:new o.bg(p,e.u_pitch),u_rotate_symbol:new o.bQ(p,e.u_rotate_symbol),u_aspect_ratio:new o.bg(p,e.u_aspect_ratio),u_fade_change:new o.bg(p,e.u_fade_change),u_label_plane_matrix:new o.bS(p,e.u_label_plane_matrix),u_coord_matrix:new o.bS(p,e.u_coord_matrix),u_is_text:new o.bQ(p,e.u_is_text),u_pitch_with_map:new o.bQ(p,e.u_pitch_with_map),u_is_along_line:new o.bQ(p,e.u_is_along_line),u_is_variable_anchor:new o.bQ(p,e.u_is_variable_anchor),u_texsize:new o.bV(p,e.u_texsize),u_texture:new o.bQ(p,e.u_texture),u_translation:new o.bV(p,e.u_translation),u_pitched_scale:new o.bg(p,e.u_pitched_scale)}),symbolSDF:(p,e)=>({u_is_size_zoom_constant:new o.bQ(p,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bQ(p,e.u_is_size_feature_constant),u_size_t:new o.bg(p,e.u_size_t),u_size:new o.bg(p,e.u_size),u_camera_to_center_distance:new o.bg(p,e.u_camera_to_center_distance),u_pitch:new o.bg(p,e.u_pitch),u_rotate_symbol:new o.bQ(p,e.u_rotate_symbol),u_aspect_ratio:new o.bg(p,e.u_aspect_ratio),u_fade_change:new o.bg(p,e.u_fade_change),u_label_plane_matrix:new o.bS(p,e.u_label_plane_matrix),u_coord_matrix:new o.bS(p,e.u_coord_matrix),u_is_text:new o.bQ(p,e.u_is_text),u_pitch_with_map:new o.bQ(p,e.u_pitch_with_map),u_is_along_line:new o.bQ(p,e.u_is_along_line),u_is_variable_anchor:new o.bQ(p,e.u_is_variable_anchor),u_texsize:new o.bV(p,e.u_texsize),u_texture:new o.bQ(p,e.u_texture),u_gamma_scale:new o.bg(p,e.u_gamma_scale),u_device_pixel_ratio:new o.bg(p,e.u_device_pixel_ratio),u_is_halo:new o.bQ(p,e.u_is_halo),u_translation:new o.bV(p,e.u_translation),u_pitched_scale:new o.bg(p,e.u_pitched_scale)}),symbolTextAndIcon:(p,e)=>({u_is_size_zoom_constant:new o.bQ(p,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bQ(p,e.u_is_size_feature_constant),u_size_t:new o.bg(p,e.u_size_t),u_size:new o.bg(p,e.u_size),u_camera_to_center_distance:new o.bg(p,e.u_camera_to_center_distance),u_pitch:new o.bg(p,e.u_pitch),u_rotate_symbol:new o.bQ(p,e.u_rotate_symbol),u_aspect_ratio:new o.bg(p,e.u_aspect_ratio),u_fade_change:new o.bg(p,e.u_fade_change),u_label_plane_matrix:new o.bS(p,e.u_label_plane_matrix),u_coord_matrix:new o.bS(p,e.u_coord_matrix),u_is_text:new o.bQ(p,e.u_is_text),u_pitch_with_map:new o.bQ(p,e.u_pitch_with_map),u_is_along_line:new o.bQ(p,e.u_is_along_line),u_is_variable_anchor:new o.bQ(p,e.u_is_variable_anchor),u_texsize:new o.bV(p,e.u_texsize),u_texsize_icon:new o.bV(p,e.u_texsize_icon),u_texture:new o.bQ(p,e.u_texture),u_texture_icon:new o.bQ(p,e.u_texture_icon),u_gamma_scale:new o.bg(p,e.u_gamma_scale),u_device_pixel_ratio:new o.bg(p,e.u_device_pixel_ratio),u_is_halo:new o.bQ(p,e.u_is_halo),u_translation:new o.bV(p,e.u_translation),u_pitched_scale:new o.bg(p,e.u_pitched_scale)}),background:(p,e)=>({u_opacity:new o.bg(p,e.u_opacity),u_color:new o.bR(p,e.u_color)}),backgroundPattern:(p,e)=>({u_opacity:new o.bg(p,e.u_opacity),u_image:new o.bQ(p,e.u_image),u_pattern_tl_a:new o.bV(p,e.u_pattern_tl_a),u_pattern_br_a:new o.bV(p,e.u_pattern_br_a),u_pattern_tl_b:new o.bV(p,e.u_pattern_tl_b),u_pattern_br_b:new o.bV(p,e.u_pattern_br_b),u_texsize:new o.bV(p,e.u_texsize),u_mix:new o.bg(p,e.u_mix),u_pattern_size_a:new o.bV(p,e.u_pattern_size_a),u_pattern_size_b:new o.bV(p,e.u_pattern_size_b),u_scale_a:new o.bg(p,e.u_scale_a),u_scale_b:new o.bg(p,e.u_scale_b),u_pixel_coord_upper:new o.bV(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.bV(p,e.u_pixel_coord_lower),u_tile_units_to_pixels:new o.bg(p,e.u_tile_units_to_pixels)}),terrain:(p,e)=>({u_texture:new o.bQ(p,e.u_texture),u_ele_delta:new o.bg(p,e.u_ele_delta),u_fog_matrix:new o.bS(p,e.u_fog_matrix),u_fog_color:new o.bR(p,e.u_fog_color),u_fog_ground_blend:new o.bg(p,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new o.bg(p,e.u_fog_ground_blend_opacity),u_horizon_color:new o.bR(p,e.u_horizon_color),u_horizon_fog_blend:new o.bg(p,e.u_horizon_fog_blend),u_is_globe_mode:new o.bg(p,e.u_is_globe_mode)}),terrainDepth:(p,e)=>({u_ele_delta:new o.bg(p,e.u_ele_delta)}),terrainCoords:(p,e)=>({u_texture:new o.bQ(p,e.u_texture),u_terrain_coords_id:new o.bg(p,e.u_terrain_coords_id),u_ele_delta:new o.bg(p,e.u_ele_delta)}),projectionErrorMeasurement:(p,e)=>({u_input:new o.bg(p,e.u_input),u_output_expected:new o.bg(p,e.u_output_expected)}),atmosphere:(p,e)=>({u_sun_pos:new o.bU(p,e.u_sun_pos),u_atmosphere_blend:new o.bg(p,e.u_atmosphere_blend),u_globe_position:new o.bU(p,e.u_globe_position),u_globe_radius:new o.bg(p,e.u_globe_radius),u_inv_proj_matrix:new o.bS(p,e.u_inv_proj_matrix)}),sky:(p,e)=>({u_sky_color:new o.bR(p,e.u_sky_color),u_horizon_color:new o.bR(p,e.u_horizon_color),u_horizon:new o.bV(p,e.u_horizon),u_horizon_normal:new o.bV(p,e.u_horizon_normal),u_sky_horizon_blend:new o.bg(p,e.u_sky_horizon_blend),u_sky_blend:new o.bg(p,e.u_sky_blend)})};class ps{constructor(e,r,c){this.context=e;const f=e.gl;this.buffer=f.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const r=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const xu={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class bu{constructor(e,r,c,f){this.length=r.length,this.attributes=c,this.itemSize=r.bytesPerElement,this.dynamicDraw=f,this.context=e;const m=e.gl;this.buffer=m.createBuffer(),e.bindVertexBuffer.set(this.buffer),m.bufferData(m.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,r){for(let c=0;c<this.attributes.length;c++){const f=r.attributes[this.attributes[c].name];f!==void 0&&e.enableVertexAttribArray(f)}}setVertexAttribPointers(e,r,c){for(let f=0;f<this.attributes.length;f++){const m=this.attributes[f],x=r.attributes[m.name];x!==void 0&&e.vertexAttribPointer(x,m.components,e[xu[m.type]],!1,this.itemSize,m.offset+this.itemSize*(c||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Di{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class wu extends Di{getDefault(){return o.bf.transparent}set(e){const r=this.current;(e.r!==r.r||e.g!==r.g||e.b!==r.b||e.a!==r.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class vh extends Di{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Cr extends Di{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Sc extends Di{getDefault(){return[!0,!0,!0,!0]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||e[3]!==r[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Mc extends Di{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class xh extends Di{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class wd extends Di{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const r=this.current;(e.func!==r.func||e.ref!==r.ref||e.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Wo extends Di{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Qo extends Di{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=e,this.dirty=!1}}class bh extends Di{getDefault(){return[0,1]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class wh extends Di{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=e,this.dirty=!1}}class ms extends Di{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Tc extends Di{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.BLEND):r.disable(r.BLEND),this.current=e,this.dirty=!1}}class Ec extends Di{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Su extends Di{getDefault(){return o.bf.transparent}set(e){const r=this.current;(e.r!==r.r||e.g!==r.g||e.b!==r.b||e.a!==r.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Ko extends Di{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Cc extends Di{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=e,this.dirty=!1}}class Nl extends Di{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class sr extends Di{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Sh extends Di{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Mu extends Di{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class or extends Di{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||e[3]!==r[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class gs extends Di{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Fn extends Di{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Os extends Di{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Jo extends Di{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class el extends Di{getDefault(){return null}set(e){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ac extends Di{getDefault(){return null}set(e){var r;if(e===this.current&&!this.dirty)return;const c=this.gl;ka(c)?c.bindVertexArray(e):(r=c.getExtension("OES_vertex_array_object"))===null||r===void 0||r.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class po extends Di{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Ar extends Di{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Mh extends Di{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class mo extends Di{constructor(e,r){super(e),this.context=e,this.parent=r}getDefault(){return null}}class ui extends mo{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Tu extends mo{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class lr extends mo{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const Pc="Framebuffer is not complete";class cr{constructor(e,r,c,f,m){this.context=e,this.width=r,this.height=c;const x=e.gl,T=this.framebuffer=x.createFramebuffer();if(this.colorAttachment=new ui(e,T),f)this.depthAttachment=m?new lr(e,T):new Tu(e,T);else if(m)throw new Error("Stencil cannot be set without depth");if(x.checkFramebufferStatus(x.FRAMEBUFFER)!==x.FRAMEBUFFER_COMPLETE)throw new Error(Pc)}destroy(){const e=this.context.gl,r=this.colorAttachment.get();if(r&&e.deleteTexture(r),this.depthAttachment){const c=this.depthAttachment.get();c&&e.deleteRenderbuffer(c)}e.deleteFramebuffer(this.framebuffer)}}class Sd{constructor(e){var r,c;if(this.gl=e,this.clearColor=new wu(this),this.clearDepth=new vh(this),this.clearStencil=new Cr(this),this.colorMask=new Sc(this),this.depthMask=new Mc(this),this.stencilMask=new xh(this),this.stencilFunc=new wd(this),this.stencilOp=new Wo(this),this.stencilTest=new Qo(this),this.depthRange=new bh(this),this.depthTest=new wh(this),this.depthFunc=new ms(this),this.blend=new Tc(this),this.blendFunc=new Ec(this),this.blendColor=new Su(this),this.blendEquation=new Ko(this),this.cullFace=new Cc(this),this.cullFaceSide=new Nl(this),this.frontFace=new sr(this),this.program=new Sh(this),this.activeTexture=new Mu(this),this.viewport=new or(this),this.bindFramebuffer=new gs(this),this.bindRenderbuffer=new Fn(this),this.bindTexture=new Os(this),this.bindVertexBuffer=new Jo(this),this.bindElementBuffer=new el(this),this.bindVertexArray=new Ac(this),this.pixelStoreUnpack=new po(this),this.pixelStoreUnpackPremultiplyAlpha=new Ar(this),this.pixelStoreUnpackFlipY=new Mh(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),ka(e)){this.HALF_FLOAT=e.HALF_FLOAT;const f=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(r=e.RGBA16F)!==null&&r!==void 0?r:f?.RGBA16F_EXT,this.RGB16F=(c=e.RGB16F)!==null&&c!==void 0?c:f?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const f=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=f?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,r){return new ps(this,e,r)}createVertexBuffer(e,r,c){return new bu(this,e,r,c)}createRenderbuffer(e,r,c){const f=this.gl,m=f.createRenderbuffer();return this.bindRenderbuffer.set(m),f.renderbufferStorage(f.RENDERBUFFER,e,r,c),this.bindRenderbuffer.set(null),m}createFramebuffer(e,r,c,f){return new cr(this,e,r,c,f)}clear({color:e,depth:r,stencil:c}){const f=this.gl;let m=0;e&&(m|=f.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),r!==void 0&&(m|=f.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),c!==void 0&&(m|=f.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),f.clear(m)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){o.bH(e.blendFunction,$i.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return ka(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var r;return ka(this.gl)?this.gl.deleteVertexArray(e):(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let tl;function Bs(p,e,r,c,f){const m=p.context,x=p.transform,T=m.gl,A=p.useProgram("collisionBox"),k=[];let L=0,F=0;for(let re=0;re<c.length;re++){const oe=c[re],ue=e.getTile(oe).getBucket(r);if(!ue)continue;const le=f?ue.textCollisionBox:ue.iconCollisionBox,me=ue.collisionCircleArray;me.length>0&&(k.push({circleArray:me,circleOffset:F,coord:oe}),L+=me.length/4,F=L),le&&A.draw(m,T.LINES,Yt.disabled,ci.disabled,p.colorModeForRenderPass(),yi.disabled,md(p.transform),p.style.map.terrain&&p.style.map.terrain.getTerrainData(oe),x.getProjectionData({overscaledTileID:oe,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),r.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,null,p.transform.zoom,null,null,le.collisionVertexBuffer)}if(!f||!k.length)return;const N=p.useProgram("collisionCircle"),q=new o.c0;q.resize(4*L),q._trim();let X=0;for(const re of k)for(let oe=0;oe<re.circleArray.length/4;oe++){const ue=4*oe,le=re.circleArray[ue+0],me=re.circleArray[ue+1],ye=re.circleArray[ue+2],he=re.circleArray[ue+3];q.emplace(X++,le,me,ye,he,0),q.emplace(X++,le,me,ye,he,1),q.emplace(X++,le,me,ye,he,2),q.emplace(X++,le,me,ye,he,3)}(!tl||tl.length<2*L)&&(tl=(function(re){const oe=2*re,ue=new o.c2;ue.resize(oe),ue._trim();for(let le=0;le<oe;le++){const me=6*le;ue.uint16[me+0]=4*le+0,ue.uint16[me+1]=4*le+1,ue.uint16[me+2]=4*le+2,ue.uint16[me+3]=4*le+2,ue.uint16[me+4]=4*le+3,ue.uint16[me+5]=4*le+0}return ue})(L));const ae=m.createIndexBuffer(tl,!0),ne=m.createVertexBuffer(q,o.c1.members,!0);for(const re of k){const oe=qr(p.transform);N.draw(m,T.TRIANGLES,Yt.disabled,ci.disabled,p.colorModeForRenderPass(),yi.disabled,oe,p.style.map.terrain&&p.style.map.terrain.getTerrainData(re.coord),null,r.id,ne,ae,o.aM.simpleSegment(0,2*re.circleOffset,re.circleArray.length,re.circleArray.length/2),null,p.transform.zoom,null,null,null)}ne.destroy(),ae.destroy()}const Th=o.ag(new Float32Array(16));function Eu(p,e,r,c,f,m){const{horizontalAlign:x,verticalAlign:T}=o.aH(p);return new o.P((-(x-.5)*e/f+c[0])*m,(-(T-.5)*r/f+c[1])*m)}function jl(p,e,r,c,f,m){const x=e.tileAnchorPoint.add(new o.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let T=c.mult(m);r||(T=T.rotate(-f));const A=x.add(T);return st(A.x,A.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(r){const T=os(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(p),A=Math.atan(T.y/T.x)+(T.x<0?Math.PI:0);return p.add(c.rotate(A))}return p.add(c)}function zc(p,e,r,c,f,m,x,T,A,k,L,F){const N=p.text.placedSymbolArray,q=p.text.dynamicLayoutVertexArray,X=p.icon.dynamicLayoutVertexArray,ae={};q.clear();for(let ne=0;ne<N.length;ne++){const re=N.get(ne),oe=re.hidden||!re.crossTileID||p.allowVerticalPlacement&&!re.placedOrientation?null:c[re.crossTileID];if(oe){const ue=new o.P(re.anchorX,re.anchorY),le={getElevation:F,width:f.width,height:f.height,pitchedLabelPlaneMatrix:m,pitchWithMap:r,transform:f,tileAnchorPoint:ue,translation:k,unwrappedTileID:L},me=r?ni(ue.x,ue.y,le):os(ue.x,ue.y,le),ye=Gr(f.cameraToCenterDistance,me.signedDistanceFromCamera);let he=o.ap(p.textSizeData,T,re)*ye/o.aB;r&&(he*=p.tilePixelRatio/x);const{width:Me,height:je,anchor:De,textOffset:Le,textBoxScale:Ne}=oe,ht=Eu(De,Me,je,Le,Ne,he),dt=f.getPitchedTextCorrection(ue.x+k[0],ue.y+k[1],L),it=jl(me.point,le,e,ht,-f.bearingInRadians,dt),Rt=p.allowVerticalPlacement&&re.placedOrientation===o.ao.vertical?Math.PI/2:0;for(let ei=0;ei<re.numGlyphs;ei++)o.av(q,it,Rt);A&&re.associatedIconIndex>=0&&(ae[re.associatedIconIndex]={shiftedAnchor:it,angle:Rt})}else $n(re.numGlyphs,q)}if(A){X.clear();const ne=p.icon.placedSymbolArray;for(let re=0;re<ne.length;re++){const oe=ne.get(re);if(oe.hidden)$n(oe.numGlyphs,X);else{const ue=ae[re];if(ue)for(let le=0;le<oe.numGlyphs;le++)o.av(X,ue.shiftedAnchor,ue.angle);else $n(oe.numGlyphs,X)}}p.icon.dynamicLayoutVertexBuffer.updateData(X)}p.text.dynamicLayoutVertexBuffer.updateData(q)}function Gn(p,e,r){return r.iconsInText&&e?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function Ns(p,e,r,c,f,m,x,T,A,k,L,F,N){const q=p.context,X=q.gl,ae=p.transform,ne=T==="map",re=A==="map",oe=T!=="viewport"&&r.layout.get("symbol-placement")!=="point",ue=ne&&!re&&!oe,le=!r.layout.get("symbol-sort-key").isConstant();let me=!1;const ye=p.getDepthModeForSublayer(0,Yt.ReadOnly),he=r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Me=[],je=ae.getCircleRadiusCorrection();for(const De of c){const Le=e.getTile(De),Ne=Le.getBucket(r);if(!Ne)continue;const ht=f?Ne.text:Ne.icon;if(!ht||!ht.segments.get().length||!ht.hasVisibleVertices)continue;const dt=ht.programConfigurations.get(r.id),it=f||Ne.sdfIcons,Rt=f?Ne.textSizeData:Ne.iconSizeData,ei=re||ae.pitch!==0,Ii=p.useProgram(Gn(it,f,Ne),dt),Vi=o.an(Rt,ae.zoom),qi=p.style.map.terrain&&p.style.map.terrain.getTerrainData(De);let ua,na,vi,xa,vn=[0,0],La=null;if(f)na=Le.glyphAtlasTexture,vi=X.LINEAR,ua=Le.glyphAtlasTexture.size,Ne.iconsInText&&(vn=Le.imageAtlasTexture.size,La=Le.imageAtlasTexture,xa=ei||p.options.rotating||p.options.zooming||Rt.kind==="composite"||Rt.kind==="camera"?X.LINEAR:X.NEAREST);else{const Ea=r.layout.get("icon-size").constantOr(0)!==1||Ne.iconsNeedLinear;na=Le.imageAtlasTexture,vi=it||p.options.rotating||p.options.zooming||Ea||ei?X.LINEAR:X.NEAREST,ua=Le.imageAtlasTexture.size}const Oa=o.aC(Le,1,p.transform.zoom),Dn=Ji(ne,p.transform,Oa),Xs=o.L();o.aq(Xs,Dn);const mr=Za(re,ne,p.transform,Oa),Ys=o.aD(ae,Le,m,x),Io=ae.getProjectionData({overscaledTileID:De,applyGlobeMatrix:!N,applyTerrainMatrix:!0}),Hl=he&&Ne.hasTextData(),dl=r.layout.get("icon-text-fit")!=="none"&&Hl&&Ne.hasIconData();if(oe){const Ea=p.style.map.terrain?(Kn,xn)=>p.style.map.terrain.getElevation(De,Kn,xn):null,Xa=r.layout.get("text-rotation-alignment")==="map";$a(Ne,p,f,Dn,Xs,re,k,Xa,De.toUnwrapped(),ae.width,ae.height,Ys,Ea)}const Ss=f&&he||dl,gr=oe||Ss?Th:re?Dn:p.transform.clipSpaceToPixelsMatrix,Rr=it&&r.paint.get(f?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Kr;Kr=it?Ne.iconsInText?xd(Rt.kind,Vi,ue,re,oe,Ss,p,gr,mr,Ys,ua,vn,je):_h(Rt.kind,Vi,ue,re,oe,Ss,p,gr,mr,Ys,f,ua,0,je):vd(Rt.kind,Vi,ue,re,oe,Ss,p,gr,mr,Ys,f,ua,je);const Qn={program:Ii,buffers:ht,uniformValues:Kr,projectionData:Io,atlasTexture:na,atlasTextureIcon:La,atlasInterpolation:vi,atlasInterpolationIcon:xa,isSDF:it,hasHalo:Rr};if(le&&Ne.canOverlap){me=!0;const Ea=ht.segments.get();for(const Xa of Ea)Me.push({segments:new o.aM([Xa]),sortKey:Xa.sortKey,state:Qn,terrainData:qi})}else Me.push({segments:ht.segments,sortKey:0,state:Qn,terrainData:qi})}me&&Me.sort(((De,Le)=>De.sortKey-Le.sortKey));for(const De of Me){const Le=De.state;if(q.activeTexture.set(X.TEXTURE0),Le.atlasTexture.bind(Le.atlasInterpolation,X.CLAMP_TO_EDGE),Le.atlasTextureIcon&&(q.activeTexture.set(X.TEXTURE1),Le.atlasTextureIcon&&Le.atlasTextureIcon.bind(Le.atlasInterpolationIcon,X.CLAMP_TO_EDGE)),Le.isSDF){const Ne=Le.uniformValues;Le.hasHalo&&(Ne.u_is_halo=1,go(Le.buffers,De.segments,r,p,Le.program,ye,L,F,Ne,Le.projectionData,De.terrainData)),Ne.u_is_halo=0}go(Le.buffers,De.segments,r,p,Le.program,ye,L,F,Le.uniformValues,Le.projectionData,De.terrainData)}}function go(p,e,r,c,f,m,x,T,A,k,L){const F=c.context;f.draw(F,F.gl.TRIANGLES,m,x,T,yi.backCCW,A,L,k,r.id,p.layoutVertexBuffer,p.indexBuffer,e,r.paint,c.transform.zoom,p.programConfigurations.get(r.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function il(p,e,r,c,f){const m=p.context,x=m.gl,T=ci.disabled,A=new $i([x.ONE,x.ONE],o.bf.transparent,[!0,!0,!0,!0]),k=e.getBucket(r);if(!k)return;const L=c.key;let F=r.heatmapFbos.get(L);F||(F=In(m,e.tileSize,e.tileSize),r.heatmapFbos.set(L,F)),m.bindFramebuffer.set(F.framebuffer),m.viewport.set([0,0,e.tileSize,e.tileSize]),m.clear({color:o.bf.transparent});const N=k.programConfigurations.get(r.id),q=p.useProgram("heatmap",N,!f),X=p.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ae=p.style.map.terrain.getTerrainData(c);q.draw(m,x.TRIANGLES,Yt.disabled,T,A,yi.disabled,fh(e,p.transform.zoom,r.paint.get("heatmap-intensity"),1),ae,X,r.id,k.layoutVertexBuffer,k.indexBuffer,k.segments,r.paint,p.transform.zoom,N)}function _o(p,e,r,c,f){const m=p.context,x=m.gl,T=p.transform;m.setColorMode(p.colorModeForRenderPass());const A=gn(m,e),k=r.key,L=e.heatmapFbos.get(k);if(!L)return;m.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,L.colorAttachment.get()),m.activeTexture.set(x.TEXTURE1),A.bind(x.LINEAR,x.CLAMP_TO_EDGE);const F=T.getProjectionData({overscaledTileID:r,applyTerrainMatrix:f,applyGlobeMatrix:!c});p.useProgram("heatmapTexture").draw(m,x.TRIANGLES,Yt.disabled,ci.disabled,p.colorModeForRenderPass(),yi.disabled,_d(p,e,0,1),null,F,e.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments,e.paint,T.zoom),L.destroy(),e.heatmapFbos.delete(k)}function In(p,e,r){var c,f;const m=p.gl,x=m.createTexture();m.bindTexture(m.TEXTURE_2D,x),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.LINEAR),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.LINEAR);const T=(c=p.HALF_FLOAT)!==null&&c!==void 0?c:m.UNSIGNED_BYTE,A=(f=p.RGBA16F)!==null&&f!==void 0?f:m.RGBA;m.texImage2D(m.TEXTURE_2D,0,A,e,r,0,m.RGBA,T,null);const k=p.createFramebuffer(e,r,!1,!1);return k.colorAttachment.set(x),k}function gn(p,e){return e.colorRampTexture||(e.colorRampTexture=new o.T(p,e.colorRamp,p.gl.RGBA)),e.colorRampTexture}function Zr(p,e,r,c,f,m,x,T){let A=256;if(f.stepInterpolant){const k=e.getSource().maxzoom,L=x.canonical.z===k?Math.ceil(1<<p.transform.maxZoom-x.canonical.z):1;A=o.ah(o.c4(m.maxLineLength/o.$*1024*L),256,r.maxTextureSize)}return T.gradient=o.c5({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:A,image:T.gradient||void 0,clips:m.lineClipsArray}),T.texture?T.texture.update(T.gradient):T.texture=new o.T(r,T.gradient,c.RGBA),T.version=f.gradientVersion,T.texture}function _s(p,e,r,c,f){p.activeTexture.set(e.TEXTURE0),r.imageAtlasTexture.bind(e.LINEAR,e.CLAMP_TO_EDGE),c.updatePaintBuffers(f)}function Xn(p,e,r,c,f,m){(f||p.lineAtlas.dirty)&&(e.activeTexture.set(r.TEXTURE0),p.lineAtlas.bind(e)),c.updatePaintBuffers(m)}function js(p,e,r,c,f,m,x){const T=m.gradients[f.id];let A=T.texture;f.gradientVersion!==T.version&&(A=Zr(p,e,r,c,f,m,x,T)),r.activeTexture.set(c.TEXTURE0),A.bind(f.stepInterpolant?c.NEAREST:c.LINEAR,c.CLAMP_TO_EDGE)}function Eh(p,e,r,c,f,m,x,T,A){const k=m.gradients[f.id];let L=k.texture;f.gradientVersion!==k.version&&(L=Zr(p,e,r,c,f,m,x,k)),r.activeTexture.set(c.TEXTURE0),L.bind(f.stepInterpolant?c.NEAREST:c.LINEAR,c.CLAMP_TO_EDGE),r.activeTexture.set(c.TEXTURE1),p.lineAtlas.bind(r),T.updatePaintBuffers(A)}function al(p,e,r,c,f){if(!r||!c||!c.imageAtlas)return;const m=c.imageAtlas.patternPositions;let x=m[r.to.toString()],T=m[r.from.toString()];if(!x&&T&&(x=T),!T&&x&&(T=x),!x||!T){const A=f.getPaintProperty(e);x=m[A],T=m[A]}x&&T&&p.setConstantPatternPositions(x,T)}function Fl(p,e,r,c,f,m,x,T){const A=p.context.gl,k="fill-pattern",L=r.paint.get(k),F=L&&L.constantOr(1),N=r.getCrossfadeParameters();let q,X,ae,ne,re;const oe=p.transform,ue=r.paint.get("fill-translate"),le=r.paint.get("fill-translate-anchor");x?(X=F&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",q=A.LINES):(X=F?"fillPattern":"fill",q=A.TRIANGLES);const me=L.constantOr(null);for(const ye of c){const he=e.getTile(ye);if(F&&!he.patternsLoaded())continue;const Me=he.getBucket(r);if(!Me)continue;const je=Me.programConfigurations.get(r.id),De=p.useProgram(X,je),Le=p.style.map.terrain&&p.style.map.terrain.getTerrainData(ye);F&&(p.context.activeTexture.set(A.TEXTURE0),he.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),je.updatePaintBuffers(N)),al(je,k,me,he,r);const Ne=oe.getProjectionData({overscaledTileID:ye,applyGlobeMatrix:!T,applyTerrainMatrix:!0}),ht=o.aD(oe,he,ue,le);if(x){ne=Me.indexBuffer2,re=Me.segments2;const it=[A.drawingBufferWidth,A.drawingBufferHeight];ae=X==="fillOutlinePattern"&&F?pd(p,N,he,it,ht):Ll(it,ht)}else ne=Me.indexBuffer,re=Me.segments,ae=F?Yo(p,N,he,ht):{u_fill_translate:ht};const dt=p.stencilModeForClipping(ye);De.draw(p.context,q,f,dt,m,yi.backCCW,ae,Le,Ne,r.id,Me.layoutVertexBuffer,ne,re,r.paint,p.transform.zoom,je)}}function Ic(p,e,r,c,f,m,x,T){const A=p.context,k=A.gl,L="fill-extrusion-pattern",F=r.paint.get(L),N=F.constantOr(1),q=r.getCrossfadeParameters(),X=r.paint.get("fill-extrusion-opacity"),ae=F.constantOr(null),ne=p.transform;for(const re of c){const oe=e.getTile(re),ue=oe.getBucket(r);if(!ue)continue;const le=p.style.map.terrain&&p.style.map.terrain.getTerrainData(re),me=ue.programConfigurations.get(r.id),ye=p.useProgram(N?"fillExtrusionPattern":"fillExtrusion",me);N&&(p.context.activeTexture.set(k.TEXTURE0),oe.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),me.updatePaintBuffers(q));const he=ne.getProjectionData({overscaledTileID:re,applyGlobeMatrix:!T,applyTerrainMatrix:!0});al(me,L,ae,oe,r);const Me=o.aD(ne,oe,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),je=r.paint.get("fill-extrusion-vertical-gradient"),De=N?dh(p,je,X,Me,re,q,oe):kl(p,je,X,Me);ye.draw(A,A.gl.TRIANGLES,f,m,x,yi.backCCW,De,le,he,r.id,ue.layoutVertexBuffer,ue.indexBuffer,ue.segments,r.paint,p.transform.zoom,me,p.style.map.terrain&&ue.centroidVertexBuffer)}}function Ha(p,e,r,c,f,m,x,T,A){var k;const L=p.style.projection,F=p.context,N=p.transform,q=F.gl,X=[`#define NUM_ILLUMINATION_SOURCES ${r.paint.get("hillshade-highlight-color").values.length}`],ae=p.useProgram("hillshade",null,!1,X),ne=!p.options.moving;for(const re of c){const oe=e.getTile(re),ue=oe.fbo;if(!ue)continue;const le=L.getMeshFromTileID(F,re.canonical,T,!0,"raster"),me=(k=p.style.map.terrain)===null||k===void 0?void 0:k.getTerrainData(re);F.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_2D,ue.colorAttachment.get());const ye=N.getProjectionData({overscaledTileID:re,aligned:ne,applyGlobeMatrix:!A,applyTerrainMatrix:!0});ae.draw(F,q.TRIANGLES,m,f[re.overscaledZ],x,yi.backCCW,ph(p,oe,r),me,ye,r.id,le.vertexBuffer,le.indexBuffer,le.segments)}}function Yi(p,e,r,c,f,m,x,T,A){var k;const L=p.style.projection,F=p.context,N=p.transform,q=F.gl,X=p.useProgram("colorRelief"),ae=!p.options.moving;let ne=!0,re=0;for(const oe of c){const ue=e.getTile(oe),le=ue.dem;if(ne){const De=q.getParameter(q.MAX_TEXTURE_SIZE),{elevationTexture:Le,colorTexture:Ne}=r.getColorRampTextures(F,De,le.getUnpackVector());F.activeTexture.set(q.TEXTURE1),Le.bind(q.NEAREST,q.CLAMP_TO_EDGE),F.activeTexture.set(q.TEXTURE4),Ne.bind(q.LINEAR,q.CLAMP_TO_EDGE),ne=!1,re=Le.size[0]}if(!le||!le.data)continue;const me=le.stride,ye=le.getPixels();if(F.activeTexture.set(q.TEXTURE0),F.pixelStoreUnpackPremultiplyAlpha.set(!1),ue.demTexture=ue.demTexture||p.getTileTexture(me),ue.demTexture){const De=ue.demTexture;De.update(ye,{premultiply:!1}),De.bind(q.LINEAR,q.CLAMP_TO_EDGE)}else ue.demTexture=new o.T(F,ye,q.RGBA,{premultiply:!1}),ue.demTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE);const he=L.getMeshFromTileID(F,oe.canonical,T,!0,"raster"),Me=(k=p.style.map.terrain)===null||k===void 0?void 0:k.getTerrainData(oe),je=N.getProjectionData({overscaledTileID:oe,aligned:ae,applyGlobeMatrix:!A,applyTerrainMatrix:!0});X.draw(F,q.TRIANGLES,m,f[oe.overscaledZ],x,yi.backCCW,Bl(r,ue.dem,re),Me,je,r.id,he.vertexBuffer,he.indexBuffer,he.segments)}}const Ti=[new o.P(0,0),new o.P(o.$,0),new o.P(o.$,o.$),new o.P(0,o.$)];function $r(p,e,r,c,f,m,x,T,A=!1,k=!1){const L=c[c.length-1].overscaledZ,F=p.context,N=F.gl,q=p.useProgram("raster"),X=p.transform,ae=p.style.projection,ne=p.colorModeForRenderPass(),re=!p.options.moving,oe=r.paint.get("raster-opacity"),ue=r.paint.get("raster-resampling"),le=r.paint.get("raster-fade-duration"),me=!!p.style.map.terrain;for(const ye of c){const he=p.getDepthModeForSublayer(ye.overscaledZ-L,oe===1?Yt.ReadWrite:Yt.ReadOnly,N.LESS),Me=e.getTile(ye),je=ue==="nearest"?N.NEAREST:N.LINEAR;F.activeTexture.set(N.TEXTURE0),Me.texture.bind(je,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),F.activeTexture.set(N.TEXTURE1);const{parentTile:De,parentScaleBy:Le,parentTopLeft:Ne,fadeValues:ht}=ur(Me,e,le,me);Me.fadeOpacity=ht.tileOpacity,De?(De.fadeOpacity=ht.parentTileOpacity,De.texture.bind(je,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST)):Me.texture.bind(je,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),Me.texture.useMipmap&&F.extTextureFilterAnisotropic&&p.transform.pitch>20&&N.texParameterf(N.TEXTURE_2D,F.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,F.extTextureFilterAnisotropicMax);const dt=p.style.map.terrain&&p.style.map.terrain.getTerrainData(ye),it=X.getProjectionData({overscaledTileID:ye,aligned:re,applyGlobeMatrix:!k,applyTerrainMatrix:!0}),Rt=wc(Ne,Le,ht.fadeMix,r,T),ei=ae.getMeshFromTileID(F,ye.canonical,m,x,"raster");q.draw(F,N.TRIANGLES,he,f?f[ye.overscaledZ]:ci.disabled,ne,A?yi.frontCCW:yi.backCCW,Rt,dt,it,r.id,ei.vertexBuffer,ei.indexBuffer,ei.segments)}}function ur(p,e,r,c){const f={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(r===0||c)return f;if(p.fadingParentID){const m=e._getLoadedTile(p.fadingParentID);if(!m)return f;const x=Math.pow(2,m.tileID.overscaledZ-p.tileID.overscaledZ),T=[p.tileID.canonical.x*x%1,p.tileID.canonical.y*x%1],A=(function(k,L,F){const N=W.now(),q=(N-L.timeAdded)/F,X=k.fadingDirection===ve.Incoming,ae=o.ah((N-k.timeAdded)/F,0,1),ne=o.ah(1-q,0,1),re=X?ae:ne;return{tileOpacity:re,parentTileOpacity:X?ne:ae,fadeMix:{opacity:1,mix:1-re}}})(p,m,r);return{parentTile:m,parentScaleBy:x,parentTopLeft:T,fadeValues:A}}if(p.selfFading){const m=(function(x,T){const A=W.now(),k=o.ah((A-x.timeAdded)/T,0,1);return{tileOpacity:k,fadeMix:{opacity:k,mix:0}}})(p,r);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:m}}return f}const Ta=new o.bf(1,0,0,1),Yn=new o.bf(0,1,0,1),hr=new o.bf(0,0,1,1),Cu=new o.bf(1,0,1,1),Fs=new o.bf(0,1,1,1);function Gs(p,e,r,c){ys(p,0,e+r/2,p.transform.width,r,c)}function Us(p,e,r,c){ys(p,e-r/2,0,r,p.transform.height,c)}function ys(p,e,r,c,f,m){const x=p.context,T=x.gl;T.enable(T.SCISSOR_TEST),T.scissor(e*p.pixelRatio,r*p.pixelRatio,c*p.pixelRatio,f*p.pixelRatio),x.clear({color:m}),T.disable(T.SCISSOR_TEST)}function nl(p,e,r){const c=p.context,f=c.gl,m=p.useProgram("debug"),x=Yt.disabled,T=ci.disabled,A=p.colorModeForRenderPass(),k="$debug",L=p.style.map.terrain&&p.style.map.terrain.getTerrainData(r);c.activeTexture.set(f.TEXTURE0);const F=e.getTileByID(r.key).latestRawTileData,N=Math.floor((F&&F.byteLength||0)/1024),q=e.getTile(r).tileSize,X=512/Math.min(q,512)*(r.overscaledZ/p.transform.zoom)*.5;let ae=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(ae+=` => ${r.overscaledZ}`),(function(re,oe){re.initDebugOverlayCanvas();const ue=re.debugOverlayCanvas,le=re.context.gl,me=re.debugOverlayCanvas.getContext("2d");me.clearRect(0,0,ue.width,ue.height),me.shadowColor="white",me.shadowBlur=2,me.lineWidth=1.5,me.strokeStyle="white",me.textBaseline="top",me.font="bold 36px Open Sans, sans-serif",me.fillText(oe,5,5),me.strokeText(oe,5,5),re.debugOverlayTexture.update(ue),re.debugOverlayTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE)})(p,`${ae} ${N}kB`);const ne=p.transform.getProjectionData({overscaledTileID:r,applyGlobeMatrix:!0,applyTerrainMatrix:!0});m.draw(c,f.TRIANGLES,x,T,$i.alphaBlended,yi.disabled,gd(o.bf.transparent,X),null,ne,k,p.debugBuffer,p.quadTriangleIndexBuffer,p.debugSegments),m.draw(c,f.LINE_STRIP,x,T,A,yi.disabled,gd(o.bf.red),L,ne,k,p.debugBuffer,p.tileBorderIndexBuffer,p.debugSegments)}function vs(p,e,r,c){const{isRenderingGlobe:f}=c,m=p.context,x=m.gl,T=p.transform,A=p.colorModeForRenderPass(),k=p.getDepthModeFor3D(),L=p.useProgram("terrain");m.bindFramebuffer.set(null),m.viewport.set([0,0,p.width,p.height]);for(const F of r){const N=e.getTerrainMesh(F.tileID),q=p.renderToTexture.getTexture(F),X=e.getTerrainData(F.tileID);m.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,q.texture);const ae=e.getMeshFrameDelta(T.zoom),ne=T.calculateFogMatrix(F.tileID.toUnwrapped()),re=uh(ae,ne,p.style.sky,T.pitch,f),oe=T.getProjectionData({overscaledTileID:F.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});L.draw(m,x.TRIANGLES,k,ci.disabled,A,yi.backCCW,re,X,oe,"terrain",N.vertexBuffer,N.indexBuffer,N.segments)}}function Hr(p,e){if(!e.mesh){const r=new o.aL;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(1,1),r.emplaceBack(-1,1);const c=new o.aN;c.emplaceBack(0,1,2),c.emplaceBack(0,2,3),e.mesh=new oo(p.createVertexBuffer(r,Bn.members),p.createIndexBuffer(c),o.aM.simpleSegment(0,0,r.length,c.length))}return e.mesh}class Vs{constructor(e,r){this.context=new Sd(e),this.transform=r,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.ag(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=kt.maxUnderzooming+kt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new hs}resize(e,r,c){if(this.width=Math.floor(e*c),this.height=Math.floor(r*c),this.pixelRatio=c,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style._order)this.style._layers[f].resize()}setup(){const e=this.context,r=new o.aL;r.emplaceBack(0,0),r.emplaceBack(o.$,0),r.emplaceBack(0,o.$),r.emplaceBack(o.$,o.$),this.tileExtentBuffer=e.createVertexBuffer(r,Bn.members),this.tileExtentSegments=o.aM.simpleSegment(0,0,4,2);const c=new o.aL;c.emplaceBack(0,0),c.emplaceBack(o.$,0),c.emplaceBack(0,o.$),c.emplaceBack(o.$,o.$),this.debugBuffer=e.createVertexBuffer(c,Bn.members),this.debugSegments=o.aM.simpleSegment(0,0,4,5);const f=new o.c7;f.emplaceBack(0,0,0,0),f.emplaceBack(o.$,0,o.$,0),f.emplaceBack(0,o.$,0,o.$),f.emplaceBack(o.$,o.$,o.$,o.$),this.rasterBoundsBuffer=e.createVertexBuffer(f,xf.members),this.rasterBoundsSegments=o.aM.simpleSegment(0,0,4,2);const m=new o.aL;m.emplaceBack(0,0),m.emplaceBack(o.$,0),m.emplaceBack(0,o.$),m.emplaceBack(o.$,o.$),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(m,Bn.members),this.rasterBoundsSegmentsPosOnly=o.aM.simpleSegment(0,0,4,5);const x=new o.aL;x.emplaceBack(0,0),x.emplaceBack(1,0),x.emplaceBack(0,1),x.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(x,Bn.members),this.viewportSegments=o.aM.simpleSegment(0,0,4,2);const T=new o.c8;T.emplaceBack(0),T.emplaceBack(1),T.emplaceBack(3),T.emplaceBack(2),T.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(T);const A=new o.aN;A.emplaceBack(1,0,2),A.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(A);const k=this.context.gl;this.stencilClearMode=new ci({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO),this.tileExtentMesh=new oo(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,r=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const c=o.L();o.bZ(c,0,this.width,this.height,0,0,1),o.N(c,c,[r.drawingBufferWidth,r.drawingBufferHeight,0]);const f={mainMatrix:c,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:c};this.useProgram("clippingMask",null,!0).draw(e,r.TRIANGLES,Yt.disabled,this.stencilClearMode,$i.disabled,yi.disabled,null,null,f,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,r,c){if(this.currentStencilSource===e.source||!e.isTileClipped()||!r||!r.length)return;this.currentStencilSource=e.source,this.nextStencilID+r.length>256&&this.clearStencil();const f=this.context;f.setColorMode($i.disabled),f.setDepthMode(Yt.disabled);const m={};for(const x of r)m[x.key]=this.nextStencilID++;this._renderTileMasks(m,r,c,!0),this._renderTileMasks(m,r,c,!1),this._tileClippingMaskIDs=m}_renderTileMasks(e,r,c,f){const m=this.context,x=m.gl,T=this.style.projection,A=this.transform,k=this.useProgram("clippingMask");for(const L of r){const F=e[L.key],N=this.style.map.terrain&&this.style.map.terrain.getTerrainData(L),q=T.getMeshFromTileID(this.context,L.canonical,f,!0,"stencil"),X=A.getProjectionData({overscaledTileID:L,applyGlobeMatrix:!c,applyTerrainMatrix:!0});k.draw(m,x.TRIANGLES,Yt.disabled,new ci({func:x.ALWAYS,mask:0},F,255,x.KEEP,x.KEEP,x.REPLACE),$i.disabled,c?yi.disabled:yi.backCCW,null,N,X,"$clipping",q.vertexBuffer,q.indexBuffer,q.segments)}}_renderTilesDepthBuffer(){const e=this.context,r=e.gl,c=this.style.projection,f=this.transform,m=this.useProgram("depth"),x=this.getDepthModeFor3D(),T=_i(f,{tileSize:f.tileSize});for(const A of T){const k=this.style.map.terrain&&this.style.map.terrain.getTerrainData(A),L=c.getMeshFromTileID(this.context,A.canonical,!0,!0,"raster"),F=f.getProjectionData({overscaledTileID:A,applyGlobeMatrix:!0,applyTerrainMatrix:!0});m.draw(e,r.TRIANGLES,x,ci.disabled,$i.disabled,yi.backCCW,null,k,F,"$clipping",L.vertexBuffer,L.indexBuffer,L.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,r=this.context.gl;return new ci({func:r.NOTEQUAL,mask:255},e,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(e){const r=this.context.gl;return new ci({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,r.KEEP,r.KEEP,r.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const r=this.context.gl,c=e.sort(((x,T)=>T.overscaledZ-x.overscaledZ)),f=c[c.length-1].overscaledZ,m=c[0].overscaledZ-f+1;if(m>1){this.currentStencilSource=void 0,this.nextStencilID+m>256&&this.clearStencil();const x={};for(let T=0;T<m;T++)x[T+f]=new ci({func:r.GEQUAL,mask:255},T+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=m,[x,c]}return[{[f]:ci.disabled},c]}stencilConfigForOverlapTwoPass(e){const r=this.context.gl,c=e.sort(((x,T)=>T.overscaledZ-x.overscaledZ)),f=c[c.length-1].overscaledZ,m=c[0].overscaledZ-f+1;if(this.clearStencil(),m>1){const x={},T={};for(let A=0;A<m;A++)x[A+f]=new ci({func:r.GREATER,mask:255},m+1+A,255,r.KEEP,r.KEEP,r.REPLACE),T[A+f]=new ci({func:r.GREATER,mask:255},1+A,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID=2*m+1,[x,T,c]}return this.nextStencilID=3,[{[f]:new ci({func:r.GREATER,mask:255},2,255,r.KEEP,r.KEEP,r.REPLACE)},{[f]:new ci({func:r.GREATER,mask:255},1,255,r.KEEP,r.KEEP,r.REPLACE)},c]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new $i([e.CONSTANT_COLOR,e.ONE],new o.bf(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?$i.unblended:$i.alphaBlended}getDepthModeForSublayer(e,r,c){if(!this.opaquePassEnabledForLayer())return Yt.disabled;const f=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Yt(c||this.context.gl.LEQUAL,r,[f,f])}getDepthModeFor3D(){return new Yt(this.context.gl.LEQUAL,Yt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,r){var c,f;this.style=e,this.options=r,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(W.now()),this.imageManager.beginFrame();const m=this.style._order,x=this.style.sourceCaches,T={},A={},k={},L={isRenderingToTexture:!1,isRenderingGlobe:((c=e.projection)===null||c===void 0?void 0:c.transitionState)>0};for(const N in x){const q=x[N];q.used&&q.prepare(this.context),T[N]=q.getVisibleCoordinates(!1),A[N]=T[N].slice().reverse(),k[N]=q.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let N=0;N<m.length;N++)if(this.style._layers[m[N]].is3D()){this.opaquePassCutoff=N;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const N of m){const q=this.style._layers[N];if(!q.hasOffscreenPass()||q.isHidden(this.transform.zoom))continue;const X=A[q.source];(q.type==="custom"||X.length)&&this.renderLayer(this,x[q.source],q,X,L)}if((f=this.style.projection)===null||f===void 0||f.updateGPUdependent({context:this.context,useProgram:N=>this.useProgram(N)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?o.bf.black:o.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(N,q){const X=N.context,ae=X.gl,ne=((ye,he,Me)=>{const je=Math.cos(he.rollInRadians),De=Math.sin(he.rollInRadians),Le=Ie(he),Ne=he.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:ye.properties.get("sky-color"),u_horizon_color:ye.properties.get("horizon-color"),u_horizon:[(he.width/2-Le*De)*Me,(he.height/2+Le*je)*Me],u_horizon_normal:[-De,je],u_sky_horizon_blend:ye.properties.get("sky-horizon-blend")*he.height/2*Me,u_sky_blend:Ne}})(q,N.style.map.transform,N.pixelRatio),re=new Yt(ae.LEQUAL,Yt.ReadWrite,[0,1]),oe=ci.disabled,ue=N.colorModeForRenderPass(),le=N.useProgram("sky"),me=Hr(X,q);le.draw(X,ae.TRIANGLES,re,oe,ue,yi.disabled,ne,null,void 0,"sky",me.vertexBuffer,me.indexBuffer,me.segments)})(this,this.style.sky),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const N=this.style._layers[m[this.currentLayer]],q=x[N.source],X=T[N.source];this._renderTileClippingMasks(N,X,!1),this.renderLayer(this,q,N,X,L)}this.renderPass="translucent";let F=!1;for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const N=this.style._layers[m[this.currentLayer]],q=x[N.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(N,L))continue;this.opaquePassEnabledForLayer()||F||(F=!0,L.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const X=(N.type==="symbol"?k:A)[N.source];this._renderTileClippingMasks(N,T[N.source],!!this.renderToTexture),this.renderLayer(this,q,N,X,L)}if(L.isRenderingGlobe&&(function(N,q,X){const ae=N.context,ne=ae.gl,re=N.useProgram("atmosphere"),oe=new Yt(ne.LEQUAL,Yt.ReadOnly,[0,1]),ue=N.transform,le=(function(Ne,ht){const dt=Ne.properties.get("position"),it=[-dt.x,-dt.y,-dt.z],Rt=o.ag(new Float64Array(16));return Ne.properties.get("anchor")==="map"&&(o.b6(Rt,Rt,ht.rollInRadians),o.b7(Rt,Rt,-ht.pitchInRadians),o.b6(Rt,Rt,ht.bearingInRadians),o.b7(Rt,Rt,ht.center.lat*Math.PI/180),o.bz(Rt,Rt,-ht.center.lng*Math.PI/180)),o.c6(it,it,Rt),it})(X,N.transform),me=ue.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ye=q.properties.get("atmosphere-blend")*me.projectionTransition;if(ye===0)return;const he=Ho(ue.worldSize,ue.center.lat),Me=ue.inverseProjectionMatrix,je=new Float64Array(4);je[3]=1,o.aw(je,je,ue.modelViewProjectionMatrix),je[0]/=je[3],je[1]/=je[3],je[2]/=je[3],je[3]=1,o.aw(je,je,Me),je[0]/=je[3],je[1]/=je[3],je[2]/=je[3],je[3]=1;const De=((Ne,ht,dt,it,Rt)=>({u_sun_pos:Ne,u_atmosphere_blend:ht,u_globe_position:dt,u_globe_radius:it,u_inv_proj_matrix:Rt}))(le,ye,[je[0],je[1],je[2]],he,Me),Le=Hr(ae,q);re.draw(ae,ne.TRIANGLES,oe,ci.disabled,$i.alphaBlended,yi.disabled,De,null,null,"atmosphere",Le.vertexBuffer,Le.indexBuffer,Le.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const N=(function(q,X){let ae=null;const ne=Object.values(q._layers).flatMap((le=>le.source&&!le.isHidden(X)?[q.sourceCaches[le.source]]:[])),re=ne.filter((le=>le.getSource().type==="vector")),oe=ne.filter((le=>le.getSource().type!=="vector")),ue=le=>{(!ae||ae.getSource().maxzoom<le.getSource().maxzoom)&&(ae=le)};return re.forEach((le=>ue(le))),ae||oe.forEach((le=>ue(le))),ae})(this.style,this.transform.zoom);N&&(function(q,X,ae){for(let ne=0;ne<ae.length;ne++)nl(q,X,ae[ne])})(this,N,N.getVisibleCoordinates())}this.options.showPadding&&(function(N){const q=N.transform.padding;Gs(N,N.transform.height-(q.top||0),3,Ta),Gs(N,q.bottom||0,3,Yn),Us(N,q.left||0,3,hr),Us(N,N.transform.width-(q.right||0),3,Cu);const X=N.transform.centerPoint;(function(ae,ne,re,oe){ys(ae,ne-1,re-10,2,20,oe),ys(ae,ne-10,re-1,20,2,oe)})(N,X.x,N.transform.height-X.y,Fs)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const r=this.terrainFacilitator.matrix,c=this.transform.modelViewProjectionMatrix;let f=this.terrainFacilitator.dirty;f||(f=e?!o.c9(r,c):!o.ca(r,c)),f||(f=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),f&&(o.cb(r,c),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(m,x){const T=m.context,A=T.gl,k=m.transform,L=$i.unblended,F=new Yt(A.LEQUAL,Yt.ReadWrite,[0,1]),N=x.sourceCache.getRenderableTiles(),q=m.useProgram("terrainDepth");T.bindFramebuffer.set(x.getFramebuffer("depth").framebuffer),T.viewport.set([0,0,m.width/devicePixelRatio,m.height/devicePixelRatio]),T.clear({color:o.bf.transparent,depth:1});for(const X of N){const ae=x.getTerrainMesh(X.tileID),ne=x.getTerrainData(X.tileID),re=k.getProjectionData({overscaledTileID:X.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),oe={u_ele_delta:x.getMeshFrameDelta(k.zoom)};q.draw(T,A.TRIANGLES,F,ci.disabled,L,yi.backCCW,oe,ne,re,"terrain",ae.vertexBuffer,ae.indexBuffer,ae.segments)}T.bindFramebuffer.set(null),T.viewport.set([0,0,m.width,m.height])})(this,this.style.map.terrain),(function(m,x){const T=m.context,A=T.gl,k=m.transform,L=$i.unblended,F=new Yt(A.LEQUAL,Yt.ReadWrite,[0,1]),N=x.getCoordsTexture(),q=x.sourceCache.getRenderableTiles(),X=m.useProgram("terrainCoords");T.bindFramebuffer.set(x.getFramebuffer("coords").framebuffer),T.viewport.set([0,0,m.width/devicePixelRatio,m.height/devicePixelRatio]),T.clear({color:o.bf.transparent,depth:1}),x.coordsIndex=[];for(const ae of q){const ne=x.getTerrainMesh(ae.tileID),re=x.getTerrainData(ae.tileID);T.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,N.texture);const oe={u_terrain_coords_id:(255-x.coordsIndex.length)/255,u_texture:0,u_ele_delta:x.getMeshFrameDelta(k.zoom)},ue=k.getProjectionData({overscaledTileID:ae.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});X.draw(T,A.TRIANGLES,F,ci.disabled,L,yi.backCCW,oe,re,ue,"terrain",ne.vertexBuffer,ne.indexBuffer,ne.segments),x.coordsIndex.push(ae.tileID.key)}T.bindFramebuffer.set(null),T.viewport.set([0,0,m.width,m.height])})(this,this.style.map.terrain))}renderLayer(e,r,c,f,m){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||(f||[]).length)&&(this.id=c.id,o.cc(c)?(function(x,T,A,k,L,F){if(x.renderPass!=="translucent")return;const{isRenderingToTexture:N}=F,q=ci.disabled,X=x.colorModeForRenderPass();(A._unevaluatedLayout.hasValue("text-variable-anchor")||A._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(ae,ne,re,oe,ue,le,me,ye,he){const Me=ne.transform,je=ne.style.map.terrain,De=ue==="map",Le=le==="map";for(const Ne of ae){const ht=oe.getTile(Ne),dt=ht.getBucket(re);if(!dt||!dt.text||!dt.text.segments.get().length)continue;const it=o.an(dt.textSizeData,Me.zoom),Rt=o.aC(ht,1,ne.transform.zoom),ei=Ji(De,ne.transform,Rt),Ii=re.layout.get("icon-text-fit")!=="none"&&dt.hasIconData();if(it){const Vi=Math.pow(2,Me.zoom-ht.tileID.overscaledZ),qi=je?(ua,na)=>je.getElevation(Ne,ua,na):null;zc(dt,De,Le,he,Me,ei,Vi,it,Ii,o.aD(Me,ht,me,ye),Ne.toUnwrapped(),qi)}}})(k,x,A,T,A.layout.get("text-rotation-alignment"),A.layout.get("text-pitch-alignment"),A.paint.get("text-translate"),A.paint.get("text-translate-anchor"),L),A.paint.get("icon-opacity").constantOr(1)!==0&&Ns(x,T,A,k,!1,A.paint.get("icon-translate"),A.paint.get("icon-translate-anchor"),A.layout.get("icon-rotation-alignment"),A.layout.get("icon-pitch-alignment"),A.layout.get("icon-keep-upright"),q,X,N),A.paint.get("text-opacity").constantOr(1)!==0&&Ns(x,T,A,k,!0,A.paint.get("text-translate"),A.paint.get("text-translate-anchor"),A.layout.get("text-rotation-alignment"),A.layout.get("text-pitch-alignment"),A.layout.get("text-keep-upright"),q,X,N),T.map.showCollisionBoxes&&(Bs(x,T,A,k,!0),Bs(x,T,A,k,!1))})(e,r,c,f,this.style.placement.variableOffsets,m):o.cd(c)?(function(x,T,A,k,L){if(x.renderPass!=="translucent")return;const{isRenderingToTexture:F}=L,N=A.paint.get("circle-opacity"),q=A.paint.get("circle-stroke-width"),X=A.paint.get("circle-stroke-opacity"),ae=!A.layout.get("circle-sort-key").isConstant();if(N.constantOr(1)===0&&(q.constantOr(1)===0||X.constantOr(1)===0))return;const ne=x.context,re=ne.gl,oe=x.transform,ue=x.getDepthModeForSublayer(0,Yt.ReadOnly),le=ci.disabled,me=x.colorModeForRenderPass(),ye=[],he=oe.getCircleRadiusCorrection();for(let Me=0;Me<k.length;Me++){const je=k[Me],De=T.getTile(je),Le=De.getBucket(A);if(!Le)continue;const Ne=A.paint.get("circle-translate"),ht=A.paint.get("circle-translate-anchor"),dt=o.aD(oe,De,Ne,ht),it=Le.programConfigurations.get(A.id),Rt=x.useProgram("circle",it),ei=Le.layoutVertexBuffer,Ii=Le.indexBuffer,Vi=x.style.map.terrain&&x.style.map.terrain.getTerrainData(je),qi={programConfiguration:it,program:Rt,layoutVertexBuffer:ei,indexBuffer:Ii,uniformValues:vc(x,De,A,dt,he),terrainData:Vi,projectionData:oe.getProjectionData({overscaledTileID:je,applyGlobeMatrix:!F,applyTerrainMatrix:!0})};if(ae){const ua=Le.segments.get();for(const na of ua)ye.push({segments:new o.aM([na]),sortKey:na.sortKey,state:qi})}else ye.push({segments:Le.segments,sortKey:0,state:qi})}ae&&ye.sort(((Me,je)=>Me.sortKey-je.sortKey));for(const Me of ye){const{programConfiguration:je,program:De,layoutVertexBuffer:Le,indexBuffer:Ne,uniformValues:ht,terrainData:dt,projectionData:it}=Me.state;De.draw(ne,re.TRIANGLES,ue,le,me,yi.backCCW,ht,dt,it,A.id,Le,Ne,Me.segments,A.paint,x.transform.zoom,je)}})(e,r,c,f,m):o.ce(c)?(function(x,T,A,k,L){if(A.paint.get("heatmap-opacity")===0)return;const F=x.context,{isRenderingToTexture:N,isRenderingGlobe:q}=L;if(x.style.map.terrain){for(const X of k){const ae=T.getTile(X);T.hasRenderableParent(X)||(x.renderPass==="offscreen"?il(x,ae,A,X,q):x.renderPass==="translucent"&&_o(x,A,X,N,q))}F.viewport.set([0,0,x.width,x.height])}else x.renderPass==="offscreen"?(function(X,ae,ne,re){const oe=X.context,ue=oe.gl,le=X.transform,me=ci.disabled,ye=new $i([ue.ONE,ue.ONE],o.bf.transparent,[!0,!0,!0,!0]);(function(he,Me,je){const De=he.gl;he.activeTexture.set(De.TEXTURE1),he.viewport.set([0,0,Me.width/4,Me.height/4]);let Le=je.heatmapFbos.get(o.c3);Le?(De.bindTexture(De.TEXTURE_2D,Le.colorAttachment.get()),he.bindFramebuffer.set(Le.framebuffer)):(Le=In(he,Me.width/4,Me.height/4),je.heatmapFbos.set(o.c3,Le))})(oe,X,ne),oe.clear({color:o.bf.transparent});for(let he=0;he<re.length;he++){const Me=re[he];if(ae.hasRenderableParent(Me))continue;const je=ae.getTile(Me),De=je.getBucket(ne);if(!De)continue;const Le=De.programConfigurations.get(ne.id),Ne=X.useProgram("heatmap",Le),ht=le.getProjectionData({overscaledTileID:Me,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),dt=le.getCircleRadiusCorrection();Ne.draw(oe,ue.TRIANGLES,Yt.disabled,me,ye,yi.backCCW,fh(je,le.zoom,ne.paint.get("heatmap-intensity"),dt),null,ht,ne.id,De.layoutVertexBuffer,De.indexBuffer,De.segments,ne.paint,le.zoom,Le)}oe.viewport.set([0,0,X.width,X.height])})(x,T,A,k):x.renderPass==="translucent"&&(function(X,ae){const ne=X.context,re=ne.gl;ne.setColorMode(X.colorModeForRenderPass());const oe=ae.heatmapFbos.get(o.c3);oe&&(ne.activeTexture.set(re.TEXTURE0),re.bindTexture(re.TEXTURE_2D,oe.colorAttachment.get()),ne.activeTexture.set(re.TEXTURE1),gn(ne,ae).bind(re.LINEAR,re.CLAMP_TO_EDGE),X.useProgram("heatmapTexture").draw(ne,re.TRIANGLES,Yt.disabled,ci.disabled,X.colorModeForRenderPass(),yi.disabled,_d(X,ae,0,1),null,null,ae.id,X.viewportBuffer,X.quadTriangleIndexBuffer,X.viewportSegments,ae.paint,X.transform.zoom))})(x,A)})(e,r,c,f,m):o.cf(c)?(function(x,T,A,k,L){if(x.renderPass!=="translucent")return;const{isRenderingToTexture:F}=L,N=A.paint.get("line-opacity"),q=A.paint.get("line-width");if(N.constantOr(1)===0||q.constantOr(1)===0)return;const X=x.getDepthModeForSublayer(0,Yt.ReadOnly),ae=x.colorModeForRenderPass(),ne=A.paint.get("line-dasharray"),re=ne.constantOr(1),oe=A.paint.get("line-pattern"),ue=oe.constantOr(1),le=A.paint.get("line-gradient"),me=A.getCrossfadeParameters();let ye;ye=ue?"linePattern":re&&le?"lineGradientSDF":re?"lineSDF":le?"lineGradient":"line";const he=x.context,Me=he.gl,je=x.transform;let De=!0;for(const Le of k){const Ne=T.getTile(Le);if(ue&&!Ne.patternsLoaded())continue;const ht=Ne.getBucket(A);if(!ht)continue;const dt=ht.programConfigurations.get(A.id),it=x.context.program.get(),Rt=x.useProgram(ye,dt),ei=De||Rt.program!==it,Ii=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Le),Vi=oe.constantOr(null),qi=ne&&ne.constantOr(null);if(Vi&&Ne.imageAtlas){const vn=Ne.imageAtlas,La=vn.patternPositions[Vi.to.toString()],Oa=vn.patternPositions[Vi.from.toString()];La&&Oa&&dt.setConstantPatternPositions(La,Oa)}else if(qi){const vn=A.layout.get("line-cap")==="round",La=x.lineAtlas.getDash(qi.to,vn),Oa=x.lineAtlas.getDash(qi.from,vn);dt.setConstantDashPositions(La,Oa)}const ua=je.getProjectionData({overscaledTileID:Le,applyGlobeMatrix:!F,applyTerrainMatrix:!0}),na=je.getPixelScale();let vi;ue?(vi=ho(x,Ne,A,na,me),_s(he,Me,Ne,dt,me)):re&&le?(vi=vu(x,Ne,A,na,me,ht.lineClipsArray.length),Eh(x,T,he,Me,A,ht,Le,dt,me)):re?(vi=mh(x,Ne,A,na,me),Xn(x,he,Me,dt,ei,me)):le?(vi=bc(x,Ne,A,na,ht.lineClipsArray.length),js(x,T,he,Me,A,ht,Le)):vi=xc(x,Ne,A,na);const xa=x.stencilModeForClipping(Le);Rt.draw(he,Me.TRIANGLES,X,xa,ae,yi.disabled,vi,Ii,ua,A.id,ht.layoutVertexBuffer,ht.indexBuffer,ht.segments,A.paint,x.transform.zoom,dt,ht.layoutVertexBuffer2),De=!1}})(e,r,c,f,m):o.cg(c)?(function(x,T,A,k,L){const F=A.paint.get("fill-color"),N=A.paint.get("fill-opacity");if(N.constantOr(1)===0)return;const{isRenderingToTexture:q}=L,X=x.colorModeForRenderPass(),ae=A.paint.get("fill-pattern"),ne=x.opaquePassEnabledForLayer()&&!ae.constantOr(1)&&F.constantOr(o.bf.transparent).a===1&&N.constantOr(0)===1?"opaque":"translucent";if(x.renderPass===ne){const re=x.getDepthModeForSublayer(1,x.renderPass==="opaque"?Yt.ReadWrite:Yt.ReadOnly);Fl(x,T,A,k,re,X,!1,q)}if(x.renderPass==="translucent"&&A.paint.get("fill-antialias")){const re=x.getDepthModeForSublayer(A.getPaintProperty("fill-outline-color")?2:0,Yt.ReadOnly);Fl(x,T,A,k,re,X,!0,q)}})(e,r,c,f,m):o.ch(c)?(function(x,T,A,k,L){const F=A.paint.get("fill-extrusion-opacity");if(F===0)return;const{isRenderingToTexture:N}=L;if(x.renderPass==="translucent"){const q=new Yt(x.context.gl.LEQUAL,Yt.ReadWrite,x.depthRangeFor3D);if(F!==1||A.paint.get("fill-extrusion-pattern").constantOr(1))Ic(x,T,A,k,q,ci.disabled,$i.disabled,N),Ic(x,T,A,k,q,x.stencilModeFor3D(),x.colorModeForRenderPass(),N);else{const X=x.colorModeForRenderPass();Ic(x,T,A,k,q,ci.disabled,X,N)}}})(e,r,c,f,m):o.ci(c)?(function(x,T,A,k,L){if(x.renderPass!=="offscreen"&&x.renderPass!=="translucent")return;const{isRenderingToTexture:F}=L,N=x.context,q=x.style.projection.useSubdivision,X=x.getDepthModeForSublayer(0,Yt.ReadOnly),ae=x.colorModeForRenderPass();if(x.renderPass==="offscreen")(function(ne,re,oe,ue,le,me,ye){const he=ne.context,Me=he.gl;for(const je of oe){const De=re.getTile(je),Le=De.dem;if(!Le||!Le.data||!De.needsHillshadePrepare)continue;const Ne=Le.dim,ht=Le.stride,dt=Le.getPixels();if(he.activeTexture.set(Me.TEXTURE1),he.pixelStoreUnpackPremultiplyAlpha.set(!1),De.demTexture=De.demTexture||ne.getTileTexture(ht),De.demTexture){const Rt=De.demTexture;Rt.update(dt,{premultiply:!1}),Rt.bind(Me.NEAREST,Me.CLAMP_TO_EDGE)}else De.demTexture=new o.T(he,dt,Me.RGBA,{premultiply:!1}),De.demTexture.bind(Me.NEAREST,Me.CLAMP_TO_EDGE);he.activeTexture.set(Me.TEXTURE0);let it=De.fbo;if(!it){const Rt=new o.T(he,{width:Ne,height:Ne,data:null},Me.RGBA);Rt.bind(Me.LINEAR,Me.CLAMP_TO_EDGE),it=De.fbo=he.createFramebuffer(Ne,Ne,!0,!1),it.colorAttachment.set(Rt.texture)}he.bindFramebuffer.set(it.framebuffer),he.viewport.set([0,0,Ne,Ne]),ne.useProgram("hillshadePrepare").draw(he,Me.TRIANGLES,le,me,ye,yi.disabled,yu(De.tileID,Le),null,null,ue.id,ne.rasterBoundsBuffer,ne.quadTriangleIndexBuffer,ne.rasterBoundsSegments),De.needsHillshadePrepare=!1}})(x,T,k,A,X,ci.disabled,ae),N.viewport.set([0,0,x.width,x.height]);else if(x.renderPass==="translucent")if(q){const[ne,re,oe]=x.stencilConfigForOverlapTwoPass(k);Ha(x,T,A,oe,ne,X,ae,!1,F),Ha(x,T,A,oe,re,X,ae,!0,F)}else{const[ne,re]=x.getStencilConfigForOverlapAndUpdateStencilID(k);Ha(x,T,A,re,ne,X,ae,!1,F)}})(e,r,c,f,m):o.cj(c)?(function(x,T,A,k,L){if(x.renderPass!=="translucent"||!k.length)return;const{isRenderingToTexture:F}=L,N=x.style.projection.useSubdivision,q=x.getDepthModeForSublayer(0,Yt.ReadOnly),X=x.colorModeForRenderPass();if(N){const[ae,ne,re]=x.stencilConfigForOverlapTwoPass(k);Yi(x,T,A,re,ae,q,X,!1,F),Yi(x,T,A,re,ne,q,X,!0,F)}else{const[ae,ne]=x.getStencilConfigForOverlapAndUpdateStencilID(k);Yi(x,T,A,ne,ae,q,X,!1,F)}})(e,r,c,f,m):o.bK(c)?(function(x,T,A,k,L){if(x.renderPass!=="translucent"||A.paint.get("raster-opacity")===0||!k.length)return;const{isRenderingToTexture:F}=L,N=T.getSource(),q=x.style.projection.useSubdivision;if(N instanceof gi)$r(x,T,A,k,null,!1,!1,N.tileCoords,N.flippedWindingOrder,F);else if(q){const[X,ae,ne]=x.stencilConfigForOverlapTwoPass(k);$r(x,T,A,ne,X,!1,!0,Ti,!1,F),$r(x,T,A,ne,ae,!0,!0,Ti,!1,F)}else{const[X,ae]=x.getStencilConfigForOverlapAndUpdateStencilID(k);$r(x,T,A,ae,X,!1,!0,Ti,!1,F)}})(e,r,c,f,m):o.ck(c)?(function(x,T,A,k,L){const F=A.paint.get("background-color"),N=A.paint.get("background-opacity");if(N===0)return;const{isRenderingToTexture:q}=L,X=x.context,ae=X.gl,ne=x.style.projection,re=x.transform,oe=re.tileSize,ue=A.paint.get("background-pattern");if(x.isPatternMissing(ue))return;const le=!ue&&F.a===1&&N===1&&x.opaquePassEnabledForLayer()?"opaque":"translucent";if(x.renderPass!==le)return;const me=ci.disabled,ye=x.getDepthModeForSublayer(0,le==="opaque"?Yt.ReadWrite:Yt.ReadOnly),he=x.colorModeForRenderPass(),Me=x.useProgram(ue?"backgroundPattern":"background"),je=k||_i(re,{tileSize:oe,terrain:x.style.map.terrain});ue&&(X.activeTexture.set(ae.TEXTURE0),x.imageManager.bind(x.context));const De=A.getCrossfadeParameters();for(const Le of je){const Ne=re.getProjectionData({overscaledTileID:Le,applyGlobeMatrix:!q,applyTerrainMatrix:!0}),ht=ue?yh(N,x,ue,{tileID:Le,tileSize:oe},De):bd(N,F),dt=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Le),it=ne.getMeshFromTileID(X,Le.canonical,!1,!0,"raster");Me.draw(X,ae.TRIANGLES,ye,me,he,yi.backCCW,ht,dt,Ne,A.id,it.vertexBuffer,it.indexBuffer,it.segments)}})(e,0,c,f,m):o.cl(c)&&(function(x,T,A,k){const{isRenderingGlobe:L}=k,F=x.context,N=A.implementation,q=x.style.projection,X=x.transform,ae=X.getProjectionDataForCustomLayer(L),ne={farZ:X.farZ,nearZ:X.nearZ,fov:X.fov*Math.PI/180,modelViewProjectionMatrix:X.modelViewProjectionMatrix,projectionMatrix:X.projectionMatrix,shaderData:{variantName:q.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${q.shaderPreludeCode.vertexSource}`,define:q.shaderDefine},defaultProjectionData:ae},re=N.renderingMode?N.renderingMode:"2d";if(x.renderPass==="offscreen"){const oe=N.prerender;oe&&(x.setCustomLayerDefaults(),F.setColorMode(x.colorModeForRenderPass()),oe.call(N,F.gl,ne),F.setDirty(),x.setBaseState())}else if(x.renderPass==="translucent"){x.setCustomLayerDefaults(),F.setColorMode(x.colorModeForRenderPass()),F.setStencilMode(ci.disabled);const oe=re==="3d"?x.getDepthModeFor3D():x.getDepthModeForSublayer(0,Yt.ReadOnly);F.setDepthMode(oe),N.render(F.gl,ne),F.setDirty(),x.setBaseState(),F.bindFramebuffer.set(null)}})(e,0,c,m))}saveTileTexture(e){const r=this._tileTextures[e.size[0]];r?r.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const r=this._tileTextures[e];return r&&r.length>0?r.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const r=this.imageManager.getPattern(e.from.toString()),c=this.imageManager.getPattern(e.to.toString());return!r||!c}useProgram(e,r,c=!1,f=[]){this.cache=this.cache||{};const m=!!this.style.map.terrain,x=this.style.projection,T=c?zn.projectionMercator:x.shaderPreludeCode,A=c?Uo:x.shaderDefine,k=e+(r?r.cacheKey:"")+`/${c?hi:x.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(m?"/terrain":"")+(f?`/${f.join("/")}`:"");return this.cache[k]||(this.cache[k]=new hh(this.context,zn[e],r,fo[e],this._showOverdrawInspector,m,T,A,f)),this.cache[k]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:r}=this.context.gl;return this.width!==e||this.height!==r}}function Xr(p,e){let r,c=!1,f=null,m=null;const x=()=>{f=null,c&&(p.apply(m,r),f=setTimeout(x,e),c=!1)};return(...T)=>(c=!0,m=this,r=T,f||x(),f)}class Rc{constructor(e){this._getCurrentHash=()=>{const r=window.location.hash.replace("#","");if(this._hashName){let c;return r.split("&").map((f=>f.split("="))).forEach((f=>{f[0]===this._hashName&&(c=f)})),(c&&c[1]||"").split("/")}return r.split("/")},this._onHashChange=()=>{const r=this._getCurrentHash();if(!this._isValidHash(r))return!1;const c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(r[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:c,pitch:+(r[4]||0)}),!0},this._updateHashUnthrottled=()=>{const r=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,r)},this._removeHash=()=>{const r=this._getCurrentHash();if(r.length===0)return;const c=r.join("/");let f=c;f.split("&").length>0&&(f=f.split("&")[0]),this._hashName&&(f=`${this._hashName}=${c}`);let m=window.location.hash.replace(f,"");m.startsWith("#&")?m=m.slice(0,1)+m.slice(2):m==="#"&&(m="");let x=window.location.href.replace(/(#.+)?$/,m);x=x.replace("&&","&"),window.history.replaceState(window.history.state,null,x)},this._updateHash=Xr(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const r=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,f=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),m=Math.pow(10,f),x=Math.round(r.lng*m)/m,T=Math.round(r.lat*m)/m,A=this._map.getBearing(),k=this._map.getPitch();let L="";if(L+=e?`/${x}/${T}/${c}`:`${c}/${T}/${x}`,(A||k)&&(L+="/"+Math.round(10*A)/10),k&&(L+=`/${Math.round(k)}`),this._hashName){const F=this._hashName;let N=!1;const q=window.location.hash.slice(1).split("&").map((X=>{const ae=X.split("=")[0];return ae===F?(N=!0,`${ae}=${L}`):X})).filter((X=>X));return N||q.push(`${F}=${L}`),`#${q.join("&")}`}return`#${L}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new o.S(+e[2],+e[1])}catch{return!1}const r=+e[0],c=+(e[3]||0),f=+(e[4]||0);return r>=this._map.getMinZoom()&&r<=this._map.getMaxZoom()&&c>=-180&&c<=180&&f>=this._map.getMinPitch()&&f<=this._map.getMaxPitch()}}const yo={linearity:.3,easing:o.cm(0,0,.3,1)},Pr=o.e({deceleration:2500,maxSpeed:1400},yo),Dc=o.e({deceleration:20,maxSpeed:1400},yo),vo=o.e({deceleration:1e3,maxSpeed:360},yo),_n=o.e({deceleration:1e3,maxSpeed:90},yo),kc=o.e({deceleration:1e3,maxSpeed:360},yo);class Ch{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:W.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,r=W.now();for(;e.length>0&&r-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const r={zoom:0,bearing:0,pitch:0,roll:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:m}of this._inertiaBuffer)r.zoom+=m.zoomDelta||0,r.bearing+=m.bearingDelta||0,r.pitch+=m.pitchDelta||0,r.roll+=m.rollDelta||0,m.panDelta&&r.pan._add(m.panDelta),m.around&&(r.around=m.around),m.pinchAround&&(r.pinchAround=m.pinchAround);const c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,f={};if(r.pan.mag()){const m=Ul(r.pan.mag(),c,o.e({},Pr,e||{})),x=r.pan.mult(m.amount/r.pan.mag()),T=this._map.cameraHelper.handlePanInertia(x,this._map.transform);f.center=T.easingCenter,f.offset=T.easingOffset,Gl(f,m)}if(r.zoom){const m=Ul(r.zoom,c,Dc);f.zoom=this._map.transform.zoom+m.amount,Gl(f,m)}if(r.bearing){const m=Ul(r.bearing,c,vo);f.bearing=this._map.transform.bearing+o.ah(m.amount,-179,179),Gl(f,m)}if(r.pitch){const m=Ul(r.pitch,c,_n);f.pitch=this._map.transform.pitch+m.amount,Gl(f,m)}if(r.roll){const m=Ul(r.roll,c,kc);f.roll=this._map.transform.roll+o.ah(m.amount,-179,179),Gl(f,m)}if(f.zoom||f.bearing){const m=r.pinchAround===void 0?r.around:r.pinchAround;f.around=m?this._map.unproject(m):this._map.getCenter()}return this.clear(),o.e(f,{noMoveStart:!0})}}function Gl(p,e){(!p.duration||p.duration<e.duration)&&(p.duration=e.duration,p.easing=e.easing)}function Ul(p,e,r){const{maxSpeed:c,linearity:f,deceleration:m}=r,x=o.ah(p*f/(e/1e3),-c,c),T=Math.abs(x)/(m*f);return{easing:r.easing,duration:1e3*T,amount:x*(T/2)}}class Wn extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,c,f={}){c=c instanceof MouseEvent?c:new MouseEvent(e,c);const m=ee.mousePos(r.getCanvas(),c),x=r.unproject(m);super(e,o.e({point:m,lngLat:x,originalEvent:c},f)),this._defaultPrevented=!1,this.target=r}}class oa extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,c){const f=e==="touchend"?c.changedTouches:c.touches,m=ee.touchPos(r.getCanvasContainer(),f),x=m.map((A=>r.unproject(A))),T=m.reduce(((A,k,L,F)=>A.add(k.div(F.length))),new o.P(0,0));super(e,{points:m,point:T,lngLats:x,lngLat:r.unproject(T),originalEvent:c}),this._defaultPrevented=!1}}class Lc extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,c){super(e,{originalEvent:c}),this._defaultPrevented=!1}}class Rn{constructor(e,r){this._map=e,this._clickTolerance=r.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Lc(e.type,this._map,e))}mousedown(e,r){return this._mousedownPos=r,this._firePreventable(new Wn(e.type,this._map,e))}mouseup(e){this._map.fire(new Wn(e.type,this._map,e))}click(e,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||this._map.fire(new Wn(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Wn(e.type,this._map,e))}mouseover(e){this._map.fire(new Wn(e.type,this._map,e))}mouseout(e){this._map.fire(new Wn(e.type,this._map,e))}touchstart(e){return this._firePreventable(new oa(e.type,this._map,e))}touchmove(e){this._map.fire(new oa(e.type,this._map,e))}touchend(e){this._map.fire(new oa(e.type,this._map,e))}touchcancel(e){this._map.fire(new oa(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Un{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Wn(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Wn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Wn(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xo{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(o.P.convert(e),this._map.terrain)}}class Sn{constructor(e,r){this._map=e,this._tr=new xo(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,r){this.isEnabled()&&e.shiftKey&&e.button===0&&(ee.disableDrag(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(e,r){if(!this._active)return;const c=r;if(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)return;const f=this._startPos;this._lastPos=c,this._box||(this._box=ee.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const m=Math.min(f.x,c.x),x=Math.max(f.x,c.x),T=Math.min(f.y,c.y),A=Math.max(f.y,c.y);ee.setTransform(this._box,`translate(${m}px,${T}px)`),this._box.style.width=x-m+"px",this._box.style.height=A-T+"px"}mouseupWindow(e,r){if(!this._active||e.button!==0)return;const c=this._startPos,f=r;if(this.reset(),ee.suppressClick(),c.x!==f.x||c.y!==f.y)return this._map.fire(new o.l("boxzoomend",{originalEvent:e})),{cameraAnimation:m=>m.fitScreenCoordinates(c,f,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(ee.remove(this._box),this._box=null),ee.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,r){return this._map.fire(new o.l(e,{originalEvent:r}))}}function dr(p,e){if(p.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${p.length}, points ${e.length}`);const r={};for(let c=0;c<p.length;c++)r[p[c].identifier]=e[c];return r}class bf{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,r,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),c.length===this.numTouches&&(this.centroid=(function(f){const m=new o.P(0,0);for(const x of f)m._add(x);return m.div(f.length)})(r),this.touches=dr(c,r)))}touchmove(e,r,c){if(this.aborted||!this.centroid)return;const f=dr(c,r);for(const m in this.touches){const x=f[m];(!x||x.dist(this.touches[m])>30)&&(this.aborted=!0)}}touchend(e,r,c){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){const f=!this.aborted&&this.centroid;if(this.reset(),f)return f}}}class Au{constructor(e){this.singleTap=new bf(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,r,c){this.singleTap.touchstart(e,r,c)}touchmove(e,r,c){this.singleTap.touchmove(e,r,c)}touchend(e,r,c){const f=this.singleTap.touchend(e,r,c);if(f){const m=e.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(f)<30;if(m&&x||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}}}class wf{constructor(e){this._tr=new xo(e),this._zoomIn=new Au({numTouches:1,numTaps:2}),this._zoomOut=new Au({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,r,c){this._zoomIn.touchstart(e,r,c),this._zoomOut.touchstart(e,r,c)}touchmove(e,r,c){this._zoomIn.touchmove(e,r,c),this._zoomOut.touchmove(e,r,c)}touchend(e,r,c){const f=this._zoomIn.touchend(e,r,c),m=this._zoomOut.touchend(e,r,c),x=this._tr;return f?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:x.zoom+1,around:x.unproject(f)},{originalEvent:e})}):m?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:x.zoom-1,around:x.unproject(m)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vl{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const r=this._moveFunction(...e);if(r.bearingDelta||r.pitchDelta||r.rollDelta||r.around||r.panDelta)return this._active=!0,r}dragStart(e,r){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(r)?r[0]:r,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,r){if(!this.isEnabled())return;const c=this._lastPoint;if(!c)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const f=Array.isArray(r)?r[0]:r;return!this._moved&&f.dist(c)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=f,this._move(c,f))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&ee.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const bo=0,rl=2,zr={[bo]:1,[rl]:2};class Tt{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const r=ee.mouseButton(e);this._eventButton=r}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!(function(r,c){const f=zr[c];return r.buttons===void 0||(r.buttons&f)!==f})(e,this._eventButton)}isValidEndEvent(e){return ee.mouseButton(e)===this._eventButton}}class sl{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class Oc{constructor(e=new Tt({checkCorrectEvent:()=>!0}),r=new sl){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=r}_executeRelevantHandler(e,r,c){return e instanceof MouseEvent?r(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?c(e):void 0}startMove(e){this._executeRelevantHandler(e,(r=>this.mouseMoveStateManager.startMove(r)),(r=>this.oneFingerTouchMoveStateManager.startMove(r)))}endMove(e){this._executeRelevantHandler(e,(r=>this.mouseMoveStateManager.endMove(r)),(r=>this.oneFingerTouchMoveStateManager.endMove(r)))}isValidStartEvent(e){return this._executeRelevantHandler(e,(r=>this.mouseMoveStateManager.isValidStartEvent(r)),(r=>this.oneFingerTouchMoveStateManager.isValidStartEvent(r)))}isValidMoveEvent(e){return this._executeRelevantHandler(e,(r=>this.mouseMoveStateManager.isValidMoveEvent(r)),(r=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(r)))}isValidEndEvent(e){return this._executeRelevantHandler(e,(r=>this.mouseMoveStateManager.isValidEndEvent(r)),(r=>this.oneFingerTouchMoveStateManager.isValidEndEvent(r)))}}const wo=p=>{p.mousedown=p.dragStart,p.mousemoveWindow=p.dragMove,p.mouseup=p.dragEnd,p.contextmenu=e=>{e.preventDefault()}};class So{constructor(e,r){this._clickTolerance=e.clickTolerance||1,this._map=r,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,r,c){return this._calculateTransform(e,r,c)}touchmove(e,r,c){if(this._active){if(!this._shouldBePrevented(c.length))return e.preventDefault(),this._calculateTransform(e,r,c);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,r,c){this._calculateTransform(e,r,c),this._active&&this._shouldBePrevented(c.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,r,c){c.length>0&&(this._active=!0);const f=dr(c,r),m=new o.P(0,0),x=new o.P(0,0);let T=0;for(const k in f){const L=f[k],F=this._touches[k];F&&(m._add(L),x._add(L.sub(F)),T++,f[k]=L)}if(this._touches=f,this._shouldBePrevented(T)||!x.mag())return;const A=x.div(T);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:m.div(T),panDelta:A}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,r,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([r[0],r[1]]))}touchmove(e,r,c){if(!this._firstTwoTouches)return;e.preventDefault();const[f,m]=this._firstTwoTouches,x=ol(c,r,f),T=ol(c,r,m);if(!x||!T)return;const A=this._aroundCenter?null:x.add(T).div(2);return this._move([x,T],A,e)}touchend(e,r,c){if(!this._firstTwoTouches)return;const[f,m]=this._firstTwoTouches,x=ol(c,r,f),T=ol(c,r,m);x&&T||(this._active&&ee.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ol(p,e,r){for(let c=0;c<p.length;c++)if(p[c].identifier===r)return e[c]}function oi(p,e){return Math.log(p/e)/Math.LN2}class xs extends Mo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,r){const c=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(oi(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:oi(this._distance,c),pinchAround:r}}}function Ah(p,e){return 180*p.angleWith(e)/Math.PI}class Bc extends Mo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,r,c){const f=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ah(this._vector,f),pinchAround:r}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const r=25/(Math.PI*this._minDiameter)*360,c=Ah(e,this._startVector);return Math.abs(c)<r}}function To(p){return Math.abs(p.y)>Math.abs(p.x)}class ql extends Mo{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,r,c){super.touchstart(e,r,c),this._currentTouchCount=c.length}_start(e){this._lastPoints=e,To(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,r,c){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const f=e[0].sub(this._lastPoints[0]),m=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(f,m,c.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(f.y+m.y)/2*-.5}):void 0}gestureBeginsVertically(e,r,c){if(this._valid!==void 0)return this._valid;const f=e.mag()>=2,m=r.mag()>=2;if(!f&&!m)return;if(!f||!m)return this._firstMove===void 0&&(this._firstMove=c),c-this._firstMove<100&&void 0;const x=e.y>0==r.y>0;return To(e)&&To(r)&&x}}const Nc={panStep:100,bearingStep:15,pitchStep:10};class Eo{constructor(e){this._tr=new xo(e);const r=Nc;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let r=0,c=0,f=0,m=0,x=0;switch(e.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:e.shiftKey?c=-1:(e.preventDefault(),m=-1);break;case 39:e.shiftKey?c=1:(e.preventDefault(),m=1);break;case 38:e.shiftKey?f=1:(e.preventDefault(),x=-1);break;case 40:e.shiftKey?f=-1:(e.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(c=0,f=0),{cameraAnimation:T=>{const A=this._tr;T.easeTo({duration:300,easeId:"keyboardHandler",easing:jc,zoom:r?Math.round(A.zoom)+r*(e.shiftKey?2:1):A.zoom,bearing:A.bearing+c*this._bearingStep,pitch:A.pitch+f*this._pitchStep,offset:[-m*this._panStep,-x*this._panStep],center:A.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function jc(p){return p*(2-p)}const Ph=4.000244140625,Co=1/450;class zh{constructor(e,r){this._onTimeout=c=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)},this._map=e,this._tr=new xo(e),this._triggerRenderFrame=r,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Co}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let r=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const c=W.now(),f=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,r!==0&&r%Ph==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(f*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),e.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=e,this._delta-=r,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=ee.mousePos(this._map.getCanvas(),e),c=this._tr;this._aroundPoint=this._aroundCenter?c.transform.locationToScreenPoint(o.S.convert(c.center)):r,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const T=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=T),typeof this._targetZoom=="number"&&(this._targetZoom+=T)}if(this._delta!==0){const T=this._type==="wheel"&&Math.abs(this._delta)>Ph?this._wheelZoomRate:this._defaultZoomRate;let A=2/(1+Math.exp(-Math.abs(this._delta*T)));this._delta<0&&A!==0&&(A=1/A);const k=typeof this._targetZoom!="number"?e.scale:o.af(this._targetZoom);this._targetZoom=e.getConstrained(e.getCameraLngLat(),o.ak(k*A)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const r=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,c=this._startZoom,f=this._easing;let m,x=!1;if(this._type==="wheel"&&c&&f){const T=W.now()-this._lastWheelEventTime,A=Math.min((T+5)/200,1),k=f(A);m=o.C.number(c,r,k),A<1?this._frameId||(this._frameId=!0):x=!0}else m=r,x=!0;return this._active=!0,x&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=m,{noInertia:!0,needsRenderFrame:!x,zoomDelta:m-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let r=o.co;if(this._prevEase){const c=this._prevEase,f=(W.now()-c.start)/c.duration,m=c.easing(f+.01)-c.easing(f),x=.27/Math.sqrt(m*m+1e-4)*.01,T=Math.sqrt(.0729-x*x);r=o.cm(x,T,.25,1)}return this._prevEase={start:W.now(),duration:e,easing:r},r}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class qs{constructor(e,r){this._clickZoom=e,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class bs{constructor(e){this._tr=new xo(e),this.reset()}reset(){this._active=!1}dblclick(e,r){return e.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(r)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wi{constructor(){this._tap=new Au({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,r,c){if(!this._swipePoint)if(this._tapTime){const f=r[0],m=e.timeStamp-this._tapTime<500,x=this._tapPoint.dist(f)<30;m&&x?c.length>0&&(this._swipePoint=f,this._swipeTouch=c[0].identifier):this.reset()}else this._tap.touchstart(e,r,c)}touchmove(e,r,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;const f=r[0],m=f.y-this._swipePoint.y;return this._swipePoint=f,e.preventDefault(),this._active=!0,{zoomDelta:m/128}}}else this._tap.touchmove(e,r,c)}touchend(e,r,c){if(this._tapTime)this._swipePoint&&c.length===0&&this.reset();else{const f=this._tap.touchend(e,r,c);f&&(this._tapTime=e.timeStamp,this._tapPoint=f)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zs{constructor(e,r,c){this._el=e,this._mousePan=r,this._touchPan=c}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ir{constructor(e,r,c,f){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=r,this._mousePitch=c,this._mouseRoll=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Ao{constructor(e,r,c,f){this._el=e,this._touchZoom=r,this._touchRotate=c,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Fc{constructor(e,r){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=r,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=ee.create("div","maplibregl-cooperative-gesture-screen",e);let r=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(r=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const c=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),f=document.createElement("div");f.className="maplibregl-desktop-message",f.textContent=r,this._container.appendChild(f);const m=document.createElement("div");m.className="maplibregl-mobile-message",m.textContent=c,this._container.appendChild(m),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(ee.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,r){this._enabled&&(this._map.fire(new o.l("cooperativegestureprevented",{gestureType:e,originalEvent:r})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const ll=p=>p.zoom||p.drag||p.roll||p.pitch||p.rotate;class Zl extends o.l{}function cl(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta||p.rollDelta}class Yr{constructor(e,r){this.handleWindowEvent=f=>{this.handleEvent(f,`${f.type}Window`)},this.handleEvent=(f,m)=>{if(f.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const x=f.type==="renderFrame"?void 0:f,T={needsRenderFrame:!1},A={},k={};for(const{handlerName:N,handler:q,allowed:X}of this._handlers){if(!q.isEnabled())continue;let ae;if(this._blockedByActive(k,X,N))q.reset();else if(q[m||f.type]){if(o.cp(f,m||f.type)){const ne=ee.mousePos(this._map.getCanvas(),f);ae=q[m||f.type](f,ne)}else if(o.cq(f,m||f.type)){const ne=this._getMapTouches(f.touches),re=ee.touchPos(this._map.getCanvas(),ne);ae=q[m||f.type](f,re,ne)}else o.cr(m||f.type)||(ae=q[m||f.type](f));this.mergeHandlerResult(T,A,ae,N,x),ae&&ae.needsRenderFrame&&this._triggerRenderFrame()}(ae||q.isActive())&&(k[N]=q)}const L={};for(const N in this._previousActiveHandlers)k[N]||(L[N]=x);this._previousActiveHandlers=k,(Object.keys(L).length||cl(T))&&(this._changes.push([T,A,L]),this._triggerRenderFrame()),(Object.keys(k).length||cl(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:F}=T;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ch(e),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r);const c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(const[f,m,x]of this._listeners)ee.addEventListener(f,m,f===document?this.handleWindowEvent:this.handleEvent,x)}destroy(){for(const[e,r,c]of this._listeners)ee.removeEventListener(e,r,e===document?this.handleWindowEvent:this.handleEvent,c)}_addDefaultHandlers(e){const r=this._map,c=r.getCanvasContainer();this._add("mapEvent",new Rn(r,e));const f=r.boxZoom=new Sn(r,e);this._add("boxZoom",f),e.interactive&&e.boxZoom&&f.enable();const m=r.cooperativeGestures=new Fc(r,e.cooperativeGestures);this._add("cooperativeGestures",m),e.cooperativeGestures&&m.enable();const x=new wf(r),T=new bs(r);r.doubleClickZoom=new qs(T,x),this._add("tapZoom",x),this._add("clickZoom",T),e.interactive&&e.doubleClickZoom&&r.doubleClickZoom.enable();const A=new Wi;this._add("tapDragZoom",A);const k=r.touchPitch=new ql(r);this._add("touchPitch",k),e.interactive&&e.touchPitch&&r.touchPitch.enable(e.touchPitch);const L=()=>r.project(r.getCenter()),F=(function({enable:le,clickTolerance:me,aroundCenter:ye=!0,minPixelCenterThreshold:he=100,rotateDegreesPerPixelMoved:Me=.8},je){const De=new Tt({checkCorrectEvent:Le=>ee.mouseButton(Le)===0&&Le.ctrlKey||ee.mouseButton(Le)===2&&!Le.ctrlKey});return new Vl({clickTolerance:me,move:(Le,Ne)=>{const ht=je();if(ye&&Math.abs(ht.y-Le.y)>he)return{bearingDelta:o.cn(new o.P(Le.x,Ne.y),Ne,ht)};let dt=(Ne.x-Le.x)*Me;return ye&&Ne.y<ht.y&&(dt=-dt),{bearingDelta:dt}},moveStateManager:De,enable:le,assignEvents:wo})})(e,L),N=(function({enable:le,clickTolerance:me,pitchDegreesPerPixelMoved:ye=-.5}){const he=new Tt({checkCorrectEvent:Me=>ee.mouseButton(Me)===0&&Me.ctrlKey||ee.mouseButton(Me)===2});return new Vl({clickTolerance:me,move:(Me,je)=>({pitchDelta:(je.y-Me.y)*ye}),moveStateManager:he,enable:le,assignEvents:wo})})(e),q=(function({enable:le,clickTolerance:me,rollDegreesPerPixelMoved:ye=.3},he){const Me=new Tt({checkCorrectEvent:je=>ee.mouseButton(je)===2&&je.ctrlKey});return new Vl({clickTolerance:me,move:(je,De)=>{const Le=he();let Ne=(De.x-je.x)*ye;return De.y<Le.y&&(Ne=-Ne),{rollDelta:Ne}},moveStateManager:Me,enable:le,assignEvents:wo})})(e,L);r.dragRotate=new Ir(e,F,N,q),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",N,["mouseRotate","mouseRoll"]),this._add("mouseRoll",q,["mousePitch"]),e.interactive&&e.dragRotate&&r.dragRotate.enable();const X=(function({enable:le,clickTolerance:me}){const ye=new Tt({checkCorrectEvent:he=>ee.mouseButton(he)===0&&!he.ctrlKey});return new Vl({clickTolerance:me,move:(he,Me)=>({around:Me,panDelta:Me.sub(he)}),activateOnStart:!0,moveStateManager:ye,enable:le,assignEvents:wo})})(e),ae=new So(e,r);r.dragPan=new Zs(c,X,ae),this._add("mousePan",X),this._add("touchPan",ae,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&r.dragPan.enable(e.dragPan);const ne=new Bc,re=new xs;r.touchZoomRotate=new Ao(c,re,ne,A),this._add("touchRotate",ne,["touchPan","touchZoom"]),this._add("touchZoom",re,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&r.touchZoomRotate.enable(e.touchZoomRotate);const oe=r.scrollZoom=new zh(r,(()=>this._triggerRenderFrame()));this._add("scrollZoom",oe,["mousePan"]),e.interactive&&e.scrollZoom&&r.scrollZoom.enable(e.scrollZoom);const ue=r.keyboard=new Eo(r);this._add("keyboard",ue),e.interactive&&e.keyboard&&r.keyboard.enable(),this._add("blockableMapEvent",new Un(r))}_add(e,r,c){this._handlers.push({handlerName:e,handler:r,allowed:c}),this._handlersById[e]=r}stop(e){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ll(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,r,c){for(const f in e)if(f!==c&&(!r||r.indexOf(f)<0))return!0;return!1}_getMapTouches(e){const r=[];for(const c of e)this._el.contains(c.target)&&r.push(c);return r}mergeHandlerResult(e,r,c,f,m){if(!c)return;o.e(e,c);const x={handlerName:f,originalEvent:c.originalEvent||m};c.zoomDelta!==void 0&&(r.zoom=x),c.panDelta!==void 0&&(r.drag=x),c.rollDelta!==void 0&&(r.roll=x),c.pitchDelta!==void 0&&(r.pitch=x),c.bearingDelta!==void 0&&(r.rotate=x)}_applyChanges(){const e={},r={},c={};for(const[f,m,x]of this._changes)f.panDelta&&(e.panDelta=(e.panDelta||new o.P(0,0))._add(f.panDelta)),f.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+f.zoomDelta),f.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+f.bearingDelta),f.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+f.pitchDelta),f.rollDelta&&(e.rollDelta=(e.rollDelta||0)+f.rollDelta),f.around!==void 0&&(e.around=f.around),f.pinchAround!==void 0&&(e.pinchAround=f.pinchAround),f.noInertia&&(e.noInertia=f.noInertia),o.e(r,m),o.e(c,x);this._updateMapTransform(e,r,c),this._changes=[]}_updateMapTransform(e,r,c){const f=this._map,m=f._getTransformForUpdate(),x=f.terrain;if(!(cl(e)||x&&this._terrainMovement))return this._fireEvents(r,c,!0);f._stop(!0);let{panDelta:T,zoomDelta:A,bearingDelta:k,pitchDelta:L,rollDelta:F,around:N,pinchAround:q}=e;q!==void 0&&(N=q),N=N||f.transform.centerPoint,x&&!m.isPointOnMapSurface(N)&&(N=m.centerPoint);const X={panDelta:T,zoomDelta:A,rollDelta:F,pitchDelta:L,bearingDelta:k,around:N};this._map.cameraHelper.useGlobeControls&&!m.isPointOnMapSurface(N)&&(N=m.centerPoint);const ae=N.distSqr(m.centerPoint)<.01?m.center:m.screenPointToLocation(T?N.sub(T):N);this._handleMapControls({terrain:x,tr:m,deltasForHelper:X,preZoomAroundLoc:ae,combinedEventsInProgress:r,panDelta:T}),f._applyUpdatedTransform(m),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(r,c,!0)}_handleMapControls({terrain:e,tr:r,deltasForHelper:c,preZoomAroundLoc:f,combinedEventsInProgress:m,panDelta:x}){const T=this._map.cameraHelper;if(T.handleMapControlsRollPitchBearingZoom(c,r),e)return T.useGlobeControls?(this._terrainMovement||!m.drag&&!m.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void T.handleMapControlsPan(c,r,f)):this._terrainMovement||!m.drag&&!m.zoom?void(m.drag&&this._terrainMovement&&x?r.setCenter(r.screenPointToLocation(r.centerPoint.sub(x))):T.handleMapControlsPan(c,r,f)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void T.handleMapControlsPan(c,r,f));T.handleMapControlsPan(c,r,f)}_fireEvents(e,r,c){const f=ll(this._eventsInProgress),m=ll(e),x={};for(const F in e){const{originalEvent:N}=e[F];this._eventsInProgress[F]||(x[`${F}start`]=N),this._eventsInProgress[F]=e[F]}!f&&m&&this._fireEvent("movestart",m.originalEvent);for(const F in x)this._fireEvent(F,x[F]);m&&this._fireEvent("move",m.originalEvent);for(const F in e){const{originalEvent:N}=e[F];this._fireEvent(F,N)}const T={};let A;for(const F in this._eventsInProgress){const{handlerName:N,originalEvent:q}=this._eventsInProgress[F];this._handlersById[N].isActive()||(delete this._eventsInProgress[F],A=r[N]||q,T[`${F}end`]=A)}for(const F in T)this._fireEvent(F,T[F]);const k=ll(this._eventsInProgress),L=(f||m)&&!k;if(L&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const F=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&F.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(F)}if(c&&L){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=q=>q!==0&&-this._bearingSnap<q&&q<this._bearingSnap;!F||!F.essential&&W.prefersReducedMotion?(this._map.fire(new o.l("moveend",{originalEvent:A})),N(this._map.getBearing())&&this._map.resetNorth()):(N(F.bearing||this._map.getBearing())&&(F.bearing=0),F.freezeElevation=!0,this._map.easeTo(F,{originalEvent:A})),this._updatingCamera=!1}}_fireEvent(e,r){this._map.fire(new o.l(e,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new Zl("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Gc extends o.E{constructor(e,r,c){super(),this._renderFrameCallback=()=>{const f=Math.min((W.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(f)),f<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=c.bearingSnap,this.cameraHelper=r,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(e,r){e.apply(this.transform),this.transform=e,this.cameraHelper=r}getCenter(){return new o.S(this.transform.center.lng,this.transform.center.lat)}setCenter(e,r){return this.jumpTo({center:e},r)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,r){return this.jumpTo({elevation:e},r),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,r,c){return e=o.P.convert(e).mult(-1),this.panTo(this.transform.center,o.e({offset:e},r),c)}panTo(e,r,c){return this.easeTo(o.e({center:e},r),c)}getZoom(){return this.transform.zoom}setZoom(e,r){return this.jumpTo({zoom:e},r),this}zoomTo(e,r,c){return this.easeTo(o.e({zoom:e},r),c)}zoomIn(e,r){return this.zoomTo(this.getZoom()+1,e,r),this}zoomOut(e,r){return this.zoomTo(this.getZoom()-1,e,r),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,r){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new o.l("movestart",r)).fire(new o.l("move",r)).fire(new o.l("moveend",r))),this}getBearing(){return this.transform.bearing}setBearing(e,r){return this.jumpTo({bearing:e},r),this}getPadding(){return this.transform.padding}setPadding(e,r){return this.jumpTo({padding:e},r),this}rotateTo(e,r,c){return this.easeTo(o.e({bearing:e},r),c)}resetNorth(e,r){return this.rotateTo(0,o.e({duration:1e3},e),r),this}resetNorthPitch(e,r){return this.easeTo(o.e({bearing:0,pitch:0,roll:0,duration:1e3},e),r),this}snapToNorth(e,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,r):this}getPitch(){return this.transform.pitch}setPitch(e,r){return this.jumpTo({pitch:e},r),this}getRoll(){return this.transform.roll}setRoll(e,r){return this.jumpTo({roll:e},r),this}cameraForBounds(e,r){e=di.convert(e).adjustAntiMeridian();const c=r&&r.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),c,r)}_cameraForBoxAndBearing(e,r,c,f){const m={top:0,bottom:0,right:0,left:0};if(typeof(f=o.e({padding:m,offset:[0,0],maxZoom:this.transform.maxZoom},f)).padding=="number"){const k=f.padding;f.padding={top:k,bottom:k,right:k,left:k}}const x=o.e(m,f.padding);f.padding=x;const T=this.transform,A=new di(e,r);return this.cameraHelper.cameraForBoxAndBearing(f,x,A,c,T)}fitBounds(e,r,c){return this._fitInternal(this.cameraForBounds(e,r),r,c)}fitScreenCoordinates(e,r,c,f,m){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(o.P.convert(e)),this.transform.screenPointToLocation(o.P.convert(r)),c,f),f,m)}_fitInternal(e,r,c){return e?(delete(r=o.e(e,r)).padding,r.linear?this.easeTo(r,c):this.flyTo(r,c)):this}jumpTo(e,r){this.stop();const c=this._getTransformForUpdate();let f=!1,m=!1,x=!1;const T=c.zoom;this.cameraHelper.handleJumpToCenterZoom(c,e);const A=c.zoom!==T;return"elevation"in e&&c.elevation!==+e.elevation&&c.setElevation(+e.elevation),"bearing"in e&&c.bearing!==+e.bearing&&(f=!0,c.setBearing(+e.bearing)),"pitch"in e&&c.pitch!==+e.pitch&&(m=!0,c.setPitch(+e.pitch)),"roll"in e&&c.roll!==+e.roll&&(x=!0,c.setRoll(+e.roll)),e.padding==null||c.isPaddingEqual(e.padding)||c.setPadding(e.padding),this._applyUpdatedTransform(c),this.fire(new o.l("movestart",r)).fire(new o.l("move",r)),A&&this.fire(new o.l("zoomstart",r)).fire(new o.l("zoom",r)).fire(new o.l("zoomend",r)),f&&this.fire(new o.l("rotatestart",r)).fire(new o.l("rotate",r)).fire(new o.l("rotateend",r)),m&&this.fire(new o.l("pitchstart",r)).fire(new o.l("pitch",r)).fire(new o.l("pitchend",r)),x&&this.fire(new o.l("rollstart",r)).fire(new o.l("roll",r)).fire(new o.l("rollend",r)),this.fire(new o.l("moveend",r))}calculateCameraOptionsFromTo(e,r,c,f=0){const m=o.a1.fromLngLat(e,r),x=o.a1.fromLngLat(c,f),T=x.x-m.x,A=x.y-m.y,k=x.z-m.z,L=Math.hypot(T,A,k);if(L===0)throw new Error("Can't calculate camera options with same From and To");const F=Math.hypot(T,A),N=o.ak(this.transform.cameraToCenterDistance/L/this.transform.tileSize),q=180*Math.atan2(T,-A)/Math.PI;let X=180*Math.acos(F/L)/Math.PI;return X=k<0?90-X:90+X,{center:x.toLngLat(),elevation:f,zoom:N,pitch:X,bearing:q}}calculateCameraOptionsFromCameraLngLatAltRotation(e,r,c,f,m){const x=this.transform.calculateCenterFromCameraLngLatAlt(e,r,c,f);return{center:x.center,elevation:x.elevation,zoom:x.zoom,bearing:c,pitch:f,roll:m}}easeTo(e,r){this._stop(!1,e.easeId),((e=o.e({offset:[0,0],duration:500,easing:o.co},e)).animate===!1||!e.essential&&W.prefersReducedMotion)&&(e.duration=0);const c=this._getTransformForUpdate(),f=this.getBearing(),m=c.pitch,x=c.roll,T="bearing"in e?this._normalizeBearing(e.bearing,f):f,A="pitch"in e?+e.pitch:m,k="roll"in e?this._normalizeBearing(e.roll,x):x,L="padding"in e?e.padding:c.padding,F=o.P.convert(e.offset);let N,q;e.around&&(N=o.S.convert(e.around),q=c.locationToScreenPoint(N));const X={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},ae=this.cameraHelper.handleEaseTo(c,{bearing:T,pitch:A,roll:k,padding:L,around:N,aroundPoint:q,offsetAsPoint:F,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||f!==T,this._pitching=this._pitching||A!==m,this._rolling=this._rolling||k!==x,this._padding=!c.isPaddingEqual(L),this._zooming=this._zooming||ae.isZooming,this._easeId=e.easeId,this._prepareEase(r,e.noMoveStart,X),this.terrain&&this._prepareElevation(ae.elevationCenter),this._ease((ne=>{ae.easeFunc(ne),this.terrain&&!e.freezeElevation&&this._updateElevation(ne),this._applyUpdatedTransform(c),this._fireMoveEvents(r)}),(ne=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(r,ne)}),e),this}_prepareEase(e,r,c={}){this._moving=!0,r||c.moving||this.fire(new o.l("movestart",e)),this._zooming&&!c.zooming&&this.fire(new o.l("zoomstart",e)),this._rotating&&!c.rotating&&this.fire(new o.l("rotatestart",e)),this._pitching&&!c.pitching&&this.fire(new o.l("pitchstart",e)),this._rolling&&!c.rolling&&this.fire(new o.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const r=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&r!==this._elevationTarget){const c=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(c-(r-(c*e+this._elevationStart))/(1-e)),this._elevationTarget=r}this.transform.setElevation(o.C.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const r=e.getCameraLngLat(),c=e.getCameraAltitude(),f=this.terrain?this.terrain.getElevationForLngLatZoom(r,e.zoom):0;if(c<f){const m=this.calculateCameraOptionsFromTo(r,f,e.center,e.elevation);return{pitch:m.pitch,zoom:m.zoom}}return{}}_applyUpdatedTransform(e){const r=[];if(r.push((f=>this._elevateCameraIfInsideTerrain(f))),this.transformCameraUpdate&&r.push((f=>this.transformCameraUpdate(f))),!r.length)return;const c=e.clone();for(const f of r){const m=c.clone(),{center:x,zoom:T,roll:A,pitch:k,bearing:L,elevation:F}=f(m);x&&m.setCenter(x),F!==void 0&&m.setElevation(F),T!==void 0&&m.setZoom(T),A!==void 0&&m.setRoll(A),k!==void 0&&m.setPitch(k),L!==void 0&&m.setBearing(L),c.apply(m)}this.transform.apply(c)}_fireMoveEvents(e){this.fire(new o.l("move",e)),this._zooming&&this.fire(new o.l("zoom",e)),this._rotating&&this.fire(new o.l("rotate",e)),this._pitching&&this.fire(new o.l("pitch",e)),this._rolling&&this.fire(new o.l("roll",e))}_afterEase(e,r){if(this._easeId&&r&&this._easeId===r)return;delete this._easeId;const c=this._zooming,f=this._rotating,m=this._pitching,x=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,c&&this.fire(new o.l("zoomend",e)),f&&this.fire(new o.l("rotateend",e)),m&&this.fire(new o.l("pitchend",e)),x&&this.fire(new o.l("rollend",e)),this.fire(new o.l("moveend",e))}flyTo(e,r){if(!e.essential&&W.prefersReducedMotion){const Ne=o.Q(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Ne,r)}this.stop(),e=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.co},e);const c=this._getTransformForUpdate(),f=c.bearing,m=c.pitch,x=c.roll,T=c.padding,A="bearing"in e?this._normalizeBearing(e.bearing,f):f,k="pitch"in e?+e.pitch:m,L="roll"in e?this._normalizeBearing(e.roll,x):x,F="padding"in e?e.padding:c.padding,N=o.P.convert(e.offset);let q=c.centerPoint.add(N);const X=c.screenPointToLocation(q),ae=this.cameraHelper.handleFlyTo(c,{bearing:A,pitch:k,roll:L,padding:F,locationAtOffset:X,offsetAsPoint:N,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let ne=e.curve;const re=Math.max(c.width,c.height),oe=re/ae.scaleOfZoom,ue=ae.pixelPathLength;typeof ae.scaleOfMinZoom=="number"&&(ne=Math.sqrt(re/ae.scaleOfMinZoom/ue*2));const le=ne*ne;function me(Ne){const ht=(oe*oe-re*re+(Ne?-1:1)*le*le*ue*ue)/(2*(Ne?oe:re)*le*ue);return Math.log(Math.sqrt(ht*ht+1)-ht)}function ye(Ne){return(Math.exp(Ne)-Math.exp(-Ne))/2}function he(Ne){return(Math.exp(Ne)+Math.exp(-Ne))/2}const Me=me(!1);let je=function(Ne){return he(Me)/he(Me+ne*Ne)},De=function(Ne){return re*((he(Me)*(ye(ht=Me+ne*Ne)/he(ht))-ye(Me))/le)/ue;var ht},Le=(me(!0)-Me)/ne;if(Math.abs(ue)<2e-6||!isFinite(Le)){if(Math.abs(re-oe)<1e-6)return this.easeTo(e,r);const Ne=oe<re?-1:1;Le=Math.abs(Math.log(oe/re))/ne,De=()=>0,je=ht=>Math.exp(Ne*ne*ht)}return e.duration="duration"in e?+e.duration:1e3*Le/("screenSpeed"in e?+e.screenSpeed/ne:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=f!==A,this._pitching=k!==m,this._rolling=L!==x,this._padding=!c.isPaddingEqual(F),this._prepareEase(r,!1),this.terrain&&this._prepareElevation(ae.targetCenter),this._ease((Ne=>{const ht=Ne*Le,dt=1/je(ht),it=De(ht);this._rotating&&c.setBearing(o.C.number(f,A,Ne)),this._pitching&&c.setPitch(o.C.number(m,k,Ne)),this._rolling&&c.setRoll(o.C.number(x,L,Ne)),this._padding&&(c.interpolatePadding(T,F,Ne),q=c.centerPoint.add(N)),ae.easeFunc(Ne,dt,it,q),this.terrain&&!e.freezeElevation&&this._updateElevation(Ne),this._applyUpdatedTransform(c),this._fireMoveEvents(r)}),(()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(r)}),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,r){var c;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const f=this._onEaseEnd;delete this._onEaseEnd,f.call(this,r)}return e||(c=this.handlers)===null||c===void 0||c.stop(!1),this}_ease(e,r,c){c.animate===!1||c.duration===0?(e(1),r()):(this._easeStart=W.now(),this._easeOptions=c,this._onEaseFrame=e,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,r){e=o.aO(e,-180,180);const c=Math.abs(e-r);return Math.abs(e-360-r)<c&&(e-=360),Math.abs(e+360-r)<c&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(o.S.convert(e),this.transform.tileZoom):null}}const Pt={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class qt{constructor(e=Pt){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=r=>{!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"&&r.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=ee.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=ee.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ee.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){ee.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,r){const c=this._map._getUIString(`AttributionControl.${r}`);e.title=c,e.setAttribute("aria-label",c)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((f=>typeof f!="string"?"":f))):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}const r=this._map.style.sourceCaches;for(const f in r){const m=r[f];if(m.used||m.usedForTerrain){const x=m.getSource();x.attribution&&e.indexOf(x.attribution)<0&&e.push(x.attribution)}}e=e.filter((f=>String(f).trim())),e.sort(((f,m)=>f.length-m.length)),e=e.filter(((f,m)=>{for(let x=m+1;x<e.length;x++)if(e[x].indexOf(f)>=0)return!1;return!0}));const c=e.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,e.length?(this._innerContainer.innerHTML=ee.sanitize(c),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class ul{constructor(e={}){this._updateCompact=()=>{const r=this._container.children;if(r.length){const c=r[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&c.classList.add("maplibregl-compact"):c.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=ee.create("div","maplibregl-ctrl");const r=ee.create("a","maplibregl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://maplibre.org/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){ee.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Pu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const r=++this._id;return this._queue.push({callback:e,id:r,cancelled:!1}),r}remove(e){const r=this._currentlyRunning,c=r?this._queue.concat(r):this._queue;for(const f of c)if(f.id===e)return void(f.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const r=this._currentlyRunning=this._queue;this._queue=[];for(const c of r)if(!c.cancelled&&(c.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var $l=o.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class la extends o.E{constructor(e){super(),this._lastTilesetChange=W.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,r){this.sourceCache.update(e,r),this._renderableTilesKeys=[];const c={};for(const f of _i(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:r,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))c[f.key]=!0,this._renderableTilesKeys.push(f.key),this._tiles[f.key]||(f.terrainRttPosMatrix32f=new Float64Array(16),o.bZ(f.terrainRttPosMatrix32f,0,o.$,o.$,0,0,1),this._tiles[f.key]=new H(f,this.tileSize),this._lastTilesetChange=W.now());for(const f in this._tiles)c[f]||delete this._tiles[f]}freeRtt(e){for(const r in this._tiles){const c=this._tiles[r];(!e||c.tileID.equals(e)||c.tileID.isChildOf(e)||e.isChildOf(c.tileID))&&(c.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((e=>this.getTileByID(e)))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,r){return r?this._getTerrainCoordsForTileRanges(e,r):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const r={};for(const c of this._renderableTilesKeys){const f=this._tiles[c].tileID,m=e.clone(),x=o.ba();if(f.canonical.equals(e.canonical))o.bZ(x,0,o.$,o.$,0,0,1);else if(f.canonical.isChildOf(e.canonical)){const T=f.canonical.z-e.canonical.z,A=f.canonical.x-(f.canonical.x>>T<<T),k=f.canonical.y-(f.canonical.y>>T<<T),L=o.$>>T;o.bZ(x,0,L,L,0,0,1),o.M(x,x,[-A*L,-k*L,0])}else{if(!e.canonical.isChildOf(f.canonical))continue;{const T=e.canonical.z-f.canonical.z,A=e.canonical.x-(e.canonical.x>>T<<T),k=e.canonical.y-(e.canonical.y>>T<<T),L=o.$>>T;o.bZ(x,0,o.$,o.$,0,0,1),o.M(x,x,[A*L,k*L,0]),o.N(x,x,[1/2**T,1/2**T,0])}}m.terrainRttPosMatrix32f=new Float32Array(x),r[c]=m}return r}_getTerrainCoordsForTileRanges(e,r){const c={};for(const f of this._renderableTilesKeys){const m=this._tiles[f].tileID;if(!this._isWithinTileRanges(m,r))continue;const x=e.clone(),T=o.ba();if(m.canonical.z===e.canonical.z){const A=e.canonical.x-m.canonical.x,k=e.canonical.y-m.canonical.y;o.bZ(T,0,o.$,o.$,0,0,1),o.M(T,T,[A*o.$,k*o.$,0])}else if(m.canonical.z>e.canonical.z){const A=m.canonical.z-e.canonical.z,k=m.canonical.x-(m.canonical.x>>A<<A),L=m.canonical.y-(m.canonical.y>>A<<A),F=e.canonical.x-(m.canonical.x>>A),N=e.canonical.y-(m.canonical.y>>A),q=o.$>>A;o.bZ(T,0,q,q,0,0,1),o.M(T,T,[-k*q+F*o.$,-L*q+N*o.$,0])}else{const A=e.canonical.z-m.canonical.z,k=e.canonical.x-(e.canonical.x>>A<<A),L=e.canonical.y-(e.canonical.y>>A<<A),F=(e.canonical.x>>A)-m.canonical.x,N=(e.canonical.y>>A)-m.canonical.y,q=o.$<<A;o.bZ(T,0,q,q,0,0,1),o.M(T,T,[k*o.$+F*q,L*o.$+N*q,0])}x.terrainRttPosMatrix32f=new Float32Array(T),c[f]=x}return c}getSourceTile(e,r){const c=this.sourceCache._source;let f=e.overscaledZ-this.deltaZoom;if(f>c.maxzoom&&(f=c.maxzoom),f<c.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(f).key);let m=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!m||!m.dem)&&r)for(;f>=c.minzoom&&(!m||!m.dem);)m=this.sourceCache.getTileByID(e.scaledTo(f--).key);return m}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,r){return r[e.canonical.z]&&e.canonical.x>=r[e.canonical.z].minTileX&&e.canonical.x<=r[e.canonical.z].maxTileX&&e.canonical.y>=r[e.canonical.z].minTileY&&e.canonical.y<=r[e.canonical.z].maxTileY}}class fr{constructor(e,r,c){this._meshCache={},this.painter=e,this.sourceCache=new la(r),this.options=c,this.exaggeration=typeof c.exaggeration=="number"?c.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,r,c,f=o.$){var m;if(!(r>=0&&r<f&&c>=0&&c<f))return 0;const x=this.getTerrainData(e),T=(m=x.tile)===null||m===void 0?void 0:m.dem;if(!T)return 0;const A=o.cs([],[r/f*o.$,c/f*o.$],x.u_terrain_matrix),k=[A[0]*T.dim,A[1]*T.dim],L=Math.floor(k[0]),F=Math.floor(k[1]),N=k[0]-L,q=k[1]-F;return T.get(L,F)*(1-N)*(1-q)+T.get(L+1,F)*N*(1-q)+T.get(L,F+1)*(1-N)*q+T.get(L+1,F+1)*N*q}getElevationForLngLatZoom(e,r){if(!o.ct(r,e.wrap()))return 0;const{tileID:c,mercatorX:f,mercatorY:m}=this._getOverscaledTileIDFromLngLatZoom(e,r);return this.getElevation(c,f%o.$,m%o.$,o.$)}getElevation(e,r,c,f=o.$){return this.getDEMElevation(e,r,c,f)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const f=this.painter.context,m=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new o.T(f,m,f.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new o.T(f,new o.R({width:1,height:1}),f.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.ag([])}const r=this.sourceCache.getSourceTile(e,!0);if(r&&r.dem&&(!r.demTexture||r.needsTerrainPrepare)){const f=this.painter.context;r.demTexture=this.painter.getTileTexture(r.dem.stride),r.demTexture?r.demTexture.update(r.dem.getPixels(),{premultiply:!1}):r.demTexture=new o.T(f,r.dem.getPixels(),f.gl.RGBA,{premultiply:!1}),r.demTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),r.needsTerrainPrepare=!1}const c=r&&r+r.tileID.key+e.key;if(c&&!this._demMatrixCache[c]){const f=this.sourceCache.sourceCache._source.maxzoom;let m=e.canonical.z-r.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=f?m=e.canonical.z-f:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const x=e.canonical.x-(e.canonical.x>>m<<m),T=e.canonical.y-(e.canonical.y>>m<<m),A=o.cu(new Float64Array(16),[1/(o.$<<m),1/(o.$<<m),0]);o.M(A,A,[x*o.$,T*o.$,0]),this._demMatrixCache[e.key]={matrix:A,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:r&&r.dem&&r.dem.dim||1,u_terrain_matrix:c?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:r&&r.dem&&r.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(r&&r.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:r}}getFramebuffer(e){const r=this.painter,c=r.width/devicePixelRatio,f=r.height/devicePixelRatio;return!this._fbo||this._fbo.width===c&&this._fbo.height===f||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new o.T(r.context,{width:c,height:f,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new o.T(r.context,{width:c,height:f,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=r.context.createFramebuffer(c,f,!0,!1),this._fbo.depthAttachment.set(r.context.createRenderbuffer(r.context.gl.DEPTH_COMPONENT16,c,f))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const r=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let m=0,x=0;m<this._coordsTextureSize;m++)for(let T=0;T<this._coordsTextureSize;T++,x+=4)r[x+0]=255&T,r[x+1]=255&m,r[x+2]=T>>8<<4|m>>8,r[x+3]=0;const c=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(r.buffer)),f=new o.T(e,c,e.gl.RGBA,{premultiply:!1});return f.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=f,f}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const r=new Uint8Array(4),c=this.painter.context,f=c.gl,m=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),x=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),T=Math.round(this.painter.height/devicePixelRatio);c.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),f.readPixels(m,T-x-1,1,1,f.RGBA,f.UNSIGNED_BYTE,r),c.bindFramebuffer.set(null);const A=r[0]+(r[2]>>4<<8),k=r[1]+((15&r[2])<<8),L=this.coordsIndex[255-r[3]],F=L&&this.sourceCache.getTileByID(L);if(!F)return null;const N=this._coordsTextureSize,q=(1<<F.tileID.canonical.z)*N;return new o.a1((F.tileID.canonical.x*N+A)/q+F.tileID.wrap,(F.tileID.canonical.y*N+k)/q,this.getElevation(F.tileID,A,k,N))}depthAtPoint(e){const r=new Uint8Array(4),c=this.painter.context,f=c.gl;return c.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),f.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,f.RGBA,f.UNSIGNED_BYTE,r),c.bindFramebuffer.set(null),(r[0]/16777216+r[1]/65536+r[2]/256+r[3])/256}getTerrainMesh(e){var r;const c=((r=this.painter.style.projection)===null||r===void 0?void 0:r.transitionState)>0,f=c&&e.canonical.y===0,m=c&&e.canonical.y===(1<<e.canonical.z)-1,x=`m_${f?"n":""}_${m?"s":""}`;if(this._meshCache[x])return this._meshCache[x];const T=this.painter.context,A=new o.cv,k=new o.aN,L=this.meshSize,F=o.$/L,N=L*L;for(let he=0;he<=L;he++)for(let Me=0;Me<=L;Me++)A.emplaceBack(Me*F,he*F,0);for(let he=0;he<N;he+=L+1)for(let Me=0;Me<L;Me++)k.emplaceBack(Me+he,L+Me+he+1,L+Me+he+2),k.emplaceBack(Me+he,L+Me+he+2,Me+he+1);const q=A.length,X=q+(L+1),ae=(L+1)*L,ne=f?o.bh:0,re=f?0:1,oe=m?o.bi:o.$,ue=m?0:1;for(let he=0;he<=L;he++)A.emplaceBack(he*F,ne,re);for(let he=0;he<=L;he++)A.emplaceBack(he*F,oe,ue);for(let he=0;he<L;he++)k.emplaceBack(ae+he,X+he,X+he+1),k.emplaceBack(ae+he,X+he+1,ae+he+1),k.emplaceBack(0+he,q+he+1,q+he),k.emplaceBack(0+he,0+he+1,q+he+1);const le=A.length,me=le+2*(L+1);for(const he of[0,1])for(let Me=0;Me<=L;Me++)for(const je of[0,1])A.emplaceBack(he*o.$,Me*F,je);for(let he=0;he<2*L;he+=2)k.emplaceBack(le+he,le+he+1,le+he+3),k.emplaceBack(le+he,le+he+3,le+he+2),k.emplaceBack(me+he,me+he+3,me+he+1),k.emplaceBack(me+he,me+he+2,me+he+3);const ye=new oo(T.createVertexBuffer(A,$l.members),T.createIndexBuffer(k),o.aM.simpleSegment(0,0,A.length,k.length));return this._meshCache[x]=ye,ye}getMeshFrameDelta(e){return 2*Math.PI*o.bu/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,r){var c;const{tileID:f}=this._getOverscaledTileIDFromLngLatZoom(e,r);return(c=this.getMinMaxElevation(f).minElevation)!==null&&c!==void 0?c:0}getMinMaxElevation(e){const r=this.getTerrainData(e).tile,c={minElevation:null,maxElevation:null};return r&&r.dem&&(c.minElevation=r.dem.min*this.exaggeration,c.maxElevation=r.dem.max*this.exaggeration),c}_getOverscaledTileIDFromLngLatZoom(e,r){const c=o.a1.fromLngLat(e.wrap()),f=(1<<r)*o.$,m=c.x*f,x=c.y*f,T=Math.floor(m/o.$),A=Math.floor(x/o.$);return{tileID:new o.Z(r,0,r,T,A),mercatorX:m,mercatorY:x}}}class yn{constructor(e,r,c){this._context=e,this._size=r,this._tileSize=c,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const r=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),c=new o.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return c.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),r.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),r.colorAttachment.set(c.texture),{id:e,fbo:r,texture:c,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((r=>e.id!==r)),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const r of this._recentlyUsed)if(!this._objects[r].inUse)return this._objects[r];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((e=>!e.inUse))===!1}}const $s={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Md{constructor(e,r){this.painter=e,this.terrain=r,this.pool=new yn(e.context,30,r.sourceCache.tileSize*r.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,r){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter((c=>!e._layers[c].isHidden(r))),this._coordsAscending={};for(const c in e.sourceCaches){this._coordsAscending[c]={};const f=e.sourceCaches[c].getVisibleCoordinates(),m=e.sourceCaches[c].getSource(),x=m instanceof gi?m.terrainTileRanges:null;for(const T of f){const A=this.terrain.sourceCache.getTerrainCoords(T,x);for(const k in A)this._coordsAscending[c][k]||(this._coordsAscending[c][k]=[]),this._coordsAscending[c][k].push(A[k])}}this._coordsAscendingStr={};for(const c of e._order){const f=e._layers[c],m=f.source;if($s[f.type]&&!this._coordsAscendingStr[m]){this._coordsAscendingStr[m]={};for(const x in this._coordsAscending[m])this._coordsAscendingStr[m][x]=this._coordsAscending[m][x].map((T=>T.key)).sort().join()}}for(const c of this._renderableTiles)for(const f in this._coordsAscendingStr){const m=this._coordsAscendingStr[f][c.tileID.key];m&&m!==c.rttCoords[f]&&(c.rtt=[])}}renderLayer(e,r){if(e.isHidden(this.painter.transform.zoom))return!1;const c=Object.assign(Object.assign({},r),{isRenderingToTexture:!0}),f=e.type,m=this.painter,x=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if($s[f]&&(this._prevType&&$s[this._prevType]||this._stacks.push([]),this._prevType=f,this._stacks[this._stacks.length-1].push(e.id),!x))return!0;if($s[this._prevType]||$s[f]&&x){this._prevType=f;const T=this._stacks.length-1,A=this._stacks[T]||[];for(const k of this._renderableTiles){if(this.pool.isFull()&&(vs(this.painter,this.terrain,this._rttTiles,c),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(k),k.rtt[T]){const F=this.pool.getObjectForId(k.rtt[T].id);if(F.stamp===k.rtt[T].stamp){this.pool.useObject(F);continue}}const L=this.pool.getOrCreateFreeObject();this.pool.useObject(L),this.pool.stampObject(L),k.rtt[T]={id:L.id,stamp:L.stamp},m.context.bindFramebuffer.set(L.fbo.framebuffer),m.context.clear({color:o.bf.transparent,stencil:0}),m.currentStencilSource=void 0;for(let F=0;F<A.length;F++){const N=m.style._layers[A[F]],q=N.source?this._coordsAscending[N.source][k.tileID.key]:[k.tileID];m.context.viewport.set([0,0,L.fbo.width,L.fbo.height]),m._renderTileClippingMasks(N,q,!0),m.renderLayer(m,m.style.sourceCaches[N.source],N,q,c),N.source&&(k.rttCoords[N.source]=this._coordsAscendingStr[N.source][k.tileID.key])}}return vs(this.painter,this.terrain,this._rttTiles,c),this._rttTiles=[],this.pool.freeAllObjects(),$s[f]}return!1}}const Po={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},pr=B,fa={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Pt,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},ca={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Qi{constructor(e,r,c=!1){this.mousedown=m=>{this.startMove(m,ee.mousePos(this.element,m)),ee.addEventListener(window,"mousemove",this.mousemove),ee.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=m=>{this.move(m,ee.mousePos(this.element,m))},this.mouseup=m=>{this._rotatePitchHandler.dragEnd(m),this.offTemp()},this.touchstart=m=>{m.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ee.touchPos(this.element,m.targetTouches)[0],this.startMove(m,this._startPos),ee.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),ee.addEventListener(window,"touchend",this.touchend))},this.touchmove=m=>{m.targetTouches.length!==1?this.reset():(this._lastPos=ee.touchPos(this.element,m.targetTouches)[0],this.move(m,this._lastPos))},this.touchend=m=>{m.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=r;const f=new Oc;this._rotatePitchHandler=new Vl({clickTolerance:3,move:(m,x)=>{const T=r.getBoundingClientRect(),A=new o.P((T.bottom-T.top)/2,(T.right-T.left)/2);return{bearingDelta:o.cn(new o.P(m.x,x.y),x,A),pitchDelta:c?-.5*(x.y-m.y):void 0}},moveStateManager:f,enable:!0,assignEvents:()=>{}}),this.map=e,ee.addEventListener(r,"mousedown",this.mousedown),ee.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),ee.addEventListener(r,"touchcancel",this.reset)}startMove(e,r){this._rotatePitchHandler.dragStart(e,r),ee.disableDrag()}move(e,r){const c=this.map,{bearingDelta:f,pitchDelta:m}=this._rotatePitchHandler.dragMove(e,r)||{};f&&c.setBearing(c.getBearing()+f),m&&c.setPitch(c.getPitch()+m)}off(){const e=this.element;ee.removeEventListener(e,"mousedown",this.mousedown),ee.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),ee.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ee.removeEventListener(window,"touchend",this.touchend),ee.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){ee.enableDrag(),ee.removeEventListener(window,"mousemove",this.mousemove),ee.removeEventListener(window,"mouseup",this.mouseup),ee.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ee.removeEventListener(window,"touchend",this.touchend)}}let ti;function Fi(p,e,r,c=!1){if(c||!r.getCoveringTilesDetailsProvider().allowWorldCopies())return p?.wrap();const f=new o.S(p.lng,p.lat);if(p=new o.S(p.lng,p.lat),e){const m=new o.S(p.lng-360,p.lat),x=new o.S(p.lng+360,p.lat),T=r.locationToScreenPoint(p).distSqr(e);r.locationToScreenPoint(m).distSqr(e)<T?p=m:r.locationToScreenPoint(x).distSqr(e)<T&&(p=x)}for(;Math.abs(p.lng-r.center.lng)>180;){const m=r.locationToScreenPoint(p);if(m.x>=0&&m.y>=0&&m.x<=r.width&&m.y<=r.height)break;p.lng>r.center.lng?p.lng-=360:p.lng+=360}return p.lng!==f.lng&&r.isPointOnMapSurface(r.locationToScreenPoint(p))?p:f}const va={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function hl(p,e,r){const c=p.classList;for(const f in va)c.remove(`maplibregl-${r}-anchor-${f}`);c.add(`maplibregl-${r}-anchor-${e}`)}class ws extends o.E{constructor(e){if(super(),this._onKeyPress=r=>{const c=r.code,f=r.charCode||r.keyCode;c!=="Space"&&c!=="Enter"&&f!==32&&f!==13||this.togglePopup()},this._onMapClick=r=>{const c=r.originalEvent.target,f=this._element;this._popup&&(c===f||f.contains(c))&&this.togglePopup()},this._update=r=>{if(!this._map)return;const c=this._map.loaded()&&!this._map.isMoving();(r?.type==="terrain"||r?.type==="render"&&!c)&&this._map.once("render",this._update),this._lngLat=Fi(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let f="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?f=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(f=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let m="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?m="rotateX(0deg)":this._pitchAlignment==="map"&&(m=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||r&&r.type!=="moveend"||(this._pos=this._pos.round()),ee.setTransform(this._element,`${va[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${m} ${f}`),W.frameAsync(new AbortController).then((()=>{this._updateOpacity(r&&r.type==="moveend")})).catch((()=>{}))},this._onMove=r=>{if(!this._isDragging){const c=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.l("dragstart"))),this.fire(new o.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.l("dragend")),this._state="inactive"},this._addDragHandler=r=>{this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos).add(this._offset),this._pointerdownPos=r.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=o.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=ee.create("div");const r=ee.createNS("http://www.w3.org/2000/svg","svg"),c=41,f=27;r.setAttributeNS(null,"display","block"),r.setAttributeNS(null,"height",`${c}px`),r.setAttributeNS(null,"width",`${f}px`),r.setAttributeNS(null,"viewBox",`0 0 ${f} ${c}`);const m=ee.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"stroke","none"),m.setAttributeNS(null,"stroke-width","1"),m.setAttributeNS(null,"fill","none"),m.setAttributeNS(null,"fill-rule","evenodd");const x=ee.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"fill-rule","nonzero");const T=ee.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"transform","translate(3.0, 29.0)"),T.setAttributeNS(null,"fill","#000000");const A=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const re of A){const oe=ee.createNS("http://www.w3.org/2000/svg","ellipse");oe.setAttributeNS(null,"opacity","0.04"),oe.setAttributeNS(null,"cx","10.5"),oe.setAttributeNS(null,"cy","5.80029008"),oe.setAttributeNS(null,"rx",re.rx),oe.setAttributeNS(null,"ry",re.ry),T.appendChild(oe)}const k=ee.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"fill",this._color);const L=ee.createNS("http://www.w3.org/2000/svg","path");L.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),k.appendChild(L);const F=ee.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"opacity","0.25"),F.setAttributeNS(null,"fill","#000000");const N=ee.createNS("http://www.w3.org/2000/svg","path");N.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),F.appendChild(N);const q=ee.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"transform","translate(6.0, 7.0)"),q.setAttributeNS(null,"fill","#FFFFFF");const X=ee.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ae=ee.createNS("http://www.w3.org/2000/svg","circle");ae.setAttributeNS(null,"fill","#000000"),ae.setAttributeNS(null,"opacity","0.25"),ae.setAttributeNS(null,"cx","5.5"),ae.setAttributeNS(null,"cy","5.5"),ae.setAttributeNS(null,"r","5.4999962");const ne=ee.createNS("http://www.w3.org/2000/svg","circle");ne.setAttributeNS(null,"fill","#FFFFFF"),ne.setAttributeNS(null,"cx","5.5"),ne.setAttributeNS(null,"cy","5.5"),ne.setAttributeNS(null,"r","5.4999962"),X.appendChild(ae),X.appendChild(ne),x.appendChild(T),x.appendChild(k),x.appendChild(F),x.appendChild(q),x.appendChild(X),r.appendChild(x),r.setAttributeNS(null,"height",c*this._scale+"px"),r.setAttributeNS(null,"width",f*this._scale+"px"),this._element.appendChild(r),this._offset=o.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(r=>{r.preventDefault()})),this._element.addEventListener("mousedown",(r=>{r.preventDefault()})),hl(this._element,this._anchor,"marker"),e&&e.className)for(const r of e.className.split(" "))this._element.classList.add(r);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),ee.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=o.S.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const f=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(38.1-13.5+f)],"bottom-right":[-f,-1*(38.1-13.5+f)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var r,c;const f=(r=this._map)===null||r===void 0?void 0:r.terrain,m=this._map.transform.isLocationOccluded(this._lngLat);if(!f||m){const q=m?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==q&&(this._element.style.opacity=q))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const x=this._map,T=x.terrain.depthAtPoint(this._pos),A=x.terrain.getElevationForLngLatZoom(this._lngLat,x.transform.tileZoom);if(x.transform.lngLatToCameraDepth(this._lngLat,A)-T<.006)return void(this._element.style.opacity=this._opacity);const k=-this._offset.y/x.transform.pixelsPerMeter,L=Math.sin(x.getPitch()*Math.PI/180)*k,F=x.terrain.depthAtPoint(new o.P(this._pos.x,this._pos.y-this._offset.y)),N=x.transform.lngLatToCameraDepth(this._lngLat,A+L)-F>.006;!((c=this._popup)===null||c===void 0)&&c.isOpen()&&N&&this._popup.remove(),this._element.style.opacity=N?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=o.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,r){return(this._opacity===void 0||e===void 0&&r===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),r!==void 0&&(this._opacityWhenCovered=r),this._map&&this._updateOpacity(!0),this}}const Hs={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Wr=0,Qr=!1;const zo={maxWidth:100,unit:"metric"};function zu(p,e,r){const c=r&&r.maxWidth||100,f=p._container.clientHeight/2,m=p._container.clientWidth/2,x=p.unproject([m-c/2,f]),T=p.unproject([m+c/2,f]),A=Math.round(p.project(T).x-p.project(x).x),k=Math.min(c,A,p._container.clientWidth),L=x.distanceTo(T);if(r&&r.unit==="imperial"){const F=3.2808*L;F>5280?aa(e,k,F/5280,p._getUIString("ScaleControl.Miles")):aa(e,k,F,p._getUIString("ScaleControl.Feet"))}else r&&r.unit==="nautical"?aa(e,k,L/1852,p._getUIString("ScaleControl.NauticalMiles")):L>=1e3?aa(e,k,L/1e3,p._getUIString("ScaleControl.Kilometers")):aa(e,k,L,p._getUIString("ScaleControl.Meters"))}function aa(p,e,r,c){const f=(function(m){const x=Math.pow(10,`${Math.floor(m)}`.length-1);let T=m/x;return T=T>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:(function(A){const k=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*k)/k})(T),x*T})(r);p.style.width=e*(f/r)+"px",p.innerHTML=`${f}&nbsp;${c}`}const Uc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Vc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function qc(p){if(p){if(typeof p=="number"){const e=Math.round(Math.abs(p)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,p),"top-left":new o.P(e,e),"top-right":new o.P(-e,e),bottom:new o.P(0,-p),"bottom-left":new o.P(e,-e),"bottom-right":new o.P(-e,-e),left:new o.P(p,0),right:new o.P(-p,0)}}if(p instanceof o.P||Array.isArray(p)){const e=o.P.convert(p);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:o.P.convert(p.center||[0,0]),top:o.P.convert(p.top||[0,0]),"top-left":o.P.convert(p["top-left"]||[0,0]),"top-right":o.P.convert(p["top-right"]||[0,0]),bottom:o.P.convert(p.bottom||[0,0]),"bottom-left":o.P.convert(p["bottom-left"]||[0,0]),"bottom-right":o.P.convert(p["bottom-right"]||[0,0]),left:o.P.convert(p.left||[0,0]),right:o.P.convert(p.right||[0,0])}}return qc(new o.P(0,0))}const Iu=B;E.AJAXError=o.cz,E.Event=o.l,E.Evented=o.E,E.LngLat=o.S,E.MercatorCoordinate=o.a1,E.Point=o.P,E.addProtocol=o.cA,E.config=o.a,E.removeProtocol=o.cB,E.AttributionControl=qt,E.BoxZoomHandler=Sn,E.CanvasSource=qn,E.CooperativeGesturesHandler=Fc,E.DoubleClickZoomHandler=qs,E.DragPanHandler=Zs,E.DragRotateHandler=Ir,E.EdgeInsets=Vo,E.FullscreenControl=class extends o.E{constructor(p={}){super(),this._onFullscreenChange=()=>{var e;let r=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=r?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)r=r.shadowRoot.fullscreenElement;r===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=ee.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){ee.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const p=this._fullscreenButton=ee.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);ee.create("span","maplibregl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.title=p}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new o.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},E.GeoJSONSource=Si,E.GeolocateControl=class extends o.E{constructor(p){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new o.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const r=new o.S(e.coords.longitude,e.coords.latitude),c=e.coords.accuracy,f=this._map.getBearing(),m=o.e({bearing:f},this.options.fitBoundsOptions),x=di.fromLngLat(r,c);this._map.fitBounds(x,m,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const r=new o.S(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=e.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Qr)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=ee.create("button","maplibregl-ctrl-geolocate",this._container),ee.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ee.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new ws({element:this._dotElement}),this._circleElement=ee.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ws({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(r=>{const c=r?.[0]instanceof ResizeObserverEntry;r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||c||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.l("trackuserlocationend")),this.fire(new o.l("userlocationlostfocus")))}))}},this.options=o.e({},Hs,p)}onAdd(p){return this._map=p,this._container=ee.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return o._(this,arguments,void 0,(function*(e=!1){if(ti!==void 0&&!e)return ti;if(window.navigator.permissions===void 0)return ti=!!window.navigator.geolocation,ti;try{ti=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ti=!!window.navigator.geolocation}return ti}))})().then((e=>this._finishSetupUI(e))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ee.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,Wr=0,Qr=!1}_isOutOfMapMaxBounds(p){const e=this._map.getMaxBounds(),r=p.coords;return e&&(r.longitude<e.getWest()||r.longitude>e.getEast()||r.latitude<e.getSouth()||r.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const p=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&p))return;const e=this._map.project(p),r=this._map.unproject([e.x+100,e.y]),c=p.distanceTo(r)/100,f=2*this._accuracy/c;this._circleElement.style.width=`${f.toFixed(2)}px`,this._circleElement.style.height=`${f.toFixed(2)}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Wr--,Qr=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.l("trackuserlocationstart")),this.fire(new o.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Wr++,Wr>1?(p={maximumAge:6e5,timeout:0},Qr=!0):(p=this.options.positionOptions,Qr=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},E.GlobeControl=class{constructor(){this._toggleProjection=()=>{var p;const e=(p=this._map.getProjection())===null||p===void 0?void 0:p.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var p;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((p=this._map.getProjection())===null||p===void 0?void 0:p.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(p){return this._map=p,this._container=ee.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=ee.create("button","maplibregl-ctrl-globe",this._container),ee.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){ee.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},E.Hash=Rc,E.ImageSource=gi,E.KeyboardHandler=Eo,E.LngLatBounds=di,E.LogoControl=ul,E.Map=class extends Gc{constructor(p){var e,r;o.cw.mark(o.cx.create);const c=Object.assign(Object.assign(Object.assign({},fa),p),{canvasContextAttributes:Object.assign(Object.assign({},fa.canvasContextAttributes),p.canvasContextAttributes)});if(c.minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const f=new ds,m=new Tr;if(c.minZoom!==void 0&&f.setMinZoom(c.minZoom),c.maxZoom!==void 0&&f.setMaxZoom(c.maxZoom),c.minPitch!==void 0&&f.setMinPitch(c.minPitch),c.maxPitch!==void 0&&f.setMaxPitch(c.maxPitch),c.renderWorldCopies!==void 0&&f.setRenderWorldCopies(c.renderWorldCopies),super(f,m,{bearingSnap:c.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Pu,this._controls=[],this._mapId=o.a7(),this._contextLost=T=>{T.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new o.l("webglcontextlost",{originalEvent:T}))},this._contextRestored=T=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.l("webglcontextrestored",{originalEvent:T}))},this._onMapScroll=T=>{if(T.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=c.interactive,this._maxTileCacheSize=c.maxTileCacheSize,this._maxTileCacheZoomLevels=c.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},c.canvasContextAttributes),this._trackResize=c.trackResize===!0,this._bearingSnap=c.bearingSnap,this._centerClampedToGround=c.centerClampedToGround,this._refreshExpiredTiles=c.refreshExpiredTiles===!0,this._fadeDuration=c.fadeDuration,this._crossSourceCollisions=c.crossSourceCollisions===!0,this._collectResourceTiming=c.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Po),c.locale),this._clickTolerance=c.clickTolerance,this._overridePixelRatio=c.pixelRatio,this._maxCanvasSize=c.maxCanvasSize,this.transformCameraUpdate=c.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=c.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=vt.addThrottleControl((()=>this.isMoving())),this._requestManager=new Et(c.transformRequest),typeof c.container=="string"){if(this._container=document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(c.maxBounds&&this.setMaxBounds(c.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let T=!1;const A=Xr((k=>{this._trackResize&&!this._removed&&(this.resize(k),this.redraw())}),50);this._resizeObserver=new ResizeObserver((k=>{T?A(k):T=!0})),this._resizeObserver.observe(this._container)}this.handlers=new Yr(this,c),this._hash=c.hash&&new Rc(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,elevation:c.elevation,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,roll:c.roll}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,o.e({},c.fitBoundsOptions,{duration:0}))));const x=typeof c.style=="string"||((r=(e=c.style)===null||e===void 0?void 0:e.projection)===null||r===void 0?void 0:r.type)!=="globe";this.resize(null,x),this._localIdeographFontFamily=c.localIdeographFontFamily,this._validateStyle=c.validateStyle,c.style&&this.setStyle(c.style,{localIdeographFontFamily:c.localIdeographFontFamily}),c.attributionControl&&this.addControl(new qt(typeof c.attributionControl=="boolean"?void 0:c.attributionControl)),c.maplibreLogo&&this.addControl(new ul,c.logoPosition),this.on("style.load",(()=>{if(x||this._resizeTransform(),this.transform.unmodified){const T=o.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(T)}})),this.on("data",(T=>{this._update(T.dataType==="style"),this.fire(new o.l(`${T.dataType}data`,T))})),this.on("dataloading",(T=>{this.fire(new o.l(`${T.dataType}dataloading`,T))})),this.on("dataabort",(T=>{this.fire(new o.l("sourcedataabort",T))}))}_getMapId(){return this._mapId}setGlobalStateProperty(p,e){return this.style.setGlobalStateProperty(p,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(p,e){if(e===void 0&&(e=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new o.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=p.onAdd(this);this._controls.push(p);const c=this._controlPositions[e];return e.indexOf("bottom")!==-1?c.insertBefore(r,c.firstChild):c.appendChild(r),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new o.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(p);return e>-1&&this._controls.splice(e,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}coveringTiles(p){return _i(this.transform,p)}calculateCameraOptionsFromTo(p,e,r,c){return c==null&&this.terrain&&(c=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(p,e,r,c)}resize(p,e=!0){const[r,c]=this._containerDimensions(),f=this._getClampedPixelRatio(r,c);if(this._resizeCanvas(r,c,f),this.painter.resize(r,c,f),this.painter.overLimit()){const x=this.painter.context.gl;this._maxCanvasSize=[x.drawingBufferWidth,x.drawingBufferHeight];const T=this._getClampedPixelRatio(r,c);this._resizeCanvas(r,c,T),this.painter.resize(r,c,T)}this._resizeTransform(e);const m=!this._moving;return m&&(this.stop(),this.fire(new o.l("movestart",p)).fire(new o.l("move",p))),this.fire(new o.l("resize",p)),m&&this.fire(new o.l("moveend",p)),this}_resizeTransform(p=!0){var e;const[r,c]=this._containerDimensions();this.transform.resize(r,c,p),(e=this._requestedCameraState)===null||e===void 0||e.resize(r,c,p)}_getClampedPixelRatio(p,e){const{0:r,1:c}=this._maxCanvasSize,f=this.getPixelRatio(),m=p*f,x=e*f;return Math.min(m>r?r/m:1,x>c?c/x:1)*f}getPixelRatio(){var p;return(p=this._overridePixelRatio)!==null&&p!==void 0?p:devicePixelRatio}setPixelRatio(p){this._overridePixelRatio=p,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(p){return this.transform.setMaxBounds(di.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.setMinZoom(p),this._update(),this.getZoom()<p&&this.setZoom(p),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.setMaxZoom(p),this._update(),this.getZoom()>p&&this.setZoom(p),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.setMinPitch(p),this._update(),this.getPitch()<p&&this.setPitch(p),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(p>=this.transform.minPitch)return this.transform.setMaxPitch(p),this._update(),this.getPitch()>p&&this.setPitch(p),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.setRenderWorldCopies(p),this._update()}project(p){return this.transform.locationToScreenPoint(o.S.convert(p),this.style&&this.terrain)}unproject(p){return this.transform.screenPointToLocation(o.P.convert(p),this.terrain)}isMoving(){var p;return this._moving||((p=this.handlers)===null||p===void 0?void 0:p.isMoving())}isZooming(){var p;return this._zooming||((p=this.handlers)===null||p===void 0?void 0:p.isZooming())}isRotating(){var p;return this._rotating||((p=this.handlers)===null||p===void 0?void 0:p.isRotating())}_createDelegatedListener(p,e,r){if(p==="mouseenter"||p==="mouseover"){let c=!1;return{layers:e,listener:r,delegates:{mousemove:m=>{const x=e.filter((A=>this.getLayer(A))),T=x.length!==0?this.queryRenderedFeatures(m.point,{layers:x}):[];T.length?c||(c=!0,r.call(this,new Wn(p,this,m.originalEvent,{features:T}))):c=!1},mouseout:()=>{c=!1}}}}if(p==="mouseleave"||p==="mouseout"){let c=!1;return{layers:e,listener:r,delegates:{mousemove:x=>{const T=e.filter((A=>this.getLayer(A)));(T.length!==0?this.queryRenderedFeatures(x.point,{layers:T}):[]).length?c=!0:c&&(c=!1,r.call(this,new Wn(p,this,x.originalEvent)))},mouseout:x=>{c&&(c=!1,r.call(this,new Wn(p,this,x.originalEvent)))}}}}{const c=f=>{const m=e.filter((T=>this.getLayer(T))),x=m.length!==0?this.queryRenderedFeatures(f.point,{layers:m}):[];x.length&&(f.features=x,r.call(this,f),delete f.features)};return{layers:e,listener:r,delegates:{[p]:c}}}}_saveDelegatedListener(p,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(e)}_removeDelegatedListener(p,e,r){if(!this._delegatedListeners||!this._delegatedListeners[p])return;const c=this._delegatedListeners[p];for(let f=0;f<c.length;f++){const m=c[f];if(m.listener===r&&m.layers.length===e.length&&m.layers.every((x=>e.includes(x)))){for(const x in m.delegates)this.off(x,m.delegates[x]);return void c.splice(f,1)}}}on(p,e,r){if(r===void 0)return super.on(p,e);const c=typeof e=="string"?[e]:e,f=this._createDelegatedListener(p,c,r);this._saveDelegatedListener(p,f);for(const m in f.delegates)this.on(m,f.delegates[m]);return{unsubscribe:()=>{this._removeDelegatedListener(p,c,r)}}}once(p,e,r){if(r===void 0)return super.once(p,e);const c=typeof e=="string"?[e]:e,f=this._createDelegatedListener(p,c,r);for(const m in f.delegates){const x=f.delegates[m];f.delegates[m]=(...T)=>{this._removeDelegatedListener(p,c,r),x(...T)}}this._saveDelegatedListener(p,f);for(const m in f.delegates)this.once(m,f.delegates[m]);return this}off(p,e,r){return r===void 0?super.off(p,e):(this._removeDelegatedListener(p,typeof e=="string"?[e]:e,r),this)}queryRenderedFeatures(p,e){if(!this.style)return[];let r;const c=p instanceof o.P||Array.isArray(p),f=c?p:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(c?{}:p)||{},f instanceof o.P||typeof f[0]=="number")r=[o.P.convert(f)];else{const m=o.P.convert(f[0]),x=o.P.convert(f[1]);r=[m,new o.P(x.x,m.y),x,new o.P(m.x,x.y),m]}return this.style.queryRenderedFeatures(r,e,this.transform)}querySourceFeatures(p,e){return this.style.querySourceFeatures(p,e)}setStyle(p,e){return(e=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&p?(this._diffStyle(p,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(p,e))}setTransformRequest(p){return this._requestManager.setTransformRequest(p),this}_getUIString(p){const e=this._locale[p];if(e==null)throw new Error(`Missing UI string '${p}'`);return e}_updateStyle(p,e){var r,c;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(p,e)));const f=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!p)),p?(this.style=new ch(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p,e,f):this.style.loadJSON(p,e,f),this):((c=(r=this.style)===null||r===void 0?void 0:r.projection)===null||c===void 0||c.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ch(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,e){if(typeof p=="string"){const r=this._requestManager.transformRequest(p,"Style");o.j(r,new AbortController).then((c=>{this._updateDiff(c.data,e)})).catch((c=>{c&&this.fire(new o.k(c))}))}else typeof p=="object"&&this._updateDiff(p,e)}_updateDiff(p,e){try{this.style.setState(p,e)&&this._update(!0)}catch(r){o.w(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(p,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(p,e){return this._lazyInitEmptyStyle(),this.style.addSource(p,e),this._update(!0)}isSourceLoaded(p){const e=this.style&&this.style.sourceCaches[p];if(e!==void 0)return e.loaded();this.fire(new o.k(new Error(`There is no source with ID '${p}'`)))}setTerrain(p){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),p){const e=this.style.sourceCaches[p.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${p.source}`);this.terrain===null&&e.reload();for(const r in this.style._layers){const c=this.style._layers[r];c.type==="hillshade"&&c.source===p.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),c.type==="color-relief"&&c.source===p.source&&o.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new fr(this.painter,e,p),this.painter.renderToTexture=new Md(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=r=>{var c;r.dataType==="style"?this.terrain.sourceCache.freeRtt():r.dataType==="source"&&r.tile&&(r.sourceId!==p.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((c=r.source)===null||c===void 0?void 0:c.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(r.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new o.l("terrain",{terrain:p})),this}getTerrain(){var p,e;return(e=(p=this.terrain)===null||p===void 0?void 0:p.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const p=this.style&&this.style.sourceCaches;for(const e in p){const r=p[e]._tiles;for(const c in r){const f=r[c];if(f.state!=="loaded"&&f.state!=="errored")return!1}}return!0}removeSource(p){return this.style.removeSource(p),this._update(!0)}getSource(p){return this.style.getSource(p)}setSourceTileLodParams(p,e,r){if(r){const c=this.getSource(r);if(!c)throw new Error(`There is no source with ID "${r}", cannot set LOD parameters`);c.calculateTileZoom=zt(Math.max(1,p),Math.max(1,e))}else for(const c in this.style.sourceCaches)this.style.sourceCaches[c].getSource().calculateTileZoom=zt(Math.max(1,p),Math.max(1,e));return this._update(!0),this}refreshTiles(p,e){const r=this.style.sourceCaches[p];if(!r)throw new Error(`There is no source cache with ID "${p}", cannot refresh tile`);e===void 0?r.reload(!0):r.refreshTiles(e.map((c=>new o.a4(c.z,c.x,c.y))))}addImage(p,e,r={}){const{pixelRatio:c=1,sdf:f=!1,stretchX:m,stretchY:x,content:T,textFitWidth:A,textFitHeight:k}=r;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||o.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:L,height:F,data:N}=e,q=e;return this.style.addImage(p,{data:new o.R({width:L,height:F},new Uint8Array(N)),pixelRatio:c,stretchX:m,stretchY:x,content:T,textFitWidth:A,textFitHeight:k,sdf:f,version:0,userImage:q}),q.onAdd&&q.onAdd(this,p),this}}{const{width:L,height:F,data:N}=W.getImageData(e);this.style.addImage(p,{data:new o.R({width:L,height:F},N),pixelRatio:c,stretchX:m,stretchY:x,content:T,textFitWidth:A,textFitHeight:k,sdf:f,version:0})}}updateImage(p,e){const r=this.style.getImage(p);if(!r)return this.fire(new o.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const c=e instanceof HTMLImageElement||o.b(e)?W.getImageData(e):e,{width:f,height:m,data:x}=c;if(f===void 0||m===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(f!==r.data.width||m!==r.data.height)return this.fire(new o.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const T=!(e instanceof HTMLImageElement||o.b(e));return r.data.replace(x,T),this.style.updateImage(p,r),this}getImage(p){return this.style.getImage(p)}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new o.k(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p){return vt.getImage(this._requestManager.transformRequest(p,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(p,e){return this._lazyInitEmptyStyle(),this.style.addLayer(p,e),this._update(!0)}moveLayer(p,e){return this.style.moveLayer(p,e),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(p,e,r){return this.style.setLayerZoomRange(p,e,r),this._update(!0)}setFilter(p,e,r={}){return this.style.setFilter(p,e,r),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,e,r,c={}){return this.style.setPaintProperty(p,e,r,c),this._update(!0)}getPaintProperty(p,e){return this.style.getPaintProperty(p,e)}setLayoutProperty(p,e,r,c={}){return this.style.setLayoutProperty(p,e,r,c),this._update(!0)}getLayoutProperty(p,e){return this.style.getLayoutProperty(p,e)}setGlyphs(p,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(p,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(p,e,r={}){return this._lazyInitEmptyStyle(),this.style.addSprite(p,e,r,(c=>{c||this._update(!0)})),this}removeSprite(p){return this._lazyInitEmptyStyle(),this.style.removeSprite(p),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(p,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(p,e,(r=>{r||this._update(!0)})),this}setLight(p,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(p,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(p,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(p,e){return this.style.setFeatureState(p,e),this._update()}removeFeatureState(p,e){return this.style.removeFeatureState(p,e),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let p=0,e=0;return this._container&&(p=this._container.clientWidth||400,e=this._container.clientHeight||300),[p,e]}_setupContainer(){const p=this._container;p.classList.add("maplibregl-map");const e=this._canvasContainer=ee.create("div","maplibregl-canvas-container",p);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=ee.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const r=this._containerDimensions(),c=this._getClampedPixelRatio(r[0],r[1]);this._resizeCanvas(r[0],r[1],c);const f=this._controlContainer=ee.create("div","maplibregl-control-container",p),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((x=>{m[x]=ee.create("div",`maplibregl-ctrl-${x} `,f)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,e,r){this._canvas.width=Math.floor(r*p),this._canvas.height=Math.floor(r*e),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const p=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",(c=>{e={requestedAttributes:p},c&&(e.statusMessage=c.statusMessage,e.type=c.type)}),{once:!0});let r=null;if(r=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,p):this._canvas.getContext("webgl2",p)||this._canvas.getContext("webgl",p),!r){const c="Failed to initialize WebGL";throw e?(e.message=c,new Error(JSON.stringify(e))):new Error(c)}this.painter=new Vs(r,this.transform),we.testSupport(r)}migrateProjection(p,e){super.migrateProjection(p,e),this.painter.transform=p,this.fire(new o.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_render(p){var e,r,c,f,m;const x=this._idleTriggered?this._fadeDuration:0,T=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._removed)return;let A=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const F=this.transform.zoom,N=W.now();this.style.zoomHistory.update(F,N);const q=new o.F(F,{now:N,fadeDuration:x,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),X=q.crossFadingFactor();X===1&&X===this._crossFadingFactor||(A=!0,this._crossFadingFactor=X),this.style.update(q)}const k=((r=this.style.projection)===null||r===void 0?void 0:r.transitionState)>0!==T;(c=this.style.projection)===null||c===void 0||c.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((f=this.style.projection)===null||f===void 0?void 0:f.transitionState,(m=this.style.projection)===null||m===void 0?void 0:m.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||k)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,x,this._crossSourceCollisions,k),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,showPadding:this.showPadding}),this.fire(new o.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.cw.mark(o.cx.load),this.fire(new o.l("load"))),this.style&&(this.style.hasTransitions()||A)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const L=this._sourcesDirty||this._styleDirty||this._placementDirty;return L||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.l("idle")),!this._loaded||this._fullyLoaded||L||(this._fullyLoaded=!0,o.cw.mark(o.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var p;this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),vt.removeThrottleControl(this._imageQueueHandle),(p=this._resizeObserver)===null||p===void 0||p.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),ee.remove(this._canvasContainer),ee.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),o.cw.clearMetrics(),this._removed=!0,this.fire(new o.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,W.frame(this._frameRequest,(p=>{o.cw.frame(p),this._frameRequest=null;try{this._render(p)}catch(e){if(!o.cy(e)&&!(function(r){return r.message===Pc})(e))throw e}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get version(){return pr}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(p){return this._lazyInitEmptyStyle(),this.style.setProjection(p),this._update(!0)}},E.MapMouseEvent=Wn,E.MapTouchEvent=oa,E.MapWheelEvent=Lc,E.Marker=ws,E.NavigationControl=class{constructor(p){this._updateZoomButtons=()=>{const e=this._map.getZoom(),r=e===this._map.getMaxZoom(),c=e===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,r)=>{const c=this._map._getUIString(`NavigationControl.${r}`);e.title=c,e.setAttribute("aria-label",c)},this.options=o.e({},ca,p),this._container=ee.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),ee.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),ee.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})),this._compassIcon=ee.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Qi(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){ee.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(p,e){const r=ee.create("button",p,this._container);return r.type="button",r.addEventListener("click",e),r}},E.Popup=class extends o.E{constructor(p){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&ee.remove(this._content),this._container&&(ee.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new o.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=ee.create("div","maplibregl-popup",this._map.getContainer()),this._tip=ee.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const x of this.options.className.split(" "))this._container.classList.add(x);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Fi(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const r=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let c=this.options.anchor;const f=qc(this.options.offset);if(!c){const x=this._container.offsetWidth,T=this._container.offsetHeight;let A;A=r.y+f.bottom.y<T?["top"]:r.y>this._map.transform.height-T?["bottom"]:[],r.x<x/2?A.push("left"):r.x>this._map.transform.width-x/2&&A.push("right"),c=A.length===0?"bottom":A.join("-")}let m=r.add(f[c]);this.options.subpixelPositioning||(m=m.round()),ee.setTransform(this._container,`${va[c]} translate(${m.x}px,${m.y}px)`),hl(this._container,c,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(Uc),p)}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(p){return this._lngLat=o.S.convert(p),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const e=document.createDocumentFragment(),r=document.createElement("body");let c;for(r.innerHTML=p;c=r.firstChild,c;)e.appendChild(c);return this.setDOMContent(e)}getMaxWidth(){var p;return(p=this._container)===null||p===void 0?void 0:p.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ee.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(p){return this._container&&this._container.classList.add(p),this}removeClassName(p){return this._container&&this._container.classList.remove(p),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){if(this._container)return this._container.classList.toggle(p)}setSubpixelPositioning(p){this.options.subpixelPositioning=p}_createCloseButton(){this.options.closeButton&&(this._closeButton=ee.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(Vc);p&&p.focus()}},E.RasterDEMTileSource=wa,E.RasterTileSource=Jt,E.ScaleControl=class{constructor(p){this._onMove=()=>{zu(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,zu(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},zo),p)}getDefaultPosition(){return"bottom-left"}onAdd(p){return this._map=p,this._container=ee.create("div","maplibregl-ctrl maplibregl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){ee.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},E.ScrollZoomHandler=zh,E.Style=ch,E.TerrainControl=class{constructor(p){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=p}onAdd(p){return this._map=p,this._container=ee.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=ee.create("button","maplibregl-ctrl-terrain",this._container),ee.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){ee.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},E.TwoFingersTouchPitchHandler=ql,E.TwoFingersTouchRotateHandler=Bc,E.TwoFingersTouchZoomHandler=xs,E.TwoFingersTouchZoomRotateHandler=Ao,E.VectorTileSource=fi,E.VideoSource=ia,E.addSourceType=(p,e)=>o._(void 0,void 0,void 0,(function*(){if(An(p))throw new Error(`A source type called "${p}" already exists.`);((r,c)=>{Ja[r]=c})(p,e)})),E.clearPrewarmedResources=function(){const p=We;p&&(p.isPreloaded()&&p.numActive()===1?(p.release(Kt),We=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},E.createTileMesh=gc,E.getMaxParallelImageRequests=function(){return o.a.MAX_PARALLEL_IMAGE_REQUESTS},E.getRTLTextPluginStatus=function(){return Sa().getRTLTextPluginStatus()},E.getVersion=function(){return Iu},E.getWorkerCount=function(){return pe.workerCount},E.getWorkerUrl=function(){return o.a.WORKER_URL},E.importScriptInWorkers=function(p){return ai().broadcast("IS",p)},E.prewarm=function(){Lt().acquire(Kt)},E.setMaxParallelImageRequests=function(p){o.a.MAX_PARALLEL_IMAGE_REQUESTS=p},E.setRTLTextPlugin=function(p,e){return Sa().setRTLTextPlugin(p,e)},E.setWorkerCount=function(p){pe.workerCount=p},E.setWorkerUrl=function(p){o.a.WORKER_URL=p}}));var D=w;return D}))})(Bm)),Bm.exports}var uv=cv();const qg=F_(uv),hv={"nueima-solar-fields":{id:"nueima-solar-fields",name:"Nu'eima Solar Fields",pointGeoJson:"/data/geojson/Nueima Solar Fields.geojson",tableCsv:null},nueima:{id:"nueima",name:"Nu'eima",pointGeoJson:"/data/geojson/Nueima.geojson",tableCsv:null},naama:{id:"naama",name:"Na'ama",pointGeoJson:"data/geojson/Naama.geojson",tableCsv:null},"naama-solar-fields":{id:"naama-solar-fields",name:"Na'ama Solar Fields",pointGeoJson:"/data/geojson/Naama Solar Fields.geojson",tableCsv:null},"shdemot-mehola-solar":{id:"shdemot-mehola-solar",name:"Shdemot Mehola Solar Field",pointGeoJson:"/data/geojson/Shdemot Mehola Solar.geojson",tableCsv:null},"shdemot-mehola":{id:"shdemot-mehola",name:"Shdemot Mehola",pointGeoJson:"/data/geojson/Shdemot Mehola.geojson",tableCsv:null},rotem:{id:"rotem",name:"Rotem",pointGeoJson:"/data/geojson/Rotem.geojson",tableCsv:null},farsia:{id:"farsia",name:"Al-Farsia",pointGeoJson:"/data/geojson/A-Farsia.geojson",tableCsv:null},"noam-s-office":{id:"noam-s-office",name:"Noam's Office",pointGeoJson:"/data/geojson/Noam's Office.geojson",tableCsv:null},"jericho-governate":{id:"jericho-governate",name:"Jericho Governate",pointGeoJson:"/data/geojson/Jericho-Governate.geojson",tableCsv:null}};function dv(u){u("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),u("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),u("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs");for(var y=1;y<=60;++y)u("EPSG:"+(32600+y),"+proj=utm +zone="+y+" +datum=WGS84 +units=m"),u("EPSG:"+(32700+y),"+proj=utm +zone="+y+" +south +datum=WGS84 +units=m");u.WGS84=u["EPSG:4326"],u["EPSG:3785"]=u["EPSG:3857"],u.GOOGLE=u["EPSG:3857"],u["EPSG:900913"]=u["EPSG:3857"],u["EPSG:102113"]=u["EPSG:3857"]}var od=1,ld=2,df=3,fv=4,Pg=5,__=6378137,pv=6356752314e-3,y_=.0066943799901413165,Tp=484813681109536e-20,_t=Math.PI/2,mv=.16666666666666666,gv=.04722222222222222,_v=.022156084656084655,It=1e-10,Sr=.017453292519943295,cc=57.29577951308232,ga=Math.PI/4,Ip=Math.PI*2,Cn=3.14159265359,As={};As.greenwich=0;As.lisbon=-9.131906111111;As.paris=2.337229166667;As.bogota=-74.080916666667;As.madrid=-3.687938888889;As.rome=12.452333333333;As.bern=7.439583333333;As.jakarta=106.807719444444;As.ferro=-17.666666666667;As.brussels=4.367975;As.stockholm=18.058277777778;As.athens=23.7163375;As.oslo=10.722916666667;const yv={mm:{to_meter:.001},cm:{to_meter:.01},ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937},fath:{to_meter:1.8288},kmi:{to_meter:1852},"us-ch":{to_meter:20.1168402336805},"us-mi":{to_meter:1609.34721869444},km:{to_meter:1e3},"ind-ft":{to_meter:.30479841},"ind-yd":{to_meter:.91439523},mi:{to_meter:1609.344},yd:{to_meter:.9144},ch:{to_meter:20.1168},link:{to_meter:.201168},dm:{to_meter:.1},in:{to_meter:.0254},"ind-ch":{to_meter:20.11669506},"us-in":{to_meter:.025400050800101},"us-yd":{to_meter:.914401828803658}};var v_=/[\s_\-\/\(\)]/g;function eh(u,y){if(u[y])return u[y];for(var w=Object.keys(u),C=y.toLowerCase().replace(v_,""),P=-1,D,E;++P<w.length;)if(D=w[P],E=D.toLowerCase().replace(v_,""),E===C)return u[D]}function zg(u){var y={},w=u.split("+").map(function(o){return o.trim()}).filter(function(o){return o}).reduce(function(o,B){var j=B.split("=");return j.push(!0),o[j[0].toLowerCase()]=j[1],o},{}),C,P,D,E={proj:"projName",datum:"datumCode",rf:function(o){y.rf=parseFloat(o)},lat_0:function(o){y.lat0=o*Sr},lat_1:function(o){y.lat1=o*Sr},lat_2:function(o){y.lat2=o*Sr},lat_ts:function(o){y.lat_ts=o*Sr},lon_0:function(o){y.long0=o*Sr},lon_1:function(o){y.long1=o*Sr},lon_2:function(o){y.long2=o*Sr},alpha:function(o){y.alpha=parseFloat(o)*Sr},gamma:function(o){y.rectified_grid_angle=parseFloat(o)*Sr},lonc:function(o){y.longc=o*Sr},x_0:function(o){y.x0=parseFloat(o)},y_0:function(o){y.y0=parseFloat(o)},k_0:function(o){y.k0=parseFloat(o)},k:function(o){y.k0=parseFloat(o)},a:function(o){y.a=parseFloat(o)},b:function(o){y.b=parseFloat(o)},r:function(o){y.a=y.b=parseFloat(o)},r_a:function(){y.R_A=!0},zone:function(o){y.zone=parseInt(o,10)},south:function(){y.utmSouth=!0},towgs84:function(o){y.datum_params=o.split(",").map(function(B){return parseFloat(B)})},to_meter:function(o){y.to_meter=parseFloat(o)},units:function(o){y.units=o;var B=eh(yv,o);B&&(y.to_meter=B.to_meter)},from_greenwich:function(o){y.from_greenwich=o*Sr},pm:function(o){var B=eh(As,o);y.from_greenwich=(B||parseFloat(o))*Sr},nadgrids:function(o){o==="@null"?y.datumCode="none":y.nadgrids=o},axis:function(o){var B="ewnsud";o.length===3&&B.indexOf(o.substr(0,1))!==-1&&B.indexOf(o.substr(1,1))!==-1&&B.indexOf(o.substr(2,1))!==-1&&(y.axis=o)},approx:function(){y.approx=!0}};for(C in w)P=w[C],C in E?(D=E[C],typeof D=="function"?D(P):y[D]=P):y[C]=P;return typeof y.datumCode=="string"&&y.datumCode!=="WGS84"&&(y.datumCode=y.datumCode.toLowerCase()),y}class ny{static getId(y){const w=y.find(C=>Array.isArray(C)&&C[0]==="ID");return w&&w.length>=3?{authority:w[1],code:parseInt(w[2],10)}:null}static convertUnit(y,w="unit"){if(!y||y.length<3)return{type:w,name:"unknown",conversion_factor:null};const C=y[1],P=parseFloat(y[2])||null,D=y.find(o=>Array.isArray(o)&&o[0]==="ID"),E=D?{authority:D[1],code:parseInt(D[2],10)}:null;return{type:w,name:C,conversion_factor:P,id:E}}static convertAxis(y){const w=y[1]||"Unknown";let C;const P=w.match(/^\((.)\)$/);if(P){const j=P[1].toUpperCase();if(j==="E")C="east";else if(j==="N")C="north";else if(j==="U")C="up";else throw new Error(`Unknown axis abbreviation: ${j}`)}else C=y[2]?y[2].toLowerCase():"unknown";const D=y.find(j=>Array.isArray(j)&&j[0]==="ORDER"),E=D?parseInt(D[1],10):null,o=y.find(j=>Array.isArray(j)&&(j[0]==="LENGTHUNIT"||j[0]==="ANGLEUNIT"||j[0]==="SCALEUNIT")),B=this.convertUnit(o);return{name:w,direction:C,unit:B,order:E}}static extractAxes(y){return y.filter(w=>Array.isArray(w)&&w[0]==="AXIS").map(w=>this.convertAxis(w)).sort((w,C)=>(w.order||0)-(C.order||0))}static convert(y,w={}){switch(y[0]){case"PROJCRS":w.type="ProjectedCRS",w.name=y[1],w.base_crs=y.find(W=>Array.isArray(W)&&W[0]==="BASEGEOGCRS")?this.convert(y.find(W=>Array.isArray(W)&&W[0]==="BASEGEOGCRS")):null,w.conversion=y.find(W=>Array.isArray(W)&&W[0]==="CONVERSION")?this.convert(y.find(W=>Array.isArray(W)&&W[0]==="CONVERSION")):null;const C=y.find(W=>Array.isArray(W)&&W[0]==="CS");C&&(w.coordinate_system={type:C[1],axis:this.extractAxes(y)});const P=y.find(W=>Array.isArray(W)&&W[0]==="LENGTHUNIT");if(P){const W=this.convertUnit(P);w.coordinate_system.unit=W}w.id=this.getId(y);break;case"BASEGEOGCRS":case"GEOGCRS":w.type="GeographicCRS",w.name=y[1];const D=y.find(W=>Array.isArray(W)&&(W[0]==="DATUM"||W[0]==="ENSEMBLE"));if(D){const W=this.convert(D);D[0]==="ENSEMBLE"?w.datum_ensemble=W:w.datum=W;const ee=y.find(we=>Array.isArray(we)&&we[0]==="PRIMEM");ee&&ee[1]!=="Greenwich"&&(W.prime_meridian={name:ee[1],longitude:parseFloat(ee[2])})}w.coordinate_system={type:"ellipsoidal",axis:this.extractAxes(y)},w.id=this.getId(y);break;case"DATUM":w.type="GeodeticReferenceFrame",w.name=y[1],w.ellipsoid=y.find(W=>Array.isArray(W)&&W[0]==="ELLIPSOID")?this.convert(y.find(W=>Array.isArray(W)&&W[0]==="ELLIPSOID")):null;break;case"ENSEMBLE":w.type="DatumEnsemble",w.name=y[1],w.members=y.filter(W=>Array.isArray(W)&&W[0]==="MEMBER").map(W=>({type:"DatumEnsembleMember",name:W[1],id:this.getId(W)}));const E=y.find(W=>Array.isArray(W)&&W[0]==="ENSEMBLEACCURACY");E&&(w.accuracy=parseFloat(E[1]));const o=y.find(W=>Array.isArray(W)&&W[0]==="ELLIPSOID");o&&(w.ellipsoid=this.convert(o)),w.id=this.getId(y);break;case"ELLIPSOID":w.type="Ellipsoid",w.name=y[1],w.semi_major_axis=parseFloat(y[2]),w.inverse_flattening=parseFloat(y[3]),y.find(W=>Array.isArray(W)&&W[0]==="LENGTHUNIT")&&this.convert(y.find(W=>Array.isArray(W)&&W[0]==="LENGTHUNIT"),w);break;case"CONVERSION":w.type="Conversion",w.name=y[1],w.method=y.find(W=>Array.isArray(W)&&W[0]==="METHOD")?this.convert(y.find(W=>Array.isArray(W)&&W[0]==="METHOD")):null,w.parameters=y.filter(W=>Array.isArray(W)&&W[0]==="PARAMETER").map(W=>this.convert(W));break;case"METHOD":w.type="Method",w.name=y[1],w.id=this.getId(y);break;case"PARAMETER":w.type="Parameter",w.name=y[1],w.value=parseFloat(y[2]),w.unit=this.convertUnit(y.find(W=>Array.isArray(W)&&(W[0]==="LENGTHUNIT"||W[0]==="ANGLEUNIT"||W[0]==="SCALEUNIT"))),w.id=this.getId(y);break;case"BOUNDCRS":w.type="BoundCRS";const B=y.find(W=>Array.isArray(W)&&W[0]==="SOURCECRS");if(B){const W=B.find(ee=>Array.isArray(ee));w.source_crs=W?this.convert(W):null}const j=y.find(W=>Array.isArray(W)&&W[0]==="TARGETCRS");if(j){const W=j.find(ee=>Array.isArray(ee));w.target_crs=W?this.convert(W):null}const J=y.find(W=>Array.isArray(W)&&W[0]==="ABRIDGEDTRANSFORMATION");J?w.transformation=this.convert(J):w.transformation=null;break;case"ABRIDGEDTRANSFORMATION":if(w.type="Transformation",w.name=y[1],w.method=y.find(W=>Array.isArray(W)&&W[0]==="METHOD")?this.convert(y.find(W=>Array.isArray(W)&&W[0]==="METHOD")):null,w.parameters=y.filter(W=>Array.isArray(W)&&(W[0]==="PARAMETER"||W[0]==="PARAMETERFILE")).map(W=>{if(W[0]==="PARAMETER")return this.convert(W);if(W[0]==="PARAMETERFILE")return{name:W[1],value:W[2],id:{authority:"EPSG",code:8656}}}),w.parameters.length===7){const W=w.parameters[6];W.name==="Scale difference"&&(W.value=Math.round((W.value-1)*1e12)/1e6)}w.id=this.getId(y);break;case"AXIS":w.coordinate_system||(w.coordinate_system={type:"unspecified",axis:[]}),w.coordinate_system.axis.push(this.convertAxis(y));break;case"LENGTHUNIT":const K=this.convertUnit(y,"LinearUnit");w.coordinate_system&&w.coordinate_system.axis&&w.coordinate_system.axis.forEach(W=>{W.unit||(W.unit=K)}),K.conversion_factor&&K.conversion_factor!==1&&w.semi_major_axis&&(w.semi_major_axis={value:w.semi_major_axis,unit:K});break;default:w.keyword=y[0];break}return w}}class vv extends ny{static convert(y,w={}){return super.convert(y,w),w.coordinate_system&&w.coordinate_system.subtype==="Cartesian"&&delete w.coordinate_system,w.usage&&delete w.usage,w}}class xv extends ny{static convert(y,w={}){super.convert(y,w);const C=y.find(D=>Array.isArray(D)&&D[0]==="CS");C&&(w.coordinate_system={subtype:C[1],axis:this.extractAxes(y)});const P=y.find(D=>Array.isArray(D)&&D[0]==="USAGE");if(P){const D=P.find(B=>Array.isArray(B)&&B[0]==="SCOPE"),E=P.find(B=>Array.isArray(B)&&B[0]==="AREA"),o=P.find(B=>Array.isArray(B)&&B[0]==="BBOX");w.usage={},D&&(w.usage.scope=D[1]),E&&(w.usage.area=E[1]),o&&(w.usage.bbox=o.slice(1))}return w}}function bv(u){return u.find(y=>Array.isArray(y)&&y[0]==="USAGE")?"2019":(u.find(y=>Array.isArray(y)&&y[0]==="CS")||u[0]==="BOUNDCRS"||u[0]==="PROJCRS"||u[0]==="GEOGCRS","2015")}function wv(u){return(bv(u)==="2019"?xv:vv).convert(u)}function Sv(u){const y=u.toUpperCase();return y.includes("PROJCRS")||y.includes("GEOGCRS")||y.includes("BOUNDCRS")||y.includes("VERTCRS")||y.includes("LENGTHUNIT")||y.includes("ANGLEUNIT")||y.includes("SCALEUNIT")?"WKT2":(y.includes("PROJCS")||y.includes("GEOGCS")||y.includes("LOCAL_CS")||y.includes("VERT_CS")||y.includes("UNIT"),"WKT1")}var Rp=1,ry=2,sy=3,qm=4,oy=5,Zg=-1,Mv=/\s/,Tv=/[A-Za-z]/,Ev=/[A-Za-z84_]/,Km=/[,\]]/,ly=/[\d\.E\-\+]/;function uu(u){if(typeof u!="string")throw new Error("not a string");this.text=u.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=Rp}uu.prototype.readCharicter=function(){var u=this.text[this.place++];if(this.state!==qm)for(;Mv.test(u);){if(this.place>=this.text.length)return;u=this.text[this.place++]}switch(this.state){case Rp:return this.neutral(u);case ry:return this.keyword(u);case qm:return this.quoted(u);case oy:return this.afterquote(u);case sy:return this.number(u);case Zg:return}};uu.prototype.afterquote=function(u){if(u==='"'){this.word+='"',this.state=qm;return}if(Km.test(u)){this.word=this.word.trim(),this.afterItem(u);return}throw new Error(`havn't handled "`+u+'" in afterquote yet, index '+this.place)};uu.prototype.afterItem=function(u){if(u===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=Rp;return}if(u==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=Rp,this.currentObject=this.stack.pop(),this.currentObject||(this.state=Zg);return}};uu.prototype.number=function(u){if(ly.test(u)){this.word+=u;return}if(Km.test(u)){this.word=parseFloat(this.word),this.afterItem(u);return}throw new Error(`havn't handled "`+u+'" in number yet, index '+this.place)};uu.prototype.quoted=function(u){if(u==='"'){this.state=oy;return}this.word+=u};uu.prototype.keyword=function(u){if(Ev.test(u)){this.word+=u;return}if(u==="["){var y=[];y.push(this.word),this.level++,this.root===null?this.root=y:this.currentObject.push(y),this.stack.push(this.currentObject),this.currentObject=y,this.state=Rp;return}if(Km.test(u)){this.afterItem(u);return}throw new Error(`havn't handled "`+u+'" in keyword yet, index '+this.place)};uu.prototype.neutral=function(u){if(Tv.test(u)){this.word=u,this.state=ry;return}if(u==='"'){this.word="",this.state=qm;return}if(ly.test(u)){this.word=u,this.state=sy;return}if(Km.test(u)){this.afterItem(u);return}throw new Error(`havn't handled "`+u+'" in neutral yet, index '+this.place)};uu.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===Zg)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function Cv(u){var y=new uu(u);return y.output()}function Sg(u,y,w){Array.isArray(y)&&(w.unshift(y),y=null);var C=y?{}:u,P=w.reduce(function(D,E){return lf(E,D),D},C);y&&(u[y]=P)}function lf(u,y){if(!Array.isArray(u)){y[u]=!0;return}var w=u.shift();if(w==="PARAMETER"&&(w=u.shift()),u.length===1){if(Array.isArray(u[0])){y[w]={},lf(u[0],y[w]);return}y[w]=u[0];return}if(!u.length){y[w]=!0;return}if(w==="TOWGS84"){y[w]=u;return}if(w==="AXIS"){w in y||(y[w]=[]),y[w].push(u);return}Array.isArray(w)||(y[w]={});var C;switch(w){case"UNIT":case"PRIMEM":case"VERT_DATUM":y[w]={name:u[0].toLowerCase(),convert:u[1]},u.length===3&&lf(u[2],y[w]);return;case"SPHEROID":case"ELLIPSOID":y[w]={name:u[0],a:u[1],rf:u[2]},u.length===4&&lf(u[3],y[w]);return;case"EDATUM":case"ENGINEERINGDATUM":case"LOCAL_DATUM":case"DATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":u[0]=["name",u[0]],Sg(y,w,u);return;case"COMPD_CS":case"COMPOUNDCRS":case"FITTED_CS":case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"ENGCRS":case"ENGINEERINGCRS":u[0]=["name",u[0]],Sg(y,w,u),y[w].type=w;return;default:for(C=-1;++C<u.length;)if(!Array.isArray(u[C]))return lf(u,y[w]);return Sg(y,w,u)}}var Av=.017453292519943295;function Ml(u){return u*Av}function cy(u){const y=(u.projName||"").toLowerCase().replace(/_/g," ");!u.long0&&u.longc&&(y==="albers conic equal area"||y==="lambert azimuthal equal area")&&(u.long0=u.longc),!u.lat_ts&&u.lat1&&(y==="stereographic south pole"||y==="polar stereographic (variant b)")?(u.lat0=Ml(u.lat1>0?90:-90),u.lat_ts=u.lat1,delete u.lat1):!u.lat_ts&&u.lat0&&(y==="polar stereographic"||y==="polar stereographic (variant a)")&&(u.lat_ts=u.lat0,u.lat0=Ml(u.lat0>0?90:-90),delete u.lat1)}function x_(u){let y={units:null,to_meter:void 0};return typeof u=="string"?(y.units=u.toLowerCase(),y.units==="metre"&&(y.units="meter"),y.units==="meter"&&(y.to_meter=1)):u&&u.name&&(y.units=u.name.toLowerCase(),y.units==="metre"&&(y.units="meter"),y.to_meter=u.conversion_factor),y}function b_(u){return typeof u=="object"?u.value*u.unit.conversion_factor:u}function w_(u,y){u.ellipsoid.radius?(y.a=u.ellipsoid.radius,y.rf=0):(y.a=b_(u.ellipsoid.semi_major_axis),u.ellipsoid.inverse_flattening!==void 0?y.rf=u.ellipsoid.inverse_flattening:u.ellipsoid.semi_major_axis!==void 0&&u.ellipsoid.semi_minor_axis!==void 0&&(y.rf=y.a/(y.a-b_(u.ellipsoid.semi_minor_axis))))}function Zm(u,y={}){return!u||typeof u!="object"?u:u.type==="BoundCRS"?(Zm(u.source_crs,y),u.transformation&&(u.transformation.method&&u.transformation.method.name==="NTv2"?y.nadgrids=u.transformation.parameters[0].value:y.datum_params=u.transformation.parameters.map(w=>w.value)),y):(Object.keys(u).forEach(w=>{const C=u[w];if(C!==null)switch(w){case"name":if(y.srsCode)break;y.name=C,y.srsCode=C;break;case"type":C==="GeographicCRS"?y.projName="longlat":C==="ProjectedCRS"&&u.conversion&&u.conversion.method&&(y.projName=u.conversion.method.name);break;case"datum":case"datum_ensemble":C.ellipsoid&&(y.ellps=C.ellipsoid.name,w_(C,y)),C.prime_meridian&&(y.from_greenwich=C.prime_meridian.longitude*Math.PI/180);break;case"ellipsoid":y.ellps=C.name,w_(C,y);break;case"prime_meridian":y.long0=(C.longitude||0)*Math.PI/180;break;case"coordinate_system":if(C.axis){if(y.axis=C.axis.map(P=>{const D=P.direction;if(D==="east")return"e";if(D==="north")return"n";if(D==="west")return"w";if(D==="south")return"s";throw new Error(`Unknown axis direction: ${D}`)}).join("")+"u",C.unit){const{units:P,to_meter:D}=x_(C.unit);y.units=P,y.to_meter=D}else if(C.axis[0]&&C.axis[0].unit){const{units:P,to_meter:D}=x_(C.axis[0].unit);y.units=P,y.to_meter=D}}break;case"id":C.authority&&C.code&&(y.title=C.authority+":"+C.code);break;case"conversion":C.method&&C.method.name&&(y.projName=C.method.name),C.parameters&&C.parameters.forEach(P=>{const D=P.name.toLowerCase().replace(/\s+/g,"_"),E=P.value;P.unit&&P.unit.conversion_factor?y[D]=E*P.unit.conversion_factor:P.unit==="degree"?y[D]=E*Math.PI/180:y[D]=E});break;case"unit":C.name&&(y.units=C.name.toLowerCase(),y.units==="metre"&&(y.units="meter")),C.conversion_factor&&(y.to_meter=C.conversion_factor);break;case"base_crs":Zm(C,y),y.datumCode=C.id?C.id.authority+"_"+C.id.code:C.name;break}}),y.latitude_of_false_origin!==void 0&&(y.lat0=y.latitude_of_false_origin),y.longitude_of_false_origin!==void 0&&(y.long0=y.longitude_of_false_origin),y.latitude_of_standard_parallel!==void 0&&(y.lat0=y.latitude_of_standard_parallel,y.lat1=y.latitude_of_standard_parallel),y.latitude_of_1st_standard_parallel!==void 0&&(y.lat1=y.latitude_of_1st_standard_parallel),y.latitude_of_2nd_standard_parallel!==void 0&&(y.lat2=y.latitude_of_2nd_standard_parallel),y.latitude_of_projection_centre!==void 0&&(y.lat0=y.latitude_of_projection_centre),y.longitude_of_projection_centre!==void 0&&(y.longc=y.longitude_of_projection_centre),y.easting_at_false_origin!==void 0&&(y.x0=y.easting_at_false_origin),y.northing_at_false_origin!==void 0&&(y.y0=y.northing_at_false_origin),y.latitude_of_natural_origin!==void 0&&(y.lat0=y.latitude_of_natural_origin),y.longitude_of_natural_origin!==void 0&&(y.long0=y.longitude_of_natural_origin),y.longitude_of_origin!==void 0&&(y.long0=y.longitude_of_origin),y.false_easting!==void 0&&(y.x0=y.false_easting),y.easting_at_projection_centre&&(y.x0=y.easting_at_projection_centre),y.false_northing!==void 0&&(y.y0=y.false_northing),y.northing_at_projection_centre&&(y.y0=y.northing_at_projection_centre),y.standard_parallel_1!==void 0&&(y.lat1=y.standard_parallel_1),y.standard_parallel_2!==void 0&&(y.lat2=y.standard_parallel_2),y.scale_factor_at_natural_origin!==void 0&&(y.k0=y.scale_factor_at_natural_origin),y.scale_factor_at_projection_centre!==void 0&&(y.k0=y.scale_factor_at_projection_centre),y.scale_factor_on_pseudo_standard_parallel!==void 0&&(y.k0=y.scale_factor_on_pseudo_standard_parallel),y.azimuth!==void 0&&(y.alpha=y.azimuth),y.azimuth_at_projection_centre!==void 0&&(y.alpha=y.azimuth_at_projection_centre),y.angle_from_rectified_to_skew_grid&&(y.rectified_grid_angle=y.angle_from_rectified_to_skew_grid),cy(y),y)}var Pv=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function zv(u,y){var w=y[0],C=y[1];!(w in u)&&C in u&&(u[w]=u[C],y.length===3&&(u[w]=y[2](u[w])))}function uy(u){for(var y=Object.keys(u),w=0,C=y.length;w<C;++w){var P=y[w];Pv.indexOf(P)!==-1&&Iv(u[P]),typeof u[P]=="object"&&uy(u[P])}}function Iv(u){if(u.AUTHORITY){var y=Object.keys(u.AUTHORITY)[0];y&&y in u.AUTHORITY&&(u.title=y+":"+u.AUTHORITY[y])}if(u.type==="GEOGCS"?u.projName="longlat":u.type==="LOCAL_CS"?(u.projName="identity",u.local=!0):typeof u.PROJECTION=="object"?u.projName=Object.keys(u.PROJECTION)[0]:u.projName=u.PROJECTION,u.AXIS){for(var w="",C=0,P=u.AXIS.length;C<P;++C){var D=[u.AXIS[C][0].toLowerCase(),u.AXIS[C][1].toLowerCase()];D[0].indexOf("north")!==-1||(D[0]==="y"||D[0]==="lat")&&D[1]==="north"?w+="n":D[0].indexOf("south")!==-1||(D[0]==="y"||D[0]==="lat")&&D[1]==="south"?w+="s":D[0].indexOf("east")!==-1||(D[0]==="x"||D[0]==="lon")&&D[1]==="east"?w+="e":(D[0].indexOf("west")!==-1||(D[0]==="x"||D[0]==="lon")&&D[1]==="west")&&(w+="w")}w.length===2&&(w+="u"),w.length===3&&(u.axis=w)}u.UNIT&&(u.units=u.UNIT.name.toLowerCase(),u.units==="metre"&&(u.units="meter"),u.UNIT.convert&&(u.type==="GEOGCS"?u.DATUM&&u.DATUM.SPHEROID&&(u.to_meter=u.UNIT.convert*u.DATUM.SPHEROID.a):u.to_meter=u.UNIT.convert));var E=u.GEOGCS;u.type==="GEOGCS"&&(E=u),E&&(E.DATUM?u.datumCode=E.DATUM.name.toLowerCase():u.datumCode=E.name.toLowerCase(),u.datumCode.slice(0,2)==="d_"&&(u.datumCode=u.datumCode.slice(2)),u.datumCode==="new_zealand_1949"&&(u.datumCode="nzgd49"),(u.datumCode==="wgs_1984"||u.datumCode==="world_geodetic_system_1984")&&(u.PROJECTION==="Mercator_Auxiliary_Sphere"&&(u.sphere=!0),u.datumCode="wgs84"),u.datumCode==="belge_1972"&&(u.datumCode="rnb72"),E.DATUM&&E.DATUM.SPHEROID&&(u.ellps=E.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),u.ellps.toLowerCase().slice(0,13)==="international"&&(u.ellps="intl"),u.a=E.DATUM.SPHEROID.a,u.rf=parseFloat(E.DATUM.SPHEROID.rf,10)),E.DATUM&&E.DATUM.TOWGS84&&(u.datum_params=E.DATUM.TOWGS84),~u.datumCode.indexOf("osgb_1936")&&(u.datumCode="osgb36"),~u.datumCode.indexOf("osni_1952")&&(u.datumCode="osni52"),(~u.datumCode.indexOf("tm65")||~u.datumCode.indexOf("geodetic_datum_of_1965"))&&(u.datumCode="ire65"),u.datumCode==="ch1903+"&&(u.datumCode="ch1903"),~u.datumCode.indexOf("israel")&&(u.datumCode="isr93")),u.b&&!isFinite(u.b)&&(u.b=u.a),u.rectified_grid_angle&&(u.rectified_grid_angle=Ml(u.rectified_grid_angle));function o(J){var K=u.to_meter||1;return J*K}var B=function(J){return zv(u,J)},j=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Ml],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Ml],["x0","false_easting",o],["y0","false_northing",o],["long0","central_meridian",Ml],["lat0","latitude_of_origin",Ml],["lat0","standard_parallel_1",Ml],["lat1","standard_parallel_1",Ml],["lat2","standard_parallel_2",Ml],["azimuth","Azimuth"],["alpha","azimuth",Ml],["srsCode","name"]];j.forEach(B),cy(u)}function Ig(u){if(typeof u=="object")return Zm(u);const y=Sv(u);var w=Cv(u);if(y==="WKT2"){const D=wv(w);return Zm(D)}var C=w[0],P={};return lf(w,P),uy(P),P[C]}function rs(u){var y=this;if(arguments.length===2){var w=arguments[1];typeof w=="string"?w.charAt(0)==="+"?rs[u]=zg(arguments[1]):rs[u]=Ig(arguments[1]):rs[u]=w}else if(arguments.length===1){if(Array.isArray(u))return u.map(function(C){return Array.isArray(C)?rs.apply(y,C):rs(C)});if(typeof u=="string"){if(u in rs)return rs[u]}else"EPSG"in u?rs["EPSG:"+u.EPSG]=u:"ESRI"in u?rs["ESRI:"+u.ESRI]=u:"IAU2000"in u?rs["IAU2000:"+u.IAU2000]=u:console.log(u);return}}dv(rs);function Rv(u){return typeof u=="string"}function Dv(u){return u in rs}function kv(u){return u.indexOf("+")!==0&&u.indexOf("[")!==-1||typeof u=="object"&&!("srsCode"in u)}var Lv=["3857","900913","3785","102113"];function Ov(u){var y=eh(u,"authority");if(y){var w=eh(y,"epsg");return w&&Lv.indexOf(w)>-1}}function Bv(u){var y=eh(u,"extension");if(y)return eh(y,"proj4")}function Nv(u){return u[0]==="+"}function jv(u){if(Rv(u)){if(Dv(u))return rs[u];if(kv(u)){var y=Ig(u);if(Ov(y))return rs["EPSG:3857"];var w=Bv(y);return w?zg(w):y}if(Nv(u))return zg(u)}else return"projName"in u?u:Ig(u)}function S_(u,y){u=u||{};var w,C;if(!y)return u;for(C in y)w=y[C],w!==void 0&&(u[C]=w);return u}function hc(u,y,w){var C=u*y;return w/Math.sqrt(1-C*C)}function Np(u){return u<0?-1:1}function Bt(u){return Math.abs(u)<=Cn?u:u-Np(u)*Ip}function Tl(u,y,w){var C=u*w,P=.5*u;return C=Math.pow((1-C)/(1+C),P),Math.tan(.5*(_t-y))/C}function Dp(u,y){for(var w=.5*u,C,P,D=_t-2*Math.atan(y),E=0;E<=15;E++)if(C=u*Math.sin(D),P=_t-2*Math.atan(y*Math.pow((1-C)/(1+C),w))-D,D+=P,Math.abs(P)<=1e-10)return D;return-9999}function Fv(){var u=this.b/this.a;this.es=1-u*u,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=hc(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function Gv(u){var y=u.x,w=u.y;if(w*cc>90&&w*cc<-90&&y*cc>180&&y*cc<-180)return null;var C,P;if(Math.abs(Math.abs(w)-_t)<=It)return null;if(this.sphere)C=this.x0+this.a*this.k0*Bt(y-this.long0),P=this.y0+this.a*this.k0*Math.log(Math.tan(ga+.5*w));else{var D=Math.sin(w),E=Tl(this.e,w,D);C=this.x0+this.a*this.k0*Bt(y-this.long0),P=this.y0-this.a*this.k0*Math.log(E)}return u.x=C,u.y=P,u}function Uv(u){var y=u.x-this.x0,w=u.y-this.y0,C,P;if(this.sphere)P=_t-2*Math.atan(Math.exp(-w/(this.a*this.k0)));else{var D=Math.exp(-w/(this.a*this.k0));if(P=Dp(this.e,D),P===-9999)return null}return C=Bt(this.long0+y/(this.a*this.k0)),u.x=C,u.y=P,u}var Vv=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","Mercator_Variant_A","merc"];const qv={init:Fv,forward:Gv,inverse:Uv,names:Vv};function Zv(){}function M_(u){return u}var $v=["longlat","identity"];const Hv={init:Zv,forward:M_,inverse:M_,names:$v};var Xv=[qv,Hv],sd={},cf=[];function hy(u,y){var w=cf.length;return u.names?(cf[w]=u,u.names.forEach(function(C){sd[C.toLowerCase()]=w}),this):(console.log(y),!0)}function dy(u){return u.replace(/[-\(\)\s]+/g," ").trim().replace(/ /g,"_")}function Yv(u){if(!u)return!1;var y=u.toLowerCase();if(typeof sd[y]<"u"&&cf[sd[y]]||(y=dy(y),y in sd&&cf[sd[y]]))return cf[sd[y]]}function Wv(){Xv.forEach(hy)}const Qv={start:Wv,add:hy,get:Yv};var fy={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"},andrae:{a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"},clrk80:{a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk80ign:{a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"},clrk58:{a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:63558348467e-4,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"},sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}};const Kv=fy.WGS84;function Jv(u,y,w,C){var P=u*u,D=y*y,E=(P-D)/P,o=0;C?(u*=1-E*(mv+E*(gv+E*_v)),P=u*u,E=0):o=Math.sqrt(E);var B=(P-D)/D;return{es:E,e:o,ep2:B}}function e1(u,y,w,C,P){if(!u){var D=eh(fy,C);D||(D=Kv),u=D.a,y=D.b,w=D.rf}return w&&!y&&(y=(1-1/w)*u),(w===0||Math.abs(u-y)<It)&&(P=!0,y=u),{a:u,b:y,rf:w,sphere:P}}var Nm={wgs84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ch1903:{towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ggrs87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nad83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nad27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},mgi:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"},osni52:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rassadiran:{towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},osgb36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Ordnance Survey of Great Britain 1936"},s_jtsk:{towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},beduaram:{towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},gunung_segara:{towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rnb72:{towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"},EPSG_5451:{towgs84:"6.41,-49.05,-11.28,1.5657,0.5242,6.9718,-5.7649"},IGNF_LURESG:{towgs84:"-192.986,13.673,-39.309,-0.4099,-2.9332,2.6881,0.43"},EPSG_4614:{towgs84:"-119.4248,-303.65872,-11.00061,1.164298,0.174458,1.096259,3.657065"},EPSG_4615:{towgs84:"-494.088,-312.129,279.877,-1.423,-1.013,1.59,-0.748"},ESRI_37241:{towgs84:"-76.822,257.457,-12.817,2.136,-0.033,-2.392,-0.031"},ESRI_37249:{towgs84:"-440.296,58.548,296.265,1.128,10.202,4.559,-0.438"},ESRI_37245:{towgs84:"-511.151,-181.269,139.609,1.05,2.703,1.798,3.071"},EPSG_4178:{towgs84:"24.9,-126.4,-93.2,-0.063,-0.247,-0.041,1.01"},EPSG_4622:{towgs84:"-472.29,-5.63,-304.12,0.4362,-0.8374,0.2563,1.8984"},EPSG_4625:{towgs84:"126.93,547.94,130.41,-2.7867,5.1612,-0.8584,13.8227"},EPSG_5252:{towgs84:"0.023,0.036,-0.068,0.00176,0.00912,-0.01136,0.00439"},EPSG_4314:{towgs84:"597.1,71.4,412.1,0.894,0.068,-1.563,7.58"},EPSG_4282:{towgs84:"-178.3,-316.7,-131.5,5.278,6.077,10.979,19.166"},EPSG_4231:{towgs84:"-83.11,-97.38,-117.22,0.0276,-0.2167,0.2147,0.1218"},EPSG_4274:{towgs84:"-230.994,102.591,25.199,0.633,-0.239,0.9,1.95"},EPSG_4134:{towgs84:"-180.624,-225.516,173.919,-0.81,-1.898,8.336,16.71006"},EPSG_4254:{towgs84:"18.38,192.45,96.82,0.056,-0.142,-0.2,-0.0013"},EPSG_4159:{towgs84:"-194.513,-63.978,-25.759,-3.4027,3.756,-3.352,-0.9175"},EPSG_4687:{towgs84:"0.072,-0.507,-0.245,0.0183,-0.0003,0.007,-0.0093"},EPSG_4227:{towgs84:"-83.58,-397.54,458.78,-17.595,-2.847,4.256,3.225"},EPSG_4746:{towgs84:"599.4,72.4,419.2,-0.062,-0.022,-2.723,6.46"},EPSG_4745:{towgs84:"612.4,77,440.2,-0.054,0.057,-2.797,2.55"},EPSG_6311:{towgs84:"8.846,-4.394,-1.122,-0.00237,-0.146528,0.130428,0.783926"},EPSG_4289:{towgs84:"565.7381,50.4018,465.2904,-1.91514,1.60363,-9.09546,4.07244"},EPSG_4230:{towgs84:"-68.863,-134.888,-111.49,-0.53,-0.14,0.57,-3.4"},EPSG_4154:{towgs84:"-123.02,-158.95,-168.47"},EPSG_4156:{towgs84:"570.8,85.7,462.8,4.998,1.587,5.261,3.56"},EPSG_4299:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4179:{towgs84:"33.4,-146.6,-76.3,-0.359,-0.053,0.844,-0.84"},EPSG_4313:{towgs84:"-106.8686,52.2978,-103.7239,0.3366,-0.457,1.8422,-1.2747"},EPSG_4194:{towgs84:"163.511,127.533,-159.789"},EPSG_4195:{towgs84:"105,326,-102.5"},EPSG_4196:{towgs84:"-45,417,-3.5"},EPSG_4611:{towgs84:"-162.619,-276.959,-161.764,0.067753,-2.243649,-1.158827,-1.094246"},EPSG_4633:{towgs84:"137.092,131.66,91.475,-1.9436,-11.5993,-4.3321,-7.4824"},EPSG_4641:{towgs84:"-408.809,366.856,-412.987,1.8842,-0.5308,2.1655,-121.0993"},EPSG_4643:{towgs84:"-480.26,-438.32,-643.429,16.3119,20.1721,-4.0349,-111.7002"},EPSG_4300:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4188:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4660:{towgs84:"982.6087,552.753,-540.873,32.39344,-153.25684,-96.2266,16.805"},EPSG_4662:{towgs84:"97.295,-263.247,310.882,-1.5999,0.8386,3.1409,13.3259"},EPSG_3906:{towgs84:"577.88891,165.22205,391.18289,4.9145,-0.94729,-13.05098,7.78664"},EPSG_4307:{towgs84:"-209.3622,-87.8162,404.6198,0.0046,3.4784,0.5805,-1.4547"},EPSG_6892:{towgs84:"-76.269,-16.683,68.562,-6.275,10.536,-4.286,-13.686"},EPSG_4690:{towgs84:"221.597,152.441,176.523,2.403,1.3893,0.884,11.4648"},EPSG_4691:{towgs84:"218.769,150.75,176.75,3.5231,2.0037,1.288,10.9817"},EPSG_4629:{towgs84:"72.51,345.411,79.241,-1.5862,-0.8826,-0.5495,1.3653"},EPSG_4630:{towgs84:"165.804,216.213,180.26,-0.6251,-0.4515,-0.0721,7.4111"},EPSG_4692:{towgs84:"217.109,86.452,23.711,0.0183,-0.0003,0.007,-0.0093"},EPSG_9333:{towgs84:"0,0,0,-8.393,0.749,-10.276,0"},EPSG_9059:{towgs84:"0,0,0"},EPSG_4312:{towgs84:"601.705,84.263,485.227,4.7354,1.3145,5.393,-2.3887"},EPSG_4123:{towgs84:"-96.062,-82.428,-121.753,4.801,0.345,-1.376,1.496"},EPSG_4309:{towgs84:"-124.45,183.74,44.64,-0.4384,0.5446,-0.9706,-2.1365"},ESRI_104106:{towgs84:"-283.088,-70.693,117.445,-1.157,0.059,-0.652,-4.058"},EPSG_4281:{towgs84:"-219.247,-73.802,269.529"},EPSG_4322:{towgs84:"0,0,4.5"},EPSG_4324:{towgs84:"0,0,1.9"},EPSG_4284:{towgs84:"43.822,-108.842,-119.585,1.455,-0.761,0.737,0.549"},EPSG_4277:{towgs84:"446.448,-125.157,542.06,0.15,0.247,0.842,-20.489"},EPSG_4207:{towgs84:"-282.1,-72.2,120,-1.529,0.145,-0.89,-4.46"},EPSG_4688:{towgs84:"347.175,1077.618,2623.677,33.9058,-70.6776,9.4013,186.0647"},EPSG_4689:{towgs84:"410.793,54.542,80.501,-2.5596,-2.3517,-0.6594,17.3218"},EPSG_4720:{towgs84:"0,0,4.5"},EPSG_4273:{towgs84:"278.3,93,474.5,7.889,0.05,-6.61,6.21"},EPSG_4240:{towgs84:"204.64,834.74,293.8"},EPSG_4817:{towgs84:"278.3,93,474.5,7.889,0.05,-6.61,6.21"},ESRI_104131:{towgs84:"426.62,142.62,460.09,4.98,4.49,-12.42,-17.1"},EPSG_4265:{towgs84:"-104.1,-49.1,-9.9,0.971,-2.917,0.714,-11.68"},EPSG_4263:{towgs84:"-111.92,-87.85,114.5,1.875,0.202,0.219,0.032"},EPSG_4298:{towgs84:"-689.5937,623.84046,-65.93566,-0.02331,1.17094,-0.80054,5.88536"},EPSG_4270:{towgs84:"-253.4392,-148.452,386.5267,0.15605,0.43,-0.1013,-0.0424"},EPSG_4229:{towgs84:"-121.8,98.1,-10.7"},EPSG_4220:{towgs84:"-55.5,-348,-229.2"},EPSG_4214:{towgs84:"12.646,-155.176,-80.863"},EPSG_4232:{towgs84:"-345,3,223"},EPSG_4238:{towgs84:"-1.977,-13.06,-9.993,0.364,0.254,0.689,-1.037"},EPSG_4168:{towgs84:"-170,33,326"},EPSG_4131:{towgs84:"199,931,318.9"},EPSG_4152:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_5228:{towgs84:"572.213,85.334,461.94,4.9732,1.529,5.2484,3.5378"},EPSG_8351:{towgs84:"485.021,169.465,483.839,7.786342,4.397554,4.102655,0"},EPSG_4683:{towgs84:"-127.62,-67.24,-47.04,-3.068,4.903,1.578,-1.06"},EPSG_4133:{towgs84:"0,0,0"},EPSG_7373:{towgs84:"0.819,-0.5762,-1.6446,-0.00378,-0.03317,0.00318,0.0693"},EPSG_9075:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_9072:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_9294:{towgs84:"1.16835,-1.42001,-2.24431,-0.00822,-0.05508,0.01818,0.23388"},EPSG_4212:{towgs84:"-267.434,173.496,181.814,-13.4704,8.7154,7.3926,14.7492"},EPSG_4191:{towgs84:"-44.183,-0.58,-38.489,2.3867,2.7072,-3.5196,-8.2703"},EPSG_4237:{towgs84:"52.684,-71.194,-13.975,-0.312,-0.1063,-0.3729,1.0191"},EPSG_4740:{towgs84:"-1.08,-0.27,-0.9"},EPSG_4124:{towgs84:"419.3836,99.3335,591.3451,0.850389,1.817277,-7.862238,-0.99496"},EPSG_5681:{towgs84:"584.9636,107.7175,413.8067,1.1155,0.2824,-3.1384,7.9922"},EPSG_4141:{towgs84:"23.772,17.49,17.859,-0.3132,-1.85274,1.67299,-5.4262"},EPSG_4204:{towgs84:"-85.645,-273.077,-79.708,2.289,-1.421,2.532,3.194"},EPSG_4319:{towgs84:"226.702,-193.337,-35.371,-2.229,-4.391,9.238,0.9798"},EPSG_4200:{towgs84:"24.82,-131.21,-82.66"},EPSG_4130:{towgs84:"0,0,0"},EPSG_4127:{towgs84:"-82.875,-57.097,-156.768,-2.158,1.524,-0.982,-0.359"},EPSG_4149:{towgs84:"674.374,15.056,405.346"},EPSG_4617:{towgs84:"-0.991,1.9072,0.5129,1.25033e-7,4.6785e-8,5.6529e-8,0"},EPSG_4663:{towgs84:"-210.502,-66.902,-48.476,2.094,-15.067,-5.817,0.485"},EPSG_4664:{towgs84:"-211.939,137.626,58.3,-0.089,0.251,0.079,0.384"},EPSG_4665:{towgs84:"-105.854,165.589,-38.312,-0.003,-0.026,0.024,-0.048"},EPSG_4666:{towgs84:"631.392,-66.551,481.442,1.09,-4.445,-4.487,-4.43"},EPSG_4756:{towgs84:"-192.873,-39.382,-111.202,-0.00205,-0.0005,0.00335,0.0188"},EPSG_4723:{towgs84:"-179.483,-69.379,-27.584,-7.862,8.163,6.042,-13.925"},EPSG_4726:{towgs84:"8.853,-52.644,180.304,-0.393,-2.323,2.96,-24.081"},EPSG_4267:{towgs84:"-8.0,160.0,176.0"},EPSG_5365:{towgs84:"-0.16959,0.35312,0.51846,0.03385,-0.16325,0.03446,0.03693"},EPSG_4218:{towgs84:"304.5,306.5,-318.1"},EPSG_4242:{towgs84:"-33.722,153.789,94.959,-8.581,-4.478,4.54,8.95"},EPSG_4216:{towgs84:"-292.295,248.758,429.447,4.9971,2.99,6.6906,1.0289"},ESRI_104105:{towgs84:"631.392,-66.551,481.442,1.09,-4.445,-4.487,-4.43"},ESRI_104129:{towgs84:"0,0,0"},EPSG_4673:{towgs84:"174.05,-25.49,112.57"},EPSG_4202:{towgs84:"-124,-60,154"},EPSG_4203:{towgs84:"-117.763,-51.51,139.061,0.292,0.443,0.277,-0.191"},EPSG_3819:{towgs84:"595.48,121.69,515.35,4.115,-2.9383,0.853,-3.408"},EPSG_8694:{towgs84:"-93.799,-132.737,-219.073,-1.844,0.648,-6.37,-0.169"},EPSG_4145:{towgs84:"275.57,676.78,229.6"},EPSG_4283:{towgs84:"61.55,-10.87,-40.19,39.4924,32.7221,32.8979,-9.994"},EPSG_4317:{towgs84:"2.3287,-147.0425,-92.0802,-0.3092483,0.32482185,0.49729934,5.68906266"},EPSG_4272:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993"},EPSG_4248:{towgs84:"-307.7,265.3,-363.5"},EPSG_5561:{towgs84:"24,-121,-76"},EPSG_5233:{towgs84:"-0.293,766.95,87.713,0.195704,1.695068,3.473016,-0.039338"},ESRI_104130:{towgs84:"-86,-98,-119"},ESRI_104102:{towgs84:"682,-203,480"},ESRI_37207:{towgs84:"7,-10,-26"},EPSG_4675:{towgs84:"59.935,118.4,-10.871"},ESRI_104109:{towgs84:"-89.121,-348.182,260.871"},ESRI_104112:{towgs84:"-185.583,-230.096,281.361"},ESRI_104113:{towgs84:"25.1,-275.6,222.6"},IGNF_WGS72G:{towgs84:"0,12,6"},IGNF_NTFG:{towgs84:"-168,-60,320"},IGNF_EFATE57G:{towgs84:"-127,-769,472"},IGNF_PGP50G:{towgs84:"324.8,153.6,172.1"},IGNF_REUN47G:{towgs84:"94,-948,-1262"},IGNF_CSG67G:{towgs84:"-186,230,110"},IGNF_GUAD48G:{towgs84:"-467,-16,-300"},IGNF_TAHI51G:{towgs84:"162,117,154"},IGNF_TAHAAG:{towgs84:"65,342,77"},IGNF_NUKU72G:{towgs84:"84,274,65"},IGNF_PETRELS72G:{towgs84:"365,194,166"},IGNF_WALL78G:{towgs84:"253,-133,-127"},IGNF_MAYO50G:{towgs84:"-382,-59,-262"},IGNF_TANNAG:{towgs84:"-139,-967,436"},IGNF_IGN72G:{towgs84:"-13,-348,292"},IGNF_ATIGG:{towgs84:"1118,23,66"},IGNF_FANGA84G:{towgs84:"150.57,158.33,118.32"},IGNF_RUSAT84G:{towgs84:"202.13,174.6,-15.74"},IGNF_KAUE70G:{towgs84:"126.74,300.1,-75.49"},IGNF_MOP90G:{towgs84:"-10.8,-1.8,12.77"},IGNF_MHPF67G:{towgs84:"338.08,212.58,-296.17"},IGNF_TAHI79G:{towgs84:"160.61,116.05,153.69"},IGNF_ANAA92G:{towgs84:"1.5,3.84,4.81"},IGNF_MARQUI72G:{towgs84:"330.91,-13.92,58.56"},IGNF_APAT86G:{towgs84:"143.6,197.82,74.05"},IGNF_TUBU69G:{towgs84:"237.17,171.61,-77.84"},IGNF_STPM50G:{towgs84:"11.363,424.148,373.13"},EPSG_4150:{towgs84:"674.374,15.056,405.346"},EPSG_4754:{towgs84:"-208.4058,-109.8777,-2.5764"},ESRI_104101:{towgs84:"374,150,588"},EPSG_4693:{towgs84:"0,-0.15,0.68"},EPSG_6207:{towgs84:"293.17,726.18,245.36"},EPSG_4153:{towgs84:"-133.63,-157.5,-158.62"},EPSG_4132:{towgs84:"-241.54,-163.64,396.06"},EPSG_4221:{towgs84:"-154.5,150.7,100.4"},EPSG_4266:{towgs84:"-80.7,-132.5,41.1"},EPSG_4193:{towgs84:"-70.9,-151.8,-41.4"},EPSG_5340:{towgs84:"-0.41,0.46,-0.35"},EPSG_4246:{towgs84:"-294.7,-200.1,525.5"},EPSG_4318:{towgs84:"-3.2,-5.7,2.8"},EPSG_4121:{towgs84:"-199.87,74.79,246.62"},EPSG_4223:{towgs84:"-260.1,5.5,432.2"},EPSG_4158:{towgs84:"-0.465,372.095,171.736"},EPSG_4285:{towgs84:"-128.16,-282.42,21.93"},EPSG_4613:{towgs84:"-404.78,685.68,45.47"},EPSG_4607:{towgs84:"195.671,332.517,274.607"},EPSG_4475:{towgs84:"-381.788,-57.501,-256.673"},EPSG_4208:{towgs84:"-157.84,308.54,-146.6"},EPSG_4743:{towgs84:"70.995,-335.916,262.898"},EPSG_4710:{towgs84:"-323.65,551.39,-491.22"},EPSG_7881:{towgs84:"-0.077,0.079,0.086"},EPSG_4682:{towgs84:"283.729,735.942,261.143"},EPSG_4739:{towgs84:"-156,-271,-189"},EPSG_4679:{towgs84:"-80.01,253.26,291.19"},EPSG_4750:{towgs84:"-56.263,16.136,-22.856"},EPSG_4644:{towgs84:"-10.18,-350.43,291.37"},EPSG_4695:{towgs84:"-103.746,-9.614,-255.95"},EPSG_4292:{towgs84:"-355,21,72"},EPSG_4302:{towgs84:"-61.702,284.488,472.052"},EPSG_4143:{towgs84:"-124.76,53,466.79"},EPSG_4606:{towgs84:"-153,153,307"},EPSG_4699:{towgs84:"-770.1,158.4,-498.2"},EPSG_4247:{towgs84:"-273.5,110.6,-357.9"},EPSG_4160:{towgs84:"8.88,184.86,106.69"},EPSG_4161:{towgs84:"-233.43,6.65,173.64"},EPSG_9251:{towgs84:"-9.5,122.9,138.2"},EPSG_9253:{towgs84:"-78.1,101.6,133.3"},EPSG_4297:{towgs84:"-198.383,-240.517,-107.909"},EPSG_4269:{towgs84:"0,0,0"},EPSG_4301:{towgs84:"-147,506,687"},EPSG_4618:{towgs84:"-59,-11,-52"},EPSG_4612:{towgs84:"0,0,0"},EPSG_4678:{towgs84:"44.585,-131.212,-39.544"},EPSG_4250:{towgs84:"-130,29,364"},EPSG_4144:{towgs84:"214,804,268"},EPSG_4147:{towgs84:"-17.51,-108.32,-62.39"},EPSG_4259:{towgs84:"-254.1,-5.36,-100.29"},EPSG_4164:{towgs84:"-76,-138,67"},EPSG_4211:{towgs84:"-378.873,676.002,-46.255"},EPSG_4182:{towgs84:"-422.651,-172.995,84.02"},EPSG_4224:{towgs84:"-143.87,243.37,-33.52"},EPSG_4225:{towgs84:"-205.57,168.77,-4.12"},EPSG_5527:{towgs84:"-67.35,3.88,-38.22"},EPSG_4752:{towgs84:"98,390,-22"},EPSG_4310:{towgs84:"-30,190,89"},EPSG_9248:{towgs84:"-192.26,65.72,132.08"},EPSG_4680:{towgs84:"124.5,-63.5,-281"},EPSG_4701:{towgs84:"-79.9,-158,-168.9"},EPSG_4706:{towgs84:"-146.21,112.63,4.05"},EPSG_4805:{towgs84:"682,-203,480"},EPSG_4201:{towgs84:"-165,-11,206"},EPSG_4210:{towgs84:"-157,-2,-299"},EPSG_4183:{towgs84:"-104,167,-38"},EPSG_4139:{towgs84:"11,72,-101"},EPSG_4668:{towgs84:"-86,-98,-119"},EPSG_4717:{towgs84:"-2,151,181"},EPSG_4732:{towgs84:"102,52,-38"},EPSG_4280:{towgs84:"-377,681,-50"},EPSG_4209:{towgs84:"-138,-105,-289"},EPSG_4261:{towgs84:"31,146,47"},EPSG_4658:{towgs84:"-73,46,-86"},EPSG_4721:{towgs84:"265.025,384.929,-194.046"},EPSG_4222:{towgs84:"-136,-108,-292"},EPSG_4601:{towgs84:"-255,-15,71"},EPSG_4602:{towgs84:"725,685,536"},EPSG_4603:{towgs84:"72,213.7,93"},EPSG_4605:{towgs84:"9,183,236"},EPSG_4621:{towgs84:"137,248,-430"},EPSG_4657:{towgs84:"-28,199,5"},EPSG_4316:{towgs84:"103.25,-100.4,-307.19"},EPSG_4642:{towgs84:"-13,-348,292"},EPSG_4698:{towgs84:"145,-187,103"},EPSG_4192:{towgs84:"-206.1,-174.7,-87.7"},EPSG_4311:{towgs84:"-265,120,-358"},EPSG_4135:{towgs84:"58,-283,-182"},ESRI_104138:{towgs84:"198,-226,-347"},EPSG_4245:{towgs84:"-11,851,5"},EPSG_4142:{towgs84:"-125,53,467"},EPSG_4213:{towgs84:"-106,-87,188"},EPSG_4253:{towgs84:"-133,-77,-51"},EPSG_4129:{towgs84:"-132,-110,-335"},EPSG_4713:{towgs84:"-77,-128,142"},EPSG_4239:{towgs84:"217,823,299"},EPSG_4146:{towgs84:"295,736,257"},EPSG_4155:{towgs84:"-83,37,124"},EPSG_4165:{towgs84:"-173,253,27"},EPSG_4672:{towgs84:"175,-38,113"},EPSG_4236:{towgs84:"-637,-549,-203"},EPSG_4251:{towgs84:"-90,40,88"},EPSG_4271:{towgs84:"-2,374,172"},EPSG_4175:{towgs84:"-88,4,101"},EPSG_4716:{towgs84:"298,-304,-375"},EPSG_4315:{towgs84:"-23,259,-9"},EPSG_4744:{towgs84:"-242.2,-144.9,370.3"},EPSG_4244:{towgs84:"-97,787,86"},EPSG_4293:{towgs84:"616,97,-251"},EPSG_4714:{towgs84:"-127,-769,472"},EPSG_4736:{towgs84:"260,12,-147"},EPSG_6883:{towgs84:"-235,-110,393"},EPSG_6894:{towgs84:"-63,176,185"},EPSG_4205:{towgs84:"-43,-163,45"},EPSG_4256:{towgs84:"41,-220,-134"},EPSG_4262:{towgs84:"639,405,60"},EPSG_4604:{towgs84:"174,359,365"},EPSG_4169:{towgs84:"-115,118,426"},EPSG_4620:{towgs84:"-106,-129,165"},EPSG_4184:{towgs84:"-203,141,53"},EPSG_4616:{towgs84:"-289,-124,60"},EPSG_9403:{towgs84:"-307,-92,127"},EPSG_4684:{towgs84:"-133,-321,50"},EPSG_4708:{towgs84:"-491,-22,435"},EPSG_4707:{towgs84:"114,-116,-333"},EPSG_4709:{towgs84:"145,75,-272"},EPSG_4712:{towgs84:"-205,107,53"},EPSG_4711:{towgs84:"124,-234,-25"},EPSG_4718:{towgs84:"230,-199,-752"},EPSG_4719:{towgs84:"211,147,111"},EPSG_4724:{towgs84:"208,-435,-229"},EPSG_4725:{towgs84:"189,-79,-202"},EPSG_4735:{towgs84:"647,1777,-1124"},EPSG_4722:{towgs84:"-794,119,-298"},EPSG_4728:{towgs84:"-307,-92,127"},EPSG_4734:{towgs84:"-632,438,-609"},EPSG_4727:{towgs84:"912,-58,1227"},EPSG_4729:{towgs84:"185,165,42"},EPSG_4730:{towgs84:"170,42,84"},EPSG_4733:{towgs84:"276,-57,149"},ESRI_37218:{towgs84:"230,-199,-752"},ESRI_37240:{towgs84:"-7,215,225"},ESRI_37221:{towgs84:"252,-209,-751"},ESRI_4305:{towgs84:"-123,-206,219"},ESRI_104139:{towgs84:"-73,-247,227"},EPSG_4748:{towgs84:"51,391,-36"},EPSG_4219:{towgs84:"-384,664,-48"},EPSG_4255:{towgs84:"-333,-222,114"},EPSG_4257:{towgs84:"-587.8,519.75,145.76"},EPSG_4646:{towgs84:"-963,510,-359"},EPSG_6881:{towgs84:"-24,-203,268"},EPSG_6882:{towgs84:"-183,-15,273"},EPSG_4715:{towgs84:"-104,-129,239"},IGNF_RGF93GDD:{towgs84:"0,0,0"},IGNF_RGM04GDD:{towgs84:"0,0,0"},IGNF_RGSPM06GDD:{towgs84:"0,0,0"},IGNF_RGTAAF07GDD:{towgs84:"0,0,0"},IGNF_RGFG95GDD:{towgs84:"0,0,0"},IGNF_RGNCG:{towgs84:"0,0,0"},IGNF_RGPFGDD:{towgs84:"0,0,0"},IGNF_ETRS89G:{towgs84:"0,0,0"},IGNF_RGR92GDD:{towgs84:"0,0,0"},EPSG_4173:{towgs84:"0,0,0"},EPSG_4180:{towgs84:"0,0,0"},EPSG_4619:{towgs84:"0,0,0"},EPSG_4667:{towgs84:"0,0,0"},EPSG_4075:{towgs84:"0,0,0"},EPSG_6706:{towgs84:"0,0,0"},EPSG_7798:{towgs84:"0,0,0"},EPSG_4661:{towgs84:"0,0,0"},EPSG_4669:{towgs84:"0,0,0"},EPSG_8685:{towgs84:"0,0,0"},EPSG_4151:{towgs84:"0,0,0"},EPSG_9702:{towgs84:"0,0,0"},EPSG_4758:{towgs84:"0,0,0"},EPSG_4761:{towgs84:"0,0,0"},EPSG_4765:{towgs84:"0,0,0"},EPSG_8997:{towgs84:"0,0,0"},EPSG_4023:{towgs84:"0,0,0"},EPSG_4670:{towgs84:"0,0,0"},EPSG_4694:{towgs84:"0,0,0"},EPSG_4148:{towgs84:"0,0,0"},EPSG_4163:{towgs84:"0,0,0"},EPSG_4167:{towgs84:"0,0,0"},EPSG_4189:{towgs84:"0,0,0"},EPSG_4190:{towgs84:"0,0,0"},EPSG_4176:{towgs84:"0,0,0"},EPSG_4659:{towgs84:"0,0,0"},EPSG_3824:{towgs84:"0,0,0"},EPSG_3889:{towgs84:"0,0,0"},EPSG_4046:{towgs84:"0,0,0"},EPSG_4081:{towgs84:"0,0,0"},EPSG_4558:{towgs84:"0,0,0"},EPSG_4483:{towgs84:"0,0,0"},EPSG_5013:{towgs84:"0,0,0"},EPSG_5264:{towgs84:"0,0,0"},EPSG_5324:{towgs84:"0,0,0"},EPSG_5354:{towgs84:"0,0,0"},EPSG_5371:{towgs84:"0,0,0"},EPSG_5373:{towgs84:"0,0,0"},EPSG_5381:{towgs84:"0,0,0"},EPSG_5393:{towgs84:"0,0,0"},EPSG_5489:{towgs84:"0,0,0"},EPSG_5593:{towgs84:"0,0,0"},EPSG_6135:{towgs84:"0,0,0"},EPSG_6365:{towgs84:"0,0,0"},EPSG_5246:{towgs84:"0,0,0"},EPSG_7886:{towgs84:"0,0,0"},EPSG_8431:{towgs84:"0,0,0"},EPSG_8427:{towgs84:"0,0,0"},EPSG_8699:{towgs84:"0,0,0"},EPSG_8818:{towgs84:"0,0,0"},EPSG_4757:{towgs84:"0,0,0"},EPSG_9140:{towgs84:"0,0,0"},EPSG_8086:{towgs84:"0,0,0"},EPSG_4686:{towgs84:"0,0,0"},EPSG_4737:{towgs84:"0,0,0"},EPSG_4702:{towgs84:"0,0,0"},EPSG_4747:{towgs84:"0,0,0"},EPSG_4749:{towgs84:"0,0,0"},EPSG_4674:{towgs84:"0,0,0"},EPSG_4755:{towgs84:"0,0,0"},EPSG_4759:{towgs84:"0,0,0"},EPSG_4762:{towgs84:"0,0,0"},EPSG_4763:{towgs84:"0,0,0"},EPSG_4764:{towgs84:"0,0,0"},EPSG_4166:{towgs84:"0,0,0"},EPSG_4170:{towgs84:"0,0,0"},EPSG_5546:{towgs84:"0,0,0"},EPSG_7844:{towgs84:"0,0,0"},EPSG_4818:{towgs84:"589,76,480"}};for(var t1 in Nm){var Mg=Nm[t1];Mg.datumName&&(Nm[Mg.datumName]=Mg)}function i1(u,y,w,C,P,D,E){var o={};return u===void 0||u==="none"?o.datum_type=Pg:o.datum_type=fv,y&&(o.datum_params=y.map(parseFloat),(o.datum_params[0]!==0||o.datum_params[1]!==0||o.datum_params[2]!==0)&&(o.datum_type=od),o.datum_params.length>3&&(o.datum_params[3]!==0||o.datum_params[4]!==0||o.datum_params[5]!==0||o.datum_params[6]!==0)&&(o.datum_type=ld,o.datum_params[3]*=Tp,o.datum_params[4]*=Tp,o.datum_params[5]*=Tp,o.datum_params[6]=o.datum_params[6]/1e6+1)),E&&(o.datum_type=df,o.grids=E),o.a=w,o.b=C,o.es=P,o.ep2=D,o}var $g={};function a1(u,y,w){return y instanceof ArrayBuffer?n1(u,y,w):{ready:r1(u,y)}}function n1(u,y,w){var C=!0;w!==void 0&&w.includeErrorFields===!1&&(C=!1);var P=new DataView(y),D=l1(P),E=c1(P,D),o=u1(P,E,D,C),B={header:E,subgrids:o};return $g[u]=B,B}async function r1(u,y){for(var w=[],C=await y.getImageCount(),P=C-1;P>=0;P--){var D=await y.getImage(P),E=await D.readRasters(),o=E,B=[D.getWidth(),D.getHeight()],j=D.getBoundingBox().map(T_),J=[D.fileDirectory.ModelPixelScale[0],D.fileDirectory.ModelPixelScale[1]].map(T_),K=j[0]+(B[0]-1)*J[0],W=j[3]-(B[1]-1)*J[1],ee=o[0],we=o[1],Oe=[];for(let Be=B[1]-1;Be>=0;Be--)for(let Ke=B[0]-1;Ke>=0;Ke--){var Ae=Be*B[0]+Ke;Oe.push([-Ku(we[Ae]),Ku(ee[Ae])])}w.push({del:J,lim:B,ll:[-K,W],cvs:Oe})}var Ze={header:{nSubgrids:C},subgrids:w};return $g[u]=Ze,Ze}function s1(u){if(u===void 0)return null;var y=u.split(",");return y.map(o1)}function o1(u){if(u.length===0)return null;var y=u[0]==="@";return y&&(u=u.slice(1)),u==="null"?{name:"null",mandatory:!y,grid:null,isNull:!0}:{name:u,mandatory:!y,grid:$g[u]||null,isNull:!1}}function T_(u){return u*Math.PI/180}function Ku(u){return u/3600*Math.PI/180}function l1(u){var y=u.getInt32(8,!1);return y===11?!1:(y=u.getInt32(8,!0),y!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function c1(u,y){return{nFields:u.getInt32(8,y),nSubgridFields:u.getInt32(24,y),nSubgrids:u.getInt32(40,y),shiftType:Rg(u,56,64).trim(),fromSemiMajorAxis:u.getFloat64(120,y),fromSemiMinorAxis:u.getFloat64(136,y),toSemiMajorAxis:u.getFloat64(152,y),toSemiMinorAxis:u.getFloat64(168,y)}}function Rg(u,y,w){return String.fromCharCode.apply(null,new Uint8Array(u.buffer.slice(y,w)))}function u1(u,y,w,C){for(var P=176,D=[],E=0;E<y.nSubgrids;E++){var o=d1(u,P,w),B=f1(u,P,o,w,C),j=Math.round(1+(o.upperLongitude-o.lowerLongitude)/o.longitudeInterval),J=Math.round(1+(o.upperLatitude-o.lowerLatitude)/o.latitudeInterval);D.push({ll:[Ku(o.lowerLongitude),Ku(o.lowerLatitude)],del:[Ku(o.longitudeInterval),Ku(o.latitudeInterval)],lim:[j,J],count:o.gridNodeCount,cvs:h1(B)});var K=16;C===!1&&(K=8),P+=176+o.gridNodeCount*K}return D}function h1(u){return u.map(function(y){return[Ku(y.longitudeShift),Ku(y.latitudeShift)]})}function d1(u,y,w){return{name:Rg(u,y+8,y+16).trim(),parent:Rg(u,y+24,y+24+8).trim(),lowerLatitude:u.getFloat64(y+72,w),upperLatitude:u.getFloat64(y+88,w),lowerLongitude:u.getFloat64(y+104,w),upperLongitude:u.getFloat64(y+120,w),latitudeInterval:u.getFloat64(y+136,w),longitudeInterval:u.getFloat64(y+152,w),gridNodeCount:u.getInt32(y+168,w)}}function f1(u,y,w,C,P){var D=y+176,E=16;P===!1&&(E=8);for(var o=[],B=0;B<w.gridNodeCount;B++){var j={latitudeShift:u.getFloat32(D+B*E,C),longitudeShift:u.getFloat32(D+B*E+4,C)};P!==!1&&(j.latitudeAccuracy=u.getFloat32(D+B*E+8,C),j.longitudeAccuracy=u.getFloat32(D+B*E+12,C)),o.push(j)}return o}function El(u,y){if(!(this instanceof El))return new El(u);this.forward=null,this.inverse=null,this.init=null,this.name,this.names=null,this.title,y=y||function(j){if(j)throw j};var w=jv(u);if(typeof w!="object"){y("Could not parse to valid json: "+u);return}var C=El.projections.get(w.projName);if(!C){y("Could not get projection name from: "+u);return}if(w.datumCode&&w.datumCode!=="none"){var P=eh(Nm,w.datumCode);P&&(w.datum_params=w.datum_params||(P.towgs84?P.towgs84.split(","):null),w.ellps=P.ellipse,w.datumName=P.datumName?P.datumName:w.datumCode)}w.k0=w.k0||1,w.axis=w.axis||"enu",w.ellps=w.ellps||"wgs84",w.lat1=w.lat1||w.lat0;var D=e1(w.a,w.b,w.rf,w.ellps,w.sphere),E=Jv(D.a,D.b,D.rf,w.R_A),o=s1(w.nadgrids),B=w.datum||i1(w.datumCode,w.datum_params,D.a,D.b,E.es,E.ep2,o);S_(this,w),S_(this,C),this.a=D.a,this.b=D.b,this.rf=D.rf,this.sphere=D.sphere,this.es=E.es,this.e=E.e,this.ep2=E.ep2,this.datum=B,"init"in this&&typeof this.init=="function"&&this.init(),y(null,this)}El.projections=Qv;El.projections.start();function p1(u,y){return u.datum_type!==y.datum_type||u.a!==y.a||Math.abs(u.es-y.es)>5e-11?!1:u.datum_type===od?u.datum_params[0]===y.datum_params[0]&&u.datum_params[1]===y.datum_params[1]&&u.datum_params[2]===y.datum_params[2]:u.datum_type===ld?u.datum_params[0]===y.datum_params[0]&&u.datum_params[1]===y.datum_params[1]&&u.datum_params[2]===y.datum_params[2]&&u.datum_params[3]===y.datum_params[3]&&u.datum_params[4]===y.datum_params[4]&&u.datum_params[5]===y.datum_params[5]&&u.datum_params[6]===y.datum_params[6]:!0}function py(u,y,w){var C=u.x,P=u.y,D=u.z?u.z:0,E,o,B,j;if(P<-_t&&P>-1.001*_t)P=-_t;else if(P>_t&&P<1.001*_t)P=_t;else{if(P<-_t)return{x:-1/0,y:-1/0,z:u.z};if(P>_t)return{x:1/0,y:1/0,z:u.z}}return C>Math.PI&&(C-=2*Math.PI),o=Math.sin(P),j=Math.cos(P),B=o*o,E=w/Math.sqrt(1-y*B),{x:(E+D)*j*Math.cos(C),y:(E+D)*j*Math.sin(C),z:(E*(1-y)+D)*o}}function my(u,y,w,C){var P=1e-12,D=P*P,E=30,o,B,j,J,K,W,ee,we,Oe,Ae,Ze,Be,Ke,vt=u.x,Et=u.y,xt=u.z?u.z:0,lt,xe,Se;if(o=Math.sqrt(vt*vt+Et*Et),B=Math.sqrt(vt*vt+Et*Et+xt*xt),o/w<P){if(lt=0,B/w<P)return xe=_t,Se=-C,{x:u.x,y:u.y,z:u.z}}else lt=Math.atan2(Et,vt);j=xt/B,J=o/B,K=1/Math.sqrt(1-y*(2-y)*J*J),we=J*(1-y)*K,Oe=j*K,Ke=0;do Ke++,ee=w/Math.sqrt(1-y*Oe*Oe),Se=o*we+xt*Oe-ee*(1-y*Oe*Oe),W=y*ee/(ee+Se),K=1/Math.sqrt(1-W*(2-W)*J*J),Ae=J*(1-W)*K,Ze=j*K,Be=Ze*we-Ae*Oe,we=Ae,Oe=Ze;while(Be*Be>D&&Ke<E);return xe=Math.atan(Ze/Math.abs(Ae)),{x:lt,y:xe,z:Se}}function m1(u,y,w){if(y===od)return{x:u.x+w[0],y:u.y+w[1],z:u.z+w[2]};if(y===ld){var C=w[0],P=w[1],D=w[2],E=w[3],o=w[4],B=w[5],j=w[6];return{x:j*(u.x-B*u.y+o*u.z)+C,y:j*(B*u.x+u.y-E*u.z)+P,z:j*(-o*u.x+E*u.y+u.z)+D}}}function g1(u,y,w){if(y===od)return{x:u.x-w[0],y:u.y-w[1],z:u.z-w[2]};if(y===ld){var C=w[0],P=w[1],D=w[2],E=w[3],o=w[4],B=w[5],j=w[6],J=(u.x-C)/j,K=(u.y-P)/j,W=(u.z-D)/j;return{x:J+B*K-o*W,y:-B*J+K+E*W,z:o*J-E*K+W}}}function Im(u){return u===od||u===ld}function _1(u,y,w){if(p1(u,y)||u.datum_type===Pg||y.datum_type===Pg)return w;var C=u.a,P=u.es;if(u.datum_type===df){var D=E_(u,!1,w);if(D!==0)return;C=__,P=y_}var E=y.a,o=y.b,B=y.es;if(y.datum_type===df&&(E=__,o=pv,B=y_),P===B&&C===E&&!Im(u.datum_type)&&!Im(y.datum_type))return w;if(w=py(w,P,C),Im(u.datum_type)&&(w=m1(w,u.datum_type,u.datum_params)),Im(y.datum_type)&&(w=g1(w,y.datum_type,y.datum_params)),w=my(w,B,E,o),y.datum_type===df){var j=E_(y,!0,w);if(j!==0)return}return w}function E_(u,y,w){if(u.grids===null||u.grids.length===0)return console.log("Grid shift grids not found"),-1;var C={x:-w.x,y:w.y},P={x:Number.NaN,y:Number.NaN},D=[];e:for(var E=0;E<u.grids.length;E++){var o=u.grids[E];if(D.push(o.name),o.isNull){P=C;break}if(o.grid===null){if(o.mandatory)return console.log("Unable to find mandatory grid '"+o.name+"'"),-1;continue}for(var B=o.grid.subgrids,j=0,J=B.length;j<J;j++){var K=B[j],W=(Math.abs(K.del[1])+Math.abs(K.del[0]))/1e4,ee=K.ll[0]-W,we=K.ll[1]-W,Oe=K.ll[0]+(K.lim[0]-1)*K.del[0]+W,Ae=K.ll[1]+(K.lim[1]-1)*K.del[1]+W;if(!(we>C.y||ee>C.x||Ae<C.y||Oe<C.x)&&(P=y1(C,y,K),!isNaN(P.x)))break e}}return isNaN(P.x)?(console.log("Failed to find a grid shift table for location '"+-C.x*cc+" "+C.y*cc+" tried: '"+D+"'"),-1):(w.x=-P.x,w.y=P.y,0)}function y1(u,y,w){var C={x:Number.NaN,y:Number.NaN};if(isNaN(u.x))return C;var P={x:u.x,y:u.y};P.x-=w.ll[0],P.y-=w.ll[1],P.x=Bt(P.x-Math.PI)+Math.PI;var D=C_(P,w);if(y){if(isNaN(D.x))return C;D.x=P.x-D.x,D.y=P.y-D.y;var E=9,o=1e-12,B,j;do{if(j=C_(D,w),isNaN(j.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}B={x:P.x-(j.x+D.x),y:P.y-(j.y+D.y)},D.x+=B.x,D.y+=B.y}while(E--&&Math.abs(B.x)>o&&Math.abs(B.y)>o);if(E<0)return console.log("Inverse grid shift iterator failed to converge."),C;C.x=Bt(D.x+w.ll[0]),C.y=D.y+w.ll[1]}else isNaN(D.x)||(C.x=u.x+D.x,C.y=u.y+D.y);return C}function C_(u,y){var w={x:u.x/y.del[0],y:u.y/y.del[1]},C={x:Math.floor(w.x),y:Math.floor(w.y)},P={x:w.x-1*C.x,y:w.y-1*C.y},D={x:Number.NaN,y:Number.NaN},E;if(C.x<0||C.x>=y.lim[0]||C.y<0||C.y>=y.lim[1])return D;E=C.y*y.lim[0]+C.x;var o={x:y.cvs[E][0],y:y.cvs[E][1]};E++;var B={x:y.cvs[E][0],y:y.cvs[E][1]};E+=y.lim[0];var j={x:y.cvs[E][0],y:y.cvs[E][1]};E--;var J={x:y.cvs[E][0],y:y.cvs[E][1]},K=P.x*P.y,W=P.x*(1-P.y),ee=(1-P.x)*(1-P.y),we=(1-P.x)*P.y;return D.x=ee*o.x+W*B.x+we*J.x+K*j.x,D.y=ee*o.y+W*B.y+we*J.y+K*j.y,D}function A_(u,y,w){var C=w.x,P=w.y,D=w.z||0,E,o,B,j={};for(B=0;B<3;B++)if(!(y&&B===2&&w.z===void 0))switch(B===0?(E=C,"ew".indexOf(u.axis[B])!==-1?o="x":o="y"):B===1?(E=P,"ns".indexOf(u.axis[B])!==-1?o="y":o="x"):(E=D,o="z"),u.axis[B]){case"e":j[o]=E;break;case"w":j[o]=-E;break;case"n":j[o]=E;break;case"s":j[o]=-E;break;case"u":w[o]!==void 0&&(j.z=E);break;case"d":w[o]!==void 0&&(j.z=-E);break;default:return null}return j}function gy(u){var y={x:u[0],y:u[1]};return u.length>2&&(y.z=u[2]),u.length>3&&(y.m=u[3]),y}function v1(u){P_(u.x),P_(u.y)}function P_(u){if(typeof Number.isFinite=="function"){if(Number.isFinite(u))return;throw new TypeError("coordinates must be finite numbers")}if(typeof u!="number"||u!==u||!isFinite(u))throw new TypeError("coordinates must be finite numbers")}function x1(u,y){return(u.datum.datum_type===od||u.datum.datum_type===ld||u.datum.datum_type===df)&&y.datumCode!=="WGS84"||(y.datum.datum_type===od||y.datum.datum_type===ld||y.datum.datum_type===df)&&u.datumCode!=="WGS84"}function $m(u,y,w,C){var P;Array.isArray(w)?w=gy(w):w={x:w.x,y:w.y,z:w.z,m:w.m};var D=w.z!==void 0;if(v1(w),u.datum&&y.datum&&x1(u,y)&&(P=new El("WGS84"),w=$m(u,P,w,C),u=P),C&&u.axis!=="enu"&&(w=A_(u,!1,w)),u.projName==="longlat")w={x:w.x*Sr,y:w.y*Sr,z:w.z||0};else if(u.to_meter&&(w={x:w.x*u.to_meter,y:w.y*u.to_meter,z:w.z||0}),w=u.inverse(w),!w)return;if(u.from_greenwich&&(w.x+=u.from_greenwich),w=_1(u.datum,y.datum,w),!!w)return w=w,y.from_greenwich&&(w={x:w.x-y.from_greenwich,y:w.y,z:w.z||0}),y.projName==="longlat"?w={x:w.x*cc,y:w.y*cc,z:w.z||0}:(w=y.forward(w),y.to_meter&&(w={x:w.x/y.to_meter,y:w.y/y.to_meter,z:w.z||0})),C&&y.axis!=="enu"?A_(y,!0,w):(w&&!D&&delete w.z,w)}var z_=El("WGS84");function Tg(u,y,w,C){var P,D,E;return Array.isArray(w)?(P=$m(u,y,w,C)||{x:NaN,y:NaN},w.length>2?typeof u.name<"u"&&u.name==="geocent"||typeof y.name<"u"&&y.name==="geocent"?typeof P.z=="number"?[P.x,P.y,P.z].concat(w.slice(3)):[P.x,P.y,w[2]].concat(w.slice(3)):[P.x,P.y].concat(w.slice(2)):[P.x,P.y]):(D=$m(u,y,w,C),E=Object.keys(w),E.length===2||E.forEach(function(o){if(typeof u.name<"u"&&u.name==="geocent"||typeof y.name<"u"&&y.name==="geocent"){if(o==="x"||o==="y"||o==="z")return}else if(o==="x"||o==="y")return;D[o]=w[o]}),D)}function Rm(u){return u instanceof El?u:typeof u=="object"&&"oProj"in u?u.oProj:El(u)}function b1(u,y,w){var C,P,D=!1,E;return typeof y>"u"?(P=Rm(u),C=z_,D=!0):(typeof y.x<"u"||Array.isArray(y))&&(w=y,P=Rm(u),C=z_,D=!0),C||(C=Rm(u)),P||(P=Rm(y)),w?Tg(C,P,w):(E={forward:function(o,B){return Tg(C,P,o,B)},inverse:function(o,B){return Tg(P,C,o,B)}},D&&(E.oProj=P),E)}var I_=6,_y="AJSAJS",yy="AFAFAF",uf=65,Es=73,Go=79,wp=86,Sp=90;const w1={forward:vy,inverse:S1,toPoint:xy};function vy(u,y){return y=y||5,E1(M1({lat:u[1],lon:u[0]}),y)}function S1(u){var y=Hg(wy(u.toUpperCase()));return y.lat&&y.lon?[y.lon,y.lat,y.lon,y.lat]:[y.left,y.bottom,y.right,y.top]}function xy(u){var y=Hg(wy(u.toUpperCase()));return y.lat&&y.lon?[y.lon,y.lat]:[(y.left+y.right)/2,(y.top+y.bottom)/2]}function Eg(u){return u*(Math.PI/180)}function R_(u){return 180*(u/Math.PI)}function M1(u){var y=u.lat,w=u.lon,C=6378137,P=.00669438,D=.9996,E,o,B,j,J,K,W,ee=Eg(y),we=Eg(w),Oe,Ae;Ae=Math.floor((w+180)/6)+1,w===180&&(Ae=60),y>=56&&y<64&&w>=3&&w<12&&(Ae=32),y>=72&&y<84&&(w>=0&&w<9?Ae=31:w>=9&&w<21?Ae=33:w>=21&&w<33?Ae=35:w>=33&&w<42&&(Ae=37)),E=(Ae-1)*6-180+3,Oe=Eg(E),o=P/(1-P),B=C/Math.sqrt(1-P*Math.sin(ee)*Math.sin(ee)),j=Math.tan(ee)*Math.tan(ee),J=o*Math.cos(ee)*Math.cos(ee),K=Math.cos(ee)*(we-Oe),W=C*((1-P/4-3*P*P/64-5*P*P*P/256)*ee-(3*P/8+3*P*P/32+45*P*P*P/1024)*Math.sin(2*ee)+(15*P*P/256+45*P*P*P/1024)*Math.sin(4*ee)-35*P*P*P/3072*Math.sin(6*ee));var Ze=D*B*(K+(1-j+J)*K*K*K/6+(5-18*j+j*j+72*J-58*o)*K*K*K*K*K/120)+5e5,Be=D*(W+B*Math.tan(ee)*(K*K/2+(5-j+9*J+4*J*J)*K*K*K*K/24+(61-58*j+j*j+600*J-330*o)*K*K*K*K*K*K/720));return y<0&&(Be+=1e7),{northing:Math.round(Be),easting:Math.round(Ze),zoneNumber:Ae,zoneLetter:T1(y)}}function Hg(u){var y=u.northing,w=u.easting,C=u.zoneLetter,P=u.zoneNumber;if(P<0||P>60)return null;var D=.9996,E=6378137,o=.00669438,B,j=(1-Math.sqrt(1-o))/(1+Math.sqrt(1-o)),J,K,W,ee,we,Oe,Ae,Ze,Be,Ke=w-5e5,vt=y;C<"N"&&(vt-=1e7),Ae=(P-1)*6-180+3,B=o/(1-o),Oe=vt/D,Ze=Oe/(E*(1-o/4-3*o*o/64-5*o*o*o/256)),Be=Ze+(3*j/2-27*j*j*j/32)*Math.sin(2*Ze)+(21*j*j/16-55*j*j*j*j/32)*Math.sin(4*Ze)+151*j*j*j/96*Math.sin(6*Ze),J=E/Math.sqrt(1-o*Math.sin(Be)*Math.sin(Be)),K=Math.tan(Be)*Math.tan(Be),W=B*Math.cos(Be)*Math.cos(Be),ee=E*(1-o)/Math.pow(1-o*Math.sin(Be)*Math.sin(Be),1.5),we=Ke/(J*D);var Et=Be-J*Math.tan(Be)/ee*(we*we/2-(5+3*K+10*W-4*W*W-9*B)*we*we*we*we/24+(61+90*K+298*W+45*K*K-252*B-3*W*W)*we*we*we*we*we*we/720);Et=R_(Et);var xt=(we-(1+2*K+W)*we*we*we/6+(5-2*W+28*K-3*W*W+8*B+24*K*K)*we*we*we*we*we/120)/Math.cos(Be);xt=Ae+R_(xt);var lt;if(u.accuracy){var xe=Hg({northing:u.northing+u.accuracy,easting:u.easting+u.accuracy,zoneLetter:u.zoneLetter,zoneNumber:u.zoneNumber});lt={top:xe.lat,right:xe.lon,bottom:Et,left:xt}}else lt={lat:Et,lon:xt};return lt}function T1(u){var y="Z";return 84>=u&&u>=72?y="X":72>u&&u>=64?y="W":64>u&&u>=56?y="V":56>u&&u>=48?y="U":48>u&&u>=40?y="T":40>u&&u>=32?y="S":32>u&&u>=24?y="R":24>u&&u>=16?y="Q":16>u&&u>=8?y="P":8>u&&u>=0?y="N":0>u&&u>=-8?y="M":-8>u&&u>=-16?y="L":-16>u&&u>=-24?y="K":-24>u&&u>=-32?y="J":-32>u&&u>=-40?y="H":-40>u&&u>=-48?y="G":-48>u&&u>=-56?y="F":-56>u&&u>=-64?y="E":-64>u&&u>=-72?y="D":-72>u&&u>=-80&&(y="C"),y}function E1(u,y){var w="00000"+u.easting,C="00000"+u.northing;return u.zoneNumber+u.zoneLetter+C1(u.easting,u.northing,u.zoneNumber)+w.substr(w.length-5,y)+C.substr(C.length-5,y)}function C1(u,y,w){var C=by(w),P=Math.floor(u/1e5),D=Math.floor(y/1e5)%20;return A1(P,D,C)}function by(u){var y=u%I_;return y===0&&(y=I_),y}function A1(u,y,w){var C=w-1,P=_y.charCodeAt(C),D=yy.charCodeAt(C),E=P+u-1,o=D+y,B=!1;E>Sp&&(E=E-Sp+uf-1,B=!0),(E===Es||P<Es&&E>Es||(E>Es||P<Es)&&B)&&E++,(E===Go||P<Go&&E>Go||(E>Go||P<Go)&&B)&&(E++,E===Es&&E++),E>Sp&&(E=E-Sp+uf-1),o>wp?(o=o-wp+uf-1,B=!0):B=!1,(o===Es||D<Es&&o>Es||(o>Es||D<Es)&&B)&&o++,(o===Go||D<Go&&o>Go||(o>Go||D<Go)&&B)&&(o++,o===Es&&o++),o>wp&&(o=o-wp+uf-1);var j=String.fromCharCode(E)+String.fromCharCode(o);return j}function wy(u){if(u&&u.length===0)throw"MGRSPoint coverting from nothing";for(var y=u.length,w=null,C="",P,D=0;!/[A-Z]/.test(P=u.charAt(D));){if(D>=2)throw"MGRSPoint bad conversion from: "+u;C+=P,D++}var E=parseInt(C,10);if(D===0||D+3>y)throw"MGRSPoint bad conversion from: "+u;var o=u.charAt(D++);if(o<="A"||o==="B"||o==="Y"||o>="Z"||o==="I"||o==="O")throw"MGRSPoint zone letter "+o+" not handled: "+u;w=u.substring(D,D+=2);for(var B=by(E),j=P1(w.charAt(0),B),J=z1(w.charAt(1),B);J<I1(o);)J+=2e6;var K=y-D;if(K%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+u;var W=K/2,ee=0,we=0,Oe,Ae,Ze,Be,Ke;return W>0&&(Oe=1e5/Math.pow(10,W),Ae=u.substring(D,D+W),ee=parseFloat(Ae)*Oe,Ze=u.substring(D+W),we=parseFloat(Ze)*Oe),Be=ee+j,Ke=we+J,{easting:Be,northing:Ke,zoneLetter:o,zoneNumber:E,accuracy:Oe}}function P1(u,y){for(var w=_y.charCodeAt(y-1),C=1e5,P=!1;w!==u.charCodeAt(0);){if(w++,w===Es&&w++,w===Go&&w++,w>Sp){if(P)throw"Bad character: "+u;w=uf,P=!0}C+=1e5}return C}function z1(u,y){if(u>"V")throw"MGRSPoint given invalid Northing "+u;for(var w=yy.charCodeAt(y-1),C=0,P=!1;w!==u.charCodeAt(0);){if(w++,w===Es&&w++,w===Go&&w++,w>wp){if(P)throw"Bad character: "+u;w=uf,P=!0}C+=1e5}return C}function I1(u){var y;switch(u){case"C":y=11e5;break;case"D":y=2e6;break;case"E":y=28e5;break;case"F":y=37e5;break;case"G":y=46e5;break;case"H":y=55e5;break;case"J":y=64e5;break;case"K":y=73e5;break;case"L":y=82e5;break;case"M":y=91e5;break;case"N":y=0;break;case"P":y=8e5;break;case"Q":y=17e5;break;case"R":y=26e5;break;case"S":y=35e5;break;case"T":y=44e5;break;case"U":y=53e5;break;case"V":y=62e5;break;case"W":y=7e6;break;case"X":y=79e5;break;default:y=-1}if(y>=0)return y;throw"Invalid zone letter: "+u}function pf(u,y,w){if(!(this instanceof pf))return new pf(u,y,w);if(Array.isArray(u))this.x=u[0],this.y=u[1],this.z=u[2]||0;else if(typeof u=="object")this.x=u.x,this.y=u.y,this.z=u.z||0;else if(typeof u=="string"&&typeof y>"u"){var C=u.split(",");this.x=parseFloat(C[0]),this.y=parseFloat(C[1]),this.z=parseFloat(C[2])||0}else this.x=u,this.y=y,this.z=w||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}pf.fromMGRS=function(u){return new pf(xy(u))};pf.prototype.toMGRS=function(u){return vy([this.x,this.y],u)};var R1=1,D1=.25,D_=.046875,k_=.01953125,L_=.01068115234375,k1=.75,L1=.46875,O1=.013020833333333334,B1=.007120768229166667,N1=.3645833333333333,j1=.005696614583333333,F1=.3076171875;function Xg(u){var y=[];y[0]=R1-u*(D1+u*(D_+u*(k_+u*L_))),y[1]=u*(k1-u*(D_+u*(k_+u*L_)));var w=u*u;return y[2]=w*(L1-u*(O1+u*B1)),w*=u,y[3]=w*(N1-u*j1),y[4]=w*u*F1,y}function _f(u,y,w,C){return w*=y,y*=y,C[0]*u-w*(C[1]+y*(C[2]+y*(C[3]+y*C[4])))}var G1=20;function Yg(u,y,w){for(var C=1/(1-y),P=u,D=G1;D;--D){var E=Math.sin(P),o=1-y*E*E;if(o=(_f(P,E,Math.cos(P),w)-u)*(o*Math.sqrt(o))*C,P-=o,Math.abs(o)<It)return P}return P}function U1(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=Xg(this.es),this.ml0=_f(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function V1(u){var y=u.x,w=u.y,C=Bt(y-this.long0),P,D,E,o=Math.sin(w),B=Math.cos(w);if(this.es){var J=B*C,K=Math.pow(J,2),W=this.ep2*Math.pow(B,2),ee=Math.pow(W,2),we=Math.abs(B)>It?Math.tan(w):0,Oe=Math.pow(we,2),Ae=Math.pow(Oe,2);P=1-this.es*Math.pow(o,2),J=J/Math.sqrt(P);var Ze=_f(w,o,B,this.en);D=this.a*(this.k0*J*(1+K/6*(1-Oe+W+K/20*(5-18*Oe+Ae+14*W-58*Oe*W+K/42*(61+179*Ae-Ae*Oe-479*Oe)))))+this.x0,E=this.a*(this.k0*(Ze-this.ml0+o*C*J/2*(1+K/12*(5-Oe+9*W+4*ee+K/30*(61+Ae-58*Oe+270*W-330*Oe*W+K/56*(1385+543*Ae-Ae*Oe-3111*Oe))))))+this.y0}else{var j=B*Math.sin(C);if(Math.abs(Math.abs(j)-1)<It)return 93;if(D=.5*this.a*this.k0*Math.log((1+j)/(1-j))+this.x0,E=B*Math.cos(C)/Math.sqrt(1-Math.pow(j,2)),j=Math.abs(E),j>=1){if(j-1>It)return 93;E=0}else E=Math.acos(E);w<0&&(E=-E),E=this.a*this.k0*(E-this.lat0)+this.y0}return u.x=D,u.y=E,u}function q1(u){var y,w,C,P,D=(u.x-this.x0)*(1/this.a),E=(u.y-this.y0)*(1/this.a);if(this.es)if(y=this.ml0+E/this.k0,w=Yg(y,this.es,this.en),Math.abs(w)<_t){var K=Math.sin(w),W=Math.cos(w),ee=Math.abs(W)>It?Math.tan(w):0,we=this.ep2*Math.pow(W,2),Oe=Math.pow(we,2),Ae=Math.pow(ee,2),Ze=Math.pow(Ae,2);y=1-this.es*Math.pow(K,2);var Be=D*Math.sqrt(y)/this.k0,Ke=Math.pow(Be,2);y=y*ee,C=w-y*Ke/(1-this.es)*.5*(1-Ke/12*(5+3*Ae-9*we*Ae+we-4*Oe-Ke/30*(61+90*Ae-252*we*Ae+45*Ze+46*we-Ke/56*(1385+3633*Ae+4095*Ze+1574*Ze*Ae)))),P=Bt(this.long0+Be*(1-Ke/6*(1+2*Ae+we-Ke/20*(5+28*Ae+24*Ze+8*we*Ae+6*we-Ke/42*(61+662*Ae+1320*Ze+720*Ze*Ae))))/W)}else C=_t*Np(E),P=0;else{var o=Math.exp(D/this.k0),B=.5*(o-1/o),j=this.lat0+E/this.k0,J=Math.cos(j);y=Math.sqrt((1-Math.pow(J,2))/(1+Math.pow(B,2))),C=Math.asin(y),E<0&&(C=-C),B===0&&J===0?P=0:P=Bt(Math.atan2(B,J)+this.long0)}return u.x=P,u.y=C,u}var Z1=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const jm={init:U1,forward:V1,inverse:q1,names:Z1};function Sy(u){var y=Math.exp(u);return y=(y-1/y)/2,y}function Cs(u,y){u=Math.abs(u),y=Math.abs(y);var w=Math.max(u,y),C=Math.min(u,y)/(w||1);return w*Math.sqrt(1+Math.pow(C,2))}function $1(u){var y=1+u,w=y-1;return w===0?u:u*Math.log(y)/w}function H1(u){var y=Math.abs(u);return y=$1(y*(1+y/(Cs(1,y)+1))),u<0?-y:y}function Wg(u,y){for(var w=2*Math.cos(2*y),C=u.length-1,P=u[C],D=0,E;--C>=0;)E=-D+w*P+u[C],D=P,P=E;return y+E*Math.sin(2*y)}function X1(u,y){for(var w=2*Math.cos(y),C=u.length-1,P=u[C],D=0,E;--C>=0;)E=-D+w*P+u[C],D=P,P=E;return Math.sin(y)*E}function Y1(u){var y=Math.exp(u);return y=(y+1/y)/2,y}function My(u,y,w){for(var C=Math.sin(y),P=Math.cos(y),D=Sy(w),E=Y1(w),o=2*P*E,B=-2*C*D,j=u.length-1,J=u[j],K=0,W=0,ee=0,we,Oe;--j>=0;)we=W,Oe=K,W=J,K=ee,J=-we+o*W-B*K+u[j],ee=-Oe+B*W+o*K;return o=C*E,B=P*D,[o*J-B*ee,o*ee+B*J]}function W1(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(jm.init.apply(this),this.forward=jm.forward,this.inverse=jm.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var u=this.es/(1+Math.sqrt(1-this.es)),y=u/(2-u),w=y;this.cgb[0]=y*(2+y*(-2/3+y*(-2+y*(116/45+y*(26/45+y*(-2854/675)))))),this.cbg[0]=y*(-2+y*(2/3+y*(4/3+y*(-82/45+y*(32/45+y*(4642/4725)))))),w=w*y,this.cgb[1]=w*(7/3+y*(-8/5+y*(-227/45+y*(2704/315+y*(2323/945))))),this.cbg[1]=w*(5/3+y*(-16/15+y*(-13/9+y*(904/315+y*(-1522/945))))),w=w*y,this.cgb[2]=w*(56/15+y*(-136/35+y*(-1262/105+y*(73814/2835)))),this.cbg[2]=w*(-26/15+y*(34/21+y*(8/5+y*(-12686/2835)))),w=w*y,this.cgb[3]=w*(4279/630+y*(-332/35+y*(-399572/14175))),this.cbg[3]=w*(1237/630+y*(-12/5+y*(-24832/14175))),w=w*y,this.cgb[4]=w*(4174/315+y*(-144838/6237)),this.cbg[4]=w*(-734/315+y*(109598/31185)),w=w*y,this.cgb[5]=w*(601676/22275),this.cbg[5]=w*(444337/155925),w=Math.pow(y,2),this.Qn=this.k0/(1+y)*(1+w*(1/4+w*(1/64+w/256))),this.utg[0]=y*(-.5+y*(2/3+y*(-37/96+y*(1/360+y*(81/512+y*(-96199/604800)))))),this.gtu[0]=y*(.5+y*(-2/3+y*(5/16+y*(41/180+y*(-127/288+y*(7891/37800)))))),this.utg[1]=w*(-1/48+y*(-1/15+y*(437/1440+y*(-46/105+y*(1118711/3870720))))),this.gtu[1]=w*(13/48+y*(-3/5+y*(557/1440+y*(281/630+y*(-1983433/1935360))))),w=w*y,this.utg[2]=w*(-17/480+y*(37/840+y*(209/4480+y*(-5569/90720)))),this.gtu[2]=w*(61/240+y*(-103/140+y*(15061/26880+y*(167603/181440)))),w=w*y,this.utg[3]=w*(-4397/161280+y*(11/504+y*(830251/7257600))),this.gtu[3]=w*(49561/161280+y*(-179/168+y*(6601661/7257600))),w=w*y,this.utg[4]=w*(-4583/161280+y*(108847/3991680)),this.gtu[4]=w*(34729/80640+y*(-3418889/1995840)),w=w*y,this.utg[5]=w*(-20648693/638668800),this.gtu[5]=w*(212378941/319334400);var C=Wg(this.cbg,this.lat0);this.Zb=-this.Qn*(C+X1(this.gtu,2*C))}function Q1(u){var y=Bt(u.x-this.long0),w=u.y;w=Wg(this.cbg,w);var C=Math.sin(w),P=Math.cos(w),D=Math.sin(y),E=Math.cos(y);w=Math.atan2(C,E*P),y=Math.atan2(D*P,Cs(C,P*E)),y=H1(Math.tan(y));var o=My(this.gtu,2*w,2*y);w=w+o[0],y=y+o[1];var B,j;return Math.abs(y)<=2.623395162778?(B=this.a*(this.Qn*y)+this.x0,j=this.a*(this.Qn*w+this.Zb)+this.y0):(B=1/0,j=1/0),u.x=B,u.y=j,u}function K1(u){var y=(u.x-this.x0)*(1/this.a),w=(u.y-this.y0)*(1/this.a);w=(w-this.Zb)/this.Qn,y=y/this.Qn;var C,P;if(Math.abs(y)<=2.623395162778){var D=My(this.utg,2*w,2*y);w=w+D[0],y=y+D[1],y=Math.atan(Sy(y));var E=Math.sin(w),o=Math.cos(w),B=Math.sin(y),j=Math.cos(y);w=Math.atan2(E*j,Cs(B,j*o)),y=Math.atan2(B,j*o),C=Bt(y+this.long0),P=Wg(this.cgb,w)}else C=1/0,P=1/0;return u.x=C,u.y=P,u}var J1=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"];const Fm={init:W1,forward:Q1,inverse:K1,names:J1};function ex(u,y){if(u===void 0){if(u=Math.floor((Bt(y)+Math.PI)*30/Math.PI)+1,u<0)return 0;if(u>60)return 60}return u}var tx="etmerc";function ix(){var u=ex(this.zone,this.long0);if(u===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(u)-183)*Sr,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Fm.init.apply(this),this.forward=Fm.forward,this.inverse=Fm.inverse}var ax=["Universal Transverse Mercator System","utm"];const nx={init:ix,names:ax,dependsOn:tx};function Qg(u,y){return Math.pow((1-u)/(1+u),y)}var rx=20;function sx(){var u=Math.sin(this.lat0),y=Math.cos(this.lat0);y*=y,this.rc=Math.sqrt(1-this.es)/(1-this.es*u*u),this.C=Math.sqrt(1+this.es*y*y/(1-this.es)),this.phic0=Math.asin(u/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+ga)/(Math.pow(Math.tan(.5*this.lat0+ga),this.C)*Qg(this.e*u,this.ratexp))}function ox(u){var y=u.x,w=u.y;return u.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*w+ga),this.C)*Qg(this.e*Math.sin(w),this.ratexp))-_t,u.x=this.C*y,u}function lx(u){for(var y=1e-14,w=u.x/this.C,C=u.y,P=Math.pow(Math.tan(.5*C+ga)/this.K,1/this.C),D=rx;D>0&&(C=2*Math.atan(P*Qg(this.e*Math.sin(u.y),-.5*this.e))-_t,!(Math.abs(C-u.y)<y));--D)u.y=C;return D?(u.x=w,u.y=C,u):null}const Kg={init:sx,forward:ox,inverse:lx};function cx(){Kg.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function ux(u){var y,w,C,P;return u.x=Bt(u.x-this.long0),Kg.forward.apply(this,[u]),y=Math.sin(u.y),w=Math.cos(u.y),C=Math.cos(u.x),P=this.k0*this.R2/(1+this.sinc0*y+this.cosc0*w*C),u.x=P*w*Math.sin(u.x),u.y=P*(this.cosc0*y-this.sinc0*w*C),u.x=this.a*u.x+this.x0,u.y=this.a*u.y+this.y0,u}function hx(u){var y,w,C,P,D;if(u.x=(u.x-this.x0)/this.a,u.y=(u.y-this.y0)/this.a,u.x/=this.k0,u.y/=this.k0,D=Cs(u.x,u.y)){var E=2*Math.atan2(D,this.R2);y=Math.sin(E),w=Math.cos(E),P=Math.asin(w*this.sinc0+u.y*y*this.cosc0/D),C=Math.atan2(u.x*y,D*this.cosc0*w-u.y*this.sinc0*y)}else P=this.phic0,C=0;return u.x=C,u.y=P,Kg.inverse.apply(this,[u]),u.x=Bt(u.x+this.long0),u}var dx=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const fx={init:cx,forward:ux,inverse:hx,names:dx};function Jg(u,y,w){return y*=w,Math.tan(.5*(_t+u))*Math.pow((1-y)/(1+y),.5*w)}function px(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=It&&(this.k0=.5*(1+Np(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=It&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=It&&Math.abs(Math.cos(this.lat_ts))>It&&(this.k0=.5*this.cons*hc(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Tl(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=hc(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(Jg(this.lat0,this.sinlat0,this.e))-_t,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function mx(u){var y=u.x,w=u.y,C=Math.sin(w),P=Math.cos(w),D,E,o,B,j,J,K=Bt(y-this.long0);return Math.abs(Math.abs(y-this.long0)-Math.PI)<=It&&Math.abs(w+this.lat0)<=It?(u.x=NaN,u.y=NaN,u):this.sphere?(D=2*this.k0/(1+this.sinlat0*C+this.coslat0*P*Math.cos(K)),u.x=this.a*D*P*Math.sin(K)+this.x0,u.y=this.a*D*(this.coslat0*C-this.sinlat0*P*Math.cos(K))+this.y0,u):(E=2*Math.atan(Jg(w,C,this.e))-_t,B=Math.cos(E),o=Math.sin(E),Math.abs(this.coslat0)<=It?(j=Tl(this.e,w*this.con,this.con*C),J=2*this.a*this.k0*j/this.cons,u.x=this.x0+J*Math.sin(y-this.long0),u.y=this.y0-this.con*J*Math.cos(y-this.long0),u):(Math.abs(this.sinlat0)<It?(D=2*this.a*this.k0/(1+B*Math.cos(K)),u.y=D*o):(D=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*o+this.cosX0*B*Math.cos(K))),u.y=D*(this.cosX0*o-this.sinX0*B*Math.cos(K))+this.y0),u.x=D*B*Math.sin(K)+this.x0,u))}function gx(u){u.x-=this.x0,u.y-=this.y0;var y,w,C,P,D,E=Math.sqrt(u.x*u.x+u.y*u.y);if(this.sphere){var o=2*Math.atan(E/(2*this.a*this.k0));return y=this.long0,w=this.lat0,E<=It?(u.x=y,u.y=w,u):(w=Math.asin(Math.cos(o)*this.sinlat0+u.y*Math.sin(o)*this.coslat0/E),Math.abs(this.coslat0)<It?this.lat0>0?y=Bt(this.long0+Math.atan2(u.x,-1*u.y)):y=Bt(this.long0+Math.atan2(u.x,u.y)):y=Bt(this.long0+Math.atan2(u.x*Math.sin(o),E*this.coslat0*Math.cos(o)-u.y*this.sinlat0*Math.sin(o))),u.x=y,u.y=w,u)}else if(Math.abs(this.coslat0)<=It){if(E<=It)return w=this.lat0,y=this.long0,u.x=y,u.y=w,u;u.x*=this.con,u.y*=this.con,C=E*this.cons/(2*this.a*this.k0),w=this.con*Dp(this.e,C),y=this.con*Bt(this.con*this.long0+Math.atan2(u.x,-1*u.y))}else P=2*Math.atan(E*this.cosX0/(2*this.a*this.k0*this.ms1)),y=this.long0,E<=It?D=this.X0:(D=Math.asin(Math.cos(P)*this.sinX0+u.y*Math.sin(P)*this.cosX0/E),y=Bt(this.long0+Math.atan2(u.x*Math.sin(P),E*this.cosX0*Math.cos(P)-u.y*this.sinX0*Math.sin(P)))),w=-1*Dp(this.e,Math.tan(.5*(_t+D)));return u.x=y,u.y=w,u}var _x=["stere","Stereographic_South_Pole","Polar_Stereographic_variant_A","Polar_Stereographic_variant_B","Polar_Stereographic"];const yx={init:px,forward:mx,inverse:gx,names:_x,ssfn_:Jg};function vx(){var u=this.lat0;this.lambda0=this.long0;var y=Math.sin(u),w=this.a,C=this.rf,P=1/C,D=2*P-Math.pow(P,2),E=this.e=Math.sqrt(D);this.R=this.k0*w*Math.sqrt(1-D)/(1-D*Math.pow(y,2)),this.alpha=Math.sqrt(1+D/(1-D)*Math.pow(Math.cos(u),4)),this.b0=Math.asin(y/this.alpha);var o=Math.log(Math.tan(Math.PI/4+this.b0/2)),B=Math.log(Math.tan(Math.PI/4+u/2)),j=Math.log((1+E*y)/(1-E*y));this.K=o-this.alpha*B+this.alpha*E/2*j}function xx(u){var y=Math.log(Math.tan(Math.PI/4-u.y/2)),w=this.e/2*Math.log((1+this.e*Math.sin(u.y))/(1-this.e*Math.sin(u.y))),C=-this.alpha*(y+w)+this.K,P=2*(Math.atan(Math.exp(C))-Math.PI/4),D=this.alpha*(u.x-this.lambda0),E=Math.atan(Math.sin(D)/(Math.sin(this.b0)*Math.tan(P)+Math.cos(this.b0)*Math.cos(D))),o=Math.asin(Math.cos(this.b0)*Math.sin(P)-Math.sin(this.b0)*Math.cos(P)*Math.cos(D));return u.y=this.R/2*Math.log((1+Math.sin(o))/(1-Math.sin(o)))+this.y0,u.x=this.R*E+this.x0,u}function bx(u){for(var y=u.x-this.x0,w=u.y-this.y0,C=y/this.R,P=2*(Math.atan(Math.exp(w/this.R))-Math.PI/4),D=Math.asin(Math.cos(this.b0)*Math.sin(P)+Math.sin(this.b0)*Math.cos(P)*Math.cos(C)),E=Math.atan(Math.sin(C)/(Math.cos(this.b0)*Math.cos(C)-Math.sin(this.b0)*Math.tan(P))),o=this.lambda0+E/this.alpha,B=0,j=D,J=-1e3,K=0;Math.abs(j-J)>1e-7;){if(++K>20)return;B=1/this.alpha*(Math.log(Math.tan(Math.PI/4+D/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(j))/2)),J=j,j=2*Math.atan(Math.exp(B))-Math.PI/2}return u.x=o,u.y=j,u}var wx=["somerc"];const Sx={init:vx,forward:xx,inverse:bx,names:wx};var of=1e-7;function Mx(u){var y=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_variant_A","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],w=typeof u.projName=="object"?Object.keys(u.projName)[0]:u.projName;return"no_uoff"in u||"no_off"in u||y.indexOf(w)!==-1||y.indexOf(dy(w))!==-1}function Tx(){var u,y,w,C,P,D,E,o,B,j,J=0,K,W=0,ee=0,we=0,Oe=0,Ae=0,Ze=0;this.no_off=Mx(this),this.no_rot="no_rot"in this;var Be=!1;"alpha"in this&&(Be=!0);var Ke=!1;if("rectified_grid_angle"in this&&(Ke=!0),Be&&(Ze=this.alpha),Ke&&(J=this.rectified_grid_angle),Be||Ke)W=this.longc;else if(ee=this.long1,Oe=this.lat1,we=this.long2,Ae=this.lat2,Math.abs(Oe-Ae)<=of||(u=Math.abs(Oe))<=of||Math.abs(u-_t)<=of||Math.abs(Math.abs(this.lat0)-_t)<=of||Math.abs(Math.abs(Ae)-_t)<=of)throw new Error;var vt=1-this.es;y=Math.sqrt(vt),Math.abs(this.lat0)>It?(o=Math.sin(this.lat0),w=Math.cos(this.lat0),u=1-this.es*o*o,this.B=w*w,this.B=Math.sqrt(1+this.es*this.B*this.B/vt),this.A=this.B*this.k0*y/u,C=this.B*y/(w*Math.sqrt(u)),P=C*C-1,P<=0?P=0:(P=Math.sqrt(P),this.lat0<0&&(P=-P)),this.E=P+=C,this.E*=Math.pow(Tl(this.e,this.lat0,o),this.B)):(this.B=1/y,this.A=this.k0,this.E=C=P=1),Be||Ke?(Be?(K=Math.asin(Math.sin(Ze)/C),Ke||(J=Ze)):(K=J,Ze=Math.asin(C*Math.sin(K))),this.lam0=W-Math.asin(.5*(P-1/P)*Math.tan(K))/this.B):(D=Math.pow(Tl(this.e,Oe,Math.sin(Oe)),this.B),E=Math.pow(Tl(this.e,Ae,Math.sin(Ae)),this.B),P=this.E/D,B=(E-D)/(E+D),j=this.E*this.E,j=(j-E*D)/(j+E*D),u=ee-we,u<-Math.PI?we-=Ip:u>Math.PI&&(we+=Ip),this.lam0=Bt(.5*(ee+we)-Math.atan(j*Math.tan(.5*this.B*(ee-we))/B)/this.B),K=Math.atan(2*Math.sin(this.B*Bt(ee-this.lam0))/(P-1/P)),J=Ze=Math.asin(C*Math.sin(K))),this.singam=Math.sin(K),this.cosgam=Math.cos(K),this.sinrot=Math.sin(J),this.cosrot=Math.cos(J),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(C*C-1)/Math.cos(Ze))),this.lat0<0&&(this.u_0=-this.u_0)),P=.5*K,this.v_pole_n=this.ArB*Math.log(Math.tan(ga-P)),this.v_pole_s=this.ArB*Math.log(Math.tan(ga+P))}function Ex(u){var y={},w,C,P,D,E,o,B,j;if(u.x=u.x-this.lam0,Math.abs(Math.abs(u.y)-_t)>It){if(E=this.E/Math.pow(Tl(this.e,u.y,Math.sin(u.y)),this.B),o=1/E,w=.5*(E-o),C=.5*(E+o),D=Math.sin(this.B*u.x),P=(w*this.singam-D*this.cosgam)/C,Math.abs(Math.abs(P)-1)<It)throw new Error;j=.5*this.ArB*Math.log((1-P)/(1+P)),o=Math.cos(this.B*u.x),Math.abs(o)<of?B=this.A*u.x:B=this.ArB*Math.atan2(w*this.cosgam+D*this.singam,o)}else j=u.y>0?this.v_pole_n:this.v_pole_s,B=this.ArB*u.y;return this.no_rot?(y.x=B,y.y=j):(B-=this.u_0,y.x=j*this.cosrot+B*this.sinrot,y.y=B*this.cosrot-j*this.sinrot),y.x=this.a*y.x+this.x0,y.y=this.a*y.y+this.y0,y}function Cx(u){var y,w,C,P,D,E,o,B={};if(u.x=(u.x-this.x0)*(1/this.a),u.y=(u.y-this.y0)*(1/this.a),this.no_rot?(w=u.y,y=u.x):(w=u.x*this.cosrot-u.y*this.sinrot,y=u.y*this.cosrot+u.x*this.sinrot+this.u_0),C=Math.exp(-this.BrA*w),P=.5*(C-1/C),D=.5*(C+1/C),E=Math.sin(this.BrA*y),o=(E*this.cosgam+P*this.singam)/D,Math.abs(Math.abs(o)-1)<It)B.x=0,B.y=o<0?-_t:_t;else{if(B.y=this.E/Math.sqrt((1+o)/(1-o)),B.y=Dp(this.e,Math.pow(B.y,1/this.B)),B.y===1/0)throw new Error;B.x=-this.rB*Math.atan2(P*this.cosgam-E*this.singam,Math.cos(this.BrA*y))}return B.x+=this.lam0,B}var Ax=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_variant_A","Hotine_Oblique_Mercator_Variant_B","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const Px={init:Tx,forward:Ex,inverse:Cx,names:Ax};function zx(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<It)){var u=this.b/this.a;this.e=Math.sqrt(1-u*u);var y=Math.sin(this.lat1),w=Math.cos(this.lat1),C=hc(this.e,y,w),P=Tl(this.e,this.lat1,y),D=Math.sin(this.lat2),E=Math.cos(this.lat2),o=hc(this.e,D,E),B=Tl(this.e,this.lat2,D),j=Math.abs(Math.abs(this.lat0)-_t)<It?0:Tl(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>It?this.ns=Math.log(C/o)/Math.log(P/B):this.ns=y,isNaN(this.ns)&&(this.ns=y),this.f0=C/(this.ns*Math.pow(P,this.ns)),this.rh=this.a*this.f0*Math.pow(j,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function Ix(u){var y=u.x,w=u.y;Math.abs(2*Math.abs(w)-Math.PI)<=It&&(w=Np(w)*(_t-2*It));var C=Math.abs(Math.abs(w)-_t),P,D;if(C>It)P=Tl(this.e,w,Math.sin(w)),D=this.a*this.f0*Math.pow(P,this.ns);else{if(C=w*this.ns,C<=0)return null;D=0}var E=this.ns*Bt(y-this.long0);return u.x=this.k0*(D*Math.sin(E))+this.x0,u.y=this.k0*(this.rh-D*Math.cos(E))+this.y0,u}function Rx(u){var y,w,C,P,D,E=(u.x-this.x0)/this.k0,o=this.rh-(u.y-this.y0)/this.k0;this.ns>0?(y=Math.sqrt(E*E+o*o),w=1):(y=-Math.sqrt(E*E+o*o),w=-1);var B=0;if(y!==0&&(B=Math.atan2(w*E,w*o)),y!==0||this.ns>0){if(w=1/this.ns,C=Math.pow(y/(this.a*this.f0),w),P=Dp(this.e,C),P===-9999)return null}else P=-_t;return D=Bt(B/this.ns+this.long0),u.x=D,u.y=P,u}var Dx=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const kx={init:zx,forward:Ix,inverse:Rx,names:Dx};function Lx(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function Ox(u){var y,w,C,P,D,E,o,B=u.x,j=u.y,J=Bt(B-this.long0);return y=Math.pow((1+this.e*Math.sin(j))/(1-this.e*Math.sin(j)),this.alfa*this.e/2),w=2*(Math.atan(this.k*Math.pow(Math.tan(j/2+this.s45),this.alfa)/y)-this.s45),C=-J*this.alfa,P=Math.asin(Math.cos(this.ad)*Math.sin(w)+Math.sin(this.ad)*Math.cos(w)*Math.cos(C)),D=Math.asin(Math.cos(w)*Math.sin(C)/Math.cos(P)),E=this.n*D,o=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(P/2+this.s45),this.n),u.y=o*Math.cos(E)/1,u.x=o*Math.sin(E)/1,this.czech||(u.y*=-1,u.x*=-1),u}function Bx(u){var y,w,C,P,D,E,o,B,j=u.x;u.x=u.y,u.y=j,this.czech||(u.y*=-1,u.x*=-1),E=Math.sqrt(u.x*u.x+u.y*u.y),D=Math.atan2(u.y,u.x),P=D/Math.sin(this.s0),C=2*(Math.atan(Math.pow(this.ro0/E,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),y=Math.asin(Math.cos(this.ad)*Math.sin(C)-Math.sin(this.ad)*Math.cos(C)*Math.cos(P)),w=Math.asin(Math.cos(C)*Math.sin(P)/Math.cos(y)),u.x=this.long0-w/this.alfa,o=y,B=0;var J=0;do u.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(y/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(o))/(1-this.e*Math.sin(o)),this.e/2))-this.s45),Math.abs(o-u.y)<1e-10&&(B=1),o=u.y,J+=1;while(B===0&&J<15);return J>=15?null:u}var Nx=["Krovak","krovak"];const jx={init:Lx,forward:Ox,inverse:Bx,names:Nx};function ss(u,y,w,C,P){return u*P-y*Math.sin(2*P)+w*Math.sin(4*P)-C*Math.sin(6*P)}function jp(u){return 1-.25*u*(1+u/16*(3+1.25*u))}function Fp(u){return .375*u*(1+.25*u*(1+.46875*u))}function Gp(u){return .05859375*u*u*(1+.75*u)}function Up(u){return u*u*u*(35/3072)}function e_(u,y,w){var C=y*w;return u/Math.sqrt(1-C*C)}function ih(u){return Math.abs(u)<_t?u:u-Np(u)*Math.PI}function Hm(u,y,w,C,P){var D,E;D=u/y;for(var o=0;o<15;o++)if(E=(u-(y*D-w*Math.sin(2*D)+C*Math.sin(4*D)-P*Math.sin(6*D)))/(y-2*w*Math.cos(2*D)+4*C*Math.cos(4*D)-6*P*Math.cos(6*D)),D+=E,Math.abs(E)<=1e-10)return D;return NaN}function Fx(){this.sphere||(this.e0=jp(this.es),this.e1=Fp(this.es),this.e2=Gp(this.es),this.e3=Up(this.es),this.ml0=this.a*ss(this.e0,this.e1,this.e2,this.e3,this.lat0))}function Gx(u){var y,w,C=u.x,P=u.y;if(C=Bt(C-this.long0),this.sphere)y=this.a*Math.asin(Math.cos(P)*Math.sin(C)),w=this.a*(Math.atan2(Math.tan(P),Math.cos(C))-this.lat0);else{var D=Math.sin(P),E=Math.cos(P),o=e_(this.a,this.e,D),B=Math.tan(P)*Math.tan(P),j=C*Math.cos(P),J=j*j,K=this.es*E*E/(1-this.es),W=this.a*ss(this.e0,this.e1,this.e2,this.e3,P);y=o*j*(1-J*B*(1/6-(8-B+8*K)*J/120)),w=W-this.ml0+o*D/E*J*(.5+(5-B+6*K)*J/24)}return u.x=y+this.x0,u.y=w+this.y0,u}function Ux(u){u.x-=this.x0,u.y-=this.y0;var y=u.x/this.a,w=u.y/this.a,C,P;if(this.sphere){var D=w+this.lat0;C=Math.asin(Math.sin(D)*Math.cos(y)),P=Math.atan2(Math.tan(y),Math.cos(D))}else{var E=this.ml0/this.a+w,o=Hm(E,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(o)-_t)<=It)return u.x=this.long0,u.y=_t,w<0&&(u.y*=-1),u;var B=e_(this.a,this.e,Math.sin(o)),j=B*B*B/this.a/this.a*(1-this.es),J=Math.pow(Math.tan(o),2),K=y*this.a/B,W=K*K;C=o-B*Math.tan(o)/j*K*K*(.5-(1+3*J)*K*K/24),P=K*(1-W*(J/3+(1+3*J)*J*W/15))/Math.cos(o)}return u.x=Bt(P+this.long0),u.y=ih(C),u}var Vx=["Cassini","Cassini_Soldner","cass"];const qx={init:Fx,forward:Gx,inverse:Ux,names:Vx};function Ju(u,y){var w;return u>1e-7?(w=u*y,(1-u*u)*(y/(1-w*w)-.5/u*Math.log((1-w)/(1+w)))):2*y}var Dg=1,kg=2,Lg=3,Gm=4;function Zx(){var u=Math.abs(this.lat0);if(Math.abs(u-_t)<It?this.mode=this.lat0<0?Dg:kg:Math.abs(u)<It?this.mode=Lg:this.mode=Gm,this.es>0){var y;switch(this.qp=Ju(this.e,1),this.mmf=.5/(1-this.es),this.apa=eb(this.es),this.mode){case kg:this.dd=1;break;case Dg:this.dd=1;break;case Lg:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case Gm:this.rq=Math.sqrt(.5*this.qp),y=Math.sin(this.lat0),this.sinb1=Ju(this.e,y)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*y*y)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===Gm&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function $x(u){var y,w,C,P,D,E,o,B,j,J,K=u.x,W=u.y;if(K=Bt(K-this.long0),this.sphere){if(D=Math.sin(W),J=Math.cos(W),C=Math.cos(K),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(w=this.mode===this.EQUIT?1+J*C:1+this.sinph0*D+this.cosph0*J*C,w<=It)return null;w=Math.sqrt(2/w),y=w*J*Math.sin(K),w*=this.mode===this.EQUIT?D:this.cosph0*D-this.sinph0*J*C}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(C=-C),Math.abs(W+this.lat0)<It)return null;w=ga-W*.5,w=2*(this.mode===this.S_POLE?Math.cos(w):Math.sin(w)),y=w*Math.sin(K),w*=C}}else{switch(o=0,B=0,j=0,C=Math.cos(K),P=Math.sin(K),D=Math.sin(W),E=Ju(this.e,D),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(o=E/this.qp,B=Math.sqrt(1-o*o)),this.mode){case this.OBLIQ:j=1+this.sinb1*o+this.cosb1*B*C;break;case this.EQUIT:j=1+B*C;break;case this.N_POLE:j=_t+W,E=this.qp-E;break;case this.S_POLE:j=W-_t,E=this.qp+E;break}if(Math.abs(j)<It)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:j=Math.sqrt(2/j),this.mode===this.OBLIQ?w=this.ymf*j*(this.cosb1*o-this.sinb1*B*C):w=(j=Math.sqrt(2/(1+B*C)))*o*this.ymf,y=this.xmf*j*B*P;break;case this.N_POLE:case this.S_POLE:E>=0?(y=(j=Math.sqrt(E))*P,w=C*(this.mode===this.S_POLE?j:-j)):y=w=0;break}}return u.x=this.a*y+this.x0,u.y=this.a*w+this.y0,u}function Hx(u){u.x-=this.x0,u.y-=this.y0;var y=u.x/this.a,w=u.y/this.a,C,P,D,E,o,B,j;if(this.sphere){var J=0,K,W=0;if(K=Math.sqrt(y*y+w*w),P=K*.5,P>1)return null;switch(P=2*Math.asin(P),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(W=Math.sin(P),J=Math.cos(P)),this.mode){case this.EQUIT:P=Math.abs(K)<=It?0:Math.asin(w*W/K),y*=W,w=J*K;break;case this.OBLIQ:P=Math.abs(K)<=It?this.lat0:Math.asin(J*this.sinph0+w*W*this.cosph0/K),y*=W*this.cosph0,w=(J-Math.sin(P)*this.sinph0)*K;break;case this.N_POLE:w=-w,P=_t-P;break;case this.S_POLE:P-=_t;break}C=w===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(y,w)}else{if(j=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(y/=this.dd,w*=this.dd,B=Math.sqrt(y*y+w*w),B<It)return u.x=this.long0,u.y=this.lat0,u;E=2*Math.asin(.5*B/this.rq),D=Math.cos(E),y*=E=Math.sin(E),this.mode===this.OBLIQ?(j=D*this.sinb1+w*E*this.cosb1/B,o=this.qp*j,w=B*this.cosb1*D-w*this.sinb1*E):(j=w*E/B,o=this.qp*j,w=B*D)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(w=-w),o=y*y+w*w,!o)return u.x=this.long0,u.y=this.lat0,u;j=1-o/this.qp,this.mode===this.S_POLE&&(j=-j)}C=Math.atan2(y,w),P=tb(Math.asin(j),this.apa)}return u.x=Bt(this.long0+C),u.y=P,u}var Xx=.3333333333333333,Yx=.17222222222222222,Wx=.10257936507936508,Qx=.06388888888888888,Kx=.0664021164021164,Jx=.016415012942191543;function eb(u){var y,w=[];return w[0]=u*Xx,y=u*u,w[0]+=y*Yx,w[1]=y*Qx,y*=u,w[0]+=y*Wx,w[1]+=y*Kx,w[2]=y*Jx,w}function tb(u,y){var w=u+u;return u+y[0]*Math.sin(w)+y[1]*Math.sin(w+w)+y[2]*Math.sin(w+w+w)}var ib=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const ab={init:Zx,forward:$x,inverse:Hx,names:ib,S_POLE:Dg,N_POLE:kg,EQUIT:Lg,OBLIQ:Gm};function th(u){return Math.abs(u)>1&&(u=u>1?1:-1),Math.asin(u)}function nb(){Math.abs(this.lat1+this.lat2)<It||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=hc(this.e3,this.sin_po,this.cos_po),this.qs1=Ju(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=hc(this.e3,this.sin_po,this.cos_po),this.qs2=Ju(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=Ju(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>It?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function rb(u){var y=u.x,w=u.y;this.sin_phi=Math.sin(w),this.cos_phi=Math.cos(w);var C=Ju(this.e3,this.sin_phi),P=this.a*Math.sqrt(this.c-this.ns0*C)/this.ns0,D=this.ns0*Bt(y-this.long0),E=P*Math.sin(D)+this.x0,o=this.rh-P*Math.cos(D)+this.y0;return u.x=E,u.y=o,u}function sb(u){var y,w,C,P,D,E;return u.x-=this.x0,u.y=this.rh-u.y+this.y0,this.ns0>=0?(y=Math.sqrt(u.x*u.x+u.y*u.y),C=1):(y=-Math.sqrt(u.x*u.x+u.y*u.y),C=-1),P=0,y!==0&&(P=Math.atan2(C*u.x,C*u.y)),C=y*this.ns0/this.a,this.sphere?E=Math.asin((this.c-C*C)/(2*this.ns0)):(w=(this.c-C*C)/this.ns0,E=this.phi1z(this.e3,w)),D=Bt(P/this.ns0+this.long0),u.x=D,u.y=E,u}function ob(u,y){var w,C,P,D,E,o=th(.5*y);if(u<It)return o;for(var B=u*u,j=1;j<=25;j++)if(w=Math.sin(o),C=Math.cos(o),P=u*w,D=1-P*P,E=.5*D*D/C*(y/(1-B)-w/D+.5/u*Math.log((1-P)/(1+P))),o=o+E,Math.abs(E)<=1e-7)return o;return null}var lb=["Albers_Conic_Equal_Area","Albers_Equal_Area","Albers","aea"];const cb={init:nb,forward:rb,inverse:sb,names:lb,phi1z:ob};function ub(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function hb(u){var y,w,C,P,D,E,o,B,j=u.x,J=u.y;return C=Bt(j-this.long0),y=Math.sin(J),w=Math.cos(J),P=Math.cos(C),E=this.sin_p14*y+this.cos_p14*w*P,D=1,E>0||Math.abs(E)<=It?(o=this.x0+this.a*D*w*Math.sin(C)/E,B=this.y0+this.a*D*(this.cos_p14*y-this.sin_p14*w*P)/E):(o=this.x0+this.infinity_dist*w*Math.sin(C),B=this.y0+this.infinity_dist*(this.cos_p14*y-this.sin_p14*w*P)),u.x=o,u.y=B,u}function db(u){var y,w,C,P,D,E;return u.x=(u.x-this.x0)/this.a,u.y=(u.y-this.y0)/this.a,u.x/=this.k0,u.y/=this.k0,(y=Math.sqrt(u.x*u.x+u.y*u.y))?(P=Math.atan2(y,this.rc),w=Math.sin(P),C=Math.cos(P),E=th(C*this.sin_p14+u.y*w*this.cos_p14/y),D=Math.atan2(u.x*w,y*this.cos_p14*C-u.y*this.sin_p14*w),D=Bt(this.long0+D)):(E=this.phic0,D=0),u.x=D,u.y=E,u}var fb=["gnom"];const pb={init:ub,forward:hb,inverse:db,names:fb};function mb(u,y){var w=1-(1-u*u)/(2*u)*Math.log((1-u)/(1+u));if(Math.abs(Math.abs(y)-w)<1e-6)return y<0?-1*_t:_t;for(var C=Math.asin(.5*y),P,D,E,o,B=0;B<30;B++)if(D=Math.sin(C),E=Math.cos(C),o=u*D,P=Math.pow(1-o*o,2)/(2*E)*(y/(1-u*u)-D/(1-o*o)+.5/u*Math.log((1-o)/(1+o))),C+=P,Math.abs(P)<=1e-10)return C;return NaN}function gb(){this.sphere||(this.k0=hc(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function _b(u){var y=u.x,w=u.y,C,P,D=Bt(y-this.long0);if(this.sphere)C=this.x0+this.a*D*Math.cos(this.lat_ts),P=this.y0+this.a*Math.sin(w)/Math.cos(this.lat_ts);else{var E=Ju(this.e,Math.sin(w));C=this.x0+this.a*this.k0*D,P=this.y0+this.a*E*.5/this.k0}return u.x=C,u.y=P,u}function yb(u){u.x-=this.x0,u.y-=this.y0;var y,w;return this.sphere?(y=Bt(this.long0+u.x/this.a/Math.cos(this.lat_ts)),w=Math.asin(u.y/this.a*Math.cos(this.lat_ts))):(w=mb(this.e,2*u.y*this.k0/this.a),y=Bt(this.long0+u.x/(this.a*this.k0))),u.x=y,u.y=w,u}var vb=["cea"];const xb={init:gb,forward:_b,inverse:yb,names:vb};function bb(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function wb(u){var y=u.x,w=u.y,C=Bt(y-this.long0),P=ih(w-this.lat0);return u.x=this.x0+this.a*C*this.rc,u.y=this.y0+this.a*P,u}function Sb(u){var y=u.x,w=u.y;return u.x=Bt(this.long0+(y-this.x0)/(this.a*this.rc)),u.y=ih(this.lat0+(w-this.y0)/this.a),u}var Mb=["Equirectangular","Equidistant_Cylindrical","Equidistant_Cylindrical_Spherical","eqc"];const Tb={init:bb,forward:wb,inverse:Sb,names:Mb};var O_=20;function Eb(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=jp(this.es),this.e1=Fp(this.es),this.e2=Gp(this.es),this.e3=Up(this.es),this.ml0=this.a*ss(this.e0,this.e1,this.e2,this.e3,this.lat0)}function Cb(u){var y=u.x,w=u.y,C,P,D,E=Bt(y-this.long0);if(D=E*Math.sin(w),this.sphere)Math.abs(w)<=It?(C=this.a*E,P=-1*this.a*this.lat0):(C=this.a*Math.sin(D)/Math.tan(w),P=this.a*(ih(w-this.lat0)+(1-Math.cos(D))/Math.tan(w)));else if(Math.abs(w)<=It)C=this.a*E,P=-1*this.ml0;else{var o=e_(this.a,this.e,Math.sin(w))/Math.tan(w);C=o*Math.sin(D),P=this.a*ss(this.e0,this.e1,this.e2,this.e3,w)-this.ml0+o*(1-Math.cos(D))}return u.x=C+this.x0,u.y=P+this.y0,u}function Ab(u){var y,w,C,P,D,E,o,B,j;if(C=u.x-this.x0,P=u.y-this.y0,this.sphere)if(Math.abs(P+this.a*this.lat0)<=It)y=Bt(C/this.a+this.long0),w=0;else{E=this.lat0+P/this.a,o=C*C/this.a/this.a+E*E,B=E;var J;for(D=O_;D;--D)if(J=Math.tan(B),j=-1*(E*(B*J+1)-B-.5*(B*B+o)*J)/((B-E)/J-1),B+=j,Math.abs(j)<=It){w=B;break}y=Bt(this.long0+Math.asin(C*Math.tan(B)/this.a)/Math.sin(w))}else if(Math.abs(P+this.ml0)<=It)w=0,y=Bt(this.long0+C/this.a);else{E=(this.ml0+P)/this.a,o=C*C/this.a/this.a+E*E,B=E;var K,W,ee,we,Oe;for(D=O_;D;--D)if(Oe=this.e*Math.sin(B),K=Math.sqrt(1-Oe*Oe)*Math.tan(B),W=this.a*ss(this.e0,this.e1,this.e2,this.e3,B),ee=this.e0-2*this.e1*Math.cos(2*B)+4*this.e2*Math.cos(4*B)-6*this.e3*Math.cos(6*B),we=W/this.a,j=(E*(K*we+1)-we-.5*K*(we*we+o))/(this.es*Math.sin(2*B)*(we*we+o-2*E*we)/(4*K)+(E-we)*(K*ee-2/Math.sin(2*B))-ee),B-=j,Math.abs(j)<=It){w=B;break}K=Math.sqrt(1-this.es*Math.pow(Math.sin(w),2))*Math.tan(w),y=Bt(this.long0+Math.asin(C*K/this.a)/Math.sin(w))}return u.x=y,u.y=w,u}var Pb=["Polyconic","American_Polyconic","poly"];const zb={init:Eb,forward:Cb,inverse:Ab,names:Pb};function Ib(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function Rb(u){var y,w=u.x,C=u.y,P=C-this.lat0,D=w-this.long0,E=P/Tp*1e-5,o=D,B=1,j=0;for(y=1;y<=10;y++)B=B*E,j=j+this.A[y]*B;var J=j,K=o,W=1,ee=0,we,Oe,Ae=0,Ze=0;for(y=1;y<=6;y++)we=W*J-ee*K,Oe=ee*J+W*K,W=we,ee=Oe,Ae=Ae+this.B_re[y]*W-this.B_im[y]*ee,Ze=Ze+this.B_im[y]*W+this.B_re[y]*ee;return u.x=Ze*this.a+this.x0,u.y=Ae*this.a+this.y0,u}function Db(u){var y,w=u.x,C=u.y,P=w-this.x0,D=C-this.y0,E=D/this.a,o=P/this.a,B=1,j=0,J,K,W=0,ee=0;for(y=1;y<=6;y++)J=B*E-j*o,K=j*E+B*o,B=J,j=K,W=W+this.C_re[y]*B-this.C_im[y]*j,ee=ee+this.C_im[y]*B+this.C_re[y]*j;for(var we=0;we<this.iterations;we++){var Oe=W,Ae=ee,Ze,Be,Ke=E,vt=o;for(y=2;y<=6;y++)Ze=Oe*W-Ae*ee,Be=Ae*W+Oe*ee,Oe=Ze,Ae=Be,Ke=Ke+(y-1)*(this.B_re[y]*Oe-this.B_im[y]*Ae),vt=vt+(y-1)*(this.B_im[y]*Oe+this.B_re[y]*Ae);Oe=1,Ae=0;var Et=this.B_re[1],xt=this.B_im[1];for(y=2;y<=6;y++)Ze=Oe*W-Ae*ee,Be=Ae*W+Oe*ee,Oe=Ze,Ae=Be,Et=Et+y*(this.B_re[y]*Oe-this.B_im[y]*Ae),xt=xt+y*(this.B_im[y]*Oe+this.B_re[y]*Ae);var lt=Et*Et+xt*xt;W=(Ke*Et+vt*xt)/lt,ee=(vt*Et-Ke*xt)/lt}var xe=W,Se=ee,Ye=1,mt=0;for(y=1;y<=9;y++)Ye=Ye*xe,mt=mt+this.D[y]*Ye;var gt=this.lat0+mt*Tp*1e5,Gt=this.long0+Se;return u.x=Gt,u.y=gt,u}var kb=["New_Zealand_Map_Grid","nzmg"];const Lb={init:Ib,forward:Rb,inverse:Db,names:kb};function Ob(){}function Bb(u){var y=u.x,w=u.y,C=Bt(y-this.long0),P=this.x0+this.a*C,D=this.y0+this.a*Math.log(Math.tan(Math.PI/4+w/2.5))*1.25;return u.x=P,u.y=D,u}function Nb(u){u.x-=this.x0,u.y-=this.y0;var y=Bt(this.long0+u.x/this.a),w=2.5*(Math.atan(Math.exp(.8*u.y/this.a))-Math.PI/4);return u.x=y,u.y=w,u}var jb=["Miller_Cylindrical","mill"];const Fb={init:Ob,forward:Bb,inverse:Nb,names:jb};var Gb=20;function Ub(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=Xg(this.es)}function Vb(u){var y,w,C=u.x,P=u.y;if(C=Bt(C-this.long0),this.sphere){if(!this.m)P=this.n!==1?Math.asin(this.n*Math.sin(P)):P;else for(var D=this.n*Math.sin(P),E=Gb;E;--E){var o=(this.m*P+Math.sin(P)-D)/(this.m+Math.cos(P));if(P-=o,Math.abs(o)<It)break}y=this.a*this.C_x*C*(this.m+Math.cos(P)),w=this.a*this.C_y*P}else{var B=Math.sin(P),j=Math.cos(P);w=this.a*_f(P,B,j,this.en),y=this.a*C*j/Math.sqrt(1-this.es*B*B)}return u.x=y,u.y=w,u}function qb(u){var y,w,C,P;return u.x-=this.x0,C=u.x/this.a,u.y-=this.y0,y=u.y/this.a,this.sphere?(y/=this.C_y,C=C/(this.C_x*(this.m+Math.cos(y))),this.m?y=th((this.m*y+Math.sin(y))/this.n):this.n!==1&&(y=th(Math.sin(y)/this.n)),C=Bt(C+this.long0),y=ih(y)):(y=Yg(u.y/this.a,this.es,this.en),P=Math.abs(y),P<_t?(P=Math.sin(y),w=this.long0+u.x*Math.sqrt(1-this.es*P*P)/(this.a*Math.cos(y)),C=Bt(w)):P-It<_t&&(C=this.long0)),u.x=C,u.y=y,u}var Zb=["Sinusoidal","sinu"];const $b={init:Ub,forward:Vb,inverse:qb,names:Zb};function Hb(){}function Xb(u){for(var y=u.x,w=u.y,C=Bt(y-this.long0),P=w,D=Math.PI*Math.sin(w);;){var E=-(P+Math.sin(P)-D)/(1+Math.cos(P));if(P+=E,Math.abs(E)<It)break}P/=2,Math.PI/2-Math.abs(w)<It&&(C=0);var o=.900316316158*this.a*C*Math.cos(P)+this.x0,B=1.4142135623731*this.a*Math.sin(P)+this.y0;return u.x=o,u.y=B,u}function Yb(u){var y,w;u.x-=this.x0,u.y-=this.y0,w=u.y/(1.4142135623731*this.a),Math.abs(w)>.999999999999&&(w=.999999999999),y=Math.asin(w);var C=Bt(this.long0+u.x/(.900316316158*this.a*Math.cos(y)));C<-Math.PI&&(C=-Math.PI),C>Math.PI&&(C=Math.PI),w=(2*y+Math.sin(2*y))/Math.PI,Math.abs(w)>1&&(w=1);var P=Math.asin(w);return u.x=C,u.y=P,u}var Wb=["Mollweide","moll"];const Qb={init:Hb,forward:Xb,inverse:Yb,names:Wb};function Kb(){Math.abs(this.lat1+this.lat2)<It||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=jp(this.es),this.e1=Fp(this.es),this.e2=Gp(this.es),this.e3=Up(this.es),this.sin_phi=Math.sin(this.lat1),this.cos_phi=Math.cos(this.lat1),this.ms1=hc(this.e,this.sin_phi,this.cos_phi),this.ml1=ss(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<It?this.ns=this.sin_phi:(this.sin_phi=Math.sin(this.lat2),this.cos_phi=Math.cos(this.lat2),this.ms2=hc(this.e,this.sin_phi,this.cos_phi),this.ml2=ss(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=ss(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function Jb(u){var y=u.x,w=u.y,C;if(this.sphere)C=this.a*(this.g-w);else{var P=ss(this.e0,this.e1,this.e2,this.e3,w);C=this.a*(this.g-P)}var D=this.ns*Bt(y-this.long0),E=this.x0+C*Math.sin(D),o=this.y0+this.rh-C*Math.cos(D);return u.x=E,u.y=o,u}function e2(u){u.x-=this.x0,u.y=this.rh-u.y+this.y0;var y,w,C,P;this.ns>=0?(w=Math.sqrt(u.x*u.x+u.y*u.y),y=1):(w=-Math.sqrt(u.x*u.x+u.y*u.y),y=-1);var D=0;if(w!==0&&(D=Math.atan2(y*u.x,y*u.y)),this.sphere)return P=Bt(this.long0+D/this.ns),C=ih(this.g-w/this.a),u.x=P,u.y=C,u;var E=this.g-w/this.a;return C=Hm(E,this.e0,this.e1,this.e2,this.e3),P=Bt(this.long0+D/this.ns),u.x=P,u.y=C,u}var t2=["Equidistant_Conic","eqdc"];const i2={init:Kb,forward:Jb,inverse:e2,names:t2};function a2(){this.R=this.a}function n2(u){var y=u.x,w=u.y,C=Bt(y-this.long0),P,D;Math.abs(w)<=It&&(P=this.x0+this.R*C,D=this.y0);var E=th(2*Math.abs(w/Math.PI));(Math.abs(C)<=It||Math.abs(Math.abs(w)-_t)<=It)&&(P=this.x0,w>=0?D=this.y0+Math.PI*this.R*Math.tan(.5*E):D=this.y0+Math.PI*this.R*-Math.tan(.5*E));var o=.5*Math.abs(Math.PI/C-C/Math.PI),B=o*o,j=Math.sin(E),J=Math.cos(E),K=J/(j+J-1),W=K*K,ee=K*(2/j-1),we=ee*ee,Oe=Math.PI*this.R*(o*(K-we)+Math.sqrt(B*(K-we)*(K-we)-(we+B)*(W-we)))/(we+B);C<0&&(Oe=-Oe),P=this.x0+Oe;var Ae=B+K;return Oe=Math.PI*this.R*(ee*Ae-o*Math.sqrt((we+B)*(B+1)-Ae*Ae))/(we+B),w>=0?D=this.y0+Oe:D=this.y0-Oe,u.x=P,u.y=D,u}function r2(u){var y,w,C,P,D,E,o,B,j,J,K,W,ee;return u.x-=this.x0,u.y-=this.y0,K=Math.PI*this.R,C=u.x/K,P=u.y/K,D=C*C+P*P,E=-Math.abs(P)*(1+D),o=E-2*P*P+C*C,B=-2*E+1+2*P*P+D*D,ee=P*P/B+(2*o*o*o/B/B/B-9*E*o/B/B)/27,j=(E-o*o/3/B)/B,J=2*Math.sqrt(-j/3),K=3*ee/j/J,Math.abs(K)>1&&(K>=0?K=1:K=-1),W=Math.acos(K)/3,u.y>=0?w=(-J*Math.cos(W+Math.PI/3)-o/3/B)*Math.PI:w=-(-J*Math.cos(W+Math.PI/3)-o/3/B)*Math.PI,Math.abs(C)<It?y=this.long0:y=Bt(this.long0+Math.PI*(D-1+Math.sqrt(1+2*(C*C-P*P)+D*D))/2/C),u.x=y,u.y=w,u}var s2=["Van_der_Grinten_I","VanDerGrinten","Van_der_Grinten","vandg"];const o2={init:a2,forward:n2,inverse:r2,names:s2};function l2(u,y,w,C,P,D){const E=C-y,o=Math.atan((1-D)*Math.tan(u)),B=Math.atan((1-D)*Math.tan(w)),j=Math.sin(o),J=Math.cos(o),K=Math.sin(B),W=Math.cos(B);let ee=E,we,Oe=100,Ae,Ze,Be,Ke,vt,Et,xt,lt,xe,Se,Ye,mt,gt,Gt;do{if(Ae=Math.sin(ee),Ze=Math.cos(ee),Be=Math.sqrt(W*Ae*(W*Ae)+(J*K-j*W*Ze)*(J*K-j*W*Ze)),Be===0)return{azi1:0,s12:0};Ke=j*K+J*W*Ze,vt=Math.atan2(Be,Ke),Et=J*W*Ae/Be,xt=1-Et*Et,lt=xt!==0?Ke-2*j*K/xt:0,xe=D/16*xt*(4+D*(4-3*xt)),we=ee,ee=E+(1-xe)*D*Et*(vt+xe*Be*(lt+xe*Ke*(-1+2*lt*lt)))}while(Math.abs(ee-we)>1e-12&&--Oe>0);return Oe===0?{azi1:NaN,s12:NaN}:(Se=xt*(P*P-P*(1-D)*(P*(1-D)))/(P*(1-D)*(P*(1-D))),Ye=1+Se/16384*(4096+Se*(-768+Se*(320-175*Se))),mt=Se/1024*(256+Se*(-128+Se*(74-47*Se))),gt=mt*Be*(lt+mt/4*(Ke*(-1+2*lt*lt)-mt/6*lt*(-3+4*Be*Be)*(-3+4*lt*lt))),Gt=P*(1-D)*Ye*(vt-gt),{azi1:Math.atan2(W*Ae,J*K-j*W*Ze),s12:Gt})}function c2(u,y,w,C,P,D){const E=Math.atan((1-D)*Math.tan(u)),o=Math.sin(E),B=Math.cos(E),j=Math.sin(w),J=Math.cos(w),K=Math.atan2(o,B*J),W=B*j,ee=1-W*W,we=ee*(P*P-P*(1-D)*(P*(1-D)))/(P*(1-D)*(P*(1-D))),Oe=1+we/16384*(4096+we*(-768+we*(320-175*we))),Ae=we/1024*(256+we*(-128+we*(74-47*we)));let Ze=C/(P*(1-D)*Oe),Be,Ke=100,vt,Et,xt,lt;do vt=Math.cos(2*K+Ze),Et=Math.sin(Ze),xt=Math.cos(Ze),lt=Ae*Et*(vt+Ae/4*(xt*(-1+2*vt*vt)-Ae/6*vt*(-3+4*Et*Et)*(-3+4*vt*vt))),Be=Ze,Ze=C/(P*(1-D)*Oe)+lt;while(Math.abs(Ze-Be)>1e-12&&--Ke>0);if(Ke===0)return{lat2:NaN,lon2:NaN};const xe=o*Et-B*xt*J,Se=Math.atan2(o*xt+B*Et*J,(1-D)*Math.sqrt(W*W+xe*xe)),Ye=Math.atan2(Et*j,B*xt-o*Et*J),mt=D/16*ee*(4+D*(4-3*ee)),gt=Ye-(1-mt)*D*W*(Ze+mt*Et*(vt+mt*xt*(-1+2*vt*vt))),Gt=y+gt;return{lat2:Se,lon2:Gt}}function u2(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0),this.f=this.es/(1+Math.sqrt(1-this.es))}function h2(u){var y=u.x,w=u.y,C=Math.sin(u.y),P=Math.cos(u.y),D=Bt(y-this.long0),E,o,B,j,J,K,W,ee,we,Oe,Ae;return this.sphere?Math.abs(this.sin_p12-1)<=It?(u.x=this.x0+this.a*(_t-w)*Math.sin(D),u.y=this.y0-this.a*(_t-w)*Math.cos(D),u):Math.abs(this.sin_p12+1)<=It?(u.x=this.x0+this.a*(_t+w)*Math.sin(D),u.y=this.y0+this.a*(_t+w)*Math.cos(D),u):(we=this.sin_p12*C+this.cos_p12*P*Math.cos(D),W=Math.acos(we),ee=W?W/Math.sin(W):1,u.x=this.x0+this.a*ee*P*Math.sin(D),u.y=this.y0+this.a*ee*(this.cos_p12*C-this.sin_p12*P*Math.cos(D)),u):(E=jp(this.es),o=Fp(this.es),B=Gp(this.es),j=Up(this.es),Math.abs(this.sin_p12-1)<=It?(J=this.a*ss(E,o,B,j,_t),K=this.a*ss(E,o,B,j,w),u.x=this.x0+(J-K)*Math.sin(D),u.y=this.y0-(J-K)*Math.cos(D),u):Math.abs(this.sin_p12+1)<=It?(J=this.a*ss(E,o,B,j,_t),K=this.a*ss(E,o,B,j,w),u.x=this.x0+(J+K)*Math.sin(D),u.y=this.y0+(J+K)*Math.cos(D),u):Math.abs(y)<It&&Math.abs(w-this.lat0)<It?(u.x=u.y=0,u):(Oe=l2(this.lat0,this.long0,w,y,this.a,this.f),Ae=Oe.azi1,u.x=Oe.s12*Math.sin(Ae),u.y=Oe.s12*Math.cos(Ae),u))}function d2(u){u.x-=this.x0,u.y-=this.y0;var y,w,C,P,D,E,o,B,j,J,K,W,ee,we,Oe,Ae;return this.sphere?(y=Math.sqrt(u.x*u.x+u.y*u.y),y>2*_t*this.a?void 0:(w=y/this.a,C=Math.sin(w),P=Math.cos(w),D=this.long0,Math.abs(y)<=It?E=this.lat0:(E=th(P*this.sin_p12+u.y*C*this.cos_p12/y),o=Math.abs(this.lat0)-_t,Math.abs(o)<=It?this.lat0>=0?D=Bt(this.long0+Math.atan2(u.x,-u.y)):D=Bt(this.long0-Math.atan2(-u.x,u.y)):D=Bt(this.long0+Math.atan2(u.x*C,y*this.cos_p12*P-u.y*this.sin_p12*C))),u.x=D,u.y=E,u)):(B=jp(this.es),j=Fp(this.es),J=Gp(this.es),K=Up(this.es),Math.abs(this.sin_p12-1)<=It?(W=this.a*ss(B,j,J,K,_t),y=Math.sqrt(u.x*u.x+u.y*u.y),ee=W-y,E=Hm(ee/this.a,B,j,J,K),D=Bt(this.long0+Math.atan2(u.x,-1*u.y)),u.x=D,u.y=E,u):Math.abs(this.sin_p12+1)<=It?(W=this.a*ss(B,j,J,K,_t),y=Math.sqrt(u.x*u.x+u.y*u.y),ee=y-W,E=Hm(ee/this.a,B,j,J,K),D=Bt(this.long0+Math.atan2(u.x,u.y)),u.x=D,u.y=E,u):(we=Math.atan2(u.x,u.y),Oe=Math.sqrt(u.x*u.x+u.y*u.y),Ae=c2(this.lat0,this.long0,we,Oe,this.a,this.f),u.x=Ae.lon2,u.y=Ae.lat2,u))}var f2=["Azimuthal_Equidistant","aeqd"];const p2={init:u2,forward:h2,inverse:d2,names:f2};function m2(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function g2(u){var y,w,C,P,D,E,o,B,j=u.x,J=u.y;return C=Bt(j-this.long0),y=Math.sin(J),w=Math.cos(J),P=Math.cos(C),E=this.sin_p14*y+this.cos_p14*w*P,D=1,(E>0||Math.abs(E)<=It)&&(o=this.a*D*w*Math.sin(C),B=this.y0+this.a*D*(this.cos_p14*y-this.sin_p14*w*P)),u.x=o,u.y=B,u}function _2(u){var y,w,C,P,D,E,o;return u.x-=this.x0,u.y-=this.y0,y=Math.sqrt(u.x*u.x+u.y*u.y),w=th(y/this.a),C=Math.sin(w),P=Math.cos(w),E=this.long0,Math.abs(y)<=It?(o=this.lat0,u.x=E,u.y=o,u):(o=th(P*this.sin_p14+u.y*C*this.cos_p14/y),D=Math.abs(this.lat0)-_t,Math.abs(D)<=It?(this.lat0>=0?E=Bt(this.long0+Math.atan2(u.x,-u.y)):E=Bt(this.long0-Math.atan2(-u.x,u.y)),u.x=E,u.y=o,u):(E=Bt(this.long0+Math.atan2(u.x*C,y*this.cos_p14*P-u.y*this.sin_p14*C)),u.x=E,u.y=o,u))}var y2=["ortho"];const v2={init:m2,forward:g2,inverse:_2,names:y2};var cn={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},_a={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function x2(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=_t-ga/2?this.face=cn.TOP:this.lat0<=-(_t-ga/2)?this.face=cn.BOTTOM:Math.abs(this.long0)<=ga?this.face=cn.FRONT:Math.abs(this.long0)<=_t+ga?this.face=this.long0>0?cn.RIGHT:cn.LEFT:this.face=cn.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function b2(u){var y={x:0,y:0},w,C,P,D,E,o,B={value:0};if(u.x-=this.long0,this.es!==0?w=Math.atan(this.one_minus_f_squared*Math.tan(u.y)):w=u.y,C=u.x,this.face===cn.TOP)D=_t-w,C>=ga&&C<=_t+ga?(B.value=_a.AREA_0,P=C-_t):C>_t+ga||C<=-(_t+ga)?(B.value=_a.AREA_1,P=C>0?C-Cn:C+Cn):C>-(_t+ga)&&C<=-ga?(B.value=_a.AREA_2,P=C+_t):(B.value=_a.AREA_3,P=C);else if(this.face===cn.BOTTOM)D=_t+w,C>=ga&&C<=_t+ga?(B.value=_a.AREA_0,P=-C+_t):C<ga&&C>=-ga?(B.value=_a.AREA_1,P=-C):C<-ga&&C>=-(_t+ga)?(B.value=_a.AREA_2,P=-C-_t):(B.value=_a.AREA_3,P=C>0?-C+Cn:-C-Cn);else{var j,J,K,W,ee,we,Oe;this.face===cn.RIGHT?C=ff(C,+_t):this.face===cn.BACK?C=ff(C,+Cn):this.face===cn.LEFT&&(C=ff(C,-_t)),W=Math.sin(w),ee=Math.cos(w),we=Math.sin(C),Oe=Math.cos(C),j=ee*Oe,J=ee*we,K=W,this.face===cn.FRONT?(D=Math.acos(j),P=Dm(D,K,J,B)):this.face===cn.RIGHT?(D=Math.acos(J),P=Dm(D,K,-j,B)):this.face===cn.BACK?(D=Math.acos(-j),P=Dm(D,K,-J,B)):this.face===cn.LEFT?(D=Math.acos(-J),P=Dm(D,K,j,B)):(D=P=0,B.value=_a.AREA_0)}return o=Math.atan(12/Cn*(P+Math.acos(Math.sin(P)*Math.cos(ga))-_t)),E=Math.sqrt((1-Math.cos(D))/(Math.cos(o)*Math.cos(o))/(1-Math.cos(Math.atan(1/Math.cos(P))))),B.value===_a.AREA_1?o+=_t:B.value===_a.AREA_2?o+=Cn:B.value===_a.AREA_3&&(o+=1.5*Cn),y.x=E*Math.cos(o),y.y=E*Math.sin(o),y.x=y.x*this.a+this.x0,y.y=y.y*this.a+this.y0,u.x=y.x,u.y=y.y,u}function w2(u){var y={lam:0,phi:0},w,C,P,D,E,o,B,j,J,K={value:0};if(u.x=(u.x-this.x0)/this.a,u.y=(u.y-this.y0)/this.a,C=Math.atan(Math.sqrt(u.x*u.x+u.y*u.y)),w=Math.atan2(u.y,u.x),u.x>=0&&u.x>=Math.abs(u.y)?K.value=_a.AREA_0:u.y>=0&&u.y>=Math.abs(u.x)?(K.value=_a.AREA_1,w-=_t):u.x<0&&-u.x>=Math.abs(u.y)?(K.value=_a.AREA_2,w=w<0?w+Cn:w-Cn):(K.value=_a.AREA_3,w+=_t),J=Cn/12*Math.tan(w),E=Math.sin(J)/(Math.cos(J)-1/Math.sqrt(2)),o=Math.atan(E),P=Math.cos(w),D=Math.tan(C),B=1-P*P*D*D*(1-Math.cos(Math.atan(1/Math.cos(o)))),B<-1?B=-1:B>1&&(B=1),this.face===cn.TOP)j=Math.acos(B),y.phi=_t-j,K.value===_a.AREA_0?y.lam=o+_t:K.value===_a.AREA_1?y.lam=o<0?o+Cn:o-Cn:K.value===_a.AREA_2?y.lam=o-_t:y.lam=o;else if(this.face===cn.BOTTOM)j=Math.acos(B),y.phi=j-_t,K.value===_a.AREA_0?y.lam=-o+_t:K.value===_a.AREA_1?y.lam=-o:K.value===_a.AREA_2?y.lam=-o-_t:y.lam=o<0?-o-Cn:-o+Cn;else{var W,ee,we;W=B,J=W*W,J>=1?we=0:we=Math.sqrt(1-J)*Math.sin(o),J+=we*we,J>=1?ee=0:ee=Math.sqrt(1-J),K.value===_a.AREA_1?(J=ee,ee=-we,we=J):K.value===_a.AREA_2?(ee=-ee,we=-we):K.value===_a.AREA_3&&(J=ee,ee=we,we=-J),this.face===cn.RIGHT?(J=W,W=-ee,ee=J):this.face===cn.BACK?(W=-W,ee=-ee):this.face===cn.LEFT&&(J=W,W=ee,ee=-J),y.phi=Math.acos(-we)-_t,y.lam=Math.atan2(ee,W),this.face===cn.RIGHT?y.lam=ff(y.lam,-_t):this.face===cn.BACK?y.lam=ff(y.lam,-Cn):this.face===cn.LEFT&&(y.lam=ff(y.lam,+_t))}if(this.es!==0){var Oe,Ae,Ze;Oe=y.phi<0?1:0,Ae=Math.tan(y.phi),Ze=this.b/Math.sqrt(Ae*Ae+this.one_minus_f_squared),y.phi=Math.atan(Math.sqrt(this.a*this.a-Ze*Ze)/(this.one_minus_f*Ze)),Oe&&(y.phi=-y.phi)}return y.lam+=this.long0,u.x=y.lam,u.y=y.phi,u}function Dm(u,y,w,C){var P;return u<It?(C.value=_a.AREA_0,P=0):(P=Math.atan2(y,w),Math.abs(P)<=ga?C.value=_a.AREA_0:P>ga&&P<=_t+ga?(C.value=_a.AREA_1,P-=_t):P>_t+ga||P<=-(_t+ga)?(C.value=_a.AREA_2,P=P>=0?P-Cn:P+Cn):(C.value=_a.AREA_3,P+=_t)),P}function ff(u,y){var w=u+y;return w<-Cn?w+=Ip:w>+Cn&&(w-=Ip),w}var S2=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const M2={init:x2,forward:b2,inverse:w2,names:S2};var Og=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Mp=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],Ty=.8487,Ey=1.3523,Cy=cc/5,T2=1/Cy,hf=18,Xm=function(u,y){return u[0]+y*(u[1]+y*(u[2]+y*u[3]))},E2=function(u,y){return u[1]+y*(2*u[2]+y*3*u[3])};function C2(u,y,w,C){for(var P=y;C;--C){var D=u(P);if(P-=D,Math.abs(D)<w)break}return P}function A2(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function P2(u){var y=Bt(u.x-this.long0),w=Math.abs(u.y),C=Math.floor(w*Cy);C<0?C=0:C>=hf&&(C=hf-1),w=cc*(w-T2*C);var P={x:Xm(Og[C],w)*y,y:Xm(Mp[C],w)};return u.y<0&&(P.y=-P.y),P.x=P.x*this.a*Ty+this.x0,P.y=P.y*this.a*Ey+this.y0,P}function z2(u){var y={x:(u.x-this.x0)/(this.a*Ty),y:Math.abs(u.y-this.y0)/(this.a*Ey)};if(y.y>=1)y.x/=Og[hf][0],y.y=u.y<0?-_t:_t;else{var w=Math.floor(y.y*hf);for(w<0?w=0:w>=hf&&(w=hf-1);;)if(Mp[w][0]>y.y)--w;else if(Mp[w+1][0]<=y.y)++w;else break;var C=Mp[w],P=5*(y.y-C[0])/(Mp[w+1][0]-C[0]);P=C2(function(D){return(Xm(C,D)-y.y)/E2(C,D)},P,It,100),y.x/=Xm(Og[w],P),y.y=(5*w+P)*Sr,u.y<0&&(y.y=-y.y)}return y.x=Bt(y.x+this.long0),y}var I2=["Robinson","robin"];const R2={init:A2,forward:P2,inverse:z2,names:I2};function D2(){this.name="geocent"}function k2(u){var y=py(u,this.es,this.a);return y}function L2(u){var y=my(u,this.es,this.a,this.b);return y}var O2=["Geocentric","geocentric","geocent","Geocent"];const B2={init:D2,forward:k2,inverse:L2,names:O2};var Fr={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},bp={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function N2(){if(Object.keys(bp).forEach((function(w){if(typeof this[w]>"u")this[w]=bp[w].def;else{if(bp[w].num&&isNaN(this[w]))throw new Error("Invalid parameter value, must be numeric "+w+" = "+this[w]);bp[w].num&&(this[w]=parseFloat(this[w]))}bp[w].degrees&&(this[w]=this[w]*Sr)}).bind(this)),Math.abs(Math.abs(this.lat0)-_t)<It?this.mode=this.lat0<0?Fr.S_POLE:Fr.N_POLE:Math.abs(this.lat0)<It?this.mode=Fr.EQUIT:(this.mode=Fr.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var u=this.tilt,y=this.azi;this.cg=Math.cos(y),this.sg=Math.sin(y),this.cw=Math.cos(u),this.sw=Math.sin(u)}function j2(u){u.x-=this.long0;var y=Math.sin(u.y),w=Math.cos(u.y),C=Math.cos(u.x),P,D;switch(this.mode){case Fr.OBLIQ:D=this.sinph0*y+this.cosph0*w*C;break;case Fr.EQUIT:D=w*C;break;case Fr.S_POLE:D=-y;break;case Fr.N_POLE:D=y;break}switch(D=this.pn1/(this.p-D),P=D*w*Math.sin(u.x),this.mode){case Fr.OBLIQ:D*=this.cosph0*y-this.sinph0*w*C;break;case Fr.EQUIT:D*=y;break;case Fr.N_POLE:D*=-(w*C);break;case Fr.S_POLE:D*=w*C;break}var E,o;return E=D*this.cg+P*this.sg,o=1/(E*this.sw*this.h1+this.cw),P=(P*this.cg-D*this.sg)*this.cw*o,D=E*o,u.x=P*this.a,u.y=D*this.a,u}function F2(u){u.x/=this.a,u.y/=this.a;var y={x:u.x,y:u.y},w,C,P;P=1/(this.pn1-u.y*this.sw),w=this.pn1*u.x*P,C=this.pn1*u.y*this.cw*P,u.x=w*this.cg+C*this.sg,u.y=C*this.cg-w*this.sg;var D=Cs(u.x,u.y);if(Math.abs(D)<It)y.x=0,y.y=u.y;else{var E,o;switch(o=1-D*D*this.pfact,o=(this.p-Math.sqrt(o))/(this.pn1/D+D/this.pn1),E=Math.sqrt(1-o*o),this.mode){case Fr.OBLIQ:y.y=Math.asin(E*this.sinph0+u.y*o*this.cosph0/D),u.y=(E-this.sinph0*Math.sin(y.y))*D,u.x*=o*this.cosph0;break;case Fr.EQUIT:y.y=Math.asin(u.y*o/D),u.y=E*D,u.x*=o;break;case Fr.N_POLE:y.y=Math.asin(E),u.y=-u.y;break;case Fr.S_POLE:y.y=-Math.asin(E);break}y.x=Math.atan2(u.x,u.y)}return u.x=y.x+this.long0,u.y=y.y,u}var G2=["Tilted_Perspective","tpers"];const U2={init:N2,forward:j2,inverse:F2,names:G2};function V2(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var u=1-this.es,y=1/u;this.radius_p=Math.sqrt(u),this.radius_p2=u,this.radius_p_inv2=y,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function q2(u){var y=u.x,w=u.y,C,P,D,E;if(y=y-this.long0,this.shape==="ellipse"){w=Math.atan(this.radius_p2*Math.tan(w));var o=this.radius_p/Cs(this.radius_p*Math.cos(w),Math.sin(w));if(P=o*Math.cos(y)*Math.cos(w),D=o*Math.sin(y)*Math.cos(w),E=o*Math.sin(w),(this.radius_g-P)*P-D*D-E*E*this.radius_p_inv2<0)return u.x=Number.NaN,u.y=Number.NaN,u;C=this.radius_g-P,this.flip_axis?(u.x=this.radius_g_1*Math.atan(D/Cs(E,C)),u.y=this.radius_g_1*Math.atan(E/C)):(u.x=this.radius_g_1*Math.atan(D/C),u.y=this.radius_g_1*Math.atan(E/Cs(D,C)))}else this.shape==="sphere"&&(C=Math.cos(w),P=Math.cos(y)*C,D=Math.sin(y)*C,E=Math.sin(w),C=this.radius_g-P,this.flip_axis?(u.x=this.radius_g_1*Math.atan(D/Cs(E,C)),u.y=this.radius_g_1*Math.atan(E/C)):(u.x=this.radius_g_1*Math.atan(D/C),u.y=this.radius_g_1*Math.atan(E/Cs(D,C))));return u.x=u.x*this.a,u.y=u.y*this.a,u}function Z2(u){var y=-1,w=0,C=0,P,D,E,o;if(u.x=u.x/this.a,u.y=u.y/this.a,this.shape==="ellipse"){this.flip_axis?(C=Math.tan(u.y/this.radius_g_1),w=Math.tan(u.x/this.radius_g_1)*Cs(1,C)):(w=Math.tan(u.x/this.radius_g_1),C=Math.tan(u.y/this.radius_g_1)*Cs(1,w));var B=C/this.radius_p;if(P=w*w+B*B+y*y,D=2*this.radius_g*y,E=D*D-4*P*this.C,E<0)return u.x=Number.NaN,u.y=Number.NaN,u;o=(-D-Math.sqrt(E))/(2*P),y=this.radius_g+o*y,w*=o,C*=o,u.x=Math.atan2(w,y),u.y=Math.atan(C*Math.cos(u.x)/y),u.y=Math.atan(this.radius_p_inv2*Math.tan(u.y))}else if(this.shape==="sphere"){if(this.flip_axis?(C=Math.tan(u.y/this.radius_g_1),w=Math.tan(u.x/this.radius_g_1)*Math.sqrt(1+C*C)):(w=Math.tan(u.x/this.radius_g_1),C=Math.tan(u.y/this.radius_g_1)*Math.sqrt(1+w*w)),P=w*w+C*C+y*y,D=2*this.radius_g*y,E=D*D-4*P*this.C,E<0)return u.x=Number.NaN,u.y=Number.NaN,u;o=(-D-Math.sqrt(E))/(2*P),y=this.radius_g+o*y,w*=o,C*=o,u.x=Math.atan2(w,y),u.y=Math.atan(C*Math.cos(u.x)/y)}return u.x=u.x+this.long0,u}var $2=["Geostationary Satellite View","Geostationary_Satellite","geos"];const H2={init:V2,forward:q2,inverse:Z2,names:$2};var Ep=1.340264,Cp=-.081106,Ap=893e-6,Pp=.003796,Ym=Math.sqrt(3)/2;function X2(){this.es=0,this.long0=this.long0!==void 0?this.long0:0}function Y2(u){var y=Bt(u.x-this.long0),w=u.y,C=Math.asin(Ym*Math.sin(w)),P=C*C,D=P*P*P;return u.x=y*Math.cos(C)/(Ym*(Ep+3*Cp*P+D*(7*Ap+9*Pp*P))),u.y=C*(Ep+Cp*P+D*(Ap+Pp*P)),u.x=this.a*u.x+this.x0,u.y=this.a*u.y+this.y0,u}function W2(u){u.x=(u.x-this.x0)/this.a,u.y=(u.y-this.y0)/this.a;var y=1e-9,w=12,C=u.y,P,D,E,o,B,j;for(j=0;j<w&&(P=C*C,D=P*P*P,E=C*(Ep+Cp*P+D*(Ap+Pp*P))-u.y,o=Ep+3*Cp*P+D*(7*Ap+9*Pp*P),C-=B=E/o,!(Math.abs(B)<y));++j);return P=C*C,D=P*P*P,u.x=Ym*u.x*(Ep+3*Cp*P+D*(7*Ap+9*Pp*P))/Math.cos(C),u.y=Math.asin(Math.sin(C)/Ym),u.x=Bt(u.x+this.long0),u}var Q2=["eqearth","Equal Earth","Equal_Earth"];const K2={init:X2,forward:Y2,inverse:W2,names:Q2};var kp=1e-10;function J2(){var u;if(this.phi1=this.lat1,Math.abs(this.phi1)<kp)throw new Error;this.es?(this.en=Xg(this.es),this.m1=_f(this.phi1,this.am1=Math.sin(this.phi1),u=Math.cos(this.phi1),this.en),this.am1=u/(Math.sqrt(1-this.es*this.am1*this.am1)*this.am1),this.inverse=tw,this.forward=ew):(Math.abs(this.phi1)+kp>=_t?this.cphi1=0:this.cphi1=1/Math.tan(this.phi1),this.inverse=aw,this.forward=iw)}function ew(u){var y=Bt(u.x-(this.long0||0)),w=u.y,C,P,D;return C=this.am1+this.m1-_f(w,P=Math.sin(w),D=Math.cos(w),this.en),P=D*y/(C*Math.sqrt(1-this.es*P*P)),u.x=C*Math.sin(P),u.y=this.am1-C*Math.cos(P),u.x=this.a*u.x+(this.x0||0),u.y=this.a*u.y+(this.y0||0),u}function tw(u){u.x=(u.x-(this.x0||0))/this.a,u.y=(u.y-(this.y0||0))/this.a;var y,w,C,P;if(w=Cs(u.x,u.y=this.am1-u.y),P=Yg(this.am1+this.m1-w,this.es,this.en),(y=Math.abs(P))<_t)y=Math.sin(P),C=w*Math.atan2(u.x,u.y)*Math.sqrt(1-this.es*y*y)/Math.cos(P);else if(Math.abs(y-_t)<=kp)C=0;else throw new Error;return u.x=Bt(C+(this.long0||0)),u.y=ih(P),u}function iw(u){var y=Bt(u.x-(this.long0||0)),w=u.y,C,P;return P=this.cphi1+this.phi1-w,Math.abs(P)>kp?(u.x=P*Math.sin(C=y*Math.cos(w)/P),u.y=this.cphi1-P*Math.cos(C)):u.x=u.y=0,u.x=this.a*u.x+(this.x0||0),u.y=this.a*u.y+(this.y0||0),u}function aw(u){u.x=(u.x-(this.x0||0))/this.a,u.y=(u.y-(this.y0||0))/this.a;var y,w,C=Cs(u.x,u.y=this.cphi1-u.y);if(w=this.cphi1+this.phi1-C,Math.abs(w)>_t)throw new Error;return Math.abs(Math.abs(w)-_t)<=kp?y=0:y=C*Math.atan2(u.x,u.y)/Math.cos(w),u.x=Bt(y+(this.long0||0)),u.y=ih(w),u}var nw=["bonne","Bonne (Werner lat_1=90)"];const rw={init:J2,names:nw};function sw(u){u.Proj.projections.add(jm),u.Proj.projections.add(Fm),u.Proj.projections.add(nx),u.Proj.projections.add(fx),u.Proj.projections.add(yx),u.Proj.projections.add(Sx),u.Proj.projections.add(Px),u.Proj.projections.add(kx),u.Proj.projections.add(jx),u.Proj.projections.add(qx),u.Proj.projections.add(ab),u.Proj.projections.add(cb),u.Proj.projections.add(pb),u.Proj.projections.add(xb),u.Proj.projections.add(Tb),u.Proj.projections.add(zb),u.Proj.projections.add(Lb),u.Proj.projections.add(Fb),u.Proj.projections.add($b),u.Proj.projections.add(Qb),u.Proj.projections.add(i2),u.Proj.projections.add(o2),u.Proj.projections.add(p2),u.Proj.projections.add(v2),u.Proj.projections.add(M2),u.Proj.projections.add(R2),u.Proj.projections.add(B2),u.Proj.projections.add(U2),u.Proj.projections.add(H2),u.Proj.projections.add(K2),u.Proj.projections.add(rw)}const Ay=Object.assign(b1,{defaultDatum:"WGS84",Proj:El,WGS84:new El("WGS84"),Point:pf,toPoint:gy,defs:rs,nadgrid:a1,transform:$m,mgrs:w1,version:"__VERSION__"});sw(Ay);const ow="+proj=utm +zone=36 +datum=WGS84 +units=m +no_defs",lw="+proj=longlat +datum=WGS84 +no_defs",cw="/assets/Map Pin.svg";async function uw(u,y,w="sites",C="site-points",P=!0,D=32){const E=[],o=[];console.log("loadSitePoints: loading",Object.keys(y).length,"sites for",w,"pinSize:",D);for(const[j,J]of Object.entries(y)){console.log(`loadSitePoints: fetching ${j} from ${J.pointGeoJson}`);const K=await fetch(J.pointGeoJson).then(Be=>Be.json()),W=K.features?.[0]||K,ee=W.geometry.coordinates;console.log(`loadSitePoints: ${j} raw coords:`,ee);let we=ee;if(Array.isArray(ee)&&Math.abs(ee[0])>180){const[Be,Ke]=ee;we=Ay(ow,lw,[Be,Ke]),console.log(`loadSitePoints: ${j} reprojected to:`,we),console.log(` IMPORTANT: ${j} is at longitude ${we[0]}, latitude ${we[1]}`)}const Oe={type:"Feature",geometry:{type:"Point",coordinates:we},properties:{...W.properties||{},siteId:j,name:J.name}};E.push(Oe);const Ae=document.createElement("div");Ae.className="map-pin-marker",Ae.innerHTML=`<img src="${cw}" alt="pin" style="width:${D}px;height:auto;display:block;" />`,Ae.style.cursor="pointer",Ae.dataset.siteId=j,Ae.dataset.name=J.name;const Ze=new qg.Marker({element:Ae,anchor:"bottom"}).setLngLat(we).addTo(u);o.push({marker:Ze,siteId:j,name:J.name,meta:J})}console.log("loadSitePoints: total features:",E.length);const B={type:"FeatureCollection",features:E};if(u.getSource(w)?u.getSource(w).setData(B):(u.addSource(w,{type:"geojson",data:B}),console.log("loadSitePoints: source added:",w)),u.getLayer(C)||(u.addLayer({id:C,source:w,type:"circle",paint:{"circle-color":"#ff0000","circle-radius":8,"circle-stroke-color":"#ffffff","circle-stroke-width":2,"circle-opacity":0,"circle-stroke-opacity":0}}),console.log("loadSitePoints: layer added (invisible):",C)),P&&E.length){const j=E.map(W=>W.geometry.coordinates[0]),J=E.map(W=>W.geometry.coordinates[1]),K=[[Math.min(...j),Math.min(...J)],[Math.max(...j),Math.max(...J)]];console.log("loadSitePoints: fitting bounds:",K),u.fitBounds(K,{padding:80,duration:1200})}return o}function hw({x:u,y,text:w,visible:C}){if(!C)return null;const P={position:"absolute",left:u+8,top:y+8,background:"rgba(0,0,0,0.8)",color:"#fff",padding:"6px 8px",borderRadius:4,pointerEvents:"none",fontSize:12,zIndex:10};return Re.jsx("div",{style:P,children:w})}function dw({open:u,onClose:y,title:w,children:C}){return Qe.useEffect(()=>{function P(D){D.key==="Escape"&&y?.()}return u&&window.addEventListener("keydown",P),()=>window.removeEventListener("keydown",P)},[u,y]),u?Re.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",display:"grid",placeItems:"center",zIndex:20},onClick:y,children:Re.jsxs("div",{style:{background:"#fff",color:"#111",minWidth:320,maxWidth:"90vw",maxHeight:"80vh",overflow:"auto",borderRadius:8,padding:16},onClick:P=>P.stopPropagation(),children:[Re.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[Re.jsx("h3",{style:{margin:0},children:w}),Re.jsx("button",{onClick:y,"aria-label":"Close",children:""})]}),C]})}):null}var Um={exports:{}};/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/var fw=Um.exports,B_;function pw(){return B_||(B_=1,(function(u,y){((w,C)=>{u.exports=C()})(fw,function w(){var C=typeof self<"u"?self:typeof window<"u"?window:C!==void 0?C:{},P,D=!C.document&&!!C.postMessage,E=C.IS_PAPA_WORKER||!1,o={},B=0,j={};function J(xe){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(Se){var Ye=Et(Se);Ye.chunkSize=parseInt(Ye.chunkSize),Se.step||Se.chunk||(Ye.chunkSize=null),this._handle=new Oe(Ye),(this._handle.streamer=this)._config=Ye}).call(this,xe),this.parseChunk=function(Se,Ye){var mt=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<mt){let Gt=this._config.newline;Gt||(gt=this._config.quoteChar||'"',Gt=this._handle.guessLineEndings(Se,gt)),Se=[...Se.split(Gt).slice(mt)].join(Gt)}this.isFirstChunk&&lt(this._config.beforeFirstChunk)&&(gt=this._config.beforeFirstChunk(Se))!==void 0&&(Se=gt),this.isFirstChunk=!1,this._halted=!1;var mt=this._partialLine+Se,gt=(this._partialLine="",this._handle.parse(mt,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(Se=gt.meta.cursor,mt=(this._finished||(this._partialLine=mt.substring(Se-this._baseIndex),this._baseIndex=Se),gt&&gt.data&&(this._rowCount+=gt.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),E)C.postMessage({results:gt,workerId:j.WORKER_ID,finished:mt});else if(lt(this._config.chunk)&&!Ye){if(this._config.chunk(gt,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=gt=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(gt.data),this._completeResults.errors=this._completeResults.errors.concat(gt.errors),this._completeResults.meta=gt.meta),this._completed||!mt||!lt(this._config.complete)||gt&&gt.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),mt||gt&&gt.meta.paused||this._nextChunk(),gt}this._halted=!0},this._sendError=function(Se){lt(this._config.error)?this._config.error(Se):E&&this._config.error&&C.postMessage({workerId:j.WORKER_ID,error:Se,finished:!1})}}function K(xe){var Se;(xe=xe||{}).chunkSize||(xe.chunkSize=j.RemoteChunkSize),J.call(this,xe),this._nextChunk=D?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(Ye){this._input=Ye,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(Se=new XMLHttpRequest,this._config.withCredentials&&(Se.withCredentials=this._config.withCredentials),D||(Se.onload=xt(this._chunkLoaded,this),Se.onerror=xt(this._chunkError,this)),Se.open(this._config.downloadRequestBody?"POST":"GET",this._input,!D),this._config.downloadRequestHeaders){var Ye,mt=this._config.downloadRequestHeaders;for(Ye in mt)Se.setRequestHeader(Ye,mt[Ye])}var gt;this._config.chunkSize&&(gt=this._start+this._config.chunkSize-1,Se.setRequestHeader("Range","bytes="+this._start+"-"+gt));try{Se.send(this._config.downloadRequestBody)}catch(Gt){this._chunkError(Gt.message)}D&&Se.status===0&&this._chunkError()}},this._chunkLoaded=function(){Se.readyState===4&&(Se.status<200||400<=Se.status?this._chunkError():(this._start+=this._config.chunkSize||Se.responseText.length,this._finished=!this._config.chunkSize||this._start>=(Ye=>(Ye=Ye.getResponseHeader("Content-Range"))!==null?parseInt(Ye.substring(Ye.lastIndexOf("/")+1)):-1)(Se),this.parseChunk(Se.responseText)))},this._chunkError=function(Ye){Ye=Se.statusText||Ye,this._sendError(new Error(Ye))}}function W(xe){(xe=xe||{}).chunkSize||(xe.chunkSize=j.LocalChunkSize),J.call(this,xe);var Se,Ye,mt=typeof FileReader<"u";this.stream=function(gt){this._input=gt,Ye=gt.slice||gt.webkitSlice||gt.mozSlice,mt?((Se=new FileReader).onload=xt(this._chunkLoaded,this),Se.onerror=xt(this._chunkError,this)):Se=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var gt=this._input,Gt=(this._config.chunkSize&&(Gt=Math.min(this._start+this._config.chunkSize,this._input.size),gt=Ye.call(gt,this._start,Gt)),Se.readAsText(gt,this._config.encoding));mt||this._chunkLoaded({target:{result:Gt}})},this._chunkLoaded=function(gt){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(gt.target.result)},this._chunkError=function(){this._sendError(Se.error)}}function ee(xe){var Se;J.call(this,xe=xe||{}),this.stream=function(Ye){return Se=Ye,this._nextChunk()},this._nextChunk=function(){var Ye,mt;if(!this._finished)return Ye=this._config.chunkSize,Se=Ye?(mt=Se.substring(0,Ye),Se.substring(Ye)):(mt=Se,""),this._finished=!Se,this.parseChunk(mt)}}function we(xe){J.call(this,xe=xe||{});var Se=[],Ye=!0,mt=!1;this.pause=function(){J.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){J.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(gt){this._input=gt,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){mt&&Se.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),Se.length?this.parseChunk(Se.shift()):Ye=!0},this._streamData=xt(function(gt){try{Se.push(typeof gt=="string"?gt:gt.toString(this._config.encoding)),Ye&&(Ye=!1,this._checkIsFinished(),this.parseChunk(Se.shift()))}catch(Gt){this._streamError(Gt)}},this),this._streamError=xt(function(gt){this._streamCleanUp(),this._sendError(gt)},this),this._streamEnd=xt(function(){this._streamCleanUp(),mt=!0,this._streamData("")},this),this._streamCleanUp=xt(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function Oe(xe){var Se,Ye,mt,gt,Gt=Math.pow(2,53),Oi=-Gt,Xi=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,He=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,at=this,At=0,ft=0,Kt=!1,pe=!1,Ue=[],We={data:[],errors:[],meta:{}};function Mt(Ut){return xe.skipEmptyLines==="greedy"?Ut.join("").trim()==="":Ut.length===1&&Ut[0].length===0}function Lt(){if(We&&mt&&(ai("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+j.DefaultDelimiter+"'"),mt=!1),xe.skipEmptyLines&&(We.data=We.data.filter(function(mi){return!Mt(mi)})),Ot()){let mi=function(di,Xt){lt(xe.transformHeader)&&(di=xe.transformHeader(di,Xt)),Ue.push(di)};var ri=mi;if(We)if(Array.isArray(We.data[0])){for(var Ut=0;Ot()&&Ut<We.data.length;Ut++)We.data[Ut].forEach(mi);We.data.splice(0,1)}else We.data.forEach(mi)}function jt(mi,di){for(var Xt=xe.header?{}:[],fi=0;fi<mi.length;fi++){var Jt=fi,wa=mi[fi],wa=((Si,gi)=>(ia=>(xe.dynamicTypingFunction&&xe.dynamicTyping[ia]===void 0&&(xe.dynamicTyping[ia]=xe.dynamicTypingFunction(ia)),(xe.dynamicTyping[ia]||xe.dynamicTyping)===!0))(Si)?gi==="true"||gi==="TRUE"||gi!=="false"&&gi!=="FALSE"&&((ia=>{if(Xi.test(ia)&&(ia=parseFloat(ia),Oi<ia&&ia<Gt))return 1})(gi)?parseFloat(gi):He.test(gi)?new Date(gi):gi===""?null:gi):gi)(Jt=xe.header?fi>=Ue.length?"__parsed_extra":Ue[fi]:Jt,wa=xe.transform?xe.transform(wa,Jt):wa);Jt==="__parsed_extra"?(Xt[Jt]=Xt[Jt]||[],Xt[Jt].push(wa)):Xt[Jt]=wa}return xe.header&&(fi>Ue.length?ai("FieldMismatch","TooManyFields","Too many fields: expected "+Ue.length+" fields but parsed "+fi,ft+di):fi<Ue.length&&ai("FieldMismatch","TooFewFields","Too few fields: expected "+Ue.length+" fields but parsed "+fi,ft+di)),Xt}var Ni;We&&(xe.header||xe.dynamicTyping||xe.transform)&&(Ni=1,!We.data.length||Array.isArray(We.data[0])?(We.data=We.data.map(jt),Ni=We.data.length):We.data=jt(We.data,0),xe.header&&We.meta&&(We.meta.fields=Ue),ft+=Ni)}function Ot(){return xe.header&&Ue.length===0}function ai(Ut,jt,Ni,ri){Ut={type:Ut,code:jt,message:Ni},ri!==void 0&&(Ut.row=ri),We.errors.push(Ut)}lt(xe.step)&&(gt=xe.step,xe.step=function(Ut){We=Ut,Ot()?Lt():(Lt(),We.data.length!==0&&(At+=Ut.data.length,xe.preview&&At>xe.preview?Ye.abort():(We.data=We.data[0],gt(We,at))))}),this.parse=function(Ut,jt,Ni){var ri=xe.quoteChar||'"',ri=(xe.newline||(xe.newline=this.guessLineEndings(Ut,ri)),mt=!1,xe.delimiter?lt(xe.delimiter)&&(xe.delimiter=xe.delimiter(Ut),We.meta.delimiter=xe.delimiter):((ri=((mi,di,Xt,fi,Jt)=>{var wa,Si,gi,ia;Jt=Jt||[",","	","|",";",j.RECORD_SEP,j.UNIT_SEP];for(var qn=0;qn<Jt.length;qn++){for(var Ja,An=Jt[qn],Pi=0,Pn=0,Ui=0,Sa=(gi=void 0,new Ze({comments:fi,delimiter:An,newline:di,preview:10}).parse(mi)),ya=0;ya<Sa.data.length;ya++)Xt&&Mt(Sa.data[ya])?Ui++:(Ja=Sa.data[ya].length,Pn+=Ja,gi===void 0?gi=Ja:0<Ja&&(Pi+=Math.abs(Ja-gi),gi=Ja));0<Sa.data.length&&(Pn/=Sa.data.length-Ui),(Si===void 0||Pi<=Si)&&(ia===void 0||ia<Pn)&&1.99<Pn&&(Si=Pi,wa=An,ia=Pn)}return{successful:!!(xe.delimiter=wa),bestDelimiter:wa}})(Ut,xe.newline,xe.skipEmptyLines,xe.comments,xe.delimitersToGuess)).successful?xe.delimiter=ri.bestDelimiter:(mt=!0,xe.delimiter=j.DefaultDelimiter),We.meta.delimiter=xe.delimiter),Et(xe));return xe.preview&&xe.header&&ri.preview++,Se=Ut,Ye=new Ze(ri),We=Ye.parse(Se,jt,Ni),Lt(),Kt?{meta:{paused:!0}}:We||{meta:{paused:!1}}},this.paused=function(){return Kt},this.pause=function(){Kt=!0,Ye.abort(),Se=lt(xe.chunk)?"":Se.substring(Ye.getCharIndex())},this.resume=function(){at.streamer._halted?(Kt=!1,at.streamer.parseChunk(Se,!0)):setTimeout(at.resume,3)},this.aborted=function(){return pe},this.abort=function(){pe=!0,Ye.abort(),We.meta.aborted=!0,lt(xe.complete)&&xe.complete(We),Se=""},this.guessLineEndings=function(mi,ri){mi=mi.substring(0,1048576);var ri=new RegExp(Ae(ri)+"([^]*?)"+Ae(ri),"gm"),Ni=(mi=mi.replace(ri,"")).split("\r"),ri=mi.split(`
`),mi=1<ri.length&&ri[0].length<Ni[0].length;if(Ni.length===1||mi)return`
`;for(var di=0,Xt=0;Xt<Ni.length;Xt++)Ni[Xt][0]===`
`&&di++;return di>=Ni.length/2?`\r
`:"\r"}}function Ae(xe){return xe.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Ze(xe){var Se=(xe=xe||{}).delimiter,Ye=xe.newline,mt=xe.comments,gt=xe.step,Gt=xe.preview,Oi=xe.fastMode,Xi=null,He=!1,at=xe.quoteChar==null?'"':xe.quoteChar,At=at;if(xe.escapeChar!==void 0&&(At=xe.escapeChar),(typeof Se!="string"||-1<j.BAD_DELIMITERS.indexOf(Se))&&(Se=","),mt===Se)throw new Error("Comment character same as delimiter");mt===!0?mt="#":(typeof mt!="string"||-1<j.BAD_DELIMITERS.indexOf(mt))&&(mt=!1),Ye!==`
`&&Ye!=="\r"&&Ye!==`\r
`&&(Ye=`
`);var ft=0,Kt=!1;this.parse=function(pe,Ue,We){if(typeof pe!="string")throw new Error("Input must be a string");var Mt=pe.length,Lt=Se.length,Ot=Ye.length,ai=mt.length,Ut=lt(gt),jt=[],Ni=[],ri=[],mi=ft=0;if(!pe)return Pi();if(Oi||Oi!==!1&&pe.indexOf(at)===-1){for(var di=pe.split(Ye),Xt=0;Xt<di.length;Xt++){if(ri=di[Xt],ft+=ri.length,Xt!==di.length-1)ft+=Ye.length;else if(We)return Pi();if(!mt||ri.substring(0,ai)!==mt){if(Ut){if(jt=[],ia(ri.split(Se)),Pn(),Kt)return Pi()}else ia(ri.split(Se));if(Gt&&Gt<=Xt)return jt=jt.slice(0,Gt),Pi(!0)}}return Pi()}for(var fi=pe.indexOf(Se,ft),Jt=pe.indexOf(Ye,ft),wa=new RegExp(Ae(At)+Ae(at),"g"),Si=pe.indexOf(at,ft);;)if(pe[ft]===at)for(Si=ft,ft++;;){if((Si=pe.indexOf(at,Si+1))===-1)return We||Ni.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:jt.length,index:ft}),Ja();if(Si===Mt-1)return Ja(pe.substring(ft,Si).replace(wa,at));if(at===At&&pe[Si+1]===At)Si++;else if(at===At||Si===0||pe[Si-1]!==At){fi!==-1&&fi<Si+1&&(fi=pe.indexOf(Se,Si+1));var gi=qn((Jt=Jt!==-1&&Jt<Si+1?pe.indexOf(Ye,Si+1):Jt)===-1?fi:Math.min(fi,Jt));if(pe.substr(Si+1+gi,Lt)===Se){ri.push(pe.substring(ft,Si).replace(wa,at)),pe[ft=Si+1+gi+Lt]!==at&&(Si=pe.indexOf(at,ft)),fi=pe.indexOf(Se,ft),Jt=pe.indexOf(Ye,ft);break}if(gi=qn(Jt),pe.substring(Si+1+gi,Si+1+gi+Ot)===Ye){if(ri.push(pe.substring(ft,Si).replace(wa,at)),An(Si+1+gi+Ot),fi=pe.indexOf(Se,ft),Si=pe.indexOf(at,ft),Ut&&(Pn(),Kt))return Pi();if(Gt&&jt.length>=Gt)return Pi(!0);break}Ni.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:jt.length,index:ft}),Si++}}else if(mt&&ri.length===0&&pe.substring(ft,ft+ai)===mt){if(Jt===-1)return Pi();ft=Jt+Ot,Jt=pe.indexOf(Ye,ft),fi=pe.indexOf(Se,ft)}else if(fi!==-1&&(fi<Jt||Jt===-1))ri.push(pe.substring(ft,fi)),ft=fi+Lt,fi=pe.indexOf(Se,ft);else{if(Jt===-1)break;if(ri.push(pe.substring(ft,Jt)),An(Jt+Ot),Ut&&(Pn(),Kt))return Pi();if(Gt&&jt.length>=Gt)return Pi(!0)}return Ja();function ia(Ui){jt.push(Ui),mi=ft}function qn(Ui){var Sa=0;return Sa=Ui!==-1&&(Ui=pe.substring(Si+1,Ui))&&Ui.trim()===""?Ui.length:Sa}function Ja(Ui){return We||(Ui===void 0&&(Ui=pe.substring(ft)),ri.push(Ui),ft=Mt,ia(ri),Ut&&Pn()),Pi()}function An(Ui){ft=Ui,ia(ri),ri=[],Jt=pe.indexOf(Ye,ft)}function Pi(Ui){if(xe.header&&!Ue&&jt.length&&!He){var Sa=jt[0],ya=Object.create(null),ve=new Set(Sa);let H=!1;for(let $=0;$<Sa.length;$++){let te=Sa[$];if(ya[te=lt(xe.transformHeader)?xe.transformHeader(te,$):te]){let ce,fe=ya[te];for(;ce=te+"_"+fe,fe++,ve.has(ce););ve.add(ce),Sa[$]=ce,ya[te]++,H=!0,(Xi=Xi===null?{}:Xi)[ce]=te}else ya[te]=1,Sa[$]=te;ve.add(te)}H&&console.warn("Duplicate headers found and renamed."),He=!0}return{data:jt,errors:Ni,meta:{delimiter:Se,linebreak:Ye,aborted:Kt,truncated:!!Ui,cursor:mi+(Ue||0),renamedHeaders:Xi}}}function Pn(){gt(Pi()),jt=[],Ni=[]}},this.abort=function(){Kt=!0},this.getCharIndex=function(){return ft}}function Be(xe){var Se=xe.data,Ye=o[Se.workerId],mt=!1;if(Se.error)Ye.userError(Se.error,Se.file);else if(Se.results&&Se.results.data){var gt={abort:function(){mt=!0,Ke(Se.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:vt,resume:vt};if(lt(Ye.userStep)){for(var Gt=0;Gt<Se.results.data.length&&(Ye.userStep({data:Se.results.data[Gt],errors:Se.results.errors,meta:Se.results.meta},gt),!mt);Gt++);delete Se.results}else lt(Ye.userChunk)&&(Ye.userChunk(Se.results,gt,Se.file),delete Se.results)}Se.finished&&!mt&&Ke(Se.workerId,Se.results)}function Ke(xe,Se){var Ye=o[xe];lt(Ye.userComplete)&&Ye.userComplete(Se),Ye.terminate(),delete o[xe]}function vt(){throw new Error("Not implemented.")}function Et(xe){if(typeof xe!="object"||xe===null)return xe;var Se,Ye=Array.isArray(xe)?[]:{};for(Se in xe)Ye[Se]=Et(xe[Se]);return Ye}function xt(xe,Se){return function(){xe.apply(Se,arguments)}}function lt(xe){return typeof xe=="function"}return j.parse=function(xe,Se){var Ye=(Se=Se||{}).dynamicTyping||!1;if(lt(Ye)&&(Se.dynamicTypingFunction=Ye,Ye={}),Se.dynamicTyping=Ye,Se.transform=!!lt(Se.transform)&&Se.transform,!Se.worker||!j.WORKERS_SUPPORTED)return Ye=null,j.NODE_STREAM_INPUT,typeof xe=="string"?(xe=(mt=>mt.charCodeAt(0)!==65279?mt:mt.slice(1))(xe),Ye=new(Se.download?K:ee)(Se)):xe.readable===!0&&lt(xe.read)&&lt(xe.on)?Ye=new we(Se):(C.File&&xe instanceof File||xe instanceof Object)&&(Ye=new W(Se)),Ye.stream(xe);(Ye=(()=>{var mt;return!!j.WORKERS_SUPPORTED&&(mt=(()=>{var gt=C.URL||C.webkitURL||null,Gt=w.toString();return j.BLOB_URL||(j.BLOB_URL=gt.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",Gt,")();"],{type:"text/javascript"})))})(),(mt=new C.Worker(mt)).onmessage=Be,mt.id=B++,o[mt.id]=mt)})()).userStep=Se.step,Ye.userChunk=Se.chunk,Ye.userComplete=Se.complete,Ye.userError=Se.error,Se.step=lt(Se.step),Se.chunk=lt(Se.chunk),Se.complete=lt(Se.complete),Se.error=lt(Se.error),delete Se.worker,Ye.postMessage({input:xe,config:Se,workerId:Ye.id})},j.unparse=function(xe,Se){var Ye=!1,mt=!0,gt=",",Gt=`\r
`,Oi='"',Xi=Oi+Oi,He=!1,at=null,At=!1,ft=((()=>{if(typeof Se=="object"){if(typeof Se.delimiter!="string"||j.BAD_DELIMITERS.filter(function(Ue){return Se.delimiter.indexOf(Ue)!==-1}).length||(gt=Se.delimiter),typeof Se.quotes!="boolean"&&typeof Se.quotes!="function"&&!Array.isArray(Se.quotes)||(Ye=Se.quotes),typeof Se.skipEmptyLines!="boolean"&&typeof Se.skipEmptyLines!="string"||(He=Se.skipEmptyLines),typeof Se.newline=="string"&&(Gt=Se.newline),typeof Se.quoteChar=="string"&&(Oi=Se.quoteChar),typeof Se.header=="boolean"&&(mt=Se.header),Array.isArray(Se.columns)){if(Se.columns.length===0)throw new Error("Option columns is empty");at=Se.columns}Se.escapeChar!==void 0&&(Xi=Se.escapeChar+Oi),Se.escapeFormulae instanceof RegExp?At=Se.escapeFormulae:typeof Se.escapeFormulae=="boolean"&&Se.escapeFormulae&&(At=/^[=+\-@\t\r].*$/)}})(),new RegExp(Ae(Oi),"g"));if(typeof xe=="string"&&(xe=JSON.parse(xe)),Array.isArray(xe)){if(!xe.length||Array.isArray(xe[0]))return Kt(null,xe,He);if(typeof xe[0]=="object")return Kt(at||Object.keys(xe[0]),xe,He)}else if(typeof xe=="object")return typeof xe.data=="string"&&(xe.data=JSON.parse(xe.data)),Array.isArray(xe.data)&&(xe.fields||(xe.fields=xe.meta&&xe.meta.fields||at),xe.fields||(xe.fields=Array.isArray(xe.data[0])?xe.fields:typeof xe.data[0]=="object"?Object.keys(xe.data[0]):[]),Array.isArray(xe.data[0])||typeof xe.data[0]=="object"||(xe.data=[xe.data])),Kt(xe.fields||[],xe.data||[],He);throw new Error("Unable to serialize unrecognized input");function Kt(Ue,We,Mt){var Lt="",Ot=(typeof Ue=="string"&&(Ue=JSON.parse(Ue)),typeof We=="string"&&(We=JSON.parse(We)),Array.isArray(Ue)&&0<Ue.length),ai=!Array.isArray(We[0]);if(Ot&&mt){for(var Ut=0;Ut<Ue.length;Ut++)0<Ut&&(Lt+=gt),Lt+=pe(Ue[Ut],Ut);0<We.length&&(Lt+=Gt)}for(var jt=0;jt<We.length;jt++){var Ni=(Ot?Ue:We[jt]).length,ri=!1,mi=Ot?Object.keys(We[jt]).length===0:We[jt].length===0;if(Mt&&!Ot&&(ri=Mt==="greedy"?We[jt].join("").trim()==="":We[jt].length===1&&We[jt][0].length===0),Mt==="greedy"&&Ot){for(var di=[],Xt=0;Xt<Ni;Xt++){var fi=ai?Ue[Xt]:Xt;di.push(We[jt][fi])}ri=di.join("").trim()===""}if(!ri){for(var Jt=0;Jt<Ni;Jt++){0<Jt&&!mi&&(Lt+=gt);var wa=Ot&&ai?Ue[Jt]:Jt;Lt+=pe(We[jt][wa],Jt)}jt<We.length-1&&(!Mt||0<Ni&&!mi)&&(Lt+=Gt)}}return Lt}function pe(Ue,We){var Mt,Lt;return Ue==null?"":Ue.constructor===Date?JSON.stringify(Ue).slice(1,25):(Lt=!1,At&&typeof Ue=="string"&&At.test(Ue)&&(Ue="'"+Ue,Lt=!0),Mt=Ue.toString().replace(ft,Xi),(Lt=Lt||Ye===!0||typeof Ye=="function"&&Ye(Ue,We)||Array.isArray(Ye)&&Ye[We]||((Ot,ai)=>{for(var Ut=0;Ut<ai.length;Ut++)if(-1<Ot.indexOf(ai[Ut]))return!0;return!1})(Mt,j.BAD_DELIMITERS)||-1<Mt.indexOf(gt)||Mt.charAt(0)===" "||Mt.charAt(Mt.length-1)===" ")?Oi+Mt+Oi:Mt)}},j.RECORD_SEP="",j.UNIT_SEP="",j.BYTE_ORDER_MARK="\uFEFF",j.BAD_DELIMITERS=["\r",`
`,'"',j.BYTE_ORDER_MARK],j.WORKERS_SUPPORTED=!D&&!!C.Worker,j.NODE_STREAM_INPUT=1,j.LocalChunkSize=10485760,j.RemoteChunkSize=5242880,j.DefaultDelimiter=",",j.Parser=Ze,j.ParserHandle=Oe,j.NetworkStreamer=K,j.FileStreamer=W,j.StringStreamer=ee,j.ReadableStreamStreamer=we,C.jQuery&&((P=C.jQuery).fn.parse=function(xe){var Se=xe.config||{},Ye=[];return this.each(function(Gt){if(!(P(this).prop("tagName").toUpperCase()==="INPUT"&&P(this).attr("type").toLowerCase()==="file"&&C.FileReader)||!this.files||this.files.length===0)return!0;for(var Oi=0;Oi<this.files.length;Oi++)Ye.push({file:this.files[Oi],inputElem:this,instanceConfig:P.extend({},Se)})}),mt(),this;function mt(){if(Ye.length===0)lt(xe.complete)&&xe.complete();else{var Gt,Oi,Xi,He,at=Ye[0];if(lt(xe.before)){var At=xe.before(at.file,at.inputElem);if(typeof At=="object"){if(At.action==="abort")return Gt="AbortError",Oi=at.file,Xi=at.inputElem,He=At.reason,void(lt(xe.error)&&xe.error({name:Gt},Oi,Xi,He));if(At.action==="skip")return void gt();typeof At.config=="object"&&(at.instanceConfig=P.extend(at.instanceConfig,At.config))}else if(At==="skip")return void gt()}var ft=at.instanceConfig.complete;at.instanceConfig.complete=function(Kt){lt(ft)&&ft(Kt,at.file,at.inputElem),gt()},j.parse(at.file,at.instanceConfig)}}function gt(){Ye.splice(0,1),mt()}}),E&&(C.onmessage=function(xe){xe=xe.data,j.WORKER_ID===void 0&&xe&&(j.WORKER_ID=xe.workerId),typeof xe.input=="string"?C.postMessage({workerId:j.WORKER_ID,results:j.parse(xe.input,xe.config),finished:!0}):(C.File&&xe.input instanceof File||xe.input instanceof Object)&&(xe=j.parse(xe.input,xe.config))&&C.postMessage({workerId:j.WORKER_ID,results:xe,finished:!0})}),(K.prototype=Object.create(J.prototype)).constructor=K,(W.prototype=Object.create(J.prototype)).constructor=W,(ee.prototype=Object.create(ee.prototype)).constructor=ee,(we.prototype=Object.create(J.prototype)).constructor=we,j})})(Um)),Um.exports}var mw=pw();const gw=F_(mw);function _w({csvUrl:u}){const[y,w]=Qe.useState([]);if(Qe.useEffect(()=>{u&&gw.parse(u,{download:!0,header:!0,complete:P=>w(P.data)})},[u]),!y?.length)return Re.jsx("div",{children:"Loading"});const C=Object.keys(y[0]);return Re.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[Re.jsx("thead",{children:Re.jsx("tr",{children:C.map(P=>Re.jsx("th",{style:{textAlign:"left",borderBottom:"1px solid #ddd",padding:"6px 8px"},children:P},P))})}),Re.jsx("tbody",{children:y.map((P,D)=>Re.jsx("tr",{children:C.map(E=>Re.jsx("td",{style:{borderBottom:"1px solid #eee",padding:"6px 8px"},children:P[E]},E))},D))})]})}let N_=!1;N_||(qg.setRTLTextPlugin("https://unpkg.com/@mapbox/mapbox-gl-rtl-text@0.2.3/mapbox-gl-rtl-text.min.js",u=>{u?console.error("RTL plugin failed to load:",u):console.log("RTL plugin loaded successfully")},!0),N_=!0);function yw({onReady:u,onDotClick:y,grayscale:w=!1,showVideoPoints:C=!1,scrollContainer:P=null,visibleSiteIds:D=[]}){const E=Qe.useRef(null),o=Qe.useRef(null),B=Qe.useRef([]),j=Qe.useRef(D),[J,K]=Qe.useState(!1),[W,ee]=Qe.useState({visible:!1,x:0,y:0,text:""}),[we,Oe]=Qe.useState({open:!1,title:"",csvUrl:"",type:"data"});return Qe.useEffect(()=>{const Ae="JEADPH6EaF6ncO48MUFJ";if(console.log("MapCanvas: initializing, key present:",!0,"container:",!!E.current,"existing map:",!!o.current),!E.current){console.error("MapCanvas: container ref not available");return}if(o.current){console.log("MapCanvas: map already exists, skipping");return}const Ze=`https://api.maptiler.com/maps/satellite/style.json?key=${Ae}`;console.log("MapCanvas: using style URL:",Ze.replace(Ae,"XXXX")),console.log("MapCanvas: creating map instance...");const Be=new qg.Map({container:E.current,style:Ze,center:[35.35,31.8],zoom:8,pitch:45,bearing:-10,hash:!0,scrollZoom:!1});return o.current=Be,console.log("MapCanvas: map instance created"),Be.on("error",Ke=>{console.error("MapLibre error:",Ke.error)}),Be.on("load",async()=>{console.log("MapCanvas: map loaded");try{Be.addSource("terrain",{type:"raster-dem",url:`https://api.maptiler.com/tiles/terrain-rgb/tiles.json?key=${Ae}`,tileSize:256}),Be.setTerrain({source:"terrain",exaggeration:1.3}),console.log("MapCanvas: terrain added")}catch(Ke){console.error("MapCanvas: terrain setup error:",Ke)}try{const Ke=[[34.737255684304955,32.56348699254539],[35.57650523264138,32.56348699254539],[35.57650523264138,31.31355578154553],[34.737255684304955,31.31355578154553]];Be.addSource("west-bank-overlay",{type:"image",url:"/assets/map_resized2.png",coordinates:Ke}),Be.addLayer({id:"west-bank-overlay-layer",type:"raster",source:"west-bank-overlay",layout:{visibility:"none"},paint:{"raster-opacity":1}}),console.log("MapCanvas: West Bank overlay added (hidden)")}catch(Ke){console.error("MapCanvas: West Bank overlay setup error:",Ke)}try{const Ke=w?16:23;console.log("MapCanvas: loading site points with pinSize:",Ke,"grayscale:",w);const vt=await uw(Be,hv,"sites","site-points",!0,Ke);B.current=vt,console.log("MapCanvas: site points loaded"),vt.forEach(({marker:xt,siteId:lt,name:xe,meta:Se})=>{const Ye=xt.getElement();Ye.addEventListener("mouseenter",mt=>{const gt=Ye.getBoundingClientRect(),Gt=E.current.getBoundingClientRect();ee({visible:!0,x:gt.left-Gt.left+gt.width/2,y:gt.top-Gt.top,text:xe})}),Ye.addEventListener("mouseleave",()=>{ee(mt=>({...mt,visible:!1}))}),Ye.addEventListener("click",()=>{Oe({open:!0,title:Se.name,csvUrl:Se.tableCsv,type:"data"}),y?.()})});const Et=j.current;console.log("MapCanvas: applying initial visibility, visibleSiteIds:",Et),vt.forEach(({marker:xt,siteId:lt})=>{const xe=xt.getElement();Et.includes(lt)?xe.style.display="":xe.style.display="none"}),K(!0),u?.({map:Be,showWestBankOverlay:xt=>{Be.getLayer("west-bank-overlay-layer")&&(Be.setLayoutProperty("west-bank-overlay-layer","visibility",xt?"visible":"none"),console.log("MapCanvas: West Bank overlay visibility:",xt?"visible":"none"))}})}catch(Ke){console.error("MapCanvas: site points error:",Ke)}}),()=>{Be.remove()}},[]),Qe.useEffect(()=>{if(!o.current||!P)return;const Ae=o.current.getCanvas(),Ze=xt=>{if(xt.ctrlKey||xt.metaKey)return;xt.preventDefault();const lt=xt.deltaY;try{P.scrollBy({top:lt,behavior:"auto"})}catch{}};let Be=null;const Ke=xt=>{xt.touches&&xt.touches.length===1&&(Be=xt.touches[0].clientY)},vt=xt=>{if(Be==null)return;const lt=xt.touches[0].clientY,xe=Be-lt;if(Math.abs(xe)>0){xt.preventDefault();try{P.scrollBy({top:xe,behavior:"auto"})}catch{}}},Et=()=>{Be=null};return Ae.addEventListener("wheel",Ze,{passive:!1}),Ae.addEventListener("touchstart",Ke,{passive:!0}),Ae.addEventListener("touchmove",vt,{passive:!1}),Ae.addEventListener("touchend",Et,{passive:!0}),()=>{Ae.removeEventListener("wheel",Ze),Ae.removeEventListener("touchstart",Ke),Ae.removeEventListener("touchmove",vt),Ae.removeEventListener("touchend",Et)}},[P]),Qe.useEffect(()=>{if(!o.current)return;const Ae=o.current.getCanvas();w?Ae.style.filter="grayscale(100%) contrast(0.9)":Ae.style.filter="";const Ze=w?16:23;B.current.forEach(({marker:Be})=>{const Ke=Be.getElement().querySelector("img");Ke&&(Ke.style.width=`${Ze}px`)})},[w]),Qe.useEffect(()=>{j.current=D},[D]),Qe.useEffect(()=>{J&&(console.log("MapCanvas: updating visibility, visibleSiteIds:",D),B.current.forEach(({marker:Ae,siteId:Ze})=>{const Be=Ae.getElement();D.includes(Ze)?Be.style.display="":Be.style.display="none"}))},[D,J]),Re.jsxs("div",{style:{position:"relative",width:"100%",height:"100%"},children:[Re.jsx("div",{ref:E,style:{width:"100%",height:"100%"}}),Re.jsx(hw,{...W}),Re.jsx(dw,{open:we.open,title:we.title,onClose:()=>Oe(Ae=>({...Ae,open:!1})),children:we.type==="data"?Re.jsx(_w,{csvUrl:we.csvUrl}):Re.jsxs("div",{style:{padding:"24px",textAlign:"center"},children:[Re.jsx("div",{style:{width:"100%",height:"400px",background:"#1a1a1a",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",color:"#888",fontSize:"16px"},children:"Video Placeholder"}),Re.jsx("p",{style:{marginTop:"16px",color:"#ddd"},children:"This will be replaced with an actual video player"})]})})]})}const vw=JSON.parse(`[{"id":"intro","camera":{"center":[34.761,32.312],"zoom":8,"pitch":59,"bearing":35.3,"duration":2000}},{"id":"sub-intro","camera":{"center":[35.3354,32.1942],"zoom":9.5,"pitch":0,"bearing":17,"duration":2000}},{"id":"farsia-village","siteId":"farsia","camera":{"center":[35.51246,32.34591],"zoom":14.3,"pitch":1,"bearing":7.5,"duration":2500},"content":{"title":"Al - Farsia Story","text":"The word \\"village\\" may be an overstatement. Farj'a Nabaa al-Ghazzal is a Bedouin community, where a group of Palestinian families settled around 20 people, all belonging to the Harashina family. According to Ahmed, they have lived in this location for 47 years - they settled in this area because it was a good place for agricultural lands and find better pastures, sometimes as a consequence of forced displacement by Israeli settlers and the army. Most of these communities in the occupied West Bank also face an extremely difficult reality and are under the standing."}},{"id":"farsia-video","siteId":"farsia-video","camera":{"center":[35.509386,32.343125],"zoom":17,"pitch":1,"bearing":7.5,"duration":2500},"content":{"title":"Life in Al-Farsia","text":"They own a few hundred sheep, and a small patch of agricultural land, where they grow barley to feed the sheep. This is the economic backbone of the tiny community, they sell the lamb and sheep cheese, buy everything else they need from the markets. Both agriculture and grazing have become increasingly difficult because of pressure from Israeli settlers living nearby, who have cut Farsiya off its grazing land, and frequently damage the agricultural fields by grazing their own sheep flocks there."}},{"id":"farsia-village-2","siteId":"farsia-village-2","camera":{"center":[35.509386,32.343125],"zoom":17,"pitch":1,"bearing":7.5,"duration":2500},"content":{"title":"Al - Farsia Story","text":"The word \\"village\\" may be an overstatement. Farj'a Nabaa al-Ghazzal is a Bedouin community, where a group of Palestinian families settled around 20 people, all belonging to the Harashina family. According to Ahmed, they have lived in this location for 47 years - they settled in this area because it was a good place for agricultural lands and find better pastures, sometimes as a consequence of forced displacement by Israeli settlers and the army. Most of these communities in the occupied West Bank also face an extremely difficult reality and are under the standing."}},{"id":"rotem","siteId":"rotem","camera":{"center":[35.510981,32.340291],"zoom":15.4,"pitch":1,"bearing":7.5,"duration":2500},"content":{"title":"rotem","text":"Rotem is a settlement in the Jordan Valley, built in 1983. It is home to around 1000 people, most of whom are Jewish. The settlement is home to a number of Israeli military bases, and is a major center of Israeli military activity in the Jordan Valley."}},{"id":"rotem-video","siteId":"rotem-video","camera":{"center":[35.510981,32.340291],"zoom":15.4,"pitch":1,"bearing":7.5,"duration":2500},"content":{"title":"rotem-video","text":"Rotem is a settlement in the Jordan Valley, built in 1983. It is home to around 1000 people, most of whom are Jewish. The settlement is home to a number of Israeli military bases, and is a major center of Israeli military activity in the Jordan Valley."}},{"id":"settlements","siteId":"settlements","camera":{"center":[35.51224,32.34475],"zoom":14.2,"pitch":1,"bearing":7.5,"duration":2500},"content":{"title":"settlements","text":"The word \\"village\\" may be an overstatement. Farj'a Nabaa al-Ghazzal is a Bedouin community, where a group of Palestinian families settled around 20 people, all belonging to the Harashina family. According to Ahmed, they have lived in this location for 47 years - they settled in this area because it was a good place for agricultural lands and find better pastures, sometimes as a consequence of forced displacement by Israeli settlers and the army. Most of these communities in the occupied West Bank also face an extremely difficult reality and are under the standing."}},{"id":"shdemot-mehola","siteId":"shdemot-mehola","camera":{"center":[35.529608,32.346104],"zoom":15.4,"pitch":1,"bearing":7.5,"duration":2500},"content":{"title":"shdemot-mehola","text":"The word \\"village\\" may be an overstatement. Farj'a Nabaa al-Ghazzal is a Bedouin community, where a group of Palestinian families settled around 20 people, all belonging to the Harashina family. According to Ahmed, they have lived in this location for 47 years - they settled in this area because it was a good place for agricultural lands and find better pastures, sometimes as a consequence of forced displacement by Israeli settlers and the army. Most of these communities in the occupied West Bank also face an extremely difficult reality and are under the standing."}},{"id":"shdemot-mehola-zoom","siteId":"shdemot-mehola-zoom","camera":{"center":[35.528826,32.348095],"zoom":16.11,"pitch":1,"bearing":7.5,"duration":2500},"content":{"title":"shdemot-mehola-zoom","text":"The word \\"village\\" may be an overstatement. Farj'a Nabaa al-Ghazzal is a Bedouin community, where a group of Palestinian families settled around 20 people, all belonging to the Harashina family. According to Ahmed, they have lived in this location for 47 years - they settled in this area because it was a good place for agricultural lands and find better pastures, sometimes as a consequence of forced displacement by Israeli settlers and the army. Most of these communities in the occupied West Bank also face an extremely difficult reality and are under the standing."}},{"id":"shdemot-mehola-zoom-2","siteId":"shdemot-mehola-zoom-2","camera":{"center":[35.528826,32.348095],"zoom":16.11,"pitch":1,"bearing":7.5,"duration":2500},"content":{"title":"shdemot-mehola-zoom","text":"The word \\"village\\" may be an overstatement. Farj'a Nabaa al-Ghazzal is a Bedouin community, where a group of Palestinian families settled around 20 people, all belonging to the Harashina family. According to Ahmed, they have lived in this location for 47 years - they settled in this area because it was a good place for agricultural lands and find better pastures, sometimes as a consequence of forced displacement by Israeli settlers and the army. Most of these communities in the occupied West Bank also face an extremely difficult reality and are under the standing."}},{"id":"shdemot-mehola-video","siteId":"shdemot-mehola-video","camera":{"center":[35.528826,32.348095],"zoom":16.11,"pitch":1,"bearing":7.5,"duration":2500},"content":{"title":"shdemot-mehola-video","text":"The word \\"village\\" may be an overstatement. Farj'a Nabaa al-Ghazzal is a Bedouin community, where a group of Palestinian families settled around 20 people, all belonging to the Harashina family. According to Ahmed, they have lived in this location for 47 years - they settled in this area because it was a good place for agricultural lands and find better pastures, sometimes as a consequence of forced displacement by Israeli settlers and the army. Most of these communities in the occupied West Bank also face an extremely difficult reality and are under the standing."}},{"id":"shdemot-mehola-out","siteId":"shdemot-mehola-out","camera":{"center":[35.529608,32.346104],"zoom":15.4,"pitch":1,"bearing":7.5,"duration":2500},"content":{"title":"shdemot-mehola","text":"The word \\"village\\" may be an overstatement. Farj'a Nabaa al-Ghazzal is a Bedouin community, where a group of Palestinian families settled around 20 people, all belonging to the Harashina family. According to Ahmed, they have lived in this location for 47 years - they settled in this area because it was a good place for agricultural lands and find better pastures, sometimes as a consequence of forced displacement by Israeli settlers and the army. Most of these communities in the occupied West Bank also face an extremely difficult reality and are under the standing."}},{"id":"shdemot-mehola-solar-field","siteId":"shdemot-mehola-solar-field","camera":{"center":[35.532462,32.342895],"zoom":16.33,"pitch":1,"bearing":7.5,"duration":2500},"content":{"title":"shdemot-mehola","text":"The word \\"village\\" may be an overstatement. Farj'a Nabaa al-Ghazzal is a Bedouin community, where a group of Palestinian families settled around 20 people, all belonging to the Harashina family. According to Ahmed, they have lived in this location for 47 years - they settled in this area because it was a good place for agricultural lands and find better pastures, sometimes as a consequence of forced displacement by Israeli settlers and the army. Most of these communities in the occupied West Bank also face an extremely difficult reality and are under the standing."}},{"id":"shdemot-mehola-solar-video","siteId":"shdemot-mehola-solar-video","camera":{"center":[35.532462,32.342895],"zoom":16.33,"pitch":1,"bearing":7.5,"duration":2500},"content":{"title":"shdemot-mehola","text":"The word \\"village\\" may be an overstatement. Farj'a Nabaa al-Ghazzal is a Bedouin community, where a group of Palestinian families settled around 20 people, all belonging to the Harashina family. According to Ahmed, they have lived in this location for 47 years - they settled in this area because it was a good place for agricultural lands and find better pastures, sometimes as a consequence of forced displacement by Israeli settlers and the army. Most of these communities in the occupied West Bank also face an extremely difficult reality and are under the standing."}},{"id":"settlements-2","siteId":"settlements","camera":{"center":[35.51224,32.34475],"zoom":14.2,"pitch":1,"bearing":7.5,"duration":2500},"content":{"title":"settlements","text":"The word \\"village\\" may be an overstatement. Farj'a Nabaa al-Ghazzal is a Bedouin community, where a group of Palestinian families settled around 20 people, all belonging to the Harashina family. According to Ahmed, they have lived in this location for 47 years - they settled in this area because it was a good place for agricultural lands and find better pastures, sometimes as a consequence of forced displacement by Israeli settlers and the army. Most of these communities in the occupied West Bank also face an extremely difficult reality and are under the standing."}},{"id":"sub-intro-2","camera":{"center":[35.3354,32.1942],"zoom":9.5,"pitch":0,"bearing":17,"duration":2000}},{"id":"naama-nueima","camera":{"center":[35.4318,31.91065],"zoom":13.48,"pitch":0,"bearing":17,"duration":2000}},{"id":"naama","camera":{"center":[35.45707,31.91369],"zoom":15.03,"pitch":0,"bearing":17,"duration":2000}},{"id":"jericho-governate","camera":{"center":[35.45773934819883,31.86783239284061],"zoom":15.03,"pitch":0,"bearing":17,"duration":2000}}]`);function xw(u,y,w,C={}){const{root:P=null}=C,D=y.map(o=>{const B=document.querySelector(`[data-scene-id="${o.id}"]`);return B||console.warn(` Scene element not found: ${o.id}`),{step:o,el:B}}),E=new IntersectionObserver(o=>{o.forEach(B=>{if(B.isIntersecting&&B.intersectionRatio>=.5){const j=B.target.getAttribute("data-scene-id"),J=y.find(K=>K.id===j);console.log(` Scene changed to: ${j}`,J?.camera),J?.camera&&u.easeTo({...J.camera}),w&&w(j)}})},{root:P,threshold:.5});return D.forEach(({el:o})=>o&&E.observe(o)),console.log(` Observing ${D.filter(o=>o.el).length} scenes`),()=>E.disconnect()}const bw={intro:{reset:!0,show:["farsia","naama","nueima","shdemot-mehola"],hide:["naama-solar-fields","nueima-solar-fields","rotem"]},"farsia-village":{hide:["naama-solar-fields","nueima-solar-fields"],show:["farsia","shdemot-mehola-solar"]},"farsia-video":{hide:["naama-solar-fields","nueima-solar-fields"],show:[]},rotem:{show:["rotem"]},settlements:{hide:["naama-solar-fields","nueima-solar-fields"],show:[]},"sub-intro-2":{hide:["naama-solar-fields","nueima-solar-fields","rotem","shdemot-mehola-solar"],show:[]},"naama-nueima":{hide:[],show:["naama-solar-fields","nueima-solar-fields"]}};function ww({children:u}){return Re.jsx("div",{className:"app",children:u})}function j_(){const[u,y]=Qe.useState(null),[w,C]=Qe.useState("intro"),[P,D]=Qe.useState(!1),[E,o]=Qe.useState(!0),[B,j]=Qe.useState([]),[J,K]=Qe.useState(!1),W=Qe.useRef(null),ee=Qe.useRef(!1),we=Qe.useRef(null),Oe=vt=>{vt==="intro"?o(!0):(ee.current=!0,o(!1),D(!0)),document.querySelector(`[data-scene-id="${vt}"]`)?.scrollIntoView({behavior:"smooth"})},Ae=()=>{o(!1)};Qe.useEffect(()=>{if(!u?.map)return;const vt=xw(u.map,vw,Et=>{console.log(" Scene changed:",Et,"storyStarted:",P),C(Et),Et==="farsia-village"&&!P&&(console.log(" Auto-starting story!"),D(!0)),Et==="intro"&&(ee.current?ee.current=!1:o(!0))},{root:W.current||null});return()=>vt?.()},[u,P]),Qe.useEffect(()=>{if(!u?.showWestBankOverlay)return;const vt=w==="sub-intro";u.showWestBankOverlay(vt)},[w,u]),Qe.useEffect(()=>{console.log(" State update - storyStarted:",P,"currentScene:",w)},[P,w]),Qe.useEffect(()=>{w!=="farsia-video"&&we.current&&(we.current.pause(),K(!1))},[w]);const Ze=()=>{we.current&&(we.current.play(),K(!0))},Be=()=>K(!0),Ke=()=>K(!1);return Qe.useEffect(()=>{const vt=bw[w];vt&&j(Et=>{let xt=vt.reset?[]:[...Et];if(vt.hide?.length&&(xt=xt.filter(lt=>!vt.hide.includes(lt))),vt.show?.length)for(const lt of vt.show)xt.includes(lt)||xt.push(lt);return xt})},[w]),Re.jsxs("div",{className:"landing",ref:W,children:[Re.jsxs("header",{className:"landing-header",children:[Re.jsx("div",{className:"logo",children:Re.jsx("img",{src:"/assets/Camel.png",alt:"Camel logo"})}),Re.jsxs("div",{className:"chapter-nav",children:[Re.jsx("button",{style:{fontFamily:"Suisse Intl"},onClick:()=>Oe("intro"),className:"start-button",children:"Start"}),Re.jsx("button",{style:{fontFamily:"Suisse Intl"},onClick:()=>Oe("farsia-village"),className:"start-button",children:"Al-Farsia"}),Re.jsx("button",{style:{fontFamily:"Suisse Intl"},onClick:()=>Oe("naama-nueima"),className:"start-button",children:"Nu'eima"})]}),Re.jsx("nav",{className:"landing-nav",children:Re.jsxs(Vg,{target:"_blank",to:"https://caravancollective.org/",children:[Re.jsx("span",{style:{fontFamily:"El Messiri"},children:"Caravan"})," ",Re.jsx("span",{style:{fontFamily:"Suisse Intl"},children:"Collective"})]})})]}),Re.jsx("div",{className:"landing-map",children:Re.jsx(yw,{onReady:y,grayscale:w==="intro",onDotClick:Ae,scrollContainer:W.current,visibleSiteIds:B})}),Re.jsxs("div",{className:"scroll-container",children:[Re.jsx("div",{"data-scene-id":"intro",className:"scroll-section",children:E&&Re.jsxs("div",{className:"hero-card",children:[Re.jsx("h1",{className:"hero-title",children:"The Occupation of the Sun"}),Re.jsx("h2",{className:"hero-subtitle",children:"Research Project Investigating the Energy Industry in the Israeli-Occupied West Bank"}),Re.jsx("div",{className:"hero-body"})]})}),Re.jsx("div",{"data-scene-id":"sub-intro",className:"scroll-section"}),Re.jsx("div",{"data-scene-id":"farsia-village",className:"scroll-section",children:P&&Re.jsxs("div",{className:"hero-card",children:[Re.jsx("h1",{className:"hero-title",children:"Al - Farsia"}),Re.jsxs("div",{className:"hero-body",children:[Re.jsx("p",{children:"Barely a couple of kilometres apart, the Palestinian village of Al Farsiya Nabaa Al-Ghazzal and the Israeli settlement of Shadmot Mehola face two starkly different everyday realities."}),Re.jsx("p",{children:"By examining the disparity in access to solar energy use and production, The Occupation of the Sun narrates how Palestinians' efforts for energy self-reliance are suppressed by industrial projects supporting Israeli settlements, funded by international stakeholders. This project reveals only a part of the complex and deeply rooted systems of oppression and apartheid that characterise Israel's occupation of Palestine."}),Re.jsx("p",{children:"The destruction of these Palestinian communities livelihoods occurs through economic, infrastructural, and outwardly violent actions by settlers and military forces. Yet, the indigenous resilience remains unbroken, as Palestinians refuse to abandon their lands."})]})]})}),Re.jsx("div",{"data-scene-id":"farsia-village-2",className:"scroll-section",children:P&&Re.jsxs("div",{className:"hero-card",children:[Re.jsx("h1",{className:"hero-title",children:"Al - Farsia"}),Re.jsxs("div",{className:"hero-body",children:[Re.jsx("p",{children:"In the northern edge of the Jordan Valley, is the village of Al-Farsiya Nabaa Al-Ghazzal."}),Re.jsx("p",{children:"For 47 years, the tiny hamlet, home to roughly 20 members of the Daraghme family, has survived in the Israeli-occupied West Bank. "}),Re.jsx("p",{children:"All of its electricity comes from a handful of solar panels. The community once had a generator, but it was destroyed during one of several settler attacks in April 2024."}),Re.jsx("p",{children:"Al-Farsiya is one of the last remaining Palestinian shepherding communities in the Jordan Valley. Most others have already been displaced. The Daraghme family counts a few hundred sheep and a small strip of barley fields, an economy steadily strangled by nearby settlers who block access to grazing land and routinely damage crops by running their own flocks through the fields. Tubas, the closest Palestinian town, used to be a half-hour drive away; now, with the Israeli militarys closure of the Al-Hamra checkpoint for nearly two years, every trip requires a multi-hour detour."})]})]})}),Re.jsx("div",{"data-scene-id":"farsia-video",className:"scroll-section",children:P&&Re.jsxs("div",{className:"hero-card-video",children:[Re.jsx("h1",{className:"hero-title",children:"Life in Al-Farsia"}),Re.jsx("div",{className:"hero-body",children:Re.jsxs("div",{className:"video-container",children:[Re.jsxs("video",{ref:we,className:"scene-video",controls:!0,playsInline:!0,preload:"metadata",onPlay:Be,onPause:Ke,children:[Re.jsx("source",{src:"/assets/videos/Naama-video.mp4",type:"video/mp4"}),"Your browser does not support the video tag."]}),!J&&Re.jsx("button",{className:"video-play-button",onClick:Ze,"aria-label":"Play video",children:Re.jsx("svg",{viewBox:"0 0 24 24",fill:"white",xmlns:"http://www.w3.org/2000/svg",children:Re.jsx("path",{d:"M8 5v14l11-7z"})})})]})})]})}),Re.jsx("div",{"data-scene-id":"rotem",className:"scroll-section",children:P&&Re.jsxs("div",{className:"hero-card",children:[Re.jsx("h1",{className:"hero-title",children:"Al - Farsia"}),Re.jsxs("div",{className:"hero-body",children:[Re.jsx("p",{children:"Across Area C, which makes up more than 60 per cent of the West Bank and is under full Israeli military control, solar power is often the only available source of electricity for Palestinian herding communities -- like Al-Farsiya. Israel has refused to connect these communities to the grid, despite its obligation under international humanitarian law to provide basic services to the population under occupation."}),Re.jsx("p",{children:"Al-Farsiyas solar panels were installed by Comet-ME, an Israeli-Palestinian NGO that provides basic water and energy infrastructure to vulnerable villages. But these installations are frequent targets."}),Re.jsx("p",{children:"There's the settlers, and theres the army, said 32-year-old Ahmad Daraghme, the hamlets informal leader. Every other day they come to attack us. In September 2023, nine masked settlers from Rotem settlement assaulted him on his traditional grazing lands, breaking his hand with an iron bar, leaving him in a cast for weeks; Israeli police declined to investigate."}),Re.jsx("p",{children:"The violence escalated in April 2024, when dozens of settlers stormed Al-Farsiya at night, attacking residents, burning a car and smashing nearly every solar panel. Police again refused to open a case."}),Re.jsx("p",{children:"Today, the shattered panels serve as makeshift fencing around the homes."})]})]})}),Re.jsx("div",{"data-scene-id":"rotem-video",className:"scroll-section",children:P&&Re.jsxs("div",{className:"hero-card-video",children:[Re.jsx("h1",{className:"hero-title",children:"Al-Farsia Energy"}),Re.jsx("div",{className:"hero-body",children:Re.jsxs("div",{className:"video-container",children:[Re.jsxs("video",{ref:we,className:"scene-video",controls:!0,playsInline:!0,preload:"metadata",onPlay:Be,onPause:Ke,children:[Re.jsx("source",{src:"/assets/videos/Naama-video.mp4",type:"video/mp4"}),"Your browser does not support the video tag."]}),!J&&Re.jsx("button",{className:"video-play-button",onClick:Ze,"aria-label":"Play video",children:Re.jsx("svg",{viewBox:"0 0 24 24",fill:"white",xmlns:"http://www.w3.org/2000/svg",children:Re.jsx("path",{d:"M8 5v14l11-7z"})})})]})})]})}),Re.jsx("div",{"data-scene-id":"settlements",className:"scroll-section",children:P&&Re.jsxs("div",{className:"hero-card",children:[Re.jsx("h1",{className:"hero-title",children:"Shadmot Mehola Settlement"}),Re.jsxs("div",{className:"hero-body",children:[Re.jsx("p",{children:"Israel has set ambitious targets to expand its solar energy capacity by 2030. The government aims to generate 30% of the nation's electricity from renewable sources by that year, with solar energy playing a central role. To achieve this goal, Israel plans to increase its installed solar capacity to approximately 17 gigawatts (GW) by 2030. This expansion will involve the development of large-scale solar farms, integration of energy storage solutions, and the promotion of rooftop solar installations across the country."}),Re.jsx("p",{children:"The irony is impossible to miss: just a few dozen meters away, Israel has laid water pipes and an electricity line, but only to serve the nearby settlements. While Israel promotes its green energy initiatives and environmental policies, it systematically exploits Palestinian land, water, and natural resources."})]})]})}),Re.jsx("div",{"data-scene-id":"shdemot-mehola",className:"scroll-section",children:P&&Re.jsxs("div",{className:"hero-card",children:[Re.jsx("h1",{className:"hero-title",children:"Shadmot Mehola Settlement"}),Re.jsxs("div",{className:"hero-body",children:[Re.jsx("p",{children:"The rapid expansion of solar energy in the occupied West Bank has become a tool of colonisation, land seizure, and resource extraction, packaged as green development. This greenwashing masks the systematic transfer of  Palestinian land and resources to Israeli and international corporations through lucrative renewable energy investments."}),Re.jsx("p",{children:"Settlements are increasingly powered by large, internationally funded solar farms, while Palestinian communities in the same areas struggle simply to keep the lights on. Small, improvised systems are routinely demolished or vandalised by settlers or the military.  The result is two starkly different energy realities in one territory  what some call Energy apartheid."})]})]})}),Re.jsx("div",{"data-scene-id":"shdemot-mehola-zoom",className:"scroll-section",children:P&&Re.jsxs("div",{className:"hero-card",children:[Re.jsx("h1",{className:"hero-title",children:"Shadmot Mehola Settlement"}),Re.jsxs("div",{className:"hero-body",children:[Re.jsx("p",{children:"Just a 10-minute drive from Al-Farsiya, set in a parallel, luxurious, dystopian reality, is the settlement of Shadmot Mehola. While Al-Farsiya struggles to keep a few fragile solar panels standing, international companies are profiting from the Israeli settlements around it. "}),Re.jsx("p",{children:"Founded in 1979 as part of a broader effort to create Israeli military infrastructure along the Jordanian border, Shadmot Mehola became a civilian settlement in 1984 and is now home to roughly 650 residents  farmers, teachers, lawyers and other professionals. Four soldiers guard the settlements large electric gate. Beyond the fence, the Jordan Valleys desert topography seems to disappear: flourishing - albeit foreign - trees line the sidewalks, manicured lawns surround neat, tiled-roofed houses, and even the air seems clearer inside the enclosure."})]})]})}),Re.jsx("div",{"data-scene-id":"shdemot-mehola-zoom-2",className:"scroll-section",children:P&&Re.jsxs("div",{className:"hero-card",children:[Re.jsx("h1",{className:"hero-title",children:"Shadmot Mehola Settlement"}),Re.jsx("div",{className:"hero-body",children:Re.jsx("p",{children:"Noam Bigon, the settlements administrator, welcomed us into his air-conditioned office, offering tea and coffee in front of a large map of the settlement. He traced the locations of synagogues, community centers, schools, swimming pools, and a wide zoned area for 120 prefabricated housing units  single-family homes that, he said proudly, could be assembled in just two weeks. Families from all over the country want to live here, he said. Theres a calm environment."})})]})}),Re.jsx("div",{"data-scene-id":"shdemot-mehola-video",className:"scroll-section",children:P&&Re.jsxs("div",{className:"hero-card-video",children:[Re.jsx("h1",{className:"hero-title",children:"Shadmot Mehola Settlement"}),Re.jsx("div",{className:"hero-body",children:Re.jsxs("div",{className:"video-container",children:[Re.jsxs("video",{ref:we,className:"scene-video",controls:!0,playsInline:!0,preload:"metadata",onPlay:Be,onPause:Ke,children:[Re.jsx("source",{src:"/assets/videos/Shdemot-video.mp4",type:"video/mp4"}),"Your browser does not support the video tag."]}),!J&&Re.jsx("button",{className:"video-play-button",onClick:Ze,"aria-label":"Play video",children:Re.jsx("svg",{viewBox:"0 0 24 24",fill:"white",xmlns:"http://www.w3.org/2000/svg",children:Re.jsx("path",{d:"M8 5v14l11-7z"})})})]})})]})}),Re.jsx("div",{"data-scene-id":"shdemot-mehola-out",className:"scroll-section",children:P&&Re.jsxs("div",{className:"hero-card",children:[Re.jsx("h1",{className:"hero-title",children:"Shadmot Mehola Solar Field"}),Re.jsxs("div",{className:"hero-body",children:[Re.jsx("p",{children:"The dirt track leading out of Al-Farsiya gives way to a smooth, paved route that rises toward a half-kilometer stretch of gleaming solar panels. These panels, Bigon explained, are connected directly to the Israel Electric Corporation (IEC), the national grid."}),Re.jsx("p",{children:"Sliding his finger toward the road we had driven on, Bigon pointed to the Shadmot Mehola Solar Field. Built in 2016, the installation covered more than 50,000 square meters and produced five megawatts of electricity, financed by a 40-million-shekel private Israeli investment. The land beneath the solar field had been taken in 1997 from the Palestinian Tubas governorate and transferred to the settlement through the World Zionist Organisation."})]})]})}),Re.jsx("div",{"data-scene-id":"shdemot-mehola-solar-field",className:"scroll-section",children:P&&Re.jsxs("div",{className:"hero-card",children:[Re.jsx("h1",{className:"hero-title",children:"Shadmot Mehola Solar Field"}),Re.jsxs("div",{className:"hero-body",children:[Re.jsx("p",{children:"A newer project was also underway. In 2023, the Civil Administration outlined plans for a solar gate that would encircle the entire settlement. We are doing an innovative project, Bigon explained. The settlement's gate itself will be made out of solar panels. It will produce its own security lighting. Come back in two years, and you will see."}),Re.jsx("p",{children:"The solar field operated under a special arrangement approved by the Ministry of Energy and the Electricity Authority for entrepreneurs in the occupied West Bank. Through this scheme, the Israeli state guaranteed it would buy electricity from the field for at least 20 years at an unusually high rate of NIS 0.510.54 (.16 -.17 USD) per kilowatt."}),Re.jsx("p",{children:"When asked if the residents of Shadmot Mehola cared about the environmental significance of the panels, Bigon emphasized that, above all, they were a source of profit for the community. On the panels, you can draw a dollar sign, he said. That is their significance."})]})]})}),Re.jsx("div",{"data-scene-id":"shdemot-mehola-solar-video",className:"scroll-section",children:P&&Re.jsxs("div",{className:"hero-card-video",children:[Re.jsx("h1",{className:"hero-title",children:"Shadmot Mehola Solar Field"}),Re.jsx("div",{className:"hero-body",children:Re.jsxs("div",{className:"video-container",children:[Re.jsxs("video",{ref:we,className:"scene-video",controls:!0,playsInline:!0,preload:"metadata",onPlay:Be,onPause:Ke,children:[Re.jsx("source",{src:"/assets/videos/Shdemot-solar-video.mp4",type:"video/mp4"}),"Your browser does not support the video tag."]}),!J&&Re.jsx("button",{className:"video-play-button",onClick:Ze,"aria-label":"Play video",children:Re.jsx("svg",{viewBox:"0 0 24 24",fill:"white",xmlns:"http://www.w3.org/2000/svg",children:Re.jsx("path",{d:"M8 5v14l11-7z"})})})]})})]})}),Re.jsx("div",{"data-scene-id":"settlements-2",className:"scroll-section",children:P&&Re.jsxs("div",{className:"hero-card",children:[Re.jsx("h1",{className:"hero-title",children:"Shadmot Mehola & Al-Farsiya"}),Re.jsxs("div",{className:"hero-body",children:[Re.jsx("p",{children:"The relationship between Shadmot Mehola and Al-Farsiya runs far deeper than energy disparity and land seizure. According to evidence collected by the human rights group Jordan Valley Activists (JVA), settlers from Shadmot Mehola have for years been involved in violent attacks targeting Al-Farsiya."}),Re.jsx("p",{children:"In September 2023, the settlers who broke Ahmads hand with an iron bar came from Shadmot Mehola. Among them were the Rosenberg brothers  the grandsons of the rabbi who founded the settlements religious school. The settlements security coordinator watched the attack without intervening."}),Re.jsx("p",{children:"On June 9, 2025 two settlers walked down from Shadmot Mehola to begin constructing a 150-meter fence just two meters away from Al-Farsiyas homes, cutting off the village from its remaining land."})]})]})}),Re.jsx("div",{"data-scene-id":"sub-intro-2",className:"scroll-section",children:P&&Re.jsxs("div",{className:"hero-card",children:[Re.jsx("h1",{className:"hero-title",children:"Shadmot Mehola & Al-Farsiya"}),Re.jsx("div",{className:"hero-body",children:Re.jsx("p",{children:"The brutal violence inflicted on Ahmad and his family is not separate from the settlements glossy green energy projects. They are two sides of the same effort: a system designed to remove Palestinian communities from the Jordan Valley and replace them with Israeli settlers. The men who engineered the solar panels and the men who attacked Ahmad live in the same houses, and work towards the same end."})})]})}),Re.jsx("div",{"data-scene-id":"naama-nueima",className:"scroll-section",children:P&&Re.jsxs("div",{className:"hero-card",children:[Re.jsx("h1",{className:"hero-title",children:"Na'ama Settlement"}),Re.jsx("div",{className:"hero-body",children:Re.jsx("p",{children:"The Israeli settlement of Na'ama was established in 1982 in the Jordan Valley, occupied West Bank.Na'ama was established on land confiscated from the Palestinian village of An Nuweima. According to ARIJs GIS Unit (2011), the Israeli government seized 5,048 dunums  roughly 10.4% of the villages total area  to build what was then called Naomi."})})]})}),Re.jsx("div",{"data-scene-id":"naama",className:"scroll-section",children:P&&Re.jsxs("div",{className:"hero-card",children:[Re.jsx("h1",{className:"hero-title",children:"Na'ama Settlement"}),Re.jsxs("div",{className:"hero-body",children:[Re.jsx("p",{children:"As of 2022, Naamas population stood at 247 residents, following a communal secular lifestyle. For several years, the settlement was formally renamed Na'omi before the original name, Na'ama, was reinstated. "}),Re.jsx("p",{children:"The name Na'ama is an acronym for Hebrew Youth Settling the West Bank. The residents of Naama are mainly engaged in agriculture, growing dates, green herbs, orchards, and vegetables. The agriculture production exports goods both locally and internationally."})]})]})})]})]})}function Sw(){return Re.jsxs("div",{className:"content",children:[Re.jsx("h1",{children:"About"}),Re.jsx("p",{children:"This project investigates the energy industry in the Israeli-occupied West Bank."})]})}function Mw(){return Re.jsx(K0,{children:Re.jsx(ww,{children:Re.jsxs(P0,{children:[Re.jsx(km,{path:"/",element:Re.jsx(j_,{})}),Re.jsx(km,{path:"/about",element:Re.jsx(Sw,{})}),Re.jsx(km,{path:"*",element:Re.jsx(j_,{})})]})})})}Ny.createRoot(document.getElementById("root")).render(Re.jsx(Mw,{}));
